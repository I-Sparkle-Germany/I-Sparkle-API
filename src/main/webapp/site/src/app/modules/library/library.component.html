<div class="library notice-bg-bg">
  <div fxLayout="column" fxLayout.gt-sm="row">
    <div class="content-block dark-theme library__header primary-bg"
         fxFlex.gt-sm="33">
      <p class="info-block center">
        Explore suggested WISE curricula for the given grade levels or search for specific units that address your needs.
      </p>
      <div class="library__filter">
        <div fxLayout="row" fxLayoutAlign="center center">
          <app-search-bar [placeholderText]="'Keyword search'"
                          [value]="searchValue"
                          (update)="searchUpdated($event)"
                          [disable]="searchDisabled"
                          fxFlex>
          </app-search-bar>
          <button class="library__filter-toggle"
                  mat-icon-button
                  (click)="showFilters = !showFilters">
            <mat-icon matBadge="+"
                      matBadgeDescription="Filters applied"
                      matBadgeOverlap="true"
                      matBadgeSize="small"
                      [matBadgeHidden]="!hasFilters()">filter_list</mat-icon>
          </button>
        </div>
      </div>
      <div class="library__filters" [class.expand]="showFilters">
        <div fxLayout="column" fxLayout.md="row wrap">
          <div *ngIf="disciplineOptions.length > 0"
               class="library__filter"
               fxFlex
               fxFlex.xs="100">
            <app-select-menu [options]="disciplineOptions"
                             [placeholderText]="'Discipline'"
                             [value]="disciplineValue"
                             (update)="filterUpdated($event, 'discipline')"
                             [valueProp]="'id'"
                             [viewValueProp]="'name'"
                             [multiple]="true">
            </app-select-menu>
          </div>
          <div *ngIf="dciArrangementOptions.length > 0"
               class="library__filter"
               fxFlex
               fxFlex.xs="100">
            <app-select-menu [options]="dciArrangementOptions"
                             [placeholderText]="'DCI Arrangement'"
                             [value]="dciArrangementValue"
                             (update)="filterUpdated($event, 'dci')"
                             [valueProp]="'id'"
                             [viewValueProp]="'name'"
                             [multiple]="true">
            </app-select-menu>
          </div>
          <div *ngIf="peOptions.length > 0"
               class="library__filter"
               fxFlex
               fxFlex.xs="100">
            <app-select-menu [options]="peOptions"
                             [placeholderText]="'Performance Expectation'"
                             [value]="peValue"
                             (update)="filterUpdated($event, 'pe')"
                             [valueProp]="'id'"
                             [viewValueProp]="'name'"
                             [multiple]="true">
            </app-select-menu>
          </div>
        </div>
      </div>
    </div>
    <div class="library__content content-block"
         fxFlex.gt-sm="67">
      <div *ngIf="searchValue || hasFilters()" class="notice" fxShow fxHide.gt-xs>
        <p>
          Projects found: {{ countVisibleProjects(projects, implementationModelValue) }}.
          <a href="#" (click)="!!reset()">Reset</a>
        </p>
      </div>
      <div fxLayout="row" fxLayoutAlign="start center">
        <div [ngClass]="{ 'active': searchValue || hasFilters() }"
             class="notice notice--inline inactive"
             fxHide
             fxShow.gt-xs>
          Projects found: {{ countVisibleProjects(projects, implementationModelValue) }}.
          <a href="#" (click)="!!reset()">Reset</a>
        </div>
        <span fxFlex fxHide fxShow.gt-xs></span>
        <div fxLayout="row" fxLayoutAlign="start center">
          <app-select-menu [options]="implementationModelOptions"
                           [placeholderText]="'CA NGSS Implementation Model'"
                           [value]="implementationModelValue"
                           (update)="implementationModelUpdated($event)"
                           [valueProp]="'id'"
                           [viewValueProp]="'name'">
          </app-select-menu>
          <button mat-button
                  mat-icon-button
                  color="primary"
                  aria-label="Implementation model select explanation"
                  matTooltip="California has defined two NGSS course arrangements for grades 6-8. Select one to see WISE projects organized by grade level for that implementation model."
                  matTooltipPosition="after">
            <mat-icon> info </mat-icon>
          </button>
        </div>
      </div>
      <ng-container id="libraryGroups" *ngFor="let group of libraryGroups">
        <mat-accordion class="library__groups"
                       multi="true"
                       *ngIf="implementationModelValue === group.id">
          <ng-container *ngFor="let child of group.children; let i = index">
            <mat-expansion-panel *ngIf="child.type === 'group'"
                                 class="library-group"
                                 (opened)="expandedGroups[child.id] = true"
                                 (closed)="expandedGroups[child.id] = false"
                                 [expanded]="expandedGroups[child.id] && countVisibleProjects(child.children, implementationModelValue) > 0"
                                 [disabled]="countVisibleProjects(child.children, implementationModelValue) < 1">
              <mat-expansion-panel-header class="mat-expansion-panel-header--lg">
                <div fxLayout="column" class="library-group__title">
                  <div>{{ child.name }}</div>
                  <div class="mat-caption">
                    {{ countVisibleProjects(child.children, implementationModelValue) }} project(s)
                  </div>
                </div>
                <app-library-group-thumbs [group]="child"
                                          [ngClass]="{ 'hide': expandedGroups[child.id] }">
                </app-library-group-thumbs>
              </mat-expansion-panel-header>
              <div fxLayout="row wrap">
                <ng-container *ngFor="let project of child.children">
                  <div *ngIf="project.visible"
                       fxFlex="50"
                       fxFlex.gt-xs="33">
                    <app-library-project [project]="project" ></app-library-project>
                  </div>
                </ng-container>
              </div>
            </mat-expansion-panel>
          </ng-container>
        </mat-accordion>
      </ng-container>
    </div>
  </div>
</div>
