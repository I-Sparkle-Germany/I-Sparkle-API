<div class="library">
  <div class="content-block dark-theme primary-bg library__header">
    <h4 class="info-block center">
     Explore suggested WISE curricula for the grade levels below or search for specific units that address your needs.
    </h4>
    <div fxLayout="row wrap" fxLayout.xs="column">
      <div *ngIf="disciplineOptions.length > 0" class="library-filter" fxFlex
           fxFlex.xs="100%" >
        <app-select-menu [options]="disciplineOptions"
                         [placeholderText]="'Discipline'"
                         [value]="disciplineValue"
                         (update)="filterUpdated($event, 'discipline')"
                         [valueProp]="'id'"
                         [viewValueProp]="'name'"
                         [multiple]="true">
        </app-select-menu>
      </div>
      <div *ngIf="dciArrangementOptions.length > 0" class="library-filter"
           fxFlex fxFlex.xs="100%">
        <app-select-menu [options]="dciArrangementOptions"
                         [placeholderText]="'DCI Arrangement'"
                         [value]="dciArrangementValue"
                         (update)="filterUpdated($event, 'dci')"
                         [valueProp]="'id'"
                         [viewValueProp]="'name'"
                         [multiple]="true">
        </app-select-menu>
      </div>
      <div *ngIf="peOptions.length > 0" class="library-filter" fxFlex
           fxFlex.xs="100%">
        <app-select-menu [options]="peOptions"
                         [placeholderText]="'Performance Expectation'"
                         [value]="peValue"
                         (update)="filterUpdated($event, 'pe')"
                         [valueProp]="'id'"
                         [viewValueProp]="'name'"
                         [multiple]="true">
        </app-select-menu>
      </div>
      <div class="library-filter" fxFlex fxFlex.xs="100%">
        <app-search-bar [placeholderText]="'Keyword search'"
                        [value]="searchValue"
                        (update)="searchUpdated($event)">
        </app-search-bar>
      </div>
    </div>
  </div>
  <div *ngIf="searchValue || hasFilters()" class="notice" fxShow fxHide.gt-xs>
    <p>
      Projects found: {{ countVisibleProjects(projects, implementationModelValue) }}.
      <a href="#" (click)="!!reset()">Reset</a>
    </p>
  </div>
  <div fxLayout="row" fxLayoutAlign="start center">
    <div fxLayout="row" fxLayoutAlign="start center">
      <app-select-menu [options]="implementationModelOptions"
                       [placeholderText]="'CA NGSS Implementation Model'"
                       [value]="implementationModelValue"
                       (update)="implementationModelUpdated($event)"
                       [valueProp]="'id'"
                       [viewValueProp]="'name'">
      </app-select-menu>
      <button mat-button
              mat-icon-button
              color="primary"
              aria-label="Implementation model select explanation"
              matTooltip="California has defined two NGSS course arrangements for grades 6-8. Select one to see WISE projects organized by grade level for that implementation model."
              matTooltipPosition="after">
        <mat-icon> info </mat-icon>
      </button>
    </div>
    <span fxFlex></span>
    <div [ngClass]="{ 'active': searchValue || hasFilters() }"
         class="notice notice--inline inactive"
         fxHide
         fxShow.gt-xs>
      Projects found: {{ countVisibleProjects(projects, implementationModelValue) }}.
      <a href="#" (click)="!!reset()">Reset</a>
    </div>
  </div>
  <ng-container id="libraryGroups" *ngFor="let group of libraryGroups">
    <mat-accordion class="library__groups"
                   multi="true"
                   *ngIf="implementationModelValue === group.id">
      <ng-container *ngFor="let child of group.children; let i = index">
        <mat-expansion-panel *ngIf="child.type === 'group'"
                             class="library-group"
                             (opened)="expandedGroups[child.id] = true"
                             (closed)="expandedGroups[child.id] = false"
                             [expanded]="expandedGroups[child.id] && countVisibleProjects(child.children, implementationModelValue) > 0"
                             [disabled]="countVisibleProjects(child.children, implementationModelValue) < 1">
          <mat-expansion-panel-header class="mat-expansion-panel-header--lg">
            <div fxLayout="column" class="library-group__title">
              <div>{{ child.name }}</div>
              <div class="mat-caption">
                {{ countVisibleProjects(child.children, implementationModelValue) }} project(s)
              </div>
            </div>
            <app-library-group-thumbs [group]="child"
                                      [ngClass]="{ 'hide': expandedGroups[child.id] }">
            </app-library-group-thumbs>
          </mat-expansion-panel-header>
          <div fxLayout="row wrap">
            <ng-container *ngFor="let project of child.children">
              <div *ngIf="project.visible"
                   fxFlex="100"
                   fxFlex.sm="50"
                   fxFlex.md="33.33"
                   fxFlex.lg="25">
                <app-library-project [project]="project" ></app-library-project>
              </div>
            </ng-container>
          </div>
        </mat-expansion-panel>
      </ng-container>
    </mat-accordion>
  </ng-container>
  <div class="library__links">
    <h2 class="accent-1 center"
        fxLayout="row"
        fxLayout.xs="column"
        fxLayoutGap="16px"
        fxLayoutAlign="center center"
        fxLayoutWrap>
      <span>Ready to try WISE in the Classroom?</span>
      <a mat-raised-button color="accent" routerLink="/join">
        Sign up for free!
      </a>
    </h2>
  </div>
</div>
