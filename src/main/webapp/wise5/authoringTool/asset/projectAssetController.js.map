{"version":3,"sources":["projectAssetController.es6"],"names":[],"mappings":"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","file":"projectAssetController.js","sourcesContent":["'use strict';\n\nclass ProjectAssetController {\n\n    constructor($filter, $mdDialog, $state, $stateParams, $scope, $timeout, $translate, ProjectAssetService) {\n        this.$filter = $filter;\n        this.$mdDialog = $mdDialog;\n        this.$state = $state;\n        this.$stateParams = $stateParams;\n        this.$scope = $scope;\n        this.$timeout = $timeout;\n        this.$translate = $translate;\n        this.projectId = this.$stateParams.projectId;\n        this.ProjectAssetService = ProjectAssetService;\n        this.projectAssets = ProjectAssetService.projectAssets;\n        this.projectAssetTotalSizeMax = ProjectAssetService.projectAssetTotalSizeMax;\n        this.projectAssetUsagePercentage = ProjectAssetService.projectAssetUsagePercentage;\n\n\n        this.assetSortBy = \"aToZ\";  // initially sort assets alphabetically\n        this.assetMessage = \"\";\n\n        this.$scope.$watch(\n            () => {\n                return this.projectAssets;\n            },\n            () => {\n                this.projectAssetUsagePercentage = this.projectAssets.totalFileSize / this.projectAssetTotalSizeMax * 100;\n                this.sortAssets(this.assetSortBy);  // make sure the assets are sorted by current sort field\n            }\n        );\n\n        // When user changes sort assets by\n        this.$scope.$watch(\n            () => {\n                return this.assetSortBy;\n            },\n            () => {\n                this.sortAssets(this.assetSortBy);\n            }\n        );\n    }\n\n    sortAssets(sortBy) {\n        if (sortBy === \"aToZ\") {\n            this.projectAssets.files.sort(this.sortAssetsAToZ);\n        } else if (sortBy === \"zToA\") {\n            let files = this.projectAssets.files;\n            this.projectAssets.files = files.sort(this.sortAssetsAToZ).reverse();\n        } else if (sortBy === \"smallToLarge\") {\n            this.projectAssets.files.sort(this.sortAssetsSmallToLarge);\n        } else if (sortBy === \"largeToSmall\") {\n            let files = this.projectAssets.files;\n            this.projectAssets.files = files.sort(this.sortAssetsSmallToLarge).reverse();\n        }\n    };\n\n    sortAssetsAToZ(a, b) {\n        var aFileName = a.fileName.toLowerCase();\n        var bFileName = b.fileName.toLowerCase();\n        var result = 0;\n\n        if (aFileName < bFileName) {\n            result = -1;\n        } else if (aFileName > bFileName) {\n            result = 1;\n        }\n        return result;\n    };\n\n    sortAssetsSmallToLarge(a, b) {\n        var aFileSize = a.fileSize;\n        var bFileSize = b.fileSize;\n        var result = 0;\n\n        if (aFileSize < bFileSize) {\n            result = -1;\n        } else if (aFileSize > bFileSize) {\n            result = 1;\n        }\n        return result;\n    }\n\n    deleteAsset(assetItem) {\n        this.ProjectAssetService.deleteAssetItem(assetItem).then((newProjectAssets) => {\n            this.projectAssets = this.ProjectAssetService.projectAssets;\n        });\n    }\n\n    /**\n     * Show asset image in a popup dialog and give author an option to delete it.\n     */\n    viewAsset(assetItem) {\n        this.$translate(['close', 'delete']).then((translations) => {\n            // Append dialog to document.body\n            let assetFullURL = this.ProjectAssetService.getFullAssetItemURL(assetItem);\n            let appropriateFileSize = this.$filter('appropriateSizeText')(assetItem.fileSize);\n            let confirm = this.$mdDialog.confirm()\n                .parent(angular.element(document.body))\n                .title(assetItem.fileName + \" (\" + appropriateFileSize + \")\")\n                .htmlContent(\"<img src=\\\"\" + assetFullURL + \"\\\" />\")\n                .ok(translations.close)\n                .cancel(translations.delete);\n            this.$mdDialog.show(confirm).then(() => {\n                // Author wants to simply close the dialog\n            }, () => {\n                // Author wants to delete this item\n                this.deleteAsset(assetItem);\n            });\n        });\n    }\n\n    uploadAssetItems(files) {\n        this.ProjectAssetService.uploadAssets(files).then((uploadAssetsResults) => {\n            if (uploadAssetsResults && uploadAssetsResults.length > 0) {\n                let uploadedAssetsFilenames = [];\n                for (var r = 0; r < uploadAssetsResults.length; r++) {\n                    let uploadAssetsResult = uploadAssetsResults[r];\n                    uploadedAssetsFilenames.push(uploadAssetsResult.config.file.name);\n                }\n                this.$translate('assetUploadSuccessful', { assetFilenames: uploadedAssetsFilenames.join(\", \") }).then((assetUploadSuccessful) => {\n                    // show a confirmation message for 7 seconds\n                    this.assetMessage = assetUploadSuccessful;\n                    this.$timeout(() => {\n                            this.assetMessage = \"\";\n                    }, 7000);\n                });\n            }\n            this.projectAssets = this.ProjectAssetService.projectAssets;\n        });\n    }\n\n    exit() {\n        this.$state.go('root.project', {projectId: this.projectId});\n    }\n}\n\nProjectAssetController.$inject = ['$filter', '$mdDialog', '$state', '$stateParams', '$scope', '$timeout', '$translate', 'ProjectAssetService'];\n\nexport default ProjectAssetController;"]}