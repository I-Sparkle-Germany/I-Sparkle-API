{"version":3,"sources":["projectAssetController.es6"],"names":["ProjectAssetController","$filter","$mdDialog","$state","$stateParams","$scope","$timeout","$translate","ProjectAssetService","projectId","projectAssets","projectAssetTotalSizeMax","projectAssetUsagePercentage","assetSortBy","assetMessage","$watch","totalFileSize","sortAssets","sortBy","files","sort","sortAssetsAToZ","reverse","sortAssetsSmallToLarge","a","b","aFileName","fileName","toLowerCase","bFileName","result","aFileSize","fileSize","bFileSize","assetItem","deleteAssetItem","then","newProjectAssets","translations","assetFullURL","getFullAssetItemURL","appropriateFileSize","confirm","parent","angular","element","document","body","title","htmlContent","ok","close","cancel","delete","show","deleteAsset","uploadAssets","uploadAssetsResults","length","uploadedAssetsFilenames","r","uploadAssetsResult","push","config","file","name","assetFilenames","join","assetUploadSuccessful","go","$inject"],"mappings":"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","file":"projectAssetController.js","sourcesContent":["'use strict';\n\nclass ProjectAssetController {\n\n    constructor($filter, $mdDialog, $state, $stateParams, $scope, $timeout, $translate, ProjectAssetService) {\n        this.$filter = $filter;\n        this.$mdDialog = $mdDialog;\n        this.$state = $state;\n        this.$stateParams = $stateParams;\n        this.$scope = $scope;\n        this.$timeout = $timeout;\n        this.$translate = $translate;\n        this.projectId = this.$stateParams.projectId;\n        this.ProjectAssetService = ProjectAssetService;\n        this.projectAssets = ProjectAssetService.projectAssets;\n        this.projectAssetTotalSizeMax = ProjectAssetService.projectAssetTotalSizeMax;\n        this.projectAssetUsagePercentage = ProjectAssetService.projectAssetUsagePercentage;\n\n\n        this.assetSortBy = \"aToZ\";  // initially sort assets alphabetically\n        this.assetMessage = \"\";\n\n        this.$scope.$watch(\n            () => {\n                return this.projectAssets;\n            },\n            () => {\n                this.projectAssetUsagePercentage = this.projectAssets.totalFileSize / this.projectAssetTotalSizeMax * 100;\n                this.sortAssets(this.assetSortBy);  // make sure the assets are sorted by current sort field\n            }\n        );\n\n        // When user changes sort assets by\n        this.$scope.$watch(\n            () => {\n                return this.assetSortBy;\n            },\n            () => {\n                this.sortAssets(this.assetSortBy);\n            }\n        );\n    }\n\n    sortAssets(sortBy) {\n        if (sortBy === \"aToZ\") {\n            this.projectAssets.files.sort(this.sortAssetsAToZ);\n        } else if (sortBy === \"zToA\") {\n            let files = this.projectAssets.files;\n            this.projectAssets.files = files.sort(this.sortAssetsAToZ).reverse();\n        } else if (sortBy === \"smallToLarge\") {\n            this.projectAssets.files.sort(this.sortAssetsSmallToLarge);\n        } else if (sortBy === \"largeToSmall\") {\n            let files = this.projectAssets.files;\n            this.projectAssets.files = files.sort(this.sortAssetsSmallToLarge).reverse();\n        }\n    };\n\n    sortAssetsAToZ(a, b) {\n        var aFileName = a.fileName.toLowerCase();\n        var bFileName = b.fileName.toLowerCase();\n        var result = 0;\n\n        if (aFileName < bFileName) {\n            result = -1;\n        } else if (aFileName > bFileName) {\n            result = 1;\n        }\n        return result;\n    };\n\n    sortAssetsSmallToLarge(a, b) {\n        var aFileSize = a.fileSize;\n        var bFileSize = b.fileSize;\n        var result = 0;\n\n        if (aFileSize < bFileSize) {\n            result = -1;\n        } else if (aFileSize > bFileSize) {\n            result = 1;\n        }\n        return result;\n    }\n\n    deleteAsset(assetItem) {\n        this.ProjectAssetService.deleteAssetItem(assetItem).then((newProjectAssets) => {\n            this.projectAssets = this.ProjectAssetService.projectAssets;\n        });\n    }\n\n    /**\n     * Show asset image in a popup dialog and give author an option to delete it.\n     */\n    viewAsset(assetItem) {\n        this.$translate(['close', 'delete']).then((translations) => {\n            // Append dialog to document.body\n            let assetFullURL = this.ProjectAssetService.getFullAssetItemURL(assetItem);\n            let appropriateFileSize = this.$filter('appropriateSizeText')(assetItem.fileSize);\n            let confirm = this.$mdDialog.confirm()\n                .parent(angular.element(document.body))\n                .title(assetItem.fileName + \" (\" + appropriateFileSize + \")\")\n                .htmlContent(\"<img src=\\\"\" + assetFullURL + \"\\\" />\")\n                .ok(translations.close)\n                .cancel(translations.delete);\n            this.$mdDialog.show(confirm).then(() => {\n                // Author wants to simply close the dialog\n            }, () => {\n                // Author wants to delete this item\n                this.deleteAsset(assetItem);\n            });\n        });\n    }\n\n    uploadAssetItems(files) {\n        this.ProjectAssetService.uploadAssets(files).then((uploadAssetsResults) => {\n            if (uploadAssetsResults && uploadAssetsResults.length > 0) {\n                let uploadedAssetsFilenames = [];\n                for (var r = 0; r < uploadAssetsResults.length; r++) {\n                    let uploadAssetsResult = uploadAssetsResults[r];\n                    uploadedAssetsFilenames.push(uploadAssetsResult.config.file.name);\n                }\n                this.$translate('assetUploadSuccessful', { assetFilenames: uploadedAssetsFilenames.join(\", \") }).then((assetUploadSuccessful) => {\n                    // show a confirmation message for 7 seconds\n                    this.assetMessage = assetUploadSuccessful;\n                    this.$timeout(() => {\n                            this.assetMessage = \"\";\n                    }, 7000);\n                });\n            }\n            this.projectAssets = this.ProjectAssetService.projectAssets;\n        });\n    }\n\n    exit() {\n        this.$state.go('root.project', {projectId: this.projectId});\n    }\n}\n\nProjectAssetController.$inject = ['$filter', '$mdDialog', '$state', '$stateParams', '$scope', '$timeout', '$translate', 'ProjectAssetService'];\n\nexport default ProjectAssetController;"]}