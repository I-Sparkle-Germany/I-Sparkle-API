{"version":3,"sources":["authoringToolController.es6"],"names":["AuthoringToolController","$filter","$location","$mdDialog","$scope","$state","$timeout","ConfigService","ProjectService","SessionService","$translate","numberProject","globalMessage","text","time","menuOpen","views","name","label","icon","type","showToolbar","active","logoPath","getThemePath","processUI","$on","event","toState","toParams","fromState","fromParams","confirm","parent","angular","element","document","body","title","content","ariaLabel","ok","cancel","show","then","renewSession","forceLogOut","ev","alert","textContent","targetEvent","setGlobalMessage","clientSaveTime","Date","getTime","params","stateParams","popup","projectId","nodeId","componentId","target","targetObject","templateUrl","controller","controllerAs","$stateParams","clickOutsideToClose","escapeToClose","showStepTools","$current","view","currentViewName","getProjectId","runId","getRunId","projectTitle","getProjectTitle","result","url","mouseMoved","notifyAuthorProjectEnd","wiseBaseURL","getWISEBaseURL","teacherHomePageURL","window","location","message","$inject"],"mappings":"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","file":"authoringToolController.js","sourcesContent":["'use strict';\n\nclass AuthoringToolController {\n\n    constructor($filter,\n                $location,\n                $mdDialog,\n                $scope,\n                $state,\n                $timeout,\n                ConfigService,\n                ProjectService,\n                SessionService) {\n\n        this.$filter = $filter;\n        this.$location = $location;\n        this.$mdDialog = $mdDialog;\n        this.$scope = $scope;\n        this.$state = $state;\n        this.$timeout = $timeout;\n        this.$translate = this.$filter('translate');\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n        this.SessionService = SessionService;\n\n        this.numberProject = true; // TODO: make dynamic or remove\n\n        // the global message that shows up at the top right of the authoring tool\n        this.globalMessage = {\n            text: '',\n            time: ''\n        };\n\n        this.menuOpen = false; // boolean to indicate whether authoring sidenav is open\n\n        // ui-views and their corresponding names, labels, and icons\n        this.views = {\n            'root.project': {\n                name: this.$translate('projectStructure'),\n                label: this.$translate('projectStructure'),\n                icon: 'view_list',\n                type: 'primary',\n                showToolbar: true,\n                active: true\n            },\n            'root.project.notebook': {\n                name: this.$translate('notebookSettings'),\n                label: this.$translate('notebookSettings'),\n                icon: 'book',\n                type: 'primary',\n                showToolbar: true,\n                active: true\n            },\n            'root.project.asset': {\n                name: this.$translate('fileManager'),\n                label: this.$translate('fileManager'),\n                icon: 'photo_library',\n                type: 'primary',\n                showToolbar: true,\n                active: true\n            },\n            'root.project.info': {\n                name: this.$translate('PROJECT_INFO'),\n                label: this.$translate('PROJECT_INFO'),\n                icon: 'info',\n                type: 'primary',\n                showToolbar: true,\n                active: true\n            },\n            'root.main': {\n                name: this.$translate('closeProject'),\n                label: this.$translate('closeProject'),\n                icon: 'close',\n                type: 'secondary',\n                showToolbar: false,\n                active: true\n            },\n            'root.project.node': {\n                name: '',\n                label: '',\n                icon: '',\n                type: 'secondary',\n                showToolbar: true,\n                active: false\n            },\n        };\n\n        this.logoPath = this.ProjectService.getThemePath() + '/images/WISE-logo-ffffff.svg';\n\n        this.processUI();\n\n        // listen for state change events\n        this.$scope.$on('$stateChangeSuccess', (event, toState, toParams, fromState, fromParams) => {\n            // close the menu when the state changes\n            this.menuOpen = false;\n\n            this.processUI();\n        });\n\n        $scope.$on('showSessionWarning', () => {\n\n            // Append dialog to document.body\n            let confirm = this.$mdDialog.confirm()\n                .parent(angular.element(document.body))\n                .title(this.$translate('sessionTimeout'))\n                .content(this.$translate('autoLogoutMessage'))\n                .ariaLabel(this.$translate('sessionTimeout'))\n                .ok(this.$translate('yes'))\n                .cancel(this.$translate('no'));\n            this.$mdDialog.show(confirm).then(() => {\n                this.SessionService.renewSession();\n            }, () => {\n                this.SessionService.forceLogOut();\n            });\n        });\n\n        // alert user when inactive for a long time\n        this.$scope.$on('showRequestLogout', (ev) => {\n\n            let alert = this.$mdDialog.confirm()\n                .parent(angular.element(document.body))\n                .title(this.$translate('serverUpdate'))\n                .textContent(this.$translate('serverUpdateRequestLogoutMessage'))\n                .ariaLabel(this.$translate('serverUpdate'))\n                .targetEvent(ev)\n                .ok(this.$translate('ok'));\n\n            this.$mdDialog.show(alert).then(() => {\n                // do nothing\n            }, () => {\n                // do nothing\n            });\n        });\n\n        /*\n         * Listen for the savingProject event which means the authoring tool\n         * is in the process of saving the project\n         */\n        this.$scope.$on('savingProject', () => {\n            // display the message to show that the project is being saved\n            this.setGlobalMessage(this.$translate('saving'), null);\n        });\n\n        /*\n         * Listen for the projectSaved event which means the project has just\n         * been saved to the server\n         */\n        this.$scope.$on('projectSaved', () => {\n\n            /*\n             * Wait half a second before changing the message to 'Saved' so that\n             * the 'Saving...' message stays up long enough for the author to\n             * see that the project is saving. If we don't perform this wait,\n             * it will always say 'Saved' and authors may wonder whether the\n             * project ever gets saved.\n             */\n            this.$timeout(() => {\n                // get the current time stamp and set the 'Saved' message\n                var clientSaveTime = new Date().getTime();\n                this.setGlobalMessage(this.$translate('SAVED'), clientSaveTime);\n            }, 500);\n        });\n\n        /*\n         * Open the asset chooser to let the author insert an asset into the\n         * specified target\n         */\n        this.$scope.$on('openAssetChooser', (event, params) => {\n            // create the params for opening the asset chooser\n            var stateParams = {};\n            stateParams.popup = params.popup;\n            stateParams.projectId = params.projectId;\n            stateParams.nodeId = params.nodeId;\n            stateParams.componentId = params.componentId;\n            stateParams.target = params.target;\n            stateParams.targetObject = params.targetObject;\n\n            // open the dialog that will display the assets for the user to choose\n            this.$mdDialog.show({\n                templateUrl: 'wise5/authoringTool/asset/asset.html',\n                controller: 'ProjectAssetController',\n                controllerAs: 'projectAssetController',\n                $stateParams: stateParams,\n                clickOutsideToClose: true,\n                escapeToClose: true\n            });\n        });\n\n        /*\n         * Open the asset chooser to let the author insert an WISE Link into the\n         * specified target\n         */\n        this.$scope.$on('openWISELinkChooser', (event, params) => {\n\n            // create the params for opening the WISE Link authoring popup\n            var stateParams = {};\n            stateParams.projectId = params.projectId;\n            stateParams.nodeId = params.nodeId;\n            stateParams.componentId = params.componentId;\n            stateParams.target = params.target;\n\n            // open the WISE Link authoring popup\n            this.$mdDialog.show({\n                templateUrl: 'wise5/authoringTool/wiseLink/wiseLinkAuthoring.html',\n                controller: 'WISELinkAuthoringController',\n                controllerAs: 'wiseLinkAuthoringController',\n                $stateParams: stateParams,\n                clickOutsideToClose: true,\n                escapeToClose: true\n            });\n        });\n    }\n\n    /**\n     * Update UI items based on state, show or hide relevant menus and toolbars\n     * TODO: remove/rework this and put items in their own ui states?\n     */\n    processUI() {\n        // set current view and whether to show the toolbars and step tools\n        this.showStepTools = (this.$state.$current.name === 'root.project' || this.$state.$current.name === 'root.project.node');\n        let view = this.views[this.$state.$current.name];\n\n        if (view) {\n            this.currentViewName = view.name;\n            this.showToolbar = view.showToolbar;\n        } else {\n            this.showToolbar = false;\n            this.currentViewName = '';\n        }\n\n        this.projectId = this.ConfigService.getProjectId();\n        this.runId = this.ConfigService.getRunId();\n\n        if (this.projectId) {\n            this.projectTitle = this.ProjectService.getProjectTitle();\n        } else {\n            this.projectTitle = null;\n        }\n    }\n\n    /**\n     * Check if the author is on the My Projects page in the Authoring Tool\n     * @returns whether the author is on the My Projects page in the Authoring\n     * Tool\n     */\n    isAuthorOnMyProjectsPage() {\n        var result = false;\n\n        if (this.$location.url() == '/') {\n            /*\n             * the author is on the My Projects page. the url looks like\n             * http://wise.berkeley.edu/author#/\n             */\n            result = true;\n        }\n\n        return result;\n    }\n\n    /**\n     * Navigate the user to the My Projects page in the Authoring Tool\n     */\n    goToMyProjects() {\n        // send the user to the My Projects page in the Authoring Tool\n        this.$location.url('/author');\n    }\n\n    /**\n     * Toggle the authoring tool main menu\n     */\n    toggleMenu() {\n        this.menuOpen = !this.menuOpen;\n    }\n\n    /**\n     * The user has moved the mouse so\n     */\n    mouseMoved() {\n        /*\n         * notify the Session Service that the user has moved the mouse\n         * so we can refresh the session\n         */\n        this.SessionService.mouseMoved();\n    }\n\n    exit() {\n        // notify others that we've finished authoring\n        this.ProjectService.notifyAuthorProjectEnd().then(() => {\n            // send the user to the teacher home page\n            let wiseBaseURL = this.ConfigService.getWISEBaseURL();\n            let teacherHomePageURL = wiseBaseURL + '/teacher';\n            window.location = teacherHomePageURL;\n        })\n    }\n\n    /**\n     * Set the global message at the top right\n     * @param message the message to display\n     * @param time the time to display\n     */\n    setGlobalMessage(message, time) {\n        this.globalMessage.text = message;\n        this.globalMessage.time = time;\n    };\n}\n\nAuthoringToolController.$inject = [\n    '$filter',\n    '$location',\n    '$mdDialog',\n    '$scope',\n    '$state',\n    '$timeout',\n    'ConfigService',\n    'ProjectService',\n    'SessionService',\n    'moment'\n];\n\nexport default AuthoringToolController;\n"]}