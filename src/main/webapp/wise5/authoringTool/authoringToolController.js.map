{"version":3,"sources":["authoringToolController.es6"],"names":["AuthoringToolController","$filter","$location","$mdDialog","$scope","$state","$timeout","ConfigService","ProjectService","SessionService","$translate","numberProject","globalMessage","text","time","menuOpen","views","name","label","icon","type","showToolbar","active","logoPath","getThemePath","processUI","$on","event","toState","toParams","fromState","fromParams","confirm","parent","angular","element","document","body","title","content","ariaLabel","ok","cancel","show","then","renewSession","forceLogOut","ev","alert","textContent","targetEvent","setGlobalMessage","clientSaveTime","Date","getTime","params","stateParams","popup","projectId","nodeId","componentId","target","templateUrl","controller","controllerAs","$stateParams","clickOutsideToClose","escapeToClose","showStepTools","$current","view","currentViewName","getProjectId","runId","getRunId","projectTitle","getProjectTitle","result","url","mouseMoved","notifyAuthorProjectEnd","wiseBaseURL","getWISEBaseURL","teacherHomePageURL","window","location","message","$inject"],"mappings":"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","file":"authoringToolController.js","sourcesContent":["'use strict';\r\n\r\nclass AuthoringToolController {\r\n\r\n    constructor($filter,\r\n                $location,\r\n                $mdDialog,\r\n                $scope,\r\n                $state,\r\n                $timeout,\r\n                ConfigService,\r\n                ProjectService,\r\n                SessionService) {\r\n\r\n        this.$filter = $filter;\r\n        this.$location = $location;\r\n        this.$mdDialog = $mdDialog;\r\n        this.$scope = $scope;\r\n        this.$state = $state;\r\n        this.$timeout = $timeout;\r\n        this.$translate = this.$filter('translate');\r\n        this.ConfigService = ConfigService;\r\n        this.ProjectService = ProjectService;\r\n        this.SessionService = SessionService;\r\n\r\n        this.numberProject = true; // TODO: make dynamic or remove\r\n\r\n        // the global message that shows up at the top right of the authoring tool\r\n        this.globalMessage = {\r\n            text: '',\r\n            time: ''\r\n        };\r\n\r\n        this.menuOpen = false; // boolean to indicate whether authoring sidenav is open\r\n\r\n        // ui-views and their corresponding names, labels, and icons\r\n        this.views = {\r\n            'root.project': {\r\n                name: this.$translate('projectStructure'),\r\n                label: this.$translate('projectStructure'),\r\n                icon: 'view_list',\r\n                type: 'primary',\r\n                showToolbar: true,\r\n                active: true\r\n            },\r\n            'root.project.notebook': {\r\n                name: this.$translate('notebookSettings'),\r\n                label: this.$translate('notebookSettings'),\r\n                icon: 'book',\r\n                type: 'primary',\r\n                showToolbar: true,\r\n                active: true\r\n            },\r\n            'root.project.asset': {\r\n                name: this.$translate('fileManager'),\r\n                label: this.$translate('fileManager'),\r\n                icon: 'photo_library',\r\n                type: 'primary',\r\n                showToolbar: true,\r\n                active: true\r\n            },\r\n            'root.main': {\r\n                name: this.$translate('closeProject'),\r\n                label: this.$translate('closeProject'),\r\n                icon: 'close',\r\n                type: 'secondary',\r\n                showToolbar: false,\r\n                active: true\r\n            },\r\n            'root.project.node': {\r\n                name: '',\r\n                label: '',\r\n                icon: '',\r\n                type: 'secondary',\r\n                showToolbar: true,\r\n                active: false\r\n            },\r\n        };\r\n\r\n        this.logoPath = this.ProjectService.getThemePath() + '/images/WISE-logo-ffffff.svg';\r\n\r\n        this.processUI();\r\n\r\n        // listen for state change events\r\n        this.$scope.$on('$stateChangeSuccess', (event, toState, toParams, fromState, fromParams) => {\r\n            // close the menu when the state changes\r\n            this.menuOpen = false;\r\n\r\n            this.processUI();\r\n        });\r\n\r\n        $scope.$on('showSessionWarning', () => {\r\n\r\n            // Append dialog to document.body\r\n            let confirm = this.$mdDialog.confirm()\r\n                .parent(angular.element(document.body))\r\n                .title(this.$translate('sessionTimeout'))\r\n                .content(this.$translate('autoLogoutMessage'))\r\n                .ariaLabel(this.$translate('sessionTimeout'))\r\n                .ok(this.$translate('yes'))\r\n                .cancel(this.$translate('no'));\r\n            this.$mdDialog.show(confirm).then(() => {\r\n                this.SessionService.renewSession();\r\n            }, () => {\r\n                this.SessionService.forceLogOut();\r\n            });\r\n        });\r\n\r\n        // alert user when inactive for a long time\r\n        this.$scope.$on('showRequestLogout', (ev) => {\r\n\r\n            let alert = this.$mdDialog.confirm()\r\n                .parent(angular.element(document.body))\r\n                .title(this.$translate('serverUpdate'))\r\n                .textContent(this.$translate('serverUpdateRequestLogoutMessage'))\r\n                .ariaLabel(this.$translate('serverUpdate'))\r\n                .targetEvent(ev)\r\n                .ok(this.$translate('ok'));\r\n\r\n            this.$mdDialog.show(alert).then(() => {\r\n                // do nothing\r\n            }, () => {\r\n                // do nothing\r\n            });\r\n        });\r\n\r\n        /*\r\n         * Listen for the savingProject event which means the authoring tool\r\n         * is in the process of saving the project\r\n         */\r\n        this.$scope.$on('savingProject', () => {\r\n            // display the message to show that the project is being saved\r\n            this.setGlobalMessage(this.$translate('saving'), null);\r\n        });\r\n\r\n        /*\r\n         * Listen for the projectSaved event which means the project has just\r\n         * been saved to the server\r\n         */\r\n        this.$scope.$on('projectSaved', () => {\r\n\r\n            /*\r\n             * Wait half a second before changing the message to 'Saved' so that\r\n             * the 'Saving...' message stays up long enough for the author to\r\n             * see that the project is saving. If we don't perform this wait,\r\n             * it will always say 'Saved' and authors may wonder whether the\r\n             * project ever gets saved.\r\n             */\r\n            this.$timeout(() => {\r\n                // get the current time stamp and set the 'Saved' message\r\n                var clientSaveTime = new Date().getTime();\r\n                this.setGlobalMessage(this.$translate('SAVED'), clientSaveTime);\r\n            }, 500);\r\n        });\r\n\r\n        /*\r\n         * Open the asset chooser to let the author insert an asset into the\r\n         * specified target\r\n         */\r\n        this.$scope.$on('openAssetChooser', (event, params) => {\r\n            // create the params for opening the asset chooser\r\n            var stateParams = {};\r\n            stateParams.popup = params.popup;\r\n            stateParams.projectId = params.projectId;\r\n            stateParams.nodeId = params.nodeId;\r\n            stateParams.componentId = params.componentId;\r\n            stateParams.target = params.target;\r\n\r\n            // open the dialog that will display the assets for the user to choose\r\n            this.$mdDialog.show({\r\n                templateUrl: 'wise5/authoringTool/asset/asset.html',\r\n                controller: 'ProjectAssetController',\r\n                controllerAs: 'projectAssetController',\r\n                $stateParams: stateParams,\r\n                clickOutsideToClose: true,\r\n                escapeToClose: true\r\n            });\r\n        });\r\n\r\n        /*\r\n         * Open the asset chooser to let the author insert an WISE Link into the\r\n         * specified target\r\n         */\r\n        this.$scope.$on('openWISELinkChooser', (event, params) => {\r\n\r\n            // create the params for opening the WISE Link authoring popup\r\n            var stateParams = {};\r\n            stateParams.projectId = params.projectId;\r\n            stateParams.nodeId = params.nodeId;\r\n            stateParams.componentId = params.componentId;\r\n            stateParams.target = params.target;\r\n\r\n            // open the WISE Link authoring popup\r\n            this.$mdDialog.show({\r\n                templateUrl: 'wise5/authoringTool/wiseLink/wiseLinkAuthoring.html',\r\n                controller: 'WISELinkAuthoringController',\r\n                controllerAs: 'wiseLinkAuthoringController',\r\n                $stateParams: stateParams,\r\n                clickOutsideToClose: true,\r\n                escapeToClose: true\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Update UI items based on state, show or hide relevant menus and toolbars\r\n     * TODO: remove/rework this and put items in their own ui states?\r\n     */\r\n    processUI() {\r\n        // set current view and whether to show the toolbars and step tools\r\n        this.showStepTools = (this.$state.$current.name === 'root.project.node');\r\n        let view = this.views[this.$state.$current.name];\r\n\r\n        if (view) {\r\n            this.currentViewName = view.name;\r\n            this.showToolbar = view.showToolbar;\r\n        } else {\r\n            this.showToolbar = false;\r\n            this.currentViewName = '';\r\n        }\r\n\r\n        this.projectId = this.ConfigService.getProjectId();\r\n        this.runId = this.ConfigService.getRunId();\r\n\r\n        if (this.projectId) {\r\n            this.projectTitle = this.ProjectService.getProjectTitle();\r\n        } else {\r\n            this.projectTitle = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if the author is on the My Projects page in the Authoring Tool\r\n     * @returns whether the author is on the My Projects page in the Authoring\r\n     * Tool\r\n     */\r\n    isAuthorOnMyProjectsPage() {\r\n        var result = false;\r\n\r\n        if (this.$location.url() == '/') {\r\n            /*\r\n             * the author is on the My Projects page. the url looks like\r\n             * http://wise.berkeley.edu/author#/\r\n             */\r\n            result = true;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Navigate the user to the My Projects page in the Authoring Tool\r\n     */\r\n    goToMyProjects() {\r\n        // send the user to the My Projects page in the Authoring Tool\r\n        this.$location.url('/author');\r\n    }\r\n\r\n    /**\r\n     * Toggle the authoring tool main menu\r\n     */\r\n    toggleMenu() {\r\n        this.menuOpen = !this.menuOpen;\r\n    }\r\n\r\n    /**\r\n     * The user has moved the mouse so\r\n     */\r\n    mouseMoved() {\r\n        /*\r\n         * notify the Session Service that the user has moved the mouse\r\n         * so we can refresh the session\r\n         */\r\n        this.SessionService.mouseMoved();\r\n    }\r\n\r\n    exit() {\r\n        // notify others that we've finished authoring\r\n        this.ProjectService.notifyAuthorProjectEnd().then(() => {\r\n            // send the user to the teacher home page\r\n            let wiseBaseURL = this.ConfigService.getWISEBaseURL();\r\n            let teacherHomePageURL = wiseBaseURL + '/teacher';\r\n            window.location = teacherHomePageURL;\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Set the global message at the top right\r\n     * @param message the message to display\r\n     * @param time the time to display\r\n     */\r\n    setGlobalMessage(message, time) {\r\n        this.globalMessage.text = message;\r\n        this.globalMessage.time = time;\r\n    };\r\n}\r\n\r\nAuthoringToolController.$inject = [\r\n    '$filter',\r\n    '$location',\r\n    '$mdDialog',\r\n    '$scope',\r\n    '$state',\r\n    '$timeout',\r\n    'ConfigService',\r\n    'ProjectService',\r\n    'SessionService',\r\n    'moment'\r\n];\r\n\r\nexport default AuthoringToolController;\r\n"]}