{"version":3,"sources":["authoringToolController.es6"],"names":["AuthoringToolController","$filter","$location","$mdDialog","$scope","$timeout","ConfigService","ProjectService","SessionService","$translate","globalMessage","text","time","$on","confirm","parent","angular","element","document","body","title","content","ariaLabel","ok","cancel","show","then","renewSession","forceLogOut","ev","alert","textContent","targetEvent","setGlobalMessage","clientSaveTime","Date","getTime","result","url","mouseMoved","notifyAuthorProjectEnd","wiseBaseURL","getWISEBaseURL","teacherHomePageURL","window","location","message","$inject"],"mappings":"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","file":"authoringToolController.js","sourcesContent":["'use strict';\n\nclass AuthoringToolController {\n\n    constructor($filter,\n                $location,\n                $mdDialog,\n                $scope,\n                $timeout,\n                ConfigService,\n                ProjectService,\n                SessionService) {\n\n        this.$filter = $filter;\n        this.$location = $location;\n        this.$mdDialog = $mdDialog;\n        this.$scope = $scope;\n        this.$timeout = $timeout;\n        this.$translate = this.$filter('translate');\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n        this.SessionService = SessionService;\n\n        // the global message that shows up at the top right of the authoring tool\n        this.globalMessage = {\n            text: '',\n            time: ''\n        };\n\n        $scope.$on('showSessionWarning', () => {\n\n            // Append dialog to document.body\n            let confirm = this.$mdDialog.confirm()\n                .parent(angular.element(document.body))\n                .title(this.$translate('sessionTimeout'))\n                .content(this.$translate('autoLogoutMessage'))\n                .ariaLabel(this.$translate('sessionTimeout'))\n                .ok(this.$translate('yes'))\n                .cancel(this.$translate('no'));\n            this.$mdDialog.show(confirm).then(() => {\n                this.SessionService.renewSession();\n            }, () => {\n                this.SessionService.forceLogOut();\n            });\n        });\n\n        // alert user when inactive for a long time\n        this.$scope.$on('showRequestLogout', (ev) => {\n\n            let alert = this.$mdDialog.confirm()\n                .parent(angular.element(document.body))\n                .title(this.$translate('serverUpdate'))\n                .textContent(this.$translate('serverUpdateRequestLogoutMessage'))\n                .ariaLabel(this.$translate('serverUpdate'))\n                .targetEvent(ev)\n                .ok(this.$translate('ok'));\n\n            this.$mdDialog.show(alert).then(() => {\n                // do nothing\n            }, () => {\n                // do nothing\n            });\n        });\n\n        /*\n         * Listen for the savingProject event which means the authoring tool\n         * is in the process of saving the project\n         */\n        this.$scope.$on('savingProject', () => {\n            // display the message to show that the project is being saved\n            this.setGlobalMessage(this.$translate('saving'), null);\n        });\n\n        /*\n         * Listen for the projectSaved event which means the project has just\n         * been saved to the server\n         */\n        this.$scope.$on('projectSaved', () => {\n\n            /*\n             * Wait half a second before changing the message to 'Saved' so that\n             * the 'Saving...' message stays up long enough for the author to\n             * see that the project is saving. If we don't perform this wait,\n             * it will always say 'Saved' and authors may wonder whether the\n             * project ever gets saved.\n             */\n            this.$timeout(() => {\n                // get the current time stamp and set the 'Saved' message\n                var clientSaveTime = new Date().getTime();\n                this.setGlobalMessage(this.$translate('SAVED'), clientSaveTime);\n            }, 500);\n        });\n    }\n\n    /**\n     * Check if the author is on the My Projects page in the Authoring Tool\n     * @returns whether the author is on the My Projects page in the Authoring\n     * Tool\n     */\n    isAuthorOnMyProjectsPage() {\n        var result = false;\n\n        if (this.$location.url() == '/') {\n            /*\n             * the author is on the My Projects page. the url looks like\n             * http://wise.berkeley.edu/author#/\n             */\n            result = true;\n        }\n\n        return result;\n    }\n\n    /**\n     * Navigate the user to the My Projects page in the Authoring Tool\n     */\n    goToMyProjects() {\n        // send the user to the My Projects page in the Authoring Tool\n        this.$location.url('/author');\n    }\n\n    /**\n     * The user has moved the mouse so\n     */\n    mouseMoved() {\n        /*\n         * notify the Session Service that the user has moved the mouse\n         * so we can refresh the session\n         */\n        this.SessionService.mouseMoved();\n    }\n\n    exit() {\n        // notify others that we've finished authoring\n        this.ProjectService.notifyAuthorProjectEnd().then(() => {\n            // send the user to the teacher home page\n            let wiseBaseURL = this.ConfigService.getWISEBaseURL();\n            let teacherHomePageURL = wiseBaseURL + '/teacher';\n            window.location = teacherHomePageURL;\n        })\n    }\n\n    /**\n     * Set the global message at the top right\n     * @param message the message to display\n     * @param time the time to display\n     */\n    setGlobalMessage(message, time) {\n        this.globalMessage.text = message;\n        this.globalMessage.time = time;\n    };\n}\n\nAuthoringToolController.$inject = [\n    '$filter',\n    '$location',\n    '$mdDialog',\n    '$scope',\n    '$timeout',\n    'ConfigService',\n    'ProjectService',\n    'SessionService',\n    'moment'\n];\n\nexport default AuthoringToolController;\n"]}