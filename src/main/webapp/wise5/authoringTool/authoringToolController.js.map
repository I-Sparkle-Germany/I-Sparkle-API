{"version":3,"sources":["authoringToolController.es6"],"names":["AuthoringToolController","$location","$mdDialog","$scope","$timeout","$translate","ConfigService","ProjectService","SessionService","globalMessage","text","time","$on","then","autoLogoutMessage","confirm","parent","angular","element","document","body","title","content","ariaLabel","ok","cancel","show","renewSession","forceLogOut","ev","translations","alert","serverUpdate","textContent","serverUpdateRequestLogoutMessage","targetEvent","setGlobalMessage","clientSaveTime","Date","getTime","result","url","mouseMoved","notifyAuthorProjectEnd","wiseBaseURL","getWISEBaseURL","teacherHomePageURL","window","location","message","$inject"],"mappings":"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","file":"authoringToolController.js","sourcesContent":["'use strict';\n\nclass AuthoringToolController {\n\n    constructor($location,\n                $mdDialog,\n                $scope,\n                $timeout,\n                $translate,\n                ConfigService,\n                ProjectService,\n                SessionService) {\n\n        this.$location = $location;\n        this.$mdDialog = $mdDialog;\n        this.$scope = $scope;\n        this.$timeout = $timeout;\n        this.$translate = $translate;\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n        this.SessionService = SessionService;\n        \n        // the global message that shows up at the top right of the authoring tool\n        this.globalMessage = {\n            text: '',\n            time: ''\n        };\n\n        $scope.$on('showSessionWarning', () => {\n\n            this.$translate('autoLogoutMessage').then((autoLogoutMessage) => {\n                // Appending dialog to document.body\n                let confirm = this.$mdDialog.confirm()\n                    .parent(angular.element(document.body))\n                    .title('Session Timeout')\n                    .content(autoLogoutMessage)\n                    .ariaLabel('Session Timeout')\n                    .ok('YES')\n                    .cancel('No');\n                this.$mdDialog.show(confirm).then(() => {\n                    this.SessionService.renewSession();\n                }, () => {\n                    this.SessionService.forceLogOut();\n                });\n\n            });\n        });\n\n        // alert user when inactive for a long time\n        this.$scope.$on('showRequestLogout', (ev) => {\n            this.$translate([\"serverUpdate\", \"serverUpdateRequestLogoutMessage\", \"ok\"]).then((translations) => {\n                let alert = this.$mdDialog.confirm()\n                    .parent(angular.element(document.body))\n                    .title(translations.serverUpdate)\n                    .textContent(translations.serverUpdateRequestLogoutMessage)\n                    .ariaLabel(translations.serverUpdate)\n                    .targetEvent(ev)\n                    .ok(translations.ok);\n\n                this.$mdDialog.show(alert).then(() => {\n                    // do nothing\n                }, () => {\n                    // do nothing\n                });\n\n            });\n        });\n        \n        /*\n         * Listen for the savingProject event which means the authoring tool\n         * is in the process of saving the project\n         */\n        this.$scope.$on('savingProject', () => {\n            // display the message to show that the project is being saved\n            this.setGlobalMessage('Saving...', null);\n        });\n        \n        /*\n         * Listen for the projectSaved event which means the project has just\n         * been saved to the server\n         */\n        this.$scope.$on('projectSaved', () => {\n            \n            /*\n             * Wait half a second before changing the message to 'Saved' so that\n             * the 'Saving...' message stays up long enough for the author to\n             * see that the project is saving. If we don't perform this wait,\n             * it will always say 'Saved' and authors may wonder whether the\n             * project ever gets saved.\n             */\n            this.$timeout(() => {\n                // get the current time stamp and set the 'Saved' message\n                var clientSaveTime = new Date().getTime();\n                this.setGlobalMessage('Saved', clientSaveTime);\n            }, 500);\n        });\n    }\n    \n    /**\n     * Check if the author is on the My Projects page in the Authoring Tool\n     * @returns whether the author is on the My Projects page in the Authoring\n     * Tool\n     */\n    isAuthorOnMyProjectsPage() {\n        var result = false;\n        \n        if (this.$location.url() == '/') {\n            /*\n             * the author is on the My Projects page. the url looks like\n             * http://wise.berkeley.edu/author#/\n             */\n            result = true;\n        }\n        \n        return result;\n    }\n    \n    /**\n     * Navigate the user to the My Projects page in the Authoring Tool\n     */\n    goToMyProjects() {\n        // send the user to the My Projects page in the Authoring Tool\n        this.$location.url('/author');\n    }\n    \n    /**\n     * The user has moved the mouse so\n     */\n    mouseMoved() {\n        /*\n         * notify the Session Service that the user has moved the mouse\n         * so we can refresh the session\n         */\n        this.SessionService.mouseMoved();\n    }\n\n    exit() {\n        // notify others that we've finished authoring\n        this.ProjectService.notifyAuthorProjectEnd().then(() => {\n            // send the user to the teacher home page\n            let wiseBaseURL = this.ConfigService.getWISEBaseURL();\n            let teacherHomePageURL = wiseBaseURL + '/teacher';\n            window.location = teacherHomePageURL;\n        })\n    }\n    \n    /**\n     * Set the global message at the top right\n     * @param message the message to display\n     * @param time the time to display\n     */\n    setGlobalMessage(message, time) {\n        this.globalMessage.text = message;\n        this.globalMessage.time = time;\n    };\n}\n\nAuthoringToolController.$inject = [\n    '$location',\n    '$mdDialog',\n    '$scope',\n    '$timeout',\n    '$translate',\n    'ConfigService',\n    'ProjectService',\n    'SessionService',\n    'moment'\n];\n\nexport default AuthoringToolController;\n"]}