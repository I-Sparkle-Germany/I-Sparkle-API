{"version":3,"sources":["authoringToolMainController.es6"],"names":["AuthoringToolMainController","$anchorScroll","$filter","$state","$timeout","ConfigService","ProjectService","$translate","projects","getConfigParam","sharedProjects","showCreateProjectView","projectId","p","length","project","id","sp","sharedProject","getProjectByProjectId","projectName","name","projectRunId","runId","projectInfo","message","answer","confirm","copyProject","then","configURL","window","retrieveConfig","componentElement","$","originalBackgroundColor","css","exportProjectURL","getWISEBaseURL","location","href","getNewProjectTemplate","projectTitle","metadata","title","alert","projectJSONString","angular","toJson","commitMessage","Date","getTime","registerNewProject","go","previewProjectURL","open","wiseBaseURL","teacherHomePageURL","$inject"],"mappings":"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","file":"authoringToolMainController.js","sourcesContent":["'use strict';\n\nclass AuthoringToolMainController {\n\n    constructor($anchorScroll, $filter, $state, $timeout, ConfigService, ProjectService) {\n        this.$anchorScroll = $anchorScroll;\n        this.$filter = $filter;\n        this.$state = $state;\n        this.$timeout = $timeout;\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n\n        this.$translate = this.$filter('translate');\n\n        // get list of projects owned by this user and shared with this\n        this.projects = this.ConfigService.getConfigParam(\"projects\");\n        this.sharedProjects = this.ConfigService.getConfigParam(\"sharedProjects\");\n\n        this.showCreateProjectView = false;\n    }\n\n    /**\n     * Get a project by project id\n     * @param projectId the project id\n     * @return the project object that just contains the name and id and run id\n     * if it is associated with a run\n     */\n    getProjectByProjectId(projectId) {\n\n        // loop through all my projects\n        for (var p = 0; p < this.projects.length; p++) {\n            var project = this.projects[p];\n\n            if (project != null) {\n                if (project.id == projectId) {\n                    // we have found the project we want\n                    return project;\n                }\n            }\n        }\n\n        // loop through all the shared projects\n        for (var sp = 0; sp < this.sharedProjects.length; sp++) {\n            var sharedProject = this.sharedProjects[sp];\n\n            if (sharedProject != null) {\n                if (sharedProject.id == projectId) {\n                    // we have found the project we want\n                    return sharedProject;\n                }\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * Copy a project\n     * @param projectId the project to copy\n     */\n    copyProject(projectId) {\n\n        // get the project info\n        var project = this.getProjectByProjectId(projectId);\n\n        // get the project name\n        var projectName = project.name;\n\n        // get the project run id if any\n        var projectRunId = project.runId;\n\n        // get the project info that we will display in the confirm message\n        var projectInfo = projectId + ' ' + projectName;\n\n        if (projectRunId != null) {\n            // add the run id to the info\n            projectInfo += ' (Run ID: ' + projectRunId + ')';\n        }\n\n        /*\n         * the message that we will use to confirm that the author wants to copy\n         * the project\n         */\n        var message = this.$translate('areYouSureYouWantToCopyThisProject') + '\\n\\n' + projectInfo;\n\n        var answer = confirm(message);\n\n        if (answer) {\n            // the author answered yes they want to copy\n\n            // copy the project\n            this.ProjectService.copyProject(projectId).then((projectId) => {\n\n                // refresh the project list\n                var configURL = window.configURL;\n                this.ConfigService.retrieveConfig(configURL).then(() => {\n                    this.projects = this.ConfigService.getConfigParam(\"projects\");\n\n                    // scroll to the top of the page\n                    this.$anchorScroll('top');\n\n                    // briefly highlight the new project to draw attention to it\n                    this.$timeout(() => {\n\n                        // get the component UI element\n                        let componentElement = $(\"#\" + projectId);\n\n                        // save the original background color\n                        let originalBackgroundColor = componentElement.css(\"backgroundColor\");\n\n                        // highlight the background briefly to draw attention to it\n                        componentElement.css(\"background-color\", \"#FFFF9C\");\n\n                        /*\n                         * Use a timeout before starting to transition back to\n                         * the original background color. For some reason the\n                         * element won't get highlighted in the first place\n                         * unless this timeout is used.\n                         */\n                        this.$timeout(() => {\n                            // slowly fade back to original background color\n                            componentElement.css({\n                                'transition': 'background-color 3s ease-in-out',\n                                'background-color': originalBackgroundColor\n                            });\n\n                            /*\n                             * remove these styling fields after we perform\n                             * the fade otherwise the regular mouseover\n                             * background color change will not work\n                             */\n                            this.$timeout(() => {\n                                componentElement.css({\n                                    'transition': '',\n                                    'background-color': ''\n                                });\n                            }, 3000);\n                        });\n                    });\n                });\n            });\n        }\n    }\n\n    /**\n     * Download a project as a zip file\n     * @param projectId the project id\n     */\n    downloadProject(projectId) {\n        // make a request to download the project as a zip file\n        let exportProjectURL = this.ConfigService.getWISEBaseURL() + \"/project/export/\" + projectId;\n        window.location.href = exportProjectURL;\n    }\n\n    /**\n     * The create new project button was clicked\n     */\n    createNewProjectButtonClicked() {\n        // generate a project template for the new project\n        this.project = this.ProjectService.getNewProjectTemplate();\n\n        // show the view where the author enters the title for the new project\n        this.showCreateProjectView = true;\n    }\n\n    /**\n     * Create a new project\n     */\n    registerNewProject() {\n\n        // get the project title the author has entered\n        var projectTitle = this.project.metadata.title;\n\n        if (projectTitle == null || projectTitle == '') {\n            // the author has not entered a project title\n            alert(this.$translate('pleaseEnterAProjectTitleForYourNewProject'));\n        } else {\n            // the author has entered a project title\n\n            // get the project json string\n            var projectJSONString = angular.toJson(this.project, 4);\n            var commitMessage = this.$translate('projectCreatedOn') + new Date().getTime();\n\n            // create the new project on the server\n            this.ProjectService.registerNewProject(projectJSONString, commitMessage).then((projectId) => {\n                // hide the create project view\n                this.showCreateProjectView = false;\n\n                // open the new project in the authoring tool\n                this.$state.go('root.project', {projectId: projectId});\n            });\n        }\n    }\n\n    /**\n     * Cancel the create new project\n     */\n    cancelRegisterNewProject() {\n        // clear the project template\n        this.project = null;\n\n        // hide the create project view\n        this.showCreateProjectView = false;\n    }\n\n    /**\n     * Open a project in the authoring tool\n     * @param projectId the project id to open\n     */\n    openProject(projectId) {\n        this.$state.go('root.project', {projectId:projectId});\n    }\n\n    /**\n     * Launch the project in preview mode\n     */\n    previewProject(projectId) {\n        let previewProjectURL = this.ConfigService.getWISEBaseURL() + \"/project/\" + projectId;\n        window.open(previewProjectURL);\n    }\n\n    /**\n     * Go to the teacher home\n     */\n    goHome() {\n        // send the user to the teacher home page\n        let wiseBaseURL = this.ConfigService.getWISEBaseURL();\n        let teacherHomePageURL = wiseBaseURL + '/teacher';\n        window.location = teacherHomePageURL;\n    }\n};\n\nAuthoringToolMainController.$inject = [\n    '$anchorScroll',\n    '$filter',\n    '$state',\n    '$timeout',\n    'ConfigService',\n    'ProjectService'\n];\n\nexport default AuthoringToolMainController;\n"]}