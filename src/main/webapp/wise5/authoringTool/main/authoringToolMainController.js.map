{"version":3,"sources":["authoringToolMainController.es6"],"names":["AuthoringToolMainController","$anchorScroll","$filter","$rootScope","$state","$timeout","ConfigService","ProjectService","TeacherDataService","$translate","projects","getConfigParam","sharedProjects","showCreateProjectView","$on","saveEvent","projectId","project","id","sharedProject","getProjectByProjectId","projectName","name","projectInfo","projectRunId","runId","doCopyConfirmMessage","confirm","copyProject","then","retrieveConfig","window","configURL","scrollToTopOfPage","newProjectElement","$","highlightDuration","highlightElement","getNewProjectTemplate","createGroupTitleInput","document","getElementById","focus","componentElement","duration","originalBackgroundColor","css","projectTitle","metadata","title","alert","projectJSONString","angular","toJson","commitMessage","Date","getTime","registerNewProject","go","data","constraints","open","getWISEBaseURL","location","eventName","category","context","nodeId","componentId","componentType","$inject"],"mappings":"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","file":"authoringToolMainController.js","sourcesContent":["'use strict';\n\nclass AuthoringToolMainController {\n\n  constructor(\n      $anchorScroll,\n      $filter,\n      $rootScope,\n      $state,\n      $timeout,\n      ConfigService,\n      ProjectService,\n      TeacherDataService) {\n    this.$anchorScroll = $anchorScroll;\n    this.$filter = $filter;\n    this.$rootScope = $rootScope;\n    this.$state = $state;\n    this.$timeout = $timeout;\n    this.ConfigService = ConfigService;\n    this.ProjectService = ProjectService;\n    this.TeacherDataService = TeacherDataService;\n\n    this.$translate = this.$filter('translate');\n    this.projects = this.ConfigService.getConfigParam('projects');\n    this.sharedProjects = this.ConfigService.getConfigParam('sharedProjects');\n    this.showCreateProjectView = false;\n\n    this.$rootScope.$on('goHome', () => {\n      this.saveEvent('goToTeacherHome', 'Navigation', null, null);\n    });\n    this.$rootScope.$on('logOut', () => {\n      this.saveEvent('logOut', 'Navigation', null, null);\n    });\n  }\n\n  /**\n   * Get my project or shared project by project id\n   * @param projectId the project id\n   * @return the project object that just contains the name and id and run id\n   * if it is associated with a run. If none were found, return null.\n   */\n  getProjectByProjectId(projectId) {\n    for (let project of this.projects) {\n      if (project != null && project.id == projectId) {\n        return project;\n      }\n    }\n\n    for (let sharedProject of this.sharedProjects) {\n      if (sharedProject != null && sharedProject.id == projectId) {\n        return sharedProject;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Copy a project after confirming and highlight it to draw attention to it\n   * @param projectId the project to copy\n   */\n  copyProject(projectId) {\n    let project = this.getProjectByProjectId(projectId);\n    let projectName = project.name;\n\n    // get the project info that we will display in the confirm message\n    let projectInfo = projectId + ' ' + projectName;\n    let projectRunId = project.runId;\n    if (projectRunId != null) {\n      projectInfo += ' (Run ID: ' + projectRunId + ')';\n    }\n\n    /*\n     * the message that we will use to confirm that the author wants to copy\n     * the project\n     */\n    let doCopyConfirmMessage =\n        this.$translate('areYouSureYouWantToCopyThisProject') +\n        '\\n\\n' + projectInfo;\n    if (confirm(doCopyConfirmMessage)) {\n      this.ProjectService.copyProject(projectId).then((projectId) => {\n        this.saveEvent('projectCopied', 'Authoring', null, projectId);\n\n        // refresh the project list and highlight the newly copied project\n        this.ConfigService.retrieveConfig(window.configURL).then(() => {\n          this.projects = this.ConfigService.getConfigParam('projects');\n          this.scrollToTopOfPage();\n          // the timeout is necessary for new element to appear on the page\n          this.$timeout(() => {\n            let newProjectElement = $('#' + projectId);\n            let highlightDuration = 3000;\n            this.highlightElement(newProjectElement, highlightDuration);\n          });\n        });\n      });\n    }\n  }\n\n  createNewProjectButtonClicked() {\n    this.project = this.ProjectService.getNewProjectTemplate();\n    this.showCreateProjectView = true;\n\n    // focus on the newProjectTitle input element\n    this.$timeout(() => {\n      let createGroupTitleInput = document.getElementById('newProjectTitle');\n      if (createGroupTitleInput != null) {\n        createGroupTitleInput.focus();\n      }\n    });\n  }\n\n  /**\n   * Highlights the specified element in yellow for specified duration, used\n   * to draw user's attention to new changes.\n   * @param componentElement DOM element to highlight\n   * @param duration Number how long (in ms) to highlight\n   */\n  highlightElement(componentElement, duration) {\n    let originalBackgroundColor = componentElement.css('backgroundColor');\n    componentElement.css('background-color', '#FFFF9C');\n\n    /*\n     * Use a timeout before starting to transition back to\n     * the original background color. For some reason the\n     * element won't get highlighted in the first place\n     * unless this timeout is used.\n     */\n    this.$timeout(() => {\n      // slowly fade back to original background color\n      componentElement.css({\n        'transition': 'background-color 3s ease-in-out',\n        'background-color': originalBackgroundColor\n      });\n\n      /*\n       * remove these styling fields after we perform\n       * the fade otherwise the regular mouseover\n       * background color change will not work\n       */\n      this.$timeout(() => {\n        componentElement.css({\n          'transition': '',\n          'background-color': ''\n        });\n      }, duration);\n    });\n  }\n\n  /**\n   * Create a new project and open it\n   */\n  registerNewProject() {\n    let projectTitle = this.project.metadata.title;\n    if (projectTitle == null || projectTitle == '') {\n      alert(this.$translate('pleaseEnterAProjectTitleForYourNewProject'));\n    } else {\n      let projectJSONString = angular.toJson(this.project, 4);\n      let commitMessage =\n          this.$translate('projectCreatedOn') + new Date().getTime();\n      this.ProjectService.registerNewProject(projectJSONString, commitMessage)\n          .then((projectId) => {\n        this.showCreateProjectView = false;\n        this.saveEvent('projectCreated', 'Authoring', null, projectId);\n        this.$state.go('root.project', {projectId: projectId});\n      });\n    }\n  }\n\n  cancelRegisterNewProject() {\n    // clear the project template\n    this.project = null;\n    this.showCreateProjectView = false;\n  }\n\n  /**\n   * Open a project in the authoring tool, replacing any current view\n   * @param projectId the project id to open\n   */\n  openProject(projectId) {\n    this.$state.go('root.project', {projectId:projectId});\n  }\n\n  /**\n   * Launch the project in preview mode in a new tab\n   */\n  previewProject(projectId) {\n    let data = { constraints: true };\n    this.saveEvent('projectPreviewed', 'Authoring', data, projectId);\n    window.open(this.ConfigService.getWISEBaseURL() + '/project/' + projectId);\n  }\n\n  /**\n   * Send the user to the teacher home page\n   */\n  goHome() {\n    window.location = this.ConfigService.getWISEBaseURL() + '/teacher';\n  }\n\n  /**\n   * Save an Authoring Tool event\n   * @param eventName the name of the event\n   * @param category the category of the event\n   * example 'Navigation' or 'Authoring'\n   */\n  saveEvent(eventName, category, data, projectId) {\n    let context = 'AuthoringTool';\n    let nodeId = null;\n    let componentId = null;\n    let componentType = null;\n    if (data == null) {\n      data = {};\n    }\n    this.TeacherDataService.saveEvent(context, nodeId, componentId,\n        componentType, category, eventName, data, projectId);\n  }\n\n  scrollToTopOfPage() {\n    this.$anchorScroll('top');\n  }\n};\n\nAuthoringToolMainController.$inject = [\n    '$anchorScroll',\n    '$filter',\n    '$rootScope',\n    '$state',\n    '$timeout',\n    'ConfigService',\n    'ProjectService',\n    'TeacherDataService'\n];\n\nexport default AuthoringToolMainController;\n"]}