<style>
    .componentTypeSelected {
        border-style: solid;
        border-color: black;
    }
</style>
<div style='background-color: white; position: sticky; top: 17px; z-index: 2;'>
    <md-button class='topButton md-raised md-primary md-raised md-primary' ng-click='nodeAuthoringController.close()'
               ng-disabled='nodeAuthoringController.insertComponentMode'>
        <md-icon>home</md-icon>
        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ "home" | translate }}</md-tooltip>
    </md-button>
    <md-button class='topButton md-raised md-primary' ng-click='nodeAuthoringController.addComponentButtonClicked()'
               ng-disabled='nodeAuthoringController.insertComponentMode'
               ng-show='!projectController.isGroupNode(nodeAuthoringController.node.id)'>
        <md-icon>add</md-icon>
        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ "addNewComponent" | translate }}</md-tooltip>
    </md-button>
    <md-button id='importStepButton' class='topButton md-raised md-primary' ng-click='nodeAuthoringController.importButtonClicked()'
            ng-disabled='nodeAuthoringController.insertComponentMode'>
        <md-icon>system_update_alt</md-icon>
        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ "importComponent" | translate }}</md-tooltip>
    </md-button>
    <md-button class='topButton md-raised md-primary' ng-click='nodeAuthoringController.moveButtonClicked()'
            ng-disabled='nodeAuthoringController.getSelectedComponentIds().length == 0 || nodeAuthoringController.insertComponentMode'>
        <md-icon>redo</md-icon>
        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ "move" | translate }}</md-tooltip>
    </md-button>
    <md-button class='topButton md-raised md-primary' ng-click='nodeAuthoringController.copyButtonClicked()'
            ng-disabled='nodeAuthoringController.getSelectedComponentIds().length == 0 || nodeAuthoringController.insertComponentMode'>
        <md-icon>content_copy</md-icon>
        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ "copy" | translate }}</md-tooltip>
    </md-button>
    <md-button class='topButton md-raised md-primary' ng-click='nodeAuthoringController.deleteButtonClicked()'
            ng-disabled='nodeAuthoringController.getSelectedComponentIds().length == 0 || nodeAuthoringController.insertComponentMode'>
        <md-icon>delete</md-icon>
        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ "DELETE" | translate }}</md-tooltip>
    </md-button>
    <md-button class='topButton md-raised md-primary'
               ng-click='nodeAuthoringController.nodeAuthoringViewButtonClicked("editTransitions")'
               ng-disabled='nodeAuthoringController.insertComponentMode'>
        <md-icon>trending_up</md-icon>
        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ "editTransitions" | translate }}</md-tooltip>
    </md-button>
    <md-button class='topButton md-raised md-primary'
               ng-click='nodeAuthoringController.nodeAuthoringViewButtonClicked("editConstraints")'
               ng-disabled='nodeAuthoringController.insertComponentMode'>
        <md-icon>block</md-icon>
        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ "editConstraints" | translate }}</md-tooltip>
    </md-button>
    <md-button class='topButton md-raised md-primary'
               ng-click='nodeAuthoringController.nodeAuthoringViewButtonClicked("editRubric")'
               ng-disabled='nodeAuthoringController.insertComponentMode'>
        <md-icon>message</md-icon>
        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ "editStepRubric" | translate }}</md-tooltip>
    </md-button>
    <md-button class='topButton md-raised md-primary'
               ng-click='nodeAuthoringController.nodeAuthoringViewButtonClicked("advanced")'
               ng-disabled='nodeAuthoringController.insertComponentMode'>
        <md-icon>build</md-icon>
        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ "ADVANCED" | translate }}</md-tooltip>
    </md-button>
    <md-button class='topButton md-raised md-primary'
               ng-click='nodeAuthoringController.nodeAuthoringViewButtonClicked("createBranch")'
               ng-disabled='nodeAuthoringController.insertComponentMode'>
        <md-icon>call_split</md-icon>
        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ "createBranch" | translate }}</md-tooltip>
    </md-button>
    <md-button class='topButton md-raised md-primary' ng-click='nodeAuthoringController.undo()'
            ng-show='!projectController.isGroupNode(nodeAuthoringController.node.id)'
            ng-disabled='nodeAuthoringController.undoStack.length == 0 || nodeAuthoringController.insertComponentMode'>
        <md-icon>undo</md-icon>
        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ "undo" | translate }}</md-tooltip>
    </md-button>
    <div style="float:right">
        <md-button class='topButton md-raised md-primary' ng-click='nodeAuthoringController.previewStep()'
                ng-show='!projectController.isGroupNode(nodeAuthoringController.node.id)'
                ng-disabled='nodeAuthoringController.showEditTransitions || nodeAuthoringController.insertComponentMode'>
            <md-icon>visibility</md-icon>
            <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ "previewStep" | translate }}</md-tooltip>
        </md-button>
        <md-button class='topButton md-raised md-primary' ng-click="nodeAuthoringController.previewStepWithoutConstraints()"
                ng-show='!projectController.isGroupNode(nodeAuthoringController.node.id)'
                ng-disabled='nodeAuthoringController.showEditTransitions || nodeAuthoringController.insertComponentMode'>
            <md-icon>visibility_off</md-icon>
            <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ "previewStepWithoutConstraints" | translate }}</md-tooltip>
        </md-button>
    </div>
    <div ng-show='nodeAuthoringController.showCreateComponent' layout='row' style='margin-left: 10px;'>
        <div layout='row'>
            <h6>{{ 'clickTheNewComponentTypeYouWantToAdd' | translate }}</h6>
            <md-button class='createButton md-raised md-primary'
                       ng-click='nodeAuthoringController.cancelCreateComponentClicked()'
                       aria-label="{{ 'CANCEL' | translate }}"
                       translate="CANCEL">
            </md-button>
        </div>
    </div>
    <div ng-show='nodeAuthoringController.showCreateComponent'>
        <md-grid-list md-cols-xs='1' md-cols-sm='2' md-cols-md='4' md-cols-gt-md='7' md-row-height='30'>
            <md-grid-tile ng-repeat='componentType in nodeAuthoringController.componentTypes'
                          style='outline: none; cursor: pointer;'
                          ng-mousedown='nodeAuthoringController.componentTypeClicked(componentType.componentType)'
                          ng-class='{ componentTypeSelected: componentType.componentType == nodeAuthoringController.selectedComponent }'>
                {{componentType.componentName}}
            </md-grid-tile>
        </md-grid-list>
    </div>
    <div ng-show='nodeAuthoringController.showEditTransitions'>
        <span>{{'transitions' | translate}}:</span>
        <div id="transitions" style="margin-left:40px; margin-bottom:10px; background-color:lightgray; width:700px"
             ng-repeat='(transitionIndex, transition) in nodeAuthoringController.node.transitionLogic.transitions'>
            {{transitionIndex+1}}. {{'transitionToStep' | translate}}:
            <md-select id="stepSelectMenu" md-theme="default" class="node-select md-subhead" ng-model="transition.to"
                       ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                       aria-label="Transitions" style="margin-left:30px; width:600px">
                <md-option ng-repeat="item in projectController.items | toArray | orderBy : 'order'"
                           value="{{ item.$key }}"
                           ng-class="{'node-select-option--group': projectController.isGroupNode(item.$key), 'node-select-option--node': !projectController.isGroupNode(item.$key)}">
                    <span layout="row" layout-align="start center">
                        <span class="node-select__text">{{ projectController.getNodePositionById(item.$key) + ': '}}{{ projectController.getNodeTitleByNodeId(item.$key) }} ({{item.$key}})</span>
                        <node-status-icon node-id="item.$key" custom-class="'node-select__status'"></node-status-icon>
                    </span>
                </md-option>
            </md-select>
            <br/>
            <div ng-repeat='(criteriaIndex, transitionCriteria) in transition.criteria' style="margin:10px; border: .5px dotted gray">
                {{'transitionCriteriaStep' | translate}}:
                <md-select ng-model='transitionCriteria.name'
                           ng-change='nodeAuthoringController.transitionCriteriaNameChanged(transitionCriteria)'
                           class="node-select md-subhead">
                    <md-option ng-repeat='availableTransitionCriteriaName in nodeAuthoringController.transitionCriterias'
                               ng-value='availableTransitionCriteriaName.value'>
                    <span layout="row" layout-align="start center">
                       <span class="node-select__text">{{availableTransitionCriteriaName.text}}</span>
                    </span>
                    </md-option>
                </md-select>
                <div ng-repeat='param in nodeAuthoringController.getTransitionCriteriaParamsByName(transitionCriteria.name)'>
                    {{param.text}}:
                    <div ng-if='param.value == "nodeId"'>
                        <md-select id="nodeIdSelectMenu"
                                   md-theme="default"
                                   class="node-select md-subhead"
                                   ng-model="transitionCriteria.params.nodeId"
                                   ng-change='nodeAuthoringController.transitionCriteriaNodeIdChanged(transitionCriteria)'
                                   aria-label="TransitionCriteriaNode"
                                   style="margin-left:30px; width:600px">
                            <md-option ng-repeat="item in projectController.items | toArray | orderBy : 'order'"
                                       value="{{ item.$key }}"
                                       ng-class="{'node-select-option--group': projectController.isGroupNode(item.$key), 'node-select-option--node': !projectController.isGroupNode(item.$key)}">
                            <span layout="row" layout-align="start center">
                                <span class="node-select__text">{{ projectController.getNodePositionById(item.$key) + ': '}}{{ projectController.getNodeTitleByNodeId(item.$key) }} ({{item.$key}})</span>
                                <node-status-icon node-id="item.$key" custom-class="'node-select__status'"></node-status-icon>
                            </span>
                            </md-option>
                        </md-select>
                    </div>
                    <div ng-if='param.value == "componentId"'>
                        <md-select id="componentIdSelectMenu"
                                   md-theme="default"
                                   class="node-select md-subhead"
                                   ng-model="transitionCriteria.params.componentId"
                                   ng-change='nodeAuthoringController.transitionCriteriaComponentIdChanged(transitionCriteria)'
                                   aria-label="TransitionCriteriaComponent"
                                   style="margin-left:30px; width:600px">
                            <md-option ng-repeat="component in projectController.getComponentsByNodeId(transitionCriteria.params.nodeId)"
                                       value="{{ component.id }}">
                            <span layout="row" layout-align="start center">
                                <span class="node-select__text">{{ 'ID' | translate }}: {{component.id}} | {{ 'TYPE' | translate }}: {{component.type}} | {{ 'PROMPT' | translate }}: {{component.prompt}}</span>
                            </span>
                            </md-option>
                        </md-select>
                    </div>
                    <div ng-if='param.value == "scores"'>
                        <input type='text'
                               ng-model='transitionCriteria.params.scores'
                               ng-model-options='{ debounce: 1000 }'
                               ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                               ng-list=','/>
                    </div>
                    <div ng-if='param.value == "choiceIds" && "radio" == nodeAuthoringController.getChoiceTypeByNodeIdAndComponentId(transitionCriteria.params.nodeId, transitionCriteria.params.componentId)'>
                        <md-select id="radioChoiceIdsSelectMenu"
                                   md-theme="default"
                                   class="node-select md-subhead"
                                   ng-model="transitionCriteria.params.choiceIds"
                                   ng-list
                                   ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                                   aria-label="TransitionCriteriaNode"
                                   style="margin-left:30px; width:600px">
                            <md-optgroup>
                                <md-option ng-value="choice.id" ng-repeat="choice in nodeAuthoringController.getChoicesByNodeIdAndComponentId(transitionCriteria.params.nodeId, transitionCriteria.params.componentId)">{{choice.text}}</md-option>
                            </md-optgroup>
                        </md-select>
                    </div>
                    <div ng-if='param.value == "choiceIds" && "checkbox" == nodeAuthoringController.getChoiceTypeByNodeIdAndComponentId(transitionCriteria.params.nodeId, transitionCriteria.params.componentId)'>
                        <md-select id="checkboxChoiceIdsSelectMenu"
                                   md-theme="default"
                                   class="node-select md-subhead"
                                   ng-model="transitionCriteria.params.choiceIds"
                                   ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                                   aria-label="TransitionCriteriaNode"
                                   style="margin-left:30px; width:600px"
                                   multiple={{nodeAuthoringController.getChoiceTypeByNodeIdAndComponentId(transitionCriteria.params.nodeId, transitionCriteria.params.componentId)}}>
                            <md-optgroup>
                                <md-option ng-value="choice.id" ng-repeat="choice in nodeAuthoringController.getChoicesByNodeIdAndComponentId(transitionCriteria.params.nodeId, transitionCriteria.params.componentId)">{{choice.text}}</md-option>
                            </md-optgroup>
                        </md-select>
                    </div>
                </div>
                <br/>
                <button ng-click='nodeAuthoringController.deleteTransitionCriteria(transition, criteriaIndex)'
                        translate="deleteTransitionCriteria"></button>
            </div>

            <button ng-click="nodeAuthoringController.addNewTransitionCriteria(transition)"
                    translate="addNewTransitionCriteria"></button><br/><br/>
            <button ng-click="nodeAuthoringController.deleteTransition(transition)"
                    translate="deleteTransition"></button>
        </div>


        <button style="margin-left:40px; margin-bottom:10px"
                ng-click='nodeAuthoringController.addNewTransition()' translate="addNewTransition"></button>

        <div ng-show="nodeAuthoringController.node.transitionLogic.transitions.length > 1">
            <div id="howToChooseAmongAvailablePaths">
                <span>{{'howToChooseAmongAvailablePaths' | translate}}:</span>
                <md-select id="stepSelectMenu" md-theme="default" class="node-select md-subhead"
                           ng-model="nodeAuthoringController.node.transitionLogic.howToChooseAmongAvailablePaths"
                           ng-change="nodeAuthoringController.authoringViewNodeChanged()"
                           aria-label="howToChooseAmongAvailablePaths" style="margin-left:30px; width:600px">
                    <md-option ng-repeat="item in nodeAuthoringController.howToChooseAmongAvailablePathsOptions"
                               value="{{ item }}">
                        <span layout="row" layout-align="start center">
                            <span class="node-select__text">{{item}}</span>
                        </span>
                    </md-option>
                </md-select>
            </div>

            <div id="whenToChoosePath">
                <span>{{'whenToChoosePath' | translate}}:</span>
                <md-select id="stepSelectMenu" md-theme="default" class="node-select md-subhead"
                           ng-model="nodeAuthoringController.node.transitionLogic.whenToChoosePath"
                           ng-change="nodeAuthoringController.authoringViewNodeChanged()"
                           aria-label="whenToChoosePath" style="margin-left:30px; width:600px">
                    <md-option ng-repeat="item in nodeAuthoringController.whenToChoosePathOptions"
                               value="{{ item }}">
                        <span layout="row" layout-align="start center">
                            <span class="node-select__text">{{item}}</span>
                        </span>
                    </md-option>
                </md-select>
            </div>

            <div id="canChangePath">
                <span>{{'canChangePath' | translate}}:</span>
                <md-select id="stepSelectMenu" md-theme="default" class="node-select md-subhead"
                           ng-model="nodeAuthoringController.node.transitionLogic.canChangePath"
                           ng-change="nodeAuthoringController.authoringViewNodeChanged()"
                           aria-label="canChangePath" style="margin-left:30px; width:600px">
                    <md-option ng-repeat="item in nodeAuthoringController.canChangePathOptions"
                               ng-value="item">
                        <span layout="row" layout-align="start center">
                            <span class="node-select__text">{{item}}</span>
                        </span>
                    </md-option>
                </md-select>
            </div>

            <div><span translate="maxPathsVisitable"></span> :
                <input ng-model="nodeAuthoringController.node.transitionLogic.maxPathsVisitable"
                       ng-change="nodeAuthoringController.authoringViewNodeChanged()"
                       ng-model-options='{ debounce: 1000 }' size='60' />
            </div>
        </div>

        <br/>
        <button ng-click='nodeAuthoringController.saveTransitions()' translate="SAVE"></button>
    </div>

    <div ng-show='nodeAuthoringController.showConstraints' style='width:700px'>
        {{ 'constraints' | translate }}
        <br/>
        <div ng-repeat='constraint in nodeAuthoringController.node.constraints' style='border: 1px solid black'>
            {{ 'constraint' | translate }}: {{constraint.id}}
            <button ng-click='nodeAuthoringController.deleteConstraint($index)'>{{ 'deleteConstraint' | translate }}</button>
            <br/>
            {{ 'action' | translate }}: <md-select ng-model='constraint.action'
                               ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                               class="node-select md-subhead">
                <md-option ng-repeat='action in nodeAuthoringController.constraintActions'
                           ng-value='action.value'>
                    <span layout="row" layout-align="start center">
                        <span class="node-select__text">{{action.text}}</span>
                    </span>
                </md-option>
            </md-select>
            {{ 'removalConditional' | translate }}
            <md-select ng-model='constraint.removalConditional'
                       ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                       class="node-select md-subhead">
                <md-option ng-repeat='availableRemovalConditional in nodeAuthoringController.removalConditionals'
                           ng-value='availableRemovalConditional.value'>
                    <span layout="row" layout-align="start center">
                       <span class="node-select__text">{{availableRemovalConditional.text}}</span>
                    </span>
                </md-option>
            </md-select>
            <div ng-repeat='criteria in constraint.removalCriteria' style='border: 1px solid red'>
                {{ 'removalCriteriaName' | translate }}:
                <md-select ng-model='criteria.name'
                           ng-change='nodeAuthoringController.removalCriteriaNameChanged(criteria)'
                           class="node-select md-subhead">
                    <md-option ng-repeat='availableRemovalCriteria in nodeAuthoringController.removalCriteria'
                               ng-value='availableRemovalCriteria.value'>
                        <span layout="row" layout-align="start center">
                           <span class="node-select__text">{{availableRemovalCriteria.text}}</span>
                        </span>
                    </md-option>
                </md-select>
                <div ng-repeat='param in nodeAuthoringController.getRemovalCriteriaParamsByName(criteria.name)'>
                    {{param.text}}:
                    <div ng-if='param.value == "nodeId"'>
                        <md-select id="nodeIdSelectMenu"
                                   md-theme="default"
                                   class="node-select md-subhead"
                                   ng-model="criteria.params.nodeId"
                                   ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                                   aria-label="TransitionCriteriaNode"
                                   style="margin-left:30px; width:600px">
                            <md-option value="''">(Please Choose a Step)</md-option>
                            <md-option ng-repeat="item in projectController.items | toArray | orderBy : 'order'"
                                       value="{{ item.$key }}"
                                       ng-class="{'node-select-option--group': projectController.isGroupNode(item.$key), 'node-select-option--node': !projectController.isGroupNode(item.$key)}">
                            <span layout="row" layout-align="start center">
                                <span class="node-select__text">{{ projectController.getNodePositionById(item.$key) + ': '}}{{ projectController.getNodeTitleByNodeId(item.$key) }} ({{item.$key}})</span>
                                <node-status-icon node-id="item.$key" custom-class="'node-select__status'"></node-status-icon>
                            </span>
                            </md-option>
                        </md-select>
                    </div>
                    <div ng-if='param.value == "componentId"'>
                        <md-select id="componentIdSelectMenu"
                                   md-theme="default"
                                   class="node-select md-subhead"
                                   ng-model="criteria.params.componentId"
                                   ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                                   aria-label="TransitionCriteriaComponent"
                                   style="margin-left:30px; width:600px">
                            <md-option ng-value="''">(Please Choose a Component)</md-option>
                            <md-option ng-repeat="component in projectController.getComponentsByNodeId(criteria.params.nodeId)"
                                       value="{{ component.id }}">
                            <span layout="row" layout-align="start center">
                                <span class="node-select__text">{{ 'ID' | translate }}: {{component.id}} | {{ 'type' | translate }}: {{component.type}} | {{ 'prompt' | translate }}: {{component.prompt}}</span>
                            </span>
                            </md-option>
                        </md-select>
                    </div>
                    <div ng-if='param.value == "fromNodeId"'>
                        <md-select id="fromNodeIdSelectMenu"
                                   md-theme="default"
                                   class="node-select md-subhead"
                                   ng-model="criteria.params.fromNodeId"
                                   ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                                   aria-label="TransitionCriteriaNode"
                                   style="margin-left:30px; width:600px">
                            <md-option ng-repeat="item in projectController.items | toArray | orderBy : 'order'"
                                       value="{{ item.$key }}"
                                       ng-class="{'node-select-option--group': projectController.isGroupNode(item.$key), 'node-select-option--node': !projectController.isGroupNode(item.$key)}">
                            <span layout="row" layout-align="start center">
                                <span class="node-select__text">{{ projectController.getNodePositionById(item.$key) + ': '}}{{ projectController.getNodeTitleByNodeId(item.$key) }} ({{item.$key}})</span>
                                <node-status-icon node-id="item.$key" custom-class="'node-select__status'"></node-status-icon>
                            </span>
                            </md-option>
                        </md-select>
                    </div>
                    <div ng-if='param.value == "toNodeId"'>
                        <md-select id="toNodeIdSelectMenu"
                                   md-theme="default"
                                   class="node-select md-subhead"
                                   ng-model="criteria.params.toNodeId"
                                   ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                                   aria-label="TransitionCriteriaNode"
                                   style="margin-left:30px; width:600px">
                            <md-option ng-repeat="item in projectController.items | toArray | orderBy : 'order'"
                                       value="{{ item.$key }}"
                                       ng-class="{'node-select-option--group': projectController.isGroupNode(item.$key), 'node-select-option--node': !projectController.isGroupNode(item.$key)}">
                            <span layout="row" layout-align="start center">
                                <span class="node-select__text">{{ projectController.getNodePositionById(item.$key) + ': '}}{{ projectController.getNodeTitleByNodeId(item.$key) }} ({{item.$key}})</span>
                                <node-status-icon node-id="item.$key" custom-class="'node-select__status'"></node-status-icon>
                            </span>
                            </md-option>
                        </md-select>
                    </div>
                    <div ng-if='param.value == "scores"'>
                        <input type='text'
                               ng-model='criteria.params.scores'
                               ng-model-options='{ debounce: 1000 }'
                               ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                               ng-list=','/>
                    </div>
                    <div ng-if='param.value == "requiredSubmitCount"'>
                        <input type='number'
                               ng-model='criteria.params.requiredSubmitCount'
                               ng-model-options='{ debounce: 1000 }'
                               ng-change='nodeAuthoringController.authoringViewNodeChanged()'/>
                    </div>
                    <div ng-if='param.value == "choiceIds" && "radio" == nodeAuthoringController.getChoiceTypeByNodeIdAndComponentId(criteria.params.nodeId, criteria.params.componentId)'>
                        <md-select id="radioChoiceIdsSelectMenu"
                                   md-theme="default"
                                   class="node-select md-subhead"
                                   ng-model="criteria.params.choiceIds"
                                   ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                                   aria-label="TransitionCriteriaNode"
                                   style="margin-left:30px; width:600px">
                            <md-optgroup>
                                <md-option ng-value="choice.id" ng-repeat="choice in nodeAuthoringController.getChoicesByNodeIdAndComponentId(criteria.params.nodeId, criteria.params.componentId)">{{choice.text}}</md-option>
                            </md-optgroup>
                        </md-select>
                    </div>
                    <div ng-if='param.value == "choiceIds" && "checkbox" == nodeAuthoringController.getChoiceTypeByNodeIdAndComponentId(criteria.params.nodeId, criteria.params.componentId)'>
                        <md-select id="checkboxChoiceIdsSelectMenu"
                                   md-theme="default"
                                   class="node-select md-subhead"
                                   ng-model="criteria.params.choiceIds"
                                   ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                                   aria-label="TransitionCriteriaNode"
                                   style="margin-left:30px; width:600px"
                                   multiple={{nodeAuthoringController.getChoiceTypeByNodeIdAndComponentId(criteria.params.nodeId, criteria.params.componentId)}}>
                            <md-optgroup>
                                <md-option ng-value="choice.id" ng-repeat="choice in nodeAuthoringController.getChoicesByNodeIdAndComponentId(criteria.params.nodeId, criteria.params.componentId)">{{choice.text}}</md-option>
                            </md-optgroup>
                        </md-select>
                    </div>
                </div>
                <button ng-click='nodeAuthoringController.deleteRemovalCriteria(constraint, $index)' translate='deleteRemovalCriteria'></button>
            </div>
            <br/>
            <button ng-click='nodeAuthoringController.addRemovalCriteria(constraint)' translate='addRemovalCriteria'></button>
        </div>
        <button ng-click='nodeAuthoringController.addConstraint()' translate='addConstraint'></button>
    </div>

    <div ng-show='nodeAuthoringController.showAdvanced'>
        <br/>
        {{ 'SHOW_SAVE_BUTTON' | translate }}:
        <input type='checkbox'
               ng-model='nodeAuthoringController.node.showSaveButton'
               ng-change='nodeAuthoringController.authoringViewNodeChanged()'/>
        <br/>
        {{ 'SHOW_SUBMIT_BUTTON' | translate }}:
        <input type='checkbox'
               ng-model='nodeAuthoringController.node.showSubmitButton'
               ng-change='nodeAuthoringController.authoringViewNodeChanged()'/>
    </div>

    <div ng-show='nodeAuthoringController.showRubric'>
        <summernote id='{{nodeAuthoringController.summernoteRubricId}}'
                    ng-model='nodeAuthoringController.summernoteRubricHTML'
                    ng-change='nodeAuthoringController.summernoteRubricHTMLChanged()'
                    config='nodeAuthoringController.summernoteRubricOptions'
                    ng-model-options='{ debounce: 1000 }'
                    rows='10'
                    cols='100'>
        </summernote>
    </div>

    <div ng-show='nodeAuthoringController.showCreateBranch'>
        {{ 'createBranch' | translate }}
        <br/>

        <div>
            {{ 'numberOfBranchPaths' | translate }}
            <input type='number'
                   ng-model='nodeAuthoringController.createBranchNumberOfBranches'
                   ng-change='nodeAuthoringController.createBranchNumberOfBranchesChanged()'/>
            <button ng-click='nodeAuthoringController.removeBranchButtonClicked()' translate='removeBranch'></button>
        </div>

        <div ng-show='nodeAuthoringController.createBranchNumberOfBranches > 1'>
            <div>
                {{ 'howToChooseAmongPaths' | translate }}
                <md-select md-theme="default"
                           class="node-select md-subhead"
                           style="margin-left:30px; width:600px"
                           ng-model="nodeAuthoringController.createBranchCriterion"
                           ng-change="nodeAuthoringController.createBranchCriterionChanged()">
                    <md-option ng-repeat="branchCriterion in nodeAuthoringController.branchCriteria"
                               value="{{ branchCriterion.value }}">
                        <span layout="row" layout-align="start center">
                            <span class="node-select__text">{{branchCriterion.text}}</span>
                        </span>
                    </md-option>
                </md-select>
            </div>

            <div ng-show='nodeAuthoringController.createBranchCriterion == "score" || nodeAuthoringController.createBranchCriterion == "choiceChosen"'>
                {{ 'chooseStep' | translate }}
                <md-select md-theme="default"
                           class="node-select md-subhead"
                           ng-model="nodeAuthoringController.createBranchNodeId"
                           ng-change="nodeAuthoringController.createBranchNodeIdChanged()"
                           style="margin-left:30px; width:600px">
                    <md-option ng-repeat="item in projectController.items | toArray | orderBy : 'order'"
                               value="{{ item.$key }}"
                               ng-class="{'node-select-option--group': projectController.isGroupNode(item.$key), 'node-select-option--node': !projectController.isGroupNode(item.$key)}">
                        <span layout="row" layout-align="start center">
                            <span class="node-select__text">{{ projectController.getNodePositionById(item.$key) + ': '}}{{ projectController.getNodeTitleByNodeId(item.$key) }} ({{item.$key}})</span>
                            <node-status-icon node-id="item.$key" custom-class="'node-select__status'"></node-status-icon>
                        </span>
                    </md-option>
                </md-select>
            </div>

            <div ng-show='nodeAuthoringController.createBranchCriterion == "score" || nodeAuthoringController.createBranchCriterion == "choiceChosen"'>
                {{ 'chooseComponent' | translate }}
                <md-select md-theme="default"
                           class="node-select md-subhead"
                           ng-model="nodeAuthoringController.createBranchComponentId"
                           ng-change="nodeAuthoringController.createBranchComponentIdChanged()"
                           style="margin-left:30px; width:600px">
                    <md-option ng-repeat="component in projectController.getComponentsByNodeId(nodeAuthoringController.createBranchNodeId)"
                               value="{{ component.id }}">
                        <span layout="row" layout-align="start center">
                            <span class="node-select__text">ID: {{component.id}} | Type: {{component.type}} | Prompt: {{component.prompt}}</span>
                        </span>
                    </md-option>
                </md-select>
            </div>

            <div ng-repeat='branch in nodeAuthoringController.createBranchBranches'
                 style='border: 1px solid black'>
                {{ 'branchPath' | translate }} {{branch.number}}

                <div ng-show='nodeAuthoringController.createBranchCriterion == "workgroupId"'>
                    {{ 'WORKGROUP_ID' | translate }}
                </div>

                <div ng-show='nodeAuthoringController.createBranchCriterion == "score"'>
                    {{ 'SCORE' | translate }}
                    <input type='text'
                           ng-model='branch.scores'
                           ng-change='nodeAuthoringController.createBranchScoreChanged(branch)'
                           ng-list=','/>
                </div>

                <div ng-show='nodeAuthoringController.createBranchCriterion == "choiceChosen"'>
                    {{ 'choiceChosen' | translate }}
                    <md-select ng-model='branch.choiceId'>
                        <md-option ng-repeat='choice in branch.choices'
                                   value='{{ choice.id }}'>
                           <span layout="row" layout-align="start center">
                               <span class="node-select__text">{{ 'ID' | translate }}: {{choice.id}} | {{ 'TEXT' | translate }}: {{choice.text}} | {{ 'IS_CORRECT' | translate }}: {{choice.isCorrect}} | {{ 'FEEDBACK' | translate }}: {{choice.feedback}}</span>
                           </span>
                        </md-option>
                    </md-select>
                </div>

                <div ng-show='nodeAuthoringController.createBranchCriterion == "random"'>
                    {{ 'random' | translate }}
                </div>

                <button ng-click='branch.openStepsChooser = !branch.openStepsChooser'>{{ branch.openStepsChooser ? ('closeBranchPathXStepsChooser' | translate:'{ branchNumber: ' + branch.number + ' }') : 'openBranchPathXStepsChooser' | translate:'{ branchNumber: ' + branch.number + ' }' }}</button>
                <div ng-show='branch.openStepsChooser'>
                    {{ 'chooseStepsInPath' | translate }}
                    <br/>
                    <div ng-repeat='item in branch.items | toArray | orderBy : "order"'
                         ng-class='{"node-select--group": projectController.isGroupNode(item.$key), "node-select--node": !projectController.isGroupNode(item.$key)}'
                         ng-show='!projectController.importMode'>
                        <input type='checkbox'
                               ng-model='item.checked'
                               ng-if='item.order!==0'
                               ng-click='nodeAuthoringController.createBranchStepClicked(branch, item)'
                               ng-show='!(projectController.showCreateGroup || projectController.showCreateNode || projectController.insertNodeMode || projectController.insertGroupMode)'/>
                        <h6 ng-click='item.checked = !item.checked; nodeAuthoringController.createBranchStepClicked(branch, item)'
                            style='display:inline; cursor:pointer'
                            ng-class='{"groupHeader": projectController.isGroupNode(item.$key), "stepHeader": !projectController.isGroupNode(item.$key)}'
                            ng-if='item.order!==0'>
                            {{projectController.getNodePositionById(item.$key)}} {{projectController.getNodeTitleByNodeId(item.$key)}}
                        </h6>
                    </div>
                    <button ng-click='branch.openStepsChooser = !branch.openStepsChooser'>{{ branch.openStepsChooser ? ('closeBranchPathXStepsChooser' | translate:'{ branchNumber: ' + branch.number + ' }') : 'openBranchPathXStepsChooser' | translate:'{ branchNumber: ' + branch.number + ' }' }}</button>
                </div>
            </div>
            <div>
                {{ 'chooseMergePoint' | translate }}
                <md-select md-theme="default"
                           class="node-select md-subhead"
                           ng-model="nodeAuthoringController.createBranchMergePointNodeId"
                           ng-change="nodeAuthoringController.createBranchMergePointNodeIdChanged()"
                           style="margin-left:30px; width:600px">
                    <md-option ng-repeat="item in projectController.items | toArray | orderBy : 'order'"
                               value="{{ item.$key }}"
                               ng-class="{'node-select-option--group': projectController.isGroupNode(item.$key), 'node-select-option--node': !projectController.isGroupNode(item.$key)}">
                        <span layout="row" layout-align="start center">
                            <span class="node-select__text">{{ projectController.getNodePositionById(item.$key) + ': '}}{{ projectController.getNodeTitleByNodeId(item.$key) }} ({{item.$key}})</span>
                            <node-status-icon node-id="item.$key" custom-class="'node-select__status'"></node-status-icon>
                        </span>
                    </md-option>
                </md-select>
            </div>
        </div>
    </div>

    <div ng-show='nodeAuthoringController.insertComponentMode' layout='row' style='margin-left: 10; height:50'>
        <div layout='row'>
            <h6 translate="chooseNewLocation"></h6>
        </div>
        <div layout='row'>
            <md-button class='createButton md-raised md-primary'
                       ng-click='nodeAuthoringController.cancelInsertClicked()'
                       aria-label="{{ 'CANCEL' | translate }}"
                       translate="CANCEL"></md-button>
        </div>
    </div>
</div>

<div ng-show='nodeAuthoringController.showImportView'>
    <h4>{{ 'importComponentsParens' | translate }}</h4>
    <br/>
    <span>{{ 'chooseAProjectToImportAndThenChooseAComponent' | translate }}</span>
    <br/>
    <md-input-container style='margin-right: 20; width: 100%;'>
        <label>{{ 'myProjects' | translate }}</label>
        <md-select ng-model='nodeAuthoringController.importMyProjectId'
                   ng-change='nodeAuthoringController.showMyImportProject(nodeAuthoringController.importMyProjectId)'
                   style='width: 100%;'>
            <md-option ng-repeat="project in nodeAuthoringController.myProjectsList"
                       value='{{project.id}}'>
                {{project.id + ' ' + project.name + (project.runId ? ' (' + ('RUN_ID' | translate) + ': ' + project.runId + ')': '')}}
            </md-option>
        </md-select>
    </md-input-container>
    <br/>
    <md-input-container style='margin-right: 20; width: 100%;'>
        <label>{{ 'libraryProjects' | translate }}</label>
        <md-select ng-model='nodeAuthoringController.importLibraryProjectId'
                   ng-change='nodeAuthoringController.showLibraryImportProject(nodeAuthoringController.importLibraryProjectId)'
                   style='width: 100%;'>
            <md-option ng-repeat="project in nodeAuthoringController.libraryProjectsList"
                       value='{{project.id}}'>
                {{project.id + ' ' + project.title + (project.runId ? ' (' + ('RUN_ID' | translate) + ': ' + project.runId + ')': '')}}
            </md-option>
        </md-select>
    </md-input-container>
    <br/>
    <div style='background-color: white; position: sticky; top: 65px; z-index: 3;'
         ng-if='nodeAuthoringController.importProject != null'>
        <span>{{ 'afterYouHaveChosenTheComponentToImportClickThisButtonToImport' | translate }}</span>
        <md-button class='topButton md-raised md-primary'
                ng-click='nodeAuthoringController.importComponentsButtonClicked()'>
            <md-icon>vertical_align_bottom</md-icon>
            <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'importComponentsParens' | translate }}</md-tooltip>
        </md-button>
    </div>
    <br/>
    <h4 style='display:inline'>{{nodeAuthoringController.importProject.metadata.title}}</h4>
    <md-button class='topButton md-raised md-primary'
            ng-if='nodeAuthoringController.importProject != null'
            ng-click='nodeAuthoringController.previewImportProject()'>
        <md-icon>visibility</md-icon>
        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'previewProject' | translate }}</md-tooltip>
    </md-button>
    <br/>
    <div ng-repeat='importItem in nodeAuthoringController.importProjectIdToOrder'
         ng-class='{"groupHeader": importItem.node.type == "group", "stepHeader": importItem.node.type != "group"}'>
        <h6 style='display: inline; cursor: pointer'
            ng-if='importItem.order != 0'>
            {{importItem.stepNumber}}: {{importItem.node.title}}
        </h6>
        <md-button class='topButton md-raised md-primary'
                ng-if='importItem.node.type != "group"'
                ng-click='nodeAuthoringController.previewImportNode(importItem.node)'
                aria-label='{{ "previewStep" | translate }}'>
            <md-icon>visibility</md-icon>
            <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'previewStep' | translate }}</md-tooltip>
        </md-button>
        <div ng-repeat='component in importItem.node.components track by $index'
             class='componentHeader'>
            <div layout='row'>
                <div layout='row'>
                    <md-checkbox ng-model='component.checked'>
                        <span>{{$index + 1}}. {{component.type}}</span>
                    </md-checkbox>
                </div>
                <div layout='row' style='height: 40;'>
                    <md-button class='regularButton md-raised md-primary'
                            style='margin-top: -5;'
                            ng-if='importItem.node.type != "group"'
                            ng-click='nodeAuthoringController.previewImportComponent(importItem.node, component.id)'
                            aria-label='{{ "previewComponent" | translate }}'>
                        <md-icon>visibility</md-icon>
                        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'previewComponent' | translate }}</md-tooltip>
                    </md-button>
                </div>
            </div>
        </div>
    </div>
    <md-button class='topButton md-raised md-primary'
            ng-if='nodeAuthoringController.importProject != null'
            ng-click='nodeAuthoringController.importComponentsButtonClicked()'>
        <md-icon>vertical_align_bottom</md-icon>
        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'importComponentsParens' | translate }}</md-tooltip>
    </md-button>
</div>
<div ng-show='!nodeAuthoringController.insertComponentMode && !nodeAuthoringController.showImportView'>
    <div layout='row' style='margin-left: 10px; max-height: 60px;'>
        <div layout='row' style='margin-top: 18px; margin-right: 10px;'>
            <h6 ng-if="!projectController.isGroupNode(nodeAuthoringController.node.id)">{{ 'stepTitle' | translate }} {{ nodeAuthoringController.nodePosition }}:</h6>
            <h6 ng-if="projectController.isGroupNode(nodeAuthoringController.node.id)">{{ 'activityTitle' | translate }} {{ nodeAuthoringController.nodePosition }}:</h6>
        </div>
        <div layout='row'>
            <md-input-container style="width:500">
                <input ng-model='nodeAuthoringController.node.title'
                       ng-change='nodeAuthoringController.authoringViewNodeChanged()'
                       ng-model-options='{ debounce: 500 }'
                       aria-label='{{ "title" | translate }}'
                       size='60'/>
            </md-input-container>
        </div>
    </div>
</div>
<div style='margin-left: 176;' ng-show='nodeAuthoringController.insertComponentMode'>
    <md-button class='moveComponentButton md-raised md-primary'
               ng-click='nodeAuthoringController.insertComponentAsFirst()'>
        <md-icon>keyboard_backspace</md-icon>
        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'insertAsFirstComponent' | translate }}</md-tooltip>
    </md-button>
    <span style='font-weight:bold; margin-right:10px'>{{ 'insertAsFirstComponent' | translate }}</span>
</div>
<div ng-repeat='(componentIndex, component) in nodeAuthoringController.components'
     class="md-padding"
     ng-show='!nodeAuthoringController.showImportView'>
    <div id='{{component.id}}' layout='row'>
        <div layout='row' style='margin-top: 10px; width: 170;'>
            <md-checkbox ng-model='nodeAuthoringController.componentsToChecked[component.id]'
                         ng-disabled='nodeAuthoringController.insertComponentMode'>
                <span style='font-weight:bold; margin-right:10px'>{{componentIndex + 1}}. {{nodeAuthoringController.getComponentTypeLabel(component.type)}}</span>
            </md-checkbox>
        </div>
        <div layout='row' ng-show='nodeAuthoringController.insertComponentMode'>
            <md-button class='moveComponentButton md-raised md-primary'
                       ng-click='nodeAuthoringController.insertComponentAfter(component.id)'>
                <md-icon>subdirectory_arrow_left</md-icon>
                <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ "insertAfter" | translate }}</md-tooltip>
            </md-button>
        </div>
    </div>
    <component ng-show='nodeAuthoringController.showComponentAuthoringViews' node-id='{{nodeAuthoringController.nodeId}}' component-id='{{component.id}}' mode='authoring'></component>
    <md-divider ng-show='nodeAuthoringController.showComponentAuthoringViews' ng-if="!$last"></md-divider>
</div>
