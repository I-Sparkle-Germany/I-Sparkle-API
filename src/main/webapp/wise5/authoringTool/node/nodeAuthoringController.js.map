{"version":3,"sources":["nodeAuthoringController.es6"],"names":["NodeAuthoringController","$anchorScroll","$location","$scope","$state","$stateParams","$timeout","$translate","ConfigService","ProjectService","UtilService","projectId","nodeId","showCreateComponent","showEditTransitions","selectedComponent","nodeCopy","undoStack","howToChooseAmongAvailablePathsOptions","whenToChoosePathOptions","canChangePathOptions","componentTypes","componentType","componentName","node","getNodeById","nodePosition","getNodePositionById","components","getComponentsByNodeId","originalNodeCopy","makeCopyOfJSONObject","currentNodeCopy","previewProjectURL","getConfigParam","previewStepURL","window","open","$broadcast","nodeToExit","go","angular","equals","then","confirmUndo","result","confirm","replaceNode","saveProject","close","transitionLogic","transitions","nodeTransitions","length","lastNodeTransition","newTransition","to","push","transition","n","nodeTransition","criteria","newTransitionCriteria","transitionIndex","criteriaIndex","index","indexOf","splice","createComponent","hash","componentId","moveComponentUp","moveComponentDown","confirmDeleteComponent","answer","deleteComponent","noUndoAvailable","alert","confirmUndoLastChange","pop","$inject"],"mappings":"AAAA;;;;;;;;;;IAEMA,uB;AAEF,qCAAYC,aAAZ,EACYC,SADZ,EAEYC,MAFZ,EAGYC,MAHZ,EAIYC,YAJZ,EAKYC,QALZ,EAMYC,UANZ,EAOYC,aAPZ,EAQYC,cARZ,EASYC,WATZ,EASyB;AAAA;;AAErB,aAAKT,aAAL,GAAqBA,aAArB;AACA,aAAKC,SAAL,GAAiBA,SAAjB;AACA,aAAKC,MAAL,GAAcA,MAAd;AACA,aAAKC,MAAL,GAAcA,MAAd;AACA,aAAKC,YAAL,GAAoBA,YAApB;AACA,aAAKC,QAAL,GAAgBA,QAAhB;AACA,aAAKC,UAAL,GAAkBA,UAAlB;AACA,aAAKC,aAAL,GAAqBA,aAArB;AACA,aAAKC,cAAL,GAAsBA,cAAtB;AACA,aAAKC,WAAL,GAAmBA,WAAnB;AACA,aAAKC,SAAL,GAAiBN,aAAaM,SAA9B;AACA,aAAKC,MAAL,GAAcP,aAAaO,MAA3B;AACA,aAAKC,mBAAL,GAA2B,KAA3B;AACA,aAAKC,mBAAL,GAA2B,KAA3B;AACA,aAAKC,iBAAL,GAAyB,IAAzB;AACA,aAAKC,QAAL,GAAgB,IAAhB;AACA,aAAKC,SAAL,GAAiB,EAAjB;AACA,aAAKC,qCAAL,GAA6C,CAAC,IAAD,EAAO,QAAP,EAAiB,aAAjB,EAAgC,gBAAhC,EAAkD,eAAlD,CAA7C;AACA,aAAKC,uBAAL,GAA+B,CAAC,IAAD,EAAO,WAAP,EAAoB,UAApB,EAAgC,cAAhC,EAAgD,oBAAhD,CAA/B;AACA,aAAKC,oBAAL,GAA4B,CAAC,IAAD,EAAO,IAAP,EAAa,KAAb,CAA5B;;AAEA;AACA,aAAKC,cAAL,GAAsB,CAClB,EAACC,eAAe,iBAAhB,EAAmCC,eAAe,kBAAlD,EADkB,EAElB,EAACD,eAAe,YAAhB,EAA8BC,eAAe,aAA7C,EAFkB,EAGlB,EAACD,eAAe,YAAhB,EAA8BC,eAAe,YAA7C,EAHkB,EAIlB,EAACD,eAAe,MAAhB,EAAwBC,eAAe,MAAvC,EAJkB,EAKlB,EAACD,eAAe,UAAhB,EAA4BC,eAAe,UAA3C,EALkB,EAMlB,EAACD,eAAe,OAAhB,EAAyBC,eAAe,OAAxC,EANkB,EAOlB,EAACD,eAAe,MAAhB,EAAwBC,eAAe,MAAvC,EAPkB,EAQlB,EAACD,eAAe,OAAhB,EAAyBC,eAAe,OAAxC,EARkB,EASlB,EAACD,eAAe,OAAhB,EAAyBC,eAAe,OAAxC,EATkB,EAUlB,EAACD,eAAe,gBAAhB,EAAkCC,eAAe,iBAAjD,EAVkB,EAWlB,EAACD,eAAe,cAAhB,EAAgCC,eAAe,eAA/C,EAXkB,EAYlB,EAACD,eAAe,YAAhB,EAA8BC,eAAe,aAA7C,EAZkB,EAalB,EAACD,eAAe,OAAhB,EAAyBC,eAAe,OAAxC,EAbkB,CAAtB;;AAgBA;AACA,aAAKR,iBAAL,GAAyB,KAAKM,cAAL,CAAoB,CAApB,EAAuBC,aAAhD;;AAEA;AACA,aAAKE,IAAL,GAAY,KAAKf,cAAL,CAAoBgB,WAApB,CAAgC,KAAKb,MAArC,CAAZ;;AAEA;AACA,aAAKc,YAAL,GAAoB,KAAKjB,cAAL,CAAoBkB,mBAApB,CAAwC,KAAKf,MAA7C,CAApB;;AAEA;AACA,aAAKgB,UAAL,GAAkB,KAAKnB,cAAL,CAAoBoB,qBAApB,CAA0C,KAAKjB,MAA/C,CAAlB;;AAEA;;;;;AAKA,aAAKkB,gBAAL,GAAwB,KAAKpB,WAAL,CAAiBqB,oBAAjB,CAAsC,KAAKP,IAA3C,CAAxB;;AAEA;;;;AAIA,aAAKQ,eAAL,GAAuB,KAAKtB,WAAL,CAAiBqB,oBAAjB,CAAsC,KAAKP,IAA3C,CAAvB;AACH;;AAED;;;;;;;sCAGc;AACV,gBAAIS,oBAAoB,KAAKzB,aAAL,CAAmB0B,cAAnB,CAAkC,mBAAlC,CAAxB;AACA,gBAAIC,iBAAkBF,oBAAoB,QAApB,GAA+B,KAAKrB,MAA1D;AACAwB,mBAAOC,IAAP,CAAYF,cAAZ;AACH;;;;;AAED;;;wDAGgC;AAC5B,gBAAIF,oBAAoB,KAAKzB,aAAL,CAAmB0B,cAAnB,CAAkC,mBAAlC,CAAxB;AACA,gBAAIC,iBAAkBF,oBAAoB,oBAApB,GAA2C,QAA3C,GAAsD,KAAKrB,MAAjF;AACAwB,mBAAOC,IAAP,CAAYF,cAAZ;AACH;;;;;AAED;;;gCAGQ;AACJ;AACA,iBAAKhC,MAAL,CAAYmC,UAAZ,CAAuB,UAAvB,EAAmC,EAACC,YAAY,KAAKf,IAAlB,EAAnC;;AAEA,iBAAKpB,MAAL,CAAYoC,EAAZ,CAAe,cAAf,EAA+B,EAAC7B,WAAW,KAAKA,SAAjB,EAA/B;AACH;;;;;AAED;;;;iCAIS;AAAA;;AAEL;AACA,gBAAI,CAAC8B,QAAQC,MAAR,CAAe,KAAKlB,IAApB,EAA0B,KAAKM,gBAA/B,CAAL,EAAuD;AACnD;;AAEA,qBAAKvB,UAAL,CAAgB,aAAhB,EAA+BoC,IAA/B,CAAoC,UAACC,WAAD,EAAiB;AACjD,wBAAIC,SAASC,QAAQF,WAAR,CAAb;;AAEA,wBAAIC,MAAJ,EAAY;AACR;AACA,8BAAKpC,cAAL,CAAoBsC,WAApB,CAAgC,MAAKnC,MAArC,EAA6C,MAAKkB,gBAAlD;;AAEA;AACA,8BAAKrB,cAAL,CAAoBuC,WAApB;;AAEA;AACA,8BAAKC,KAAL;AACH;AACJ,iBAbD;AAcH,aAjBD,MAiBO;AACH;;AAEA;AACA,qBAAKA,KAAL;AACH;AACJ;;AAED;;;;;;2CAGmB;AACf,gBAAI,KAAKzB,IAAL,CAAU0B,eAAV,CAA0BC,WAA1B,IAAyC,IAA7C,EAAmD;AAC/C,qBAAK3B,IAAL,CAAU0B,eAAV,CAA0BC,WAA1B,GAAwC,EAAxC;AACH;AACD,gBAAIC,kBAAkB,KAAK5B,IAAL,CAAU0B,eAAV,CAA0BC,WAAhD;AACA,gBAAIC,gBAAgBC,MAAhB,GAAyB,CAA7B,EAAgC;AAC5B;AACA,oBAAIC,qBAAqBF,gBAAgBA,gBAAgBC,MAAhB,GAAyB,CAAzC,CAAzB;AACA,oBAAIE,gBAAgB;AAChB,0BAAMD,mBAAmBE;AADT,iBAApB;AAGAJ,gCAAgBK,IAAhB,CAAqBF,aAArB;AACH,aAPD,MAOO;AACH;AACA,oBAAIA,iBAAgB;AAChB,0BAAM,KAAK3C;AADK,iBAApB;AAGAwC,gCAAgBK,IAAhB,CAAqBF,cAArB;AACH;AACJ;;AAED;;;;;;iDAGyBG,U,EAAY;AACjC,gBAAIN,kBAAkB,KAAK5B,IAAL,CAAU0B,eAAV,CAA0BC,WAAhD;AACA,iBAAK,IAAIQ,IAAI,CAAb,EAAgBA,IAAIP,gBAAgBC,MAApC,EAA4CM,GAA5C,EAAiD;AAC7C,oBAAIC,iBAAiBR,gBAAgBO,CAAhB,CAArB;AACA,oBAAIC,kBAAkBF,UAAtB,EAAkC;AAC9B,wBAAIE,eAAeC,QAAf,IAA2B,IAA/B,EAAqC;AACjCD,uCAAeC,QAAf,GAA0B,EAA1B;AACH;AACD,wBAAIC,wBAAwB;AACxB,gCAAO,EADiB;AAExB,kCAAU;AACN,sCAAU,EADJ;AAEN,2CAAe;AAFT;AAFc,qBAA5B;AAOAF,mCAAeC,QAAf,CAAwBJ,IAAxB,CAA6BK,qBAA7B;AACH;AACJ;AACJ;;AAED;;;;;;;;kDAK0BC,e,EAAiBC,a,EAAeF,qB,EAAuB;AAC7E,iBAAKtC,IAAL,CAAU0B,eAAV,CAA0BC,WAA1B,CAAsCY,eAAtC,EAAuDF,QAAvD,CAAgEG,aAAhE,IAAiFF,qBAAjF;AACH;;AAED;;;;;;yCAGiBJ,U,EAAY;AACzB,gBAAIN,kBAAkB,KAAK5B,IAAL,CAAU0B,eAAV,CAA0BC,WAAhD;;AAEA,gBAAIc,QAAQb,gBAAgBc,OAAhB,CAAwBR,UAAxB,CAAZ;AACA,gBAAIO,QAAQ,CAAC,CAAb,EAAgB;AACZb,gCAAgBe,MAAhB,CAAuBF,KAAvB,EAA8B,CAA9B;AACH;AACJ;;AAGD;;;;;;0CAGkB;;AAEd;AACA,iBAAKxD,cAAL,CAAoBuC,WAApB;;AAEA;AACA,iBAAKlC,mBAAL,GAA2B,KAA3B;AACH;;AAED;;;;;;0CAGkB;AAAA;;AAEd;AACA,iBAAKL,cAAL,CAAoB2D,eAApB,CAAoC,KAAKxD,MAAzC,EAAiD,KAAKG,iBAAtD;;AAEA;AACA,iBAAKN,cAAL,CAAoBuC,WAApB;;AAEA;AACA,iBAAKnC,mBAAL,GAA2B,KAA3B;;AAEA;AACA,iBAAKP,QAAL,CAAc,YAAM;AAChB,uBAAKJ,SAAL,CAAemE,IAAf,CAAoB,QAApB;AACA,uBAAKpE,aAAL;AACH,aAHD;AAIH;;AAED;;;;;;;wCAIgBqE,W,EAAa;;AAEzB;AACA,iBAAK7D,cAAL,CAAoB8D,eAApB,CAAoC,KAAK3D,MAAzC,EAAiD0D,WAAjD;;AAEA;AACA,iBAAK7D,cAAL,CAAoBuC,WAApB;AACH;;AAED;;;;;;;0CAIkBsB,W,EAAa;;AAE3B;AACA,iBAAK7D,cAAL,CAAoB+D,iBAApB,CAAsC,KAAK5D,MAA3C,EAAmD0D,WAAnD;;AAEA;AACA,iBAAK7D,cAAL,CAAoBuC,WAApB;AACH;;AAED;;;;;;;wCAIgBsB,W,EAAa;AAAA;;AAEzB,iBAAK/D,UAAL,CAAgB,wBAAhB,EAA0CoC,IAA1C,CAA+C,UAAC8B,sBAAD,EAA4B;;AAEvE;AACA,oBAAIC,SAAS5B,QAAQ2B,sBAAR,CAAb;;AAEA,oBAAIC,MAAJ,EAAY;AACR;;AAEA;AACA,2BAAKjE,cAAL,CAAoBkE,eAApB,CAAoC,OAAK/D,MAAzC,EAAiD0D,WAAjD;;AAEA;AACA,2BAAK7D,cAAL,CAAoBuC,WAApB;AACH;AACJ,aAdD;AAeH;;AAED;;;;;;mDAG2B;AACvB;AACA,iBAAK/B,SAAL,CAAewC,IAAf,CAAoB,KAAKzB,eAAzB;;AAEA;AACA,iBAAKvB,cAAL,CAAoBuC,WAApB;;AAEA;AACA,iBAAKhB,eAAL,GAAuB,KAAKtB,WAAL,CAAiBqB,oBAAjB,CAAsC,KAAKP,IAA3C,CAAvB;AACH;;AAED;;;;;;+BAGO;AAAA;;AAEH,gBAAI,KAAKP,SAAL,CAAeoC,MAAf,KAA0B,CAA9B,EAAiC;AAC7B;AACA,qBAAK9C,UAAL,CAAgB,iBAAhB,EAAmCoC,IAAnC,CAAwC,UAACiC,eAAD,EAAqB;AACzDC,0BAAMD,eAAN;AACH,iBAFD;AAIH,aAND,MAMO,IAAI,KAAK3D,SAAL,CAAeoC,MAAf,GAAwB,CAA5B,EAA+B;AAClC;;AAEA,qBAAK9C,UAAL,CAAgB,uBAAhB,EAAyCoC,IAAzC,CAA8C,UAACmC,qBAAD,EAA2B;;AAErE;AACA,wBAAIjC,SAASC,QAAQgC,qBAAR,CAAb;;AAEA,wBAAIjC,MAAJ,EAAY;AACR;AACA,+BAAK1C,MAAL,CAAYmC,UAAZ,CAAuB,UAAvB,EAAmC,EAACC,YAAY,OAAKf,IAAlB,EAAnC;;AAEA;AACA,4BAAIR,WAAW,OAAKC,SAAL,CAAe8D,GAAf,EAAf;;AAEA;AACA,+BAAKtE,cAAL,CAAoBsC,WAApB,CAAgC,OAAKnC,MAArC,EAA6CI,QAA7C;;AAEA;AACA,+BAAKQ,IAAL,GAAY,OAAKf,cAAL,CAAoBgB,WAApB,CAAgC,OAAKb,MAArC,CAAZ;;AAEA;AACA,+BAAKgB,UAAL,GAAkB,OAAKnB,cAAL,CAAoBoB,qBAApB,CAA0C,OAAKjB,MAA/C,CAAlB;;AAEA;AACA,+BAAKH,cAAL,CAAoBuC,WAApB;AACH;AACJ,iBAxBD;AAyBH;AACJ;;;;;;AACJ;;AAEDhD,wBAAwBgF,OAAxB,GAAkC,CAAC,eAAD,EAAkB,WAAlB,EAA+B,QAA/B,EAAyC,QAAzC,EAAmD,cAAnD,EAAmE,UAAnE,EAA+E,YAA/E,EAA6F,eAA7F,EAA8G,gBAA9G,EAAgI,aAAhI,CAAlC;;kBAEehF,uB","file":"nodeAuthoringController.js","sourcesContent":["'use strict';\n\nclass NodeAuthoringController {\n\n    constructor($anchorScroll,\n                $location,\n                $scope,\n                $state,\n                $stateParams,\n                $timeout,\n                $translate,\n                ConfigService,\n                ProjectService,\n                UtilService) {\n\n        this.$anchorScroll = $anchorScroll;\n        this.$location = $location;\n        this.$scope = $scope;\n        this.$state = $state;\n        this.$stateParams = $stateParams;\n        this.$timeout = $timeout;\n        this.$translate = $translate;\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n        this.UtilService = UtilService;\n        this.projectId = $stateParams.projectId;\n        this.nodeId = $stateParams.nodeId;\n        this.showCreateComponent = false;\n        this.showEditTransitions = false;\n        this.selectedComponent = null;\n        this.nodeCopy = null;\n        this.undoStack = [];\n        this.howToChooseAmongAvailablePathsOptions = [null, \"random\", \"workgroupId\", \"firstAvailable\", \"lastAvailable\"];\n        this.whenToChoosePathOptions = [null, \"enterNode\", \"exitNode\", \"scoreChanged\", \"studentDataChanged\"];\n        this.canChangePathOptions = [null, true, false];\n\n        // the array of component types that can be created\n        this.componentTypes = [\n            {componentType: 'AudioOscillator', componentName: 'Audio Oscillator'},\n            {componentType: 'ConceptMap', componentName: 'Concept Map'},\n            {componentType: 'Discussion', componentName: 'Discussion'},\n            {componentType: 'Draw', componentName: 'Draw'},\n            {componentType: 'Embedded', componentName: 'Embedded'},\n            {componentType: 'Graph', componentName: 'Graph'},\n            {componentType: 'HTML', componentName: 'HTML'},\n            {componentType: 'Label', componentName: 'Label'},\n            {componentType: 'Match', componentName: 'Match'},\n            {componentType: 'MultipleChoice', componentName: 'Multiple Choice'},\n            {componentType: 'OpenResponse', componentName: 'Open Response'},\n            {componentType: 'OutsideURL', componentName: 'Outside URL'},\n            {componentType: 'Table', componentName: 'Table'}\n        ];\n\n        // set the drop down to the first item\n        this.selectedComponent = this.componentTypes[0].componentType;\n\n        // get the node\n        this.node = this.ProjectService.getNodeById(this.nodeId);\n\n        // get the step number e.g. 1.3\n        this.nodePosition = this.ProjectService.getNodePositionById(this.nodeId);\n\n        // get the components in the node\n        this.components = this.ProjectService.getComponentsByNodeId(this.nodeId);\n\n        /*\n         * remember a copy of the node at the beginning of this node authoring\n         * session in case we need to roll back if the user decides to\n         * cancel/revert all the changes.\n         */\n        this.originalNodeCopy = this.UtilService.makeCopyOfJSONObject(this.node);\n\n        /*\n         * remember the current version of the node. this will be updated each\n         * time the user makes a change.\n         */\n        this.currentNodeCopy = this.UtilService.makeCopyOfJSONObject(this.node);\n    }\n\n    /**\n     * Launch VLE with this current step as the initial step\n     */\n    previewStep() {\n        let previewProjectURL = this.ConfigService.getConfigParam(\"previewProjectURL\");\n        let previewStepURL  = previewProjectURL + \"#/vle/\" + this.nodeId;\n        window.open(previewStepURL);\n    };\n    \n    /**\n     * Launch VLE with this current step as the initial step without constraints\n     */\n    previewStepWithoutConstraints() {\n        let previewProjectURL = this.ConfigService.getConfigParam(\"previewProjectURL\");\n        let previewStepURL  = previewProjectURL + \"?constraints=false\" + \"#/vle/\" + this.nodeId;\n        window.open(previewStepURL);\n    };\n\n    /**\n     * Close the node authoring view\n     */\n    close() {\n        // perform any node cleanup if necessary\n        this.$scope.$broadcast('exitNode', {nodeToExit: this.node});\n        \n        this.$state.go('root.project', {projectId: this.projectId});\n    };\n\n    /**\n     * The author has clicked the cancel button which will revert all\n     * the recent changes since they opened the node.\n     */\n    cancel() {\n\n        // check if the user has made any changes\n        if (!angular.equals(this.node, this.originalNodeCopy)) {\n            // the user has made changes\n\n            this.$translate('confirmUndo').then((confirmUndo) => {\n                var result = confirm(confirmUndo);\n\n                if (result) {\n                    // revert the node back to the previous version\n                    this.ProjectService.replaceNode(this.nodeId, this.originalNodeCopy);\n\n                    // save the project\n                    this.ProjectService.saveProject();\n\n                    // close the node authoring view\n                    this.close();\n                }\n            });\n        } else {\n            // the user has not made any changes\n\n            //close the node authoring view\n            this.close();\n        }\n    }\n\n    /**\n     * Add a new transition for this node.\n     */\n    addNewTransition() {\n        if (this.node.transitionLogic.transitions == null) {\n            this.node.transitionLogic.transitions = [];\n        }\n        let nodeTransitions = this.node.transitionLogic.transitions;\n        if (nodeTransitions.length > 0) {\n            // If this node already has transitions, copy the last one.\n            let lastNodeTransition = nodeTransitions[nodeTransitions.length - 1];\n            let newTransition = {\n                \"to\": lastNodeTransition.to\n            };\n            nodeTransitions.push(newTransition);\n        } else {\n            // Otherwise set the new transition to the current nodeId\n            let newTransition = {\n                \"to\": this.nodeId\n            };\n            nodeTransitions.push(newTransition);\n        }\n    }\n\n    /**\n     * Add a new transition for the specified transition.\n     */\n    addNewTransitionCriteria(transition) {\n        let nodeTransitions = this.node.transitionLogic.transitions;\n        for (var n = 0; n < nodeTransitions.length; n++) {\n            let nodeTransition = nodeTransitions[n];\n            if (nodeTransition == transition) {\n                if (nodeTransition.criteria == null) {\n                    nodeTransition.criteria = [];\n                }\n                let newTransitionCriteria = {\n                    \"name\":\"\",\n                    \"params\": {\n                        \"nodeId\": \"\",\n                        \"componentId\": \"\"\n                    }\n                };\n                nodeTransition.criteria.push(newTransitionCriteria);\n            }\n        }\n    }\n\n    /**\n     * Author chose/updated a transition criteria, which is saved in this.selectedTransitionCriteria.\n     * The original transitionCriteria is passed in as originalTransitionCriteria parameter.\n     * @param originalTransitionCriteria\n     */\n    transitionCriteriaChanged(transitionIndex, criteriaIndex, newTransitionCriteria) {\n        this.node.transitionLogic.transitions[transitionIndex].criteria[criteriaIndex] = newTransitionCriteria;\n    }\n\n    /**\n     * Deletes the specified transition from this node\n     */\n    deleteTransition(transition) {\n        let nodeTransitions = this.node.transitionLogic.transitions;\n\n        let index = nodeTransitions.indexOf(transition);\n        if (index > -1) {\n            nodeTransitions.splice(index, 1);\n        }\n    }\n\n\n    /**\n     * Save transitions for this node\n     */\n    saveTransitions() {\n\n        // save the project\n        this.ProjectService.saveProject();\n\n        // hide the create component elements\n        this.showEditTransitions = false;\n    }\n\n    /**\n     * Create a component in this node\n     */\n    createComponent() {\n\n        // create a component and add it to this node\n        this.ProjectService.createComponent(this.nodeId, this.selectedComponent);\n\n        // save the project\n        this.ProjectService.saveProject();\n\n        // hide the create component elements\n        this.showCreateComponent = false;\n\n        // Scroll to the bottom of the page where the new component was added\n        this.$timeout(() => {\n            this.$location.hash('bottom');\n            this.$anchorScroll();\n        });\n    }\n\n    /**\n     * Move a component up within this node\n     * @param componentId the component id\n     */\n    moveComponentUp(componentId) {\n\n        // move the component up within the node\n        this.ProjectService.moveComponentUp(this.nodeId, componentId);\n\n        // save the project\n        this.ProjectService.saveProject();\n    }\n\n    /**\n     * Move a component up within this node\n     * @param componentId the component id\n     */\n    moveComponentDown(componentId) {\n\n        // move the component down within the node\n        this.ProjectService.moveComponentDown(this.nodeId, componentId);\n\n        // save the project\n        this.ProjectService.saveProject();\n    }\n\n    /**\n     * Delete the component from this node\n     * @param componentId the component id\n     */\n    deleteComponent(componentId) {\n\n        this.$translate('confirmDeleteComponent').then((confirmDeleteComponent) => {\n\n            // ask the user to confirm the delete\n            var answer = confirm(confirmDeleteComponent);\n\n            if (answer) {\n                // the user confirmed yes\n\n                // delete the component from the node\n                this.ProjectService.deleteComponent(this.nodeId, componentId);\n\n                // save the project\n                this.ProjectService.saveProject();\n            }\n        });\n    }\n\n    /**\n     * The node has changed in the authoring view\n     */\n    authoringViewNodeChanged() {\n        // put the previous version of the node on to the undo stack\n        this.undoStack.push(this.currentNodeCopy);\n\n        // save the project\n        this.ProjectService.saveProject();\n\n        // update the current node copy\n        this.currentNodeCopy = this.UtilService.makeCopyOfJSONObject(this.node);\n    }\n\n    /**\n     * Undo the last change by reverting the node to the previous version\n     */\n    undo() {\n\n        if (this.undoStack.length === 0) {\n            // the undo stack is empty so there are no changes to undo\n            this.$translate('noUndoAvailable').then((noUndoAvailable) => {\n                alert(noUndoAvailable);\n            });\n\n        } else if (this.undoStack.length > 0) {\n            // the undo stack has elements\n\n            this.$translate('confirmUndoLastChange').then((confirmUndoLastChange) => {\n\n                // ask the user to confirm the delete\n                var result = confirm(confirmUndoLastChange);\n\n                if (result) {\n                    // perform any node cleanup if necessary\n                    this.$scope.$broadcast('exitNode', {nodeToExit: this.node});\n                    \n                    // get the previous version of the node\n                    var nodeCopy = this.undoStack.pop();\n\n                    // revert the node back to the previous version\n                    this.ProjectService.replaceNode(this.nodeId, nodeCopy);\n\n                    // get the node\n                    this.node = this.ProjectService.getNodeById(this.nodeId);\n\n                    // get the components in the node\n                    this.components = this.ProjectService.getComponentsByNodeId(this.nodeId);\n\n                    // save the project\n                    this.ProjectService.saveProject();\n                }\n            });\n        }\n    }\n};\n\nNodeAuthoringController.$inject = ['$anchorScroll', '$location', '$scope', '$state', '$stateParams', '$timeout', '$translate', 'ConfigService', 'ProjectService', 'UtilService'];\n\nexport default NodeAuthoringController;\n"]}