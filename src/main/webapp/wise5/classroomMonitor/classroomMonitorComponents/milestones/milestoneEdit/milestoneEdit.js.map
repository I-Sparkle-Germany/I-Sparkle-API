{"version":3,"sources":["milestoneEdit.es6"],"names":["MilestoneDetailsController","$filter","$scope","AchievementService","ProjectService","UtilService","moment","$translate","$onInit","milestone","createMilestone","date","Date","params","targetDate","projectAchievements","getAchievementItems","tomorrow","add","hours","minutes","seconds","id","getAvailableAchievementId","name","description","type","nodeIds","valueOf","icon","image","items","makeCopyOfJSONObject","idToOrder","isVisible","item","nodeId","$key","checked","indexOf","push","n","length","splice","change","groupId","showSteps","childIds","getChildNodeIdsById","c","childId","show","isGroupNode","getNodePositionAndTitleByNodeId","getTime","itemsArray","Object","keys","map","it","valid","milestoneEditForm","$valid","onChange","$inject","MilestoneDetails","bindings","template","controller"],"mappings":"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","file":"milestoneEdit.js","sourcesContent":["\"use strict\";\r\n\r\nclass MilestoneDetailsController {\r\n    constructor($filter,\r\n                $scope,\r\n                AchievementService,\r\n                ProjectService,\r\n                UtilService,\r\n                moment) {\r\n        this.$filter = $filter;\r\n        this.$scope = $scope;\r\n        this.AchievementService = AchievementService;\r\n        this.ProjectService = ProjectService;\r\n        this.UtilService = UtilService;\r\n        this.moment = moment;\r\n\r\n        this.$translate = this.$filter('translate');\r\n\r\n        this.$onInit = () => {\r\n            if (!this.milestone) {\r\n                // no milestone was passed in, so we'll create a new one\r\n                this.createMilestone();\r\n            }\r\n\r\n            // set the date object that we'll use with md-datepicker\r\n            if (this.milestone) {\r\n                this.date = new Date(this.milestone.params.targetDate);\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Create a new milestone\r\n     */\r\n    createMilestone() {\r\n\r\n        // get the project achievements\r\n        let projectAchievements = this.ProjectService.getAchievementItems();\r\n\r\n        if (projectAchievements != null) {\r\n\r\n            // get the time of tomorrow at 3pm\r\n            let tomorrow = this.moment().add('days', 1).hours(23).minutes(11).seconds(59);\r\n\r\n            // create a new milestone object\r\n            this.milestone = {\r\n                id: this.AchievementService.getAvailableAchievementId(),\r\n                name: '',\r\n                description: '',\r\n                type: \"milestone\",\r\n                params: {\r\n                    nodeIds: [],\r\n                    targetDate: tomorrow.valueOf()\r\n                },\r\n                icon: {\r\n                    image: \"\"\r\n                },\r\n                items: this.UtilService.makeCopyOfJSONObject(this.ProjectService.idToOrder),\r\n                isVisible: true\r\n            };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The checkbox for an activity or step was clicked\r\n     * @param milestone the milestone that is being edited\r\n     * @param item the activity or step that was clicked\r\n     */\r\n    itemChanged(item) {\r\n\r\n        if (this.milestone && this.milestone.params && this.milestone.params.nodeIds) {\r\n\r\n            // get the node ids that are currently required for the milestone\r\n            let nodeIds = this.milestone.params.nodeIds;\r\n\r\n            // get the node id of the item that was clicked\r\n            let nodeId = item.$key;\r\n\r\n            if (item.checked) {\r\n                if (nodeIds.indexOf(nodeId) == -1) {\r\n                    // add the node id\r\n                    this.milestone.params.nodeIds.push(nodeId);\r\n                }\r\n            } else {\r\n                // remove the node id\r\n\r\n                // loop through all the node ids and remove the node id\r\n                for (var n = nodeIds.length - 1; n >= 0; n--) {\r\n                    if (nodeId == nodeIds[n]) {\r\n                        nodeIds.splice(n, 1);\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.change();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Show the steps for an activity\r\n     * @param groupId the node id for the activity\r\n     */\r\n    toggleSteps(groupId) {\r\n\r\n        if (groupId) {\r\n            let showSteps = !this.milestone.items[groupId].showSteps;\r\n            this.milestone.items[groupId].showSteps = showSteps;\r\n\r\n            // get all the child ids of the group\r\n            let childIds = this.ProjectService.getChildNodeIdsById(groupId);\r\n\r\n            // loop through all the child ids\r\n            for (let c = 0; c < childIds.length; c++) {\r\n                let childId = childIds[c];\r\n\r\n                if (this.milestone.items[childId] != null) {\r\n                    // show the step\r\n                    this.milestone.items[childId].show = showSteps;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if a node id is for a group\r\n     * @param nodeId\r\n     * @returns whether the node is a group node\r\n     */\r\n    isGroupNode(nodeId) {\r\n        return this.ProjectService.isGroupNode(nodeId);\r\n    };\r\n\r\n    /**\r\n     * Get the node position and title\r\n     * @param nodeId\r\n     * @returns whether node position and id display\r\n     */\r\n    getNodePositionAndTitleByNodeId(nodeId) {\r\n        return this.ProjectService.getNodePositionAndTitleByNodeId(nodeId);\r\n    };\r\n\r\n    /**\r\n     * The date input for this milestone has changed, update in milestone object\r\n     */\r\n    dateChange() {\r\n        this.milestone.params.targetDate = this.date.getTime();\r\n        this.change();\r\n    }\r\n\r\n    /**\r\n     * Data for this milestone has changed, so run the onChange callback\r\n     */\r\n    change() {\r\n        let itemsArray = Object.keys(this.milestone.items).map(it => this.milestone.items[it]);\r\n        let valid = this.$scope.milestoneEditForm.$valid && this.$filter('filter')(itemsArray, {'checked':true}).length > 0;\r\n        this.onChange({ milestone: this.milestone, valid: valid });\r\n    }\r\n}\r\n\r\nMilestoneDetailsController.$inject = [\r\n    '$filter',\r\n    '$scope',\r\n    'AchievementService',\r\n    'ProjectService',\r\n    'UtilService',\r\n    'moment'\r\n];\r\n\r\nconst MilestoneDetails = {\r\n    bindings: {\r\n        milestone: '<',\r\n        onChange: '&'\r\n    },\r\n    template:\r\n        `<div class=\"milestone-details md-whiteframe-1dp\" layout-padding>\r\n            <form name=\"milestoneEditForm\">\r\n                <h6>{{ 'DETAILS' | translate }}</h6>\r\n                <div layout-gt-xs=\"row\">\r\n                    <md-input-container class=\"md-block\" flex>\r\n                        <label>{{ 'name' | translate }}</label>\r\n                        <input name=\"milestoneName\" ng-model=\"$ctrl.milestone.name\" ng-change=\"$ctrl.change()\" required>\r\n                    </md-input-container>\r\n\r\n                    <md-input-container>\r\n                        <label>{{ 'dueDate' | translate }}</label>\r\n                        <md-datepicker name=\"date\" ng-model=\"$ctrl.date\" ng-change=\"$ctrl.dateChange()\" required></md-datepicker>\r\n                    </md-input-container>\r\n                </div>\r\n                <md-input-container class=\"md-block\" flex>\r\n                    <label>{{ 'DESCRIPTION' | translate }}</label>\r\n                    <textarea ng-model=\"$ctrl.milestone.description\" ng-change=\"$ctrl.change()\" rows=\"1\" md-select-on-focus></textarea>\r\n                </md-input-container>\r\n            </form>\r\n        </div>\r\n        <div class=\"milestone-details md-whiteframe-1dp\" layout-padding>\r\n            <form name=\"milestoneRequirementsForm\">\r\n                <h6>{{ 'REQUIREMENTS' | translate }}</h6>\r\n                <div ng-repeat=\"item in $ctrl.milestone.items | toArray | orderBy : 'order'\"\r\n                     ng-class=\"{ 'layout-margin': !$ctrl.isGroupNode(item.$key) }\"\r\n                     ng-show=\"$ctrl.isGroupNode(item.$key) || item.show\">\r\n\r\n                    <md-checkbox ng-model=\"item.checked\"\r\n                                 ng-if=\"item.order !== 0\"\r\n                                 ng-change=\"$ctrl.itemChanged(item)\"\r\n                                 aria-label=\"{{ $ctrl.getNodePositionAndTitleByNodeId(item.$key) }}\">\r\n                        <span class=\"md-body-2\">{{ $ctrl.getNodePositionAndTitleByNodeId(item.$key) }}</span>\r\n                    </md-checkbox>\r\n                    <md-button class=\"md-primary md-icon-button\"\r\n                               ng-if=\"item.order!==0 && $ctrl.isGroupNode(item.$key)\"\r\n                               ng-click=\"$ctrl.toggleSteps(item.$key)\"\r\n                               aria-label=\"{{ $ctrl.milestone.items[item.$key].showSteps ? ('hideSteps' | translate) : ('showSteps' | translate) }}\">\r\n                        <md-icon ng-if=\"!$ctrl.milestone.items[item.$key].showSteps\"> add </md-icon>\r\n                        <md-icon ng-if=\"$ctrl.milestone.items[item.$key].showSteps\"> remove </md-icon>\r\n                    </button>\r\n                </div>\r\n            </form>\r\n        </div>`,\r\n    controller: MilestoneDetailsController\r\n};\r\n\r\nexport default MilestoneDetails;\r\n"]}