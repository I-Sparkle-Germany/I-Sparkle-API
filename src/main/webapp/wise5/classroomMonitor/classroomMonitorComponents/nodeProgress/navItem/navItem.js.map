{"version":3,"sources":["navItem.es6"],"names":["NavItemController","$element","$filter","$rootScope","$scope","$state","AnnotationService","ConfigService","NodeService","NotificationService","ProjectService","StudentDataService","StudentStatusService","TeacherDataService","TeacherWebSocketService","$translate","expanded","item","idToNode","nodeId","isGroup","isGroupNode","nodeHasWork","nodeTitle","showPosition","nodeIdToNumber","title","currentNode","previousNode","isCurrentNode","id","currentPeriod","getCurrentPeriod","currentWorkgroup","getCurrentWorkgroup","setCurrentNodeStatus","maxScore","getMaxScoreForNode","workgroupsOnNodeData","isWorkgroupOnlineOnNode","isPlanning","icon","getNodeIconByNodeId","parentGroupId","parentGroup","getParentGroup","availablePlanningNodes","getAvailablePlanningNodes","isPlanningNode","setWorkgroupsOnNodeData","$onInit","hasAlert","newAlert","alertNotifications","getAlertNotifications","hasRubrics","getNumberOfRubricsByNodeId","alertIconLabel","alertIconClass","alertIconName","rubricIconLabel","rubricIconClass","rubricIconName","$watch","newNode","oldNode","isPrev","isApplicationNode","previousStep","$parent","isPrevStep","zoomToElement","prevNodeisGroup","prevNodeIsDescendant","isNodeDescendentOfGroup","value","itemExpanded","$on","event","args","setTimeout","top","offsetTop","location","delay","$","animate","scrollTop","getNodeById","endCurrentNodeAndSetCurrentNodeByNodeId","planningNodeId","maxAddAllowed","planningGroupNode","isParentGroupPlanning","a","length","availablePlanningNode","max","numPlanningNodesAdded","ids","c","childPlanningNodeId","childPlanningNode","planningNodeTemplateId","node","description","periodId","getNodeCompletion","completionPct","workgroupId","getScore","getNodeAverageScore","getWorkgroupIdsOnNode","workgroupIdsOnNode","workgroupOnlineOnNode","n","i","usernames","getDisplayUserNamesByWorkgroupId","avatarColor","getAvatarColorForWorkgroupId","online","isStudentOnline","push","studentStatus","getStudentStatusForWorkgroupId","currentNodeStatus","nodeStatuses","toWorkgroupId","hasNewAlert","result","nAlerts","alert","timeDismissed","$inject","NavItem","bindings","type","templateUrl","controller"],"mappings":"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","file":"navItem.js","sourcesContent":["\"use strict\";\r\n\r\nclass NavItemController {\r\n    constructor($element,\r\n                $filter,\r\n                $rootScope,\r\n                $scope,\r\n                $state,\r\n                AnnotationService,\r\n                ConfigService,\r\n                NodeService,\r\n                NotificationService,\r\n                ProjectService,\r\n                StudentDataService,\r\n                StudentStatusService,\r\n                TeacherDataService,\r\n                TeacherWebSocketService) {\r\n\r\n        this.$element = $element;\r\n        this.$filter = $filter;\r\n        this.$rootScope = $rootScope;\r\n        this.$scope = $scope;\r\n        this.$state = $state;\r\n        this.AnnotationService = AnnotationService;\r\n        this.ConfigService = ConfigService;\r\n        this.NodeService = NodeService;\r\n        this.NotificationService = NotificationService;\r\n        this.ProjectService = ProjectService;\r\n        this.StudentDataService = StudentDataService;\r\n        this.StudentStatusService = StudentStatusService;\r\n        this.TeacherDataService = TeacherDataService;\r\n        this.TeacherWebSocketService = TeacherWebSocketService;\r\n\r\n        this.$translate = this.$filter('translate');\r\n\r\n        this.expanded = false;\r\n\r\n        this.item = this.ProjectService.idToNode[this.nodeId];\r\n        this.isGroup = this.ProjectService.isGroupNode(this.nodeId);\r\n        this.nodeHasWork = this.ProjectService.nodeHasWork(this.nodeId);\r\n\r\n        this.nodeTitle = this.showPosition ? (this.ProjectService.nodeIdToNumber[this.nodeId] + ': ' + this.item.title) : this.item.title;\r\n        this.currentNode = this.TeacherDataService.currentNode;\r\n        this.previousNode = null;\r\n        this.isCurrentNode = (this.currentNode.id === this.nodeId);\r\n\r\n        // the current period\r\n        this.currentPeriod = this.TeacherDataService.getCurrentPeriod();\r\n\r\n        // the current workgroup\r\n        this.currentWorkgroup = this.TeacherDataService.getCurrentWorkgroup();\r\n        this.setCurrentNodeStatus();\r\n\r\n        // the max score for the node\r\n        this.maxScore = this.ProjectService.getMaxScoreForNode(this.nodeId);\r\n\r\n        // an object to hold workgroups currently visiting this node\r\n        this.workgroupsOnNodeData = [];\r\n\r\n        // whether there is at least one workgroup both online and on this node\r\n        this.isWorkgroupOnlineOnNode = false;\r\n\r\n        // whether this node is a planning group\r\n        this.isPlanning = this.ProjectService.isPlanning(this.nodeId);\r\n\r\n        // get the node icon\r\n        this.icon = this.ProjectService.getNodeIconByNodeId(this.nodeId);\r\n\r\n        this.parentGroupId = null;\r\n\r\n        var parentGroup = this.ProjectService.getParentGroup(this.nodeId);\r\n\r\n        if (parentGroup != null) {\r\n            this.parentGroupId = parentGroup.id;\r\n        }\r\n\r\n        if (this.isPlanning) {\r\n            /*\r\n             * planning is enabled for this group so we will get the available\r\n             * planning nodes that can be used\r\n             */\r\n            this.availablePlanningNodes = this.ProjectService.getAvailablePlanningNodes(this.nodeId);\r\n        } else if (this.isPlanningNode) {\r\n            /* this is an available planning node for its parent group, so we\r\n             * need to calculate the total number of times it has been added\r\n             * to the project by all the workgroups in the current period\r\n             */\r\n\r\n        }\r\n\r\n        this.setWorkgroupsOnNodeData();\r\n\r\n        this.$onInit = () => {\r\n            this.hasAlert = false;\r\n            this.newAlert = false;\r\n            this.alertNotifications = [];\r\n\r\n            this.getAlertNotifications();\r\n\r\n            this.hasRubrics = this.ProjectService.getNumberOfRubricsByNodeId(this.nodeId) > 0;\r\n            this.alertIconLabel = this.$translate('HAS_ALERTS_NEW');\r\n            this.alertIconClass = 'warn';\r\n            this.alertIconName = 'notifications';\r\n            this.rubricIconLabel = this.$translate('STEP_HAS_TEACHING_TIPS');\r\n            this.rubricIconClass = 'info';\r\n            this.rubricIconName = 'info';\r\n        };\r\n\r\n        this.$scope.$watch(\r\n            () => { return this.TeacherDataService.currentNode; },\r\n            (newNode, oldNode) => {\r\n                this.currentNode = newNode;\r\n                this.previousNode = oldNode;\r\n                this.isCurrentNode = (this.nodeId === newNode.id);\r\n                let isPrev = false;\r\n\r\n                if (this.ProjectService.isApplicationNode(newNode.id)) {\r\n                    return;\r\n                }\r\n\r\n                if (oldNode) {\r\n                    isPrev = (this.nodeId === oldNode.id);\r\n\r\n                    if (this.TeacherDataService.previousStep) {\r\n                        this.$scope.$parent.isPrevStep = (this.nodeId === this.TeacherDataService.previousStep.id);\r\n                    }\r\n\r\n                    if (isPrev && !this.isGroup) {\r\n                        this.zoomToElement();\r\n                    }\r\n                }\r\n\r\n                if (this.isGroup) {\r\n                    let prevNodeisGroup = (!oldNode || this.ProjectService.isGroupNode(oldNode.id));\r\n                    let prevNodeIsDescendant = this.ProjectService.isNodeDescendentOfGroup(oldNode, this.item);\r\n                    if (this.isCurrentNode) {\r\n                        this.expanded = true;\r\n                        if (prevNodeisGroup || !prevNodeIsDescendant) {\r\n                            this.zoomToElement();\r\n                        }\r\n                    } else {\r\n                        if (!prevNodeisGroup) {\r\n                            if (prevNodeIsDescendant) {\r\n                                this.expanded = true;\r\n                            } else {\r\n                                this.expanded = false;\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (isPrev && this.ProjectService.isNodeDescendentOfGroup(this.item, newNode)) {\r\n                        this.zoomToElement();\r\n                    }\r\n                }\r\n            }\r\n        );\r\n\r\n        this.$scope.$watch(\r\n            () => { return this.expanded; },\r\n            (value) => {\r\n                this.$scope.$parent.itemExpanded = value;\r\n            }\r\n        );\r\n\r\n        // listen for the studentsOnlineReceived event\r\n        this.$rootScope.$on('studentsOnlineReceived', (event, args) => {\r\n            this.setWorkgroupsOnNodeData();\r\n        });\r\n\r\n        // listen for the studentStatusReceived event\r\n        this.$rootScope.$on('studentStatusReceived', (event, args) => {\r\n            this.setWorkgroupsOnNodeData();\r\n            this.setCurrentNodeStatus();\r\n        });\r\n\r\n        // listen for the currentPeriodChanged event\r\n        this.$rootScope.$on('currentPeriodChanged', (event, args) => {\r\n            this.currentPeriod = args.currentPeriod;\r\n            this.setWorkgroupsOnNodeData();\r\n            this.getAlertNotifications();\r\n        });\r\n\r\n        // listen for the currentWorkgroupChanged event\r\n        this.$rootScope.$on('currentWorkgroupChanged', (event, args) => {\r\n            this.currentWorkgroup = args.currentWorkgroup;\r\n            this.setCurrentNodeStatus();\r\n            this.getAlertNotifications();\r\n        });\r\n    }\r\n\r\n    zoomToElement() {\r\n        setTimeout(()=> {\r\n            // smooth scroll to expanded group's page location\r\n            let top = this.$element[0].offsetTop;\r\n            let location = this.isGroup ? top - 32 : top - 80;\r\n            let delay = 350;\r\n            $('#content').animate({\r\n                scrollTop: location\r\n            }, delay, 'linear');\r\n        }, 500);\r\n    }\r\n\r\n    itemClicked(event) {\r\n        let previousNode = this.TeacherDataService.currentNode;\r\n        let currentNode = this.ProjectService.getNodeById(this.nodeId);\r\n        if (this.isGroup) {\r\n            this.expanded = !this.expanded;\r\n            if (this.expanded) {\r\n                if (this.isCurrentNode) {\r\n                    this.zoomToElement();\r\n                } else {\r\n                    this.TeacherDataService.endCurrentNodeAndSetCurrentNodeByNodeId(this.nodeId);\r\n                }\r\n            }\r\n        } else {\r\n            this.TeacherDataService.endCurrentNodeAndSetCurrentNodeByNodeId(this.nodeId);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns the max times a planning node can be added to the project (-1 is\r\n     * is returned if there is no limit)\r\n     * @param planningNodeId\r\n     */\r\n    getPlannindNodeMaxAllowed(planningNodeId) {\r\n        let maxAddAllowed = -1;  // by default, students can add as many instances as they want\r\n        let planningGroupNode = null;\r\n        if (this.isParentGroupPlanning) {\r\n            planningGroupNode = this.ProjectService.getNodeById(this.parentGroupId);\r\n        } else {\r\n            planningGroupNode = this.ProjectService.getNodeById(this.nodeId);\r\n        }\r\n        // get the maxAddAllowed value by looking up the planningNode in the project.\r\n        if (planningGroupNode && planningGroupNode.availablePlanningNodes) {\r\n            for (let a = 0; a < planningGroupNode.availablePlanningNodes.length; a++) {\r\n                let availablePlanningNode = planningGroupNode.availablePlanningNodes[a];\r\n                if (availablePlanningNode.nodeId === planningNodeId && availablePlanningNode.max != null) {\r\n                    maxAddAllowed = availablePlanningNode.max;\r\n                }\r\n            }\r\n        }\r\n\r\n        return maxAddAllowed;\r\n    }\r\n\r\n    /**\r\n     * Returns the number of times a planning node has been added to the project\r\n     * @param planningNodeId\r\n     */\r\n    getNumPlannindNodeInstances(planningNodeId) {\r\n        let numPlanningNodesAdded = 0;  // keep track of number of instances\r\n        // otherwise, see how many times the planning node template has been used.\r\n\r\n        let planningGroupNode = null;\r\n        if (this.isParentGroupPlanning) {\r\n            planningGroupNode = this.ProjectService.getNodeById(this.parentGroupId);\r\n        } else {\r\n            planningGroupNode = this.ProjectService.getNodeById(this.nodeId);\r\n        }\r\n\r\n        // loop through the child ids in the planning group and see how many times they've been used\r\n        if (planningGroupNode && planningGroupNode.ids) {\r\n            for (let c = 0; c < planningGroupNode.ids.length; c++) {\r\n                let childPlanningNodeId = planningGroupNode.ids[c];\r\n                let childPlanningNode = this.ProjectService.getNodeById(childPlanningNodeId);\r\n                if (childPlanningNode != null && childPlanningNode.planningNodeTemplateId === planningNodeId) {\r\n                    numPlanningNodesAdded++;\r\n                }\r\n            }\r\n        }\r\n\r\n        return numPlanningNodesAdded;\r\n    }\r\n\r\n    /**\r\n     * Get the node title\r\n     * @param nodeId get the title for this node\r\n     * @returns the title for the node\r\n     */\r\n    getNodeTitle(nodeId) {\r\n        var node = this.ProjectService.idToNode[nodeId];\r\n        var title = null;\r\n\r\n        if (node != null) {\r\n            title = node.title;\r\n        }\r\n\r\n        return title;\r\n    }\r\n\r\n    /**\r\n     * Get the node description\r\n     * @param nodeId get the description for this node\r\n     * @returns the description for the node\r\n     */\r\n    getNodeDescription(nodeId) {\r\n        var node = this.ProjectService.idToNode[nodeId];\r\n        var description = null;\r\n\r\n        if (node != null) {\r\n            description = node.description;\r\n        }\r\n\r\n        return description;\r\n    }\r\n\r\n    /**\r\n     * Get the percentage of the node that the class or period has completed\r\n     * @returns the percentage of the node that the class or period has completed\r\n     */\r\n    getNodeCompletion() {\r\n        // get completion for all students in the current period\r\n        let periodId = this.currentPeriod.periodId;\r\n        return this.StudentStatusService.getNodeCompletion(this.nodeId, periodId, null, true).completionPct;\r\n    }\r\n\r\n    /**\r\n     * Get the average score for the node\r\n     * @returns the average score for the node\r\n     */\r\n    getNodeAverageScore() {\r\n        // get the currently seleceted workgroupId\r\n        let workgroupId = this.currentWorkgroup ? this.currentWorkgroup.workgroupId : null;\r\n\r\n        if (workgroupId) {\r\n            // get and return score for currently selected workgroup\r\n            return this.AnnotationService.getScore(workgroupId, this.nodeId);\r\n        } else {\r\n            // there is no currently selected workgroup, so get the currently selected period\r\n            let periodId = this.currentPeriod.periodId;\r\n\r\n            // get and return the average score for the node\r\n            return this.StudentStatusService.getNodeAverageScore(this.nodeId, periodId);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the workgroup ids on this node in the current period\r\n     * @returns an array of workgroup ids on a node in a period\r\n     */\r\n    getWorkgroupIdsOnNode() {\r\n        // get the currently selected period\r\n        let periodId = this.currentPeriod.periodId;\r\n\r\n        // get the workgroups that are on the node in the period\r\n        return this.StudentStatusService.getWorkgroupIdsOnNode(this.nodeId, periodId);\r\n    }\r\n\r\n    setWorkgroupsOnNodeData() {\r\n        let workgroupIdsOnNode = this.getWorkgroupIdsOnNode();\r\n        let workgroupOnlineOnNode = false;\r\n        this.workgroupsOnNodeData = [];\r\n\r\n        let n = workgroupIdsOnNode.length;\r\n        for (let i = 0; i < n; i++) {\r\n            let id = workgroupIdsOnNode[i];\r\n\r\n            let usernames = this.ConfigService.getDisplayUserNamesByWorkgroupId(id);\r\n            let avatarColor = this.ConfigService.getAvatarColorForWorkgroupId(id);\r\n            let online = this.TeacherWebSocketService.isStudentOnline(id);\r\n            if (online) {\r\n                workgroupOnlineOnNode = true;\r\n            }\r\n\r\n            this.workgroupsOnNodeData.push({\r\n                'workgroupId': id,\r\n                'usernames': usernames,\r\n                'avatarColor': avatarColor,\r\n                'online': online\r\n            });\r\n        }\r\n\r\n        this.isWorkgroupOnlineOnNode = workgroupOnlineOnNode;\r\n    }\r\n\r\n    setCurrentNodeStatus() {\r\n        if (this.currentWorkgroup) {\r\n            // get the workgroup's studentStatus\r\n            let studentStatus = this.StudentStatusService.getStudentStatusForWorkgroupId(this.currentWorkgroup.workgroupId);\r\n\r\n            // get the current node status\r\n            this.currentNodeStatus = studentStatus.nodeStatuses[this.nodeId];\r\n        }\r\n    }\r\n\r\n    getAlertNotifications() {\r\n        // get the currently selected period\r\n        let periodId = this.currentPeriod.periodId;\r\n        let workgroupId = this.currentWorkgroup ? this.currentWorkgroup.workgroupId : null;\r\n\r\n        let args = {};\r\n        args.nodeId = this.nodeId;\r\n        args.periodId = periodId;\r\n        args.toWorkgroupId = workgroupId;\r\n        this.alertNotifications = this.NotificationService.getAlertNotifications(args);\r\n\r\n        this.hasAlert = (this.alertNotifications.length > 0);\r\n        this.newAlert = this.hasNewAlert();\r\n    }\r\n\r\n    hasNewAlert() {\r\n        let result = false;\r\n\r\n        let nAlerts = this.alertNotifications.length;\r\n        for (let i = 0; i < nAlerts; i++) {\r\n            let alert = this.alertNotifications[i];\r\n\r\n            if (!alert.timeDismissed) {\r\n                result = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n}\r\n\r\nNavItemController.$inject = [\r\n    '$element',\r\n    '$filter',\r\n    '$rootScope',\r\n    '$scope',\r\n    '$state',\r\n    'AnnotationService',\r\n    'ConfigService',\r\n    'NodeService',\r\n    'NotificationService',\r\n    'ProjectService',\r\n    'StudentDataService',\r\n    'StudentStatusService',\r\n    'TeacherDataService',\r\n    'TeacherWebSocketService'\r\n];\r\n\r\nconst NavItem = {\r\n    bindings: {\r\n        nodeId: '<',\r\n        showPosition: '<',\r\n        type: '<',\r\n        isPlanningNode: '<'\r\n    },\r\n    templateUrl: 'wise5/classroomMonitor/classroomMonitorComponents/nodeProgress/navItem/navItem.html',\r\n    controller: NavItemController\r\n};\r\n\r\nexport default NavItem;\r\n"]}