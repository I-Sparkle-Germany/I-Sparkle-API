{"version":3,"sources":["componentRevisionsInfo.es6"],"names":["ComponentRevisionsInfoController","$filter","$mdDialog","$scope","ConfigService","TeacherDataService","$translate","$onInit","runId","getRunId","toUserInfo","getUserInfoByWorkgroupId","toWorkgroupId","periodId","userNamesArray","getUserNamesByWorkgroupId","userNames","map","obj","name","join","$onChanges","changes","latest","active","componentStates","getComponentStatesByWorkgroupIdAndComponentId","componentId","total","length","componentState","push","serverSaveTime","latestComponentStateTime","convertToClientTimestamp","latestComponentStateIsSubmit","isSubmit","$event","workgroupId","show","parent","angular","element","document","body","targetEvent","fullscreen","template","locals","controller","RevisionsController","close","hide","$inject","ComponentRevisionsInfo","bindings"],"mappings":"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","file":"componentRevisionsInfo.js","sourcesContent":["'use strict';\r\n\r\nclass ComponentRevisionsInfoController {\r\n    constructor($filter,\r\n                $mdDialog,\r\n                $scope,\r\n                ConfigService,\r\n                TeacherDataService) {\r\n        this.$filter = $filter;\r\n        this.$mdDialog = $mdDialog;\r\n        this.$scope = $scope;\r\n        this.ConfigService = ConfigService;\r\n        this.TeacherDataService = TeacherDataService;\r\n\r\n        this.$translate = this.$filter('translate');\r\n\r\n        this.$onInit = () => {\r\n            this.runId = this.ConfigService.getRunId();\r\n\r\n            let toUserInfo = this.ConfigService.getUserInfoByWorkgroupId(this.toWorkgroupId);\r\n            if (toUserInfo) {\r\n                // set the period id\r\n                this.periodId = toUserInfo.periodId;\r\n            }\r\n\r\n            // get the workgroup user names\r\n            let userNamesArray = this.ConfigService.getUserNamesByWorkgroupId(this.toWorkgroupId);\r\n            this.userNames = userNamesArray.map( (obj) => {\r\n                return obj.name;\r\n            }).join(', ');\r\n        };\r\n\r\n        this.$onChanges = (changes) => {\r\n            let latest = null;\r\n\r\n            if (this.active) {\r\n                // get all the componentStates for this workgroup\r\n                this.componentStates = this.TeacherDataService.getComponentStatesByWorkgroupIdAndComponentId(this.toWorkgroupId, this.componentId);\r\n                let total = this.componentStates.length;\r\n\r\n                if (total > 0) {\r\n                    latest = this.componentStates[total-1];\r\n                }\r\n            } else if (this.componentState){\r\n                // we're only showing info for a single component state\r\n                latest = this.componentState;\r\n                this.componentStates = [];\r\n                this.componentStates.push(latest);\r\n            }\r\n\r\n            if (latest) {\r\n                // calculate the save time of the latest component state\r\n                let serverSaveTime = latest.serverSaveTime;\r\n                this.latestComponentStateTime = this.ConfigService.convertToClientTimestamp(serverSaveTime);\r\n\r\n                // check if the latest component state is a submit\r\n                this.latestComponentStateIsSubmit = latest.isSubmit;\r\n            }\r\n        };\r\n    }\r\n\r\n    showRevisions($event) {\r\n        let workgroupId = this.toWorkgroupId;\r\n        let componentId = this.componentId;\r\n        let userNames = this.userNames;\r\n        let componentStates = this.componentStates;\r\n\r\n        this.$mdDialog.show({\r\n            parent: angular.element(document.body),\r\n            targetEvent: $event,\r\n            fullscreen: true,\r\n            template:\r\n                `<md-dialog aria-label=\"{{ 'revisionsForTeam' | translate:{teamNames: userNames} }}\" class=\"dialog--wider\">\r\n                    <md-toolbar>\r\n                        <div class=\"md-toolbar-tools\">\r\n                            <h2 class=\"overflow--ellipsis\">{{ 'revisionsForTeam' | translate:{teamNames: userNames} }}</h2>\r\n                        </div>\r\n                    </md-toolbar>\r\n                    <md-dialog-content>\r\n                        <div class=\"md-dialog-content gray-lighter-bg\">\r\n                            <workgroup-component-revisions component-states=\"componentStates\"\r\n                                                           workgroup-id=\"{{ workgroupId }}\"></workgroup-component-revisions>\r\n                        </div>\r\n                    </md-dialog-content>\r\n                    <md-dialog-actions layout=\"row\" layout-align=\"end center\">\r\n                        <md-button class=\"md-primary\" ng-click=\"close()\" aria-label=\"{{ 'close' | translate }}\">{{ 'close' | translate }}</md-button>\r\n                    </md-dialog-actions>\r\n                </md-dialog>`,\r\n            locals: {\r\n                workgroupId: workgroupId,\r\n                componentId: componentId,\r\n                userNames: userNames,\r\n                componentStates: componentStates\r\n            },\r\n            controller: RevisionsController\r\n        });\r\n        function RevisionsController($scope, $mdDialog, workgroupId, componentId, userNames, componentStates) {\r\n            $scope.workgroupId = workgroupId;\r\n            $scope.componentId = componentId;\r\n            $scope.userNames = userNames;\r\n            $scope.componentStates = componentStates;\r\n            $scope.close = () => {\r\n                $mdDialog.hide();\r\n            };\r\n        }\r\n        RevisionsController.$inject = [\"$scope\", \"$mdDialog\", \"workgroupId\", \"componentId\", \"userNames\", \"componentStates\"];\r\n    }\r\n}\r\n\r\nComponentRevisionsInfoController.$inject = [\r\n    '$filter',\r\n    '$mdDialog',\r\n    '$scope',\r\n    'ConfigService',\r\n    'TeacherDataService'\r\n];\r\n\r\nconst ComponentRevisionsInfo = {\r\n    bindings: {\r\n        active: '<',\r\n        componentId: '<',\r\n        componentState: '<',\r\n        toWorkgroupId: '<'\r\n    },\r\n    template:\r\n        `<div class=\"component__actions__info component--grading__actions__info md-caption\">\r\n            <span ng-if=\"$ctrl.componentStates.length > 0\">\r\n                <span ng-if=\"$ctrl.latestComponentStateIsSubmit\">{{ 'SUBMITTED' | translate }} </span>\r\n                <span ng-if=\"!$ctrl.latestComponentStateIsSubmit\">{{ 'SAVED' | translate }} </span>\r\n                <span ng-if=\"$ctrl.active\">\r\n                    <span class=\"component__actions__more\" am-time-ago=\"$ctrl.latestComponentStateTime\"></span>\r\n                    <md-tooltip md-direction=\"top\">{{ $ctrl.latestComponentStateTime | amDateFormat:'ddd MMM D YYYY, h:mm a' }}</md-tooltip>\r\n                </span>\r\n                <span ng-if=\"!$ctrl.active\">{{ $ctrl.latestComponentStateTime | amDateFormat:'ddd MMM D YYYY, h:mm a' }}</span>\r\n            </span>\r\n            <span ng-if=\"$ctrl.componentStates.length === 0\">{{ 'TEAM_HAS_NOT_SAVED_ANY_WORK' | translate }}</span>\r\n            <span ng-if=\"$ctrl.active && $ctrl.componentStates.length > 0\">\r\n                &#8226;&nbsp;<a ng-click=\"$ctrl.showRevisions($event)\" translate=\"SEE_REVISIONS\" translate-value-number=\"{{($ctrl.componentStates.length - 1)}}\"></a>\r\n           </span>\r\n    </div>`,\r\n    controller: ComponentRevisionsInfoController\r\n};\r\n\r\nexport default ComponentRevisionsInfo;\r\n"]}