{"version":3,"sources":["periodSelect.es6"],"names":["PeriodSelectController","$scope","ProjectService","StudentStatusService","TeacherDataService","startNodeId","getStartNodeId","rootNodeId","getRootNode","id","currentPeriod","periods","initializePeriods","$on","event","args","getPeriods","getCurrentPeriod","length","setCurrentPeriod","n","i","period","periodId","numWorkgroupsInPeriod","getNumberOfWorkgroupsInPeriod","getWorkgroupIdsOnNode","$inject","PeriodSelect","template","controller"],"mappings":"AAAA;;;;;;;;;;IAEMA,sB;AACF,oCAAYC,MAAZ,EACYC,cADZ,EAEYC,oBAFZ,EAGYC,kBAHZ,EAGgC;AAAA;;AAAA;;AAC5B,aAAKH,MAAL,GAAcA,MAAd;AACA,aAAKC,cAAL,GAAsBA,cAAtB;AACA,aAAKC,oBAAL,GAA4BA,oBAA5B;AACA,aAAKC,kBAAL,GAA0BA,kBAA1B;;AAEA,YAAIC,cAAc,KAAKH,cAAL,CAAoBI,cAApB,EAAlB;AACA,aAAKC,UAAL,GAAkB,KAAKL,cAAL,CAAoBM,WAApB,CAAgCH,WAAhC,EAA6CI,EAA/D;;AAEA,aAAKC,aAAL,GAAqB,IAArB;AACA,aAAKC,OAAL,GAAe,EAAf;AACA,aAAKC,iBAAL;;AAEA;;;AAGA,aAAKX,MAAL,CAAYY,GAAZ,CAAgB,sBAAhB,EAAwC,UAACC,KAAD,EAAQC,IAAR,EAAiB;AACrD,kBAAKL,aAAL,GAAqBK,KAAKL,aAA1B;AACH,SAFD;AAGH;;;;;;AAED;;;4CAGoB;AAChB,iBAAKC,OAAL,GAAe,KAAKP,kBAAL,CAAwBY,UAAxB,EAAf;;AAEA;AACA,gBAAI,KAAKC,gBAAL,EAAJ,EAA6B;AACzB,qBAAKP,aAAL,GAAqB,KAAKO,gBAAL,EAArB;AACH,aAFD,MAEO;AACH,oBAAI,KAAKN,OAAL,IAAgB,IAAhB,IAAwB,KAAKA,OAAL,CAAaO,MAAb,GAAsB,CAAlD,EAAqD;AACjD;AACA,yBAAKC,gBAAL,CAAsB,KAAKR,OAAL,CAAa,CAAb,CAAtB;AACH;AACJ;;AAED;AACA,gBAAIS,IAAI,KAAKT,OAAL,CAAaO,MAArB;AACA,iBAAK,IAAIG,IAAI,CAAb,EAAgBA,IAAID,CAApB,EAAuBC,GAAvB,EAA4B;AACxB,oBAAIC,SAAS,KAAKX,OAAL,CAAaU,CAAb,CAAb;AACA,oBAAIZ,KAAMY,MAAM,CAAP,GAAY,CAAC,CAAb,GAAiBC,OAAOC,QAAjC;AACA,oBAAIC,wBAAwB,KAAKC,6BAAL,CAAmChB,EAAnC,CAA5B;;AAEAa,uBAAOE,qBAAP,GAA+BA,qBAA/B;AACH;AACJ;;AAED;;;;;;+CAGuB;AACnB,iBAAKL,gBAAL,CAAsB,KAAKT,aAA3B;AACH;;AAED;;;;;;;yCAIiBY,M,EAAQ;AACrB,iBAAKlB,kBAAL,CAAwBe,gBAAxB,CAAyCG,MAAzC;AACH;;AAED;;;;;;2CAGmB;AACf,mBAAO,KAAKlB,kBAAL,CAAwBa,gBAAxB,EAAP;AACH;;AAED;;;;;;;;sDAK8BM,Q,EAAU;AACpC;AACA,mBAAO,KAAKpB,oBAAL,CAA0BuB,qBAA1B,CAAgD,KAAKnB,UAArD,EAAiEgB,QAAjE,EAA2EL,MAAlF;AACH;;;;;;AAGLlB,uBAAuB2B,OAAvB,GAAiC,CAC7B,QAD6B,EAE7B,gBAF6B,EAG7B,sBAH6B,EAI7B,oBAJ6B,CAAjC;;AAOA,IAAMC,eAAe;AACjBC,uoCADiB;AAmBjBC,gBAAY9B;AAnBK,CAArB;;kBAsBe4B,Y","file":"periodSelect.js","sourcesContent":["\"use strict\";\r\n\r\nclass PeriodSelectController {\r\n    constructor($scope,\r\n                ProjectService,\r\n                StudentStatusService,\r\n                TeacherDataService) {\r\n        this.$scope = $scope;\r\n        this.ProjectService = ProjectService;\r\n        this.StudentStatusService = StudentStatusService;\r\n        this.TeacherDataService = TeacherDataService;\r\n\r\n        let startNodeId = this.ProjectService.getStartNodeId();\r\n        this.rootNodeId = this.ProjectService.getRootNode(startNodeId).id;\r\n\r\n        this.currentPeriod = null;\r\n        this.periods = [];\r\n        this.initializePeriods();\r\n\r\n        /**\r\n         * Listen for current period changed event\r\n         */\r\n        this.$scope.$on('currentPeriodChanged', (event, args) => {\r\n            this.currentPeriod = args.currentPeriod;\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Initialize the periods\r\n     */\r\n    initializePeriods() {\r\n        this.periods = this.TeacherDataService.getPeriods();\r\n\r\n        // set the current period if it hasn't been set yet\r\n        if (this.getCurrentPeriod()) {\r\n            this.currentPeriod = this.getCurrentPeriod();\r\n        } else {\r\n            if (this.periods != null && this.periods.length > 0) {\r\n                // set it to the all periods option\r\n                this.setCurrentPeriod(this.periods[0]);\r\n            }\r\n        }\r\n\r\n        // set the number of workgroups in each period\r\n        let n = this.periods.length;\r\n        for (let i = 0; i < n; i++) {\r\n            let period = this.periods[i];\r\n            let id = (i === 0) ? -1 : period.periodId;\r\n            let numWorkgroupsInPeriod = this.getNumberOfWorkgroupsInPeriod(id);\r\n\r\n            period.numWorkgroupsInPeriod = numWorkgroupsInPeriod;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The current period was changed\r\n     */\r\n    currentPeriodChanged() {\r\n        this.setCurrentPeriod(this.currentPeriod);\r\n    }\r\n\r\n    /**\r\n     * Set the current period\r\n     * @param period the period object\r\n     */\r\n    setCurrentPeriod(period) {\r\n        this.TeacherDataService.setCurrentPeriod(period);\r\n    }\r\n\r\n    /**\r\n     * Get the current period\r\n     */\r\n    getCurrentPeriod() {\r\n        return this.TeacherDataService.getCurrentPeriod();\r\n    }\r\n\r\n    /**\r\n     * Get the number of workgroups in period with the given periodId\r\n     * @param periodId the period id\r\n     * @returns the number of workgroups that are in the period\r\n     */\r\n    getNumberOfWorkgroupsInPeriod(periodId) {\r\n        // get and return the number of workgroups that are in the period\r\n        return this.StudentStatusService.getWorkgroupIdsOnNode(this.rootNodeId, periodId).length;\r\n    }\r\n}\r\n\r\nPeriodSelectController.$inject = [\r\n    '$scope',\r\n    'ProjectService',\r\n    'StudentStatusService',\r\n    'TeacherDataService'\r\n];\r\n\r\nconst PeriodSelect = {\r\n    template:\r\n        `<md-select ng-model=\"$ctrl.currentPeriod\"\r\n                    ng-model-options=\"{trackBy: '$value.periodId'}\"\r\n                    class=\"md-no-underline md-button md-raised\"\r\n                    ng-change=\"$ctrl.currentPeriodChanged()\"\r\n                    aria-label=\"{{'selectPeriod' | translate}}\">\r\n            <md-option ng-repeat=\"period in $ctrl.periods\" ng-value=\"period\">\r\n                <span ng-if=\"period.periodId === -1\" translate=\"allPeriods\"></span>\r\n                <span ng-if=\"period.periodId != -1\" translate=\"periodLabel\" translate-value-name=\"{{ period.periodName }}\"></span>\r\n                <span class=\"text-secondary\">\r\n                    (<ng-pluralize count=\"period.numWorkgroupsInPeriod\"\r\n                        when=\"{'0': '{{&quot;numberOfTeams_0&quot; | translate}}',\r\n                            'one': '{{&quot;numberOfTeams_1&quot; | translate}}',\r\n                            'other': '{{&quot;numberOfTeams_other&quot; | translate:{count: period.numWorkgroupsInPeriod} }}'}\">\r\n                    </ng-pluralize>)\r\n                </span>\r\n            </md-option>\r\n        </md-select>`,\r\n    controller: PeriodSelectController\r\n};\r\n\r\nexport default PeriodSelect;\r\n"]}