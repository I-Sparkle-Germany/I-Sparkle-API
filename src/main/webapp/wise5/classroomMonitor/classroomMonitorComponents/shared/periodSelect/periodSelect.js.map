{"version":3,"sources":["periodSelect.es6"],"names":["PeriodSelectController","$filter","$scope","ProjectService","StudentStatusService","TeacherDataService","$translate","startNodeId","getStartNodeId","rootNodeId","getRootNode","id","currentPeriod","periods","initializePeriods","$on","event","args","getPeriods","getCurrentPeriod","length","setCurrentPeriod","n","i","period","periodId","numWorkgroupsInPeriod","getNumberOfWorkgroupsInPeriod","getWorkgroupIdsOnNode","text","periodName","name","$inject","PeriodSelect","bindings","customClass","flat","template","controller"],"mappings":"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","file":"periodSelect.js","sourcesContent":["\"use strict\";\r\n\r\nclass PeriodSelectController {\r\n    constructor($filter,\r\n                $scope,\r\n                ProjectService,\r\n                StudentStatusService,\r\n                TeacherDataService) {\r\n        this.$filter = $filter;\r\n        this.$scope = $scope;\r\n        this.ProjectService = ProjectService;\r\n        this.StudentStatusService = StudentStatusService;\r\n        this.TeacherDataService = TeacherDataService;\r\n        this.$translate = this.$filter('translate');\r\n\r\n        let startNodeId = this.ProjectService.getStartNodeId();\r\n        this.rootNodeId = this.ProjectService.getRootNode(startNodeId).id;\r\n\r\n        this.currentPeriod = null;\r\n        this.periods = [];\r\n        this.initializePeriods();\r\n\r\n        /**\r\n         * Listen for current period changed event\r\n         */\r\n        this.$scope.$on('currentPeriodChanged', (event, args) => {\r\n            this.currentPeriod = args.currentPeriod;\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Initialize the periods\r\n     */\r\n    initializePeriods() {\r\n        this.periods = this.TeacherDataService.getPeriods();\r\n\r\n        // set the current period if it hasn't been set yet\r\n        if (this.getCurrentPeriod()) {\r\n            this.currentPeriod = this.getCurrentPeriod();\r\n        } else {\r\n            if (this.periods != null && this.periods.length > 0) {\r\n                // set it to the all periods option\r\n                this.setCurrentPeriod(this.periods[0]);\r\n            }\r\n        }\r\n\r\n        // set the number of workgroups in each period\r\n        let n = this.periods.length;\r\n        for (let i = 0; i < n; i++) {\r\n            let period = this.periods[i];\r\n            let id = (i === 0) ? -1 : period.periodId;\r\n            let numWorkgroupsInPeriod = this.getNumberOfWorkgroupsInPeriod(id);\r\n\r\n            period.numWorkgroupsInPeriod = numWorkgroupsInPeriod;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The current period was changed\r\n     */\r\n    currentPeriodChanged() {\r\n        this.setCurrentPeriod(this.currentPeriod);\r\n    }\r\n\r\n    /**\r\n     * Set the current period\r\n     * @param period the period object\r\n     */\r\n    setCurrentPeriod(period) {\r\n        this.TeacherDataService.setCurrentPeriod(period);\r\n    }\r\n\r\n    /**\r\n     * Get the current period\r\n     */\r\n    getCurrentPeriod() {\r\n        return this.TeacherDataService.getCurrentPeriod();\r\n    }\r\n\r\n    /**\r\n     * Get the number of workgroups in period with the given periodId\r\n     * @param periodId the period id\r\n     * @returns the number of workgroups that are in the period\r\n     */\r\n    getNumberOfWorkgroupsInPeriod(periodId) {\r\n        // get and return the number of workgroups that are in the period\r\n        return this.StudentStatusService.getWorkgroupIdsOnNode(this.rootNodeId, periodId).length;\r\n    }\r\n\r\n    getSelectedText() {\r\n        let text = '';\r\n        if (this.currentPeriod.periodId === -1) {\r\n            return this.currentPeriod.periodName;\r\n        } else {\r\n            return this.$translate('periodLabel', { name: this.currentPeriod.periodName });\r\n        }\r\n    }\r\n}\r\n\r\nPeriodSelectController.$inject = [\r\n    '$filter',\r\n    '$scope',\r\n    'ProjectService',\r\n    'StudentStatusService',\r\n    'TeacherDataService'\r\n];\r\n\r\nconst PeriodSelect = {\r\n    bindings: {\r\n        customClass: '<',\r\n        flat: '<'\r\n    },\r\n    template:\r\n        `<md-select md-theme=\"default\"\r\n                    ng-model=\"$ctrl.currentPeriod\"\r\n                    ng-model-options=\"{ trackBy: '$value.periodId' }\"\r\n                    ng-class=\"[ $ctrl.customClass,\r\n                        {'md-no-underline md-button md-raised' : !$ctrl.flat} ]\"\r\n                    ng-change=\"$ctrl.currentPeriodChanged()\"\r\n                    aria-label=\"{{ 'selectPeriod' | translate }}\"\r\n                    md-selected-text=\"$ctrl.getSelectedText()\">\r\n            <md-option ng-repeat=\"period in $ctrl.periods\" ng-value=\"period\">\r\n                <span ng-if=\"period.periodId === -1\" translate=\"allPeriods\"></span>\r\n                <span ng-if=\"period.periodId != -1\" translate=\"periodLabel\" translate-value-name=\"{{ period.periodName }}\"></span>\r\n                <span class=\"text-secondary\">\r\n                    (<ng-pluralize count=\"period.numWorkgroupsInPeriod\"\r\n                        when=\"{'0': '{{ &quot;numberOfTeams_0&quot; | translate }}',\r\n                            'one': '{{ &quot;numberOfTeams_1&quot; | translate }}',\r\n                            'other': '{{ &quot;numberOfTeams_other&quot; | translate:{count: period.numWorkgroupsInPeriod} }}'}\">\r\n                    </ng-pluralize>)\r\n                </span>\r\n            </md-option>\r\n        </md-select>`,\r\n    controller: PeriodSelectController\r\n};\r\n\r\nexport default PeriodSelect;\r\n"]}