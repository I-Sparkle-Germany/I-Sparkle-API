{"version":3,"sources":["periodSelect.es6"],"names":["PeriodSelectController","$scope","ProjectService","StudentStatusService","TeacherDataService","startNodeId","getStartNodeId","rootNodeId","getRootNode","id","currentPeriod","periods","initializePeriods","$on","event","args","getPeriods","getCurrentPeriod","length","setCurrentPeriod","n","i","period","periodId","numWorkgroupsInPeriod","getNumberOfWorkgroupsInPeriod","getWorkgroupIdsOnNode","$inject","PeriodSelect","template","controller"],"mappings":"AAAA;;;;;;;;;;IAEMA,sB;AACF,oCAAYC,MAAZ,EACYC,cADZ,EAEYC,oBAFZ,EAGYC,kBAHZ,EAGgC;AAAA;;AAAA;;AAC5B,aAAKH,MAAL,GAAcA,MAAd;AACA,aAAKC,cAAL,GAAsBA,cAAtB;AACA,aAAKC,oBAAL,GAA4BA,oBAA5B;AACA,aAAKC,kBAAL,GAA0BA,kBAA1B;;AAEA,YAAIC,cAAc,KAAKH,cAAL,CAAoBI,cAApB,EAAlB;AACA,aAAKC,UAAL,GAAkB,KAAKL,cAAL,CAAoBM,WAApB,CAAgCH,WAAhC,EAA6CI,EAA/D;;AAEA,aAAKC,aAAL,GAAqB,IAArB;AACA,aAAKC,OAAL,GAAe,EAAf;AACA,aAAKC,iBAAL;;AAEA;;;AAGA,aAAKX,MAAL,CAAYY,GAAZ,CAAgB,sBAAhB,EAAwC,UAACC,KAAD,EAAQC,IAAR,EAAiB;AACrD,kBAAKL,aAAL,GAAqBK,KAAKL,aAA1B;AACH,SAFD;AAGH;;;;;;AAED;;;4CAGoB;AAChB,iBAAKC,OAAL,GAAe,KAAKP,kBAAL,CAAwBY,UAAxB,EAAf;;AAEA;AACA,gBAAI,KAAKC,gBAAL,EAAJ,EAA6B;AACzB,qBAAKP,aAAL,GAAqB,KAAKO,gBAAL,EAArB;AACH,aAFD,MAEO;AACH,oBAAI,KAAKN,OAAL,IAAgB,IAAhB,IAAwB,KAAKA,OAAL,CAAaO,MAAb,GAAsB,CAAlD,EAAqD;AACjD;AACA,yBAAKC,gBAAL,CAAsB,KAAKR,OAAL,CAAa,CAAb,CAAtB;AACH;AACJ;;AAED;AACA,gBAAIS,IAAI,KAAKT,OAAL,CAAaO,MAArB;AACA,iBAAK,IAAIG,IAAI,CAAb,EAAgBA,IAAID,CAApB,EAAuBC,GAAvB,EAA4B;AACxB,oBAAIC,SAAS,KAAKX,OAAL,CAAaU,CAAb,CAAb;AACA,oBAAIZ,KAAMY,MAAM,CAAP,GAAY,CAAC,CAAb,GAAiBC,OAAOC,QAAjC;AACA,oBAAIC,wBAAwB,KAAKC,6BAAL,CAAmChB,EAAnC,CAA5B;;AAEAa,uBAAOE,qBAAP,GAA+BA,qBAA/B;AACH;AACJ;;AAED;;;;;;+CAGuB;AACnB,iBAAKL,gBAAL,CAAsB,KAAKT,aAA3B;AACH;;AAED;;;;;;;yCAIiBY,M,EAAQ;AACrB,iBAAKlB,kBAAL,CAAwBe,gBAAxB,CAAyCG,MAAzC;AACH;;AAED;;;;;;2CAGmB;AACf,mBAAO,KAAKlB,kBAAL,CAAwBa,gBAAxB,EAAP;AACH;;AAED;;;;;;;;sDAK8BM,Q,EAAU;AACpC;AACA,mBAAO,KAAKpB,oBAAL,CAA0BuB,qBAA1B,CAAgD,KAAKnB,UAArD,EAAiEgB,QAAjE,EAA2EL,MAAlF;AACH;;;;;;AAGLlB,uBAAuB2B,OAAvB,GAAiC,CAC7B,QAD6B,EAE7B,gBAF6B,EAG7B,sBAH6B,EAI7B,oBAJ6B,CAAjC;;AAOA,IAAMC,eAAe;AACjBC,uoCADiB;AAmBjBC,gBAAY9B;AAnBK,CAArB;;kBAsBe4B,Y","file":"periodSelect.js","sourcesContent":["\"use strict\";\n\nclass PeriodSelectController {\n    constructor($scope,\n                ProjectService,\n                StudentStatusService,\n                TeacherDataService) {\n        this.$scope = $scope;\n        this.ProjectService = ProjectService;\n        this.StudentStatusService = StudentStatusService;\n        this.TeacherDataService = TeacherDataService;\n\n        let startNodeId = this.ProjectService.getStartNodeId();\n        this.rootNodeId = this.ProjectService.getRootNode(startNodeId).id;\n\n        this.currentPeriod = null;\n        this.periods = [];\n        this.initializePeriods();\n\n        /**\n         * Listen for current period changed event\n         */\n        this.$scope.$on('currentPeriodChanged', (event, args) => {\n            this.currentPeriod = args.currentPeriod;\n        });\n    };\n\n    /**\n     * Initialize the periods\n     */\n    initializePeriods() {\n        this.periods = this.TeacherDataService.getPeriods();\n\n        // set the current period if it hasn't been set yet\n        if (this.getCurrentPeriod()) {\n            this.currentPeriod = this.getCurrentPeriod();\n        } else {\n            if (this.periods != null && this.periods.length > 0) {\n                // set it to the all periods option\n                this.setCurrentPeriod(this.periods[0]);\n            }\n        }\n\n        // set the number of workgroups in each period\n        let n = this.periods.length;\n        for (let i = 0; i < n; i++) {\n            let period = this.periods[i];\n            let id = (i === 0) ? -1 : period.periodId;\n            let numWorkgroupsInPeriod = this.getNumberOfWorkgroupsInPeriod(id);\n\n            period.numWorkgroupsInPeriod = numWorkgroupsInPeriod;\n        }\n    }\n\n    /**\n     * The current period was changed\n     */\n    currentPeriodChanged() {\n        this.setCurrentPeriod(this.currentPeriod);\n    }\n\n    /**\n     * Set the current period\n     * @param period the period object\n     */\n    setCurrentPeriod(period) {\n        this.TeacherDataService.setCurrentPeriod(period);\n    }\n\n    /**\n     * Get the current period\n     */\n    getCurrentPeriod() {\n        return this.TeacherDataService.getCurrentPeriod();\n    }\n\n    /**\n     * Get the number of workgroups in period with the given periodId\n     * @param periodId the period id\n     * @returns the number of workgroups that are in the period\n     */\n    getNumberOfWorkgroupsInPeriod(periodId) {\n        // get and return the number of workgroups that are in the period\n        return this.StudentStatusService.getWorkgroupIdsOnNode(this.rootNodeId, periodId).length;\n    }\n}\n\nPeriodSelectController.$inject = [\n    '$scope',\n    'ProjectService',\n    'StudentStatusService',\n    'TeacherDataService'\n];\n\nconst PeriodSelect = {\n    template:\n        `<md-select ng-model=\"$ctrl.currentPeriod\"\n                    ng-model-options=\"{trackBy: '$value.periodId'}\"\n                    class=\"md-no-underline md-button md-raised\"\n                    ng-change=\"$ctrl.currentPeriodChanged()\"\n                    aria-label=\"{{'selectPeriod' | translate}}\">\n            <md-option ng-repeat=\"period in $ctrl.periods\" ng-value=\"period\">\n                <span ng-if=\"period.periodId === -1\" translate=\"allPeriods\"></span>\n                <span ng-if=\"period.periodId != -1\" translate=\"periodLabel\" translate-value-name=\"{{ period.periodName }}\"></span>\n                <span class=\"text-secondary\">\n                    (<ng-pluralize count=\"period.numWorkgroupsInPeriod\"\n                        when=\"{'0': '{{&quot;numberOfTeams_0&quot; | translate}}',\n                            'one': '{{&quot;numberOfTeams_1&quot; | translate}}',\n                            'other': '{{&quot;numberOfTeams_other&quot; | translate:{count: period.numWorkgroupsInPeriod} }}'}\">\n                    </ng-pluralize>)\n                </span>\n            </md-option>\n        </md-select>`,\n    controller: PeriodSelectController\n};\n\nexport default PeriodSelect;\n"]}