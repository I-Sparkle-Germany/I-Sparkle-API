{"version":3,"sources":["workgroupSelect.es6"],"names":["WorkgroupSelectController","$scope","ConfigService","TeacherDataService","$onInit","canViewStudentNames","getPermissions","workgroups","getClassmateUserInfos","periodId","getCurrentPeriod","selectedItem","getCurrentWorkgroup","$on","event","args","currentPeriod","workgroup","setCurrentWorkgroup","query","items","n","length","i","displayNames","byTeam","names","split","l","x","name","trim","indexOfSpace","indexOf","firstName","substring","lastName","current","angular","copy","search","RegExp","push","$inject","WorkgroupSelect","bindings","template","controller"],"mappings":"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","file":"workgroupSelect.js","sourcesContent":["\"use strict\";\n\nclass WorkgroupSelectController {\n    constructor($scope,\n                ConfigService,\n                TeacherDataService) {\n        this.$scope = $scope;\n        this.ConfigService = ConfigService;\n        this.TeacherDataService = TeacherDataService;\n\n        this.$onInit = () => {\n            this.canViewStudentNames = this.ConfigService.getPermissions().canViewStudentNames;\n            this.workgroups = this.ConfigService.getClassmateUserInfos();\n            this.periodId = this.TeacherDataService.getCurrentPeriod().periodId;\n            this.selectedItem = this.getCurrentWorkgroup();\n        };\n\n        /**\n         * Listen for current period changed event\n         */\n        this.$scope.$on('currentPeriodChanged', (event, args) => {\n            this.periodId = args.currentPeriod.periodId;\n            this.selectedItem = this.getCurrentWorkgroup();\n        });\n    };\n\n    /**\n     * Set the currently selected workgroup\n     * @param workgroup the workgroup object\n     */\n    setCurrentWorkgroup(workgroup) {\n        this.TeacherDataService.setCurrentWorkgroup(workgroup);\n    }\n\n    /**\n     * Get the current workgroup\n     * @return workgroup object\n     */\n    getCurrentWorkgroup() {\n        return this.TeacherDataService.getCurrentWorkgroup();\n    }\n\n    /**\n     * Return workgroups with username text that query string matches\n     * @param query String to search for\n     * @return Array of workgroups\n     */\n    querySearch(query) {\n        let items = [];\n        let n = this.workgroups.length;\n\n        for (let i = 0; i < n; i++) {\n            let workgroup = this.workgroups[i];\n            let periodId = workgroup.periodId;\n            if (this.periodId === -1 || periodId === this.periodId) {\n                let displayNames = workgroup.displayNames;\n\n                if (!this.byTeam && this.canViewStudentNames) {\n                    let names = displayNames.split(',');\n                    let l = names.length;\n                    for (let x = 0; x < l; x++) {\n                        let name = names[x].trim();\n                        // get the index of the first empty space\n                        let indexOfSpace = name.indexOf(' ');\n                        // get the student first name e.g. \"Spongebob\"\n                        let firstName = name.substring(0, indexOfSpace);\n                        let lastName = name.substring(indexOfSpace+1);\n\n                        let current = angular.copy(workgroup);\n                        current.displayNames = lastName + ', ' + firstName;\n                        if (current.displayNames.search(new RegExp(query, 'i')) > -1 || !query) {\n                            items.push(current);\n                        }\n                    }\n                } else {\n                    if (displayNames.search(new RegExp(query, 'i')) > -1 || !query) {\n                        items.push(workgroup);\n                    }\n                }\n            }\n        }\n\n        return items;\n    }\n\n    selectedItemChange() {\n        this.setCurrentWorkgroup(this.selectedItem);\n    }\n}\n\nWorkgroupSelectController.$inject = [\n    '$scope',\n    'ConfigService',\n    'TeacherDataService'\n];\n\nconst WorkgroupSelect = {\n    bindings: {\n        byTeam: '<'\n    },\n    template:\n        `<md-autocomplete class=\"autocomplete\"\n                          md-no-cache=\"true\"\n                          md-selected-item=\"$ctrl.selectedItem\"\n                          md-search-text=\"$ctrl.searchText\"\n                          md-selected-item-change=\"$ctrl.selectedItemChange()\"\n                          md-items=\"workgroup in $ctrl.querySearch($ctrl.searchText) | orderBy: 'displayNames'\"\n                          md-item-text=\"workgroup.displayNames\"\n                          md-min-length=\"0\"\n                          ng-init=\"$ctrl.searchText=$ctrl.selectedItem.displayNames\"\n                          placeholder=\"{{'findAStudent' | translate}}\"\n                          title=\"{{'findAStudent' | translate}}\">\n            <md-item-template>\n                <span md-highlight-text=\"$ctrl.searchText\" md-highlight-flags=\"ig\">{{workgroup.displayNames}}</span>\n            </md-item-template>\n            <md-not-found>\n                {{'noMatchesFound' | translate}}\n            </md-not-found>\n        </md-autocomplete>`,\n    controller: WorkgroupSelectController\n};\n\nexport default WorkgroupSelect;\n"]}