{"version":3,"sources":["workgroupSelect.es6"],"names":["WorkgroupSelectController","$scope","ConfigService","TeacherDataService","$onInit","workgroups","getClassmateUserInfos","periodId","getCurrentPeriod","selectedItem","getCurrentWorkgroup","$on","event","args","currentPeriod","setCurrentWorkgroup","workgroup","query","items","n","length","i","displayNames","search","RegExp","push","$inject","WorkgroupSelect","bindings","template","controller"],"mappings":"AAAA;;;;;;;;;;IAEMA,yB;AACF,uCAAYC,MAAZ,EACYC,aADZ,EAEYC,kBAFZ,EAEgC;AAAA;;AAAA;;AAC5B,aAAKF,MAAL,GAAcA,MAAd;AACA,aAAKC,aAAL,GAAqBA,aAArB;AACA,aAAKC,kBAAL,GAA0BA,kBAA1B;;AAEA,aAAKC,OAAL,GAAe,YAAM;AACjB,kBAAKC,UAAL,GAAkB,MAAKH,aAAL,CAAmBI,qBAAnB,EAAlB;AACA,kBAAKC,QAAL,GAAgB,MAAKJ,kBAAL,CAAwBK,gBAAxB,GAA2CD,QAA3D;AACA,kBAAKE,YAAL,GAAoB,MAAKC,mBAAL,EAApB;AACH,SAJD;;AAMA;;;AAGA,aAAKT,MAAL,CAAYU,GAAZ,CAAgB,sBAAhB,EAAwC,UAACC,KAAD,EAAQC,IAAR,EAAiB;AACrD,kBAAKN,QAAL,GAAgBM,KAAKC,aAAL,CAAmBP,QAAnC;;AAEA,gBAAI,MAAKE,YAAT,EAAuB;AACnB,oBAAI,MAAKF,QAAL,KAAkB,CAAC,CAAnB,IAAwB,MAAKA,QAAL,KAAkB,MAAKE,YAAL,CAAkBF,QAAhE,EAA0E;AACtE,0BAAKE,YAAL,GAAoB,IAApB;AACA,0BAAKM,mBAAL,CAAyB,IAAzB;AACH;AACJ;AACJ,SATD;;AAWA;;;AAGA;AACI;AACJ;;AAEA;;;;;;;;;;;AAWH;;;;;;AAED;;;;4CAIoBC,S,EAAW;AAC3B,iBAAKb,kBAAL,CAAwBY,mBAAxB,CAA4CC,SAA5C;AACH;;AAED;;;;;;;8CAIsB;AAClB,mBAAO,KAAKb,kBAAL,CAAwBO,mBAAxB,EAAP;AACH;;AAED;;;;;;;;oCAKYO,K,EAAO;AACf,gBAAIC,QAAQ,EAAZ;AACA,gBAAIC,IAAI,KAAKd,UAAL,CAAgBe,MAAxB;;AAEA,iBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,CAApB,EAAuBE,GAAvB,EAA4B;AACxB,oBAAIL,YAAY,KAAKX,UAAL,CAAgBgB,CAAhB,CAAhB;AACA,oBAAId,WAAWS,UAAUT,QAAzB;AACA,oBAAI,KAAKA,QAAL,KAAkB,CAAC,CAAnB,IAAwBA,aAAa,KAAKA,QAA9C,EAAwD;AACpD,wBAAIe,eAAeN,UAAUM,YAA7B;AACA,wBAAIA,aAAaC,MAAb,CAAoB,IAAIC,MAAJ,CAAWP,KAAX,EAAkB,GAAlB,CAApB,IAA8C,CAAC,CAA/C,IAAoD,CAACA,KAAzD,EAAgE;AAC5DC,8BAAMO,IAAN,CAAWT,SAAX;AACH;AACJ;AACJ;;AAED,mBAAOE,KAAP;AACH;;;6CAEoB;AACjB,iBAAKH,mBAAL,CAAyB,KAAKN,YAA9B;AACH;;;;;;AAGLT,0BAA0B0B,OAA1B,GAAoC,CAChC,QADgC,EAEhC,eAFgC,EAGhC,oBAHgC,CAApC;;AAMA,IAAMC,kBAAkB;AACpBC,cAAU,EADU;AAEpBC,g/BAFoB;AAoBpBC,gBAAY9B;AApBQ,CAAxB;;kBAuBe2B,e","file":"workgroupSelect.js","sourcesContent":["\"use strict\";\n\nclass WorkgroupSelectController {\n    constructor($scope,\n                ConfigService,\n                TeacherDataService) {\n        this.$scope = $scope;\n        this.ConfigService = ConfigService;\n        this.TeacherDataService = TeacherDataService;\n\n        this.$onInit = () => {\n            this.workgroups = this.ConfigService.getClassmateUserInfos();\n            this.periodId = this.TeacherDataService.getCurrentPeriod().periodId;\n            this.selectedItem = this.getCurrentWorkgroup();\n        };\n\n        /**\n         * Listen for current period changed event\n         */\n        this.$scope.$on('currentPeriodChanged', (event, args) => {\n            this.periodId = args.currentPeriod.periodId;\n\n            if (this.selectedItem) {\n                if (this.periodId !== -1 && this.periodId !== this.selectedItem.periodId) {\n                    this.selectedItem = null;\n                    this.setCurrentWorkgroup(null);\n                }\n            }\n        });\n\n        /**\n         * Listen for current period changed event\n         */\n        //this.$scope.$on('currentWorkgroupChanged', (event, args) => {\n            //this.currentWorkgroup = args.currentWorkgroup;\n        //});\n\n        /*this.$onChanges = (changesObj) => {\n            if (changesObj.periodId) {\n                let currentPeriodId = changesObj.periodId.currentValue;\n                if (this.selectedItem) {\n                    if (currentPeriodId !== -1 && currentPeriodId !== this.selectedItem.periodId) {\n                        this.selectedItem = null;\n                        this.setCurrentWorkgroup(null);\n                    }\n                }\n            }\n        };*/\n    };\n\n    /**\n     * Set the currently selected workgroup\n     * @param workgroup the workgroup object\n     */\n    setCurrentWorkgroup(workgroup) {\n        this.TeacherDataService.setCurrentWorkgroup(workgroup);\n    }\n\n    /**\n     * Get the current workgroup\n     * @return workgroup object\n     */\n    getCurrentWorkgroup() {\n        return this.TeacherDataService.getCurrentWorkgroup();\n    }\n\n    /**\n     * Return workgroups with username(s) content that query text matches\n     * @param query String to search for\n     * @return Array of workgroups\n     */\n    querySearch(query) {\n        let items = [];\n        let n = this.workgroups.length;\n\n        for (let i = 0; i < n; i++) {\n            let workgroup = this.workgroups[i];\n            let periodId = workgroup.periodId;\n            if (this.periodId === -1 || periodId === this.periodId) {\n                let displayNames = workgroup.displayNames;\n                if (displayNames.search(new RegExp(query, 'i')) > -1 || !query) {\n                    items.push(workgroup);\n                }\n            }\n        }\n\n        return items;\n    }\n\n    selectedItemChange() {\n        this.setCurrentWorkgroup(this.selectedItem);\n    }\n}\n\nWorkgroupSelectController.$inject = [\n    '$scope',\n    'ConfigService',\n    'TeacherDataService'\n];\n\nconst WorkgroupSelect = {\n    bindings: {},\n    template:\n        `<md-autocomplete class=\"autocomplete\"\n                          md-no-cache=\"true\"\n                          md-selected-item=\"$ctrl.selectedItem\"\n                          md-search-text=\"$ctrl.searchText\"\n                          md-selected-item-change=\"$ctrl.selectedItemChange()\"\n                          md-items=\"workgroup in $ctrl.querySearch($ctrl.searchText) | orderBy: 'displayNames'\"\n                          md-item-text=\"workgroup.displayNames\"\n                          md-min-length=\"0\"\n                          ng-init=\"$ctrl.searchText=$ctrl.selectedItem.displayNames\"\n                          placeholder=\"{{'findATeam' | translate}}\">\n            <md-item-template>\n                <span md-highlight-text=\"$ctrl.searchText\" md-highlight-flags=\"ig\">{{workgroup.displayNames}}</span>\n            </md-item-template>\n            <md-not-found>\n                {{'noMatchesFound' | translate}}\n            </md-not-found>\n        </md-autocomplete>`,\n    controller: WorkgroupSelectController\n};\n\nexport default WorkgroupSelect;\n"]}