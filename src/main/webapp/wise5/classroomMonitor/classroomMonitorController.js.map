{"version":3,"sources":["classroomMonitorController.es6"],"names":["ClassroomMonitorController","$filter","$mdDialog","$mdToast","$rootScope","$scope","$state","$window","ConfigService","NodeService","NotebookService","NotificationService","ProjectService","SessionService","TeacherDataService","TeacherWebSocketService","$translate","projectTitle","getProjectTitle","runId","getRunId","numberProject","menuOpen","showSideMenu","showToolbar","showGradeByStepTools","showPeriodSelect","views","name","icon","type","active","action","currentView","current","closeNode","isNotebookEnabled","connectionLostDisplay","build","template","hideDelay","connectionLostShown","$on","confirm","parent","angular","element","document","body","title","content","ariaLabel","ok","cancel","show","then","renewSession","forceLogOut","ev","alert","translations","serverUpdate","textContent","targetEvent","event","toState","toParams","fromState","fromParams","processUI","handleServerDisconnect","handleServerReconnect","logoPath","getThemePath","themePath","notifications","context","nodeId","componentId","componentType","category","data","saveEvent","onbeforeunload","periods","getRunStatus","p","length","period","paused","pauseScreensChanged","periodId","viewName","$current","currentViewName","showGradeByTeamTools","workgroupId","params","isApplicationNode","parseInt","mouseMoved","hide","$inject"],"mappings":"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","file":"classroomMonitorController.js","sourcesContent":["'use strict';\r\n\r\nclass ClassroomMonitorController {\r\n\r\n    constructor($filter,\r\n                $mdDialog,\r\n                $mdToast,\r\n                $rootScope,\r\n                $scope,\r\n                $state,\r\n                $window,\r\n                ConfigService,\r\n                NodeService,\r\n                NotebookService,\r\n                NotificationService,\r\n                ProjectService,\r\n                SessionService,\r\n                TeacherDataService,\r\n                TeacherWebSocketService) {\r\n\r\n        this.$filter = $filter;\r\n        this.$mdToast = $mdToast;\r\n        this.$rootScope = $rootScope;\r\n        this.$scope = $scope;\r\n        this.$state = $state;\r\n        this.$window = $window;\r\n        this.ConfigService = ConfigService;\r\n        this.NodeService = NodeService;\r\n        this.NotebookService = NotebookService;\r\n        this.NotificationService = NotificationService;\r\n        this.ProjectService = ProjectService;\r\n        this.SessionService = SessionService;\r\n        this.TeacherDataService = TeacherDataService;\r\n        this.TeacherWebSocketService = TeacherWebSocketService;\r\n\r\n        this.$translate = this.$filter('translate');\r\n\r\n        this.projectTitle = this.ProjectService.getProjectTitle();\r\n        this.runId = this.ConfigService.getRunId();\r\n\r\n        this.numberProject = true; // TODO: make dynamic or remove\r\n\r\n        this.menuOpen = false; // boolean to indicate whether monitor nav menu is open\r\n        this.showSideMenu = true; // boolean to indicate whether to show the monitor side menu\r\n        this.showToolbar = true; // boolean to indicate whether to show the monitor toolbar\r\n        this.showGradeByStepTools = false; // boolean to indicate whether to show the step toolbar\r\n        this.showPeriodSelect = false; // boolean to indicate whether to show the period select\r\n\r\n        // ui-views and their corresponding names and icons\r\n        this.views = {\r\n            'root.dashboard': {\r\n                name: this.$translate('dashboard'),\r\n                icon: 'dashboard',\r\n                type: 'primary',\r\n                active: false\r\n            },\r\n            'root.project': {\r\n                name: this.$translate('gradeByStep'),\r\n                icon: 'view_list',\r\n                type: 'primary',\r\n                action: () => {\r\n                    let currentView = this.$state.current.name;\r\n                    if (currentView === 'root.project') {\r\n                        // if we're currently grading a step, close the node when a nodeProgress menu button is clicked\r\n                        this.NodeService.closeNode();\r\n                    }\r\n                },\r\n                active: true\r\n            },\r\n            'root.teamLanding': {\r\n                name: this.$translate('gradeByTeam'),\r\n                icon: 'people',\r\n                type: 'primary',\r\n                active: true\r\n            },\r\n            'root.notebooks': {\r\n                name: this.$translate('studentNotebooks'),\r\n                icon: 'chrome_reader_mode',\r\n                type: 'primary',\r\n                active: this.NotebookService.isNotebookEnabled()\r\n            },\r\n            'root.export': {\r\n                name: this.$translate('dataExport'),\r\n                icon: 'file_download',\r\n                type: 'secondary',\r\n                active: true\r\n            },\r\n            'root.milestones': {\r\n                name: this.$translate('milestones'),\r\n                icon: 'flag',\r\n                type: 'primary',\r\n                active: false\r\n            }\r\n        };\r\n\r\n        // build server disconnect display\r\n        this.connectionLostDisplay = this.$mdToast.build({\r\n            template: `<md-toast>\r\n                        <span>{{ 'ERROR_CHECK_YOUR_INTERNET_CONNECTION' | translate }}</span>\r\n                      </md-toast>`,\r\n            hideDelay: 0\r\n        });\r\n        this.connectionLostShown = false;\r\n\r\n        // alert user when inactive for a long time\r\n        this.$scope.$on('showSessionWarning', () => {\r\n            // Appending dialog to document.body\r\n            let confirm = $mdDialog.confirm()\r\n                .parent(angular.element(document.body))\r\n                .title(this.$translate('SESSION_TIMEOUT'))\r\n                .content(this.$translate('SESSION_TIMEOUT_MESSAGE'))\r\n                .ariaLabel(this.$translate('SESSION_TIMEOUT'))\r\n                .ok(this.$translate('YES'))\r\n                .cancel(this.$translate('NO'));\r\n            $mdDialog.show(confirm).then(() => {\r\n                this.SessionService.renewSession();\r\n            }, () => {\r\n                this.SessionService.forceLogOut();\r\n            });\r\n        });\r\n\r\n        // alert user when server is going to be updated\r\n        this.$scope.$on('showRequestLogout', (ev) => {\r\n            let alert = $mdDialog.confirm()\r\n                .parent(angular.element(document.body))\r\n                .title(translations.serverUpdate)\r\n                .textContent(this.$translate('serverUpdateRequestLogoutMessage'))\r\n                .ariaLabel(this.$translate('serverUpdate'))\r\n                .targetEvent(ev)\r\n                .ok(this.$translate('ok'));\r\n\r\n            $mdDialog.show(alert).then(() => {\r\n                // do nothing\r\n            }, () => {\r\n                // do nothing\r\n            });\r\n        });\r\n\r\n        // listen for state change events\r\n        this.$rootScope.$on('$stateChangeSuccess', (event, toState, toParams, fromState, fromParams) => {\r\n            // close the menu when the state changes\r\n            this.menuOpen = false;\r\n\r\n            this.processUI();\r\n        });\r\n\r\n        // alert user when server loses connection\r\n        this.$scope.$on('serverDisconnected', () => {\r\n            this.handleServerDisconnect();\r\n        });\r\n\r\n        // remove alert when server regains connection\r\n        this.$scope.$on('serverConnected', () => {\r\n            this.handleServerReconnect();\r\n        });\r\n\r\n        // TODO: make dynamic, set somewhere like in config?\r\n        this.logoPath = this.ProjectService.getThemePath() + '/images/WISE-logo-ffffff.svg';\r\n\r\n        this.processUI();\r\n\r\n        this.themePath = this.ProjectService.getThemePath();\r\n\r\n        this.notifications = this.NotificationService.notifications;\r\n\r\n        // save event when classroom monitor session is started\r\n        let context = \"ClassroomMonitor\", nodeId = null, componentId = null, componentType = null,\r\n            category = \"Navigation\", event = \"sessionStarted\", data = {};\r\n        this.TeacherDataService.saveEvent(context, nodeId, componentId, componentType, category, event, data);\r\n\r\n        // perform cleanup before the clasroom monitor tab closes\r\n        this.$window.onbeforeunload = () => {\r\n\r\n            // unpause all the periods that are currently paused\r\n\r\n            // get all the periods\r\n            var periods = this.TeacherDataService.getRunStatus().periods;\r\n\r\n            if (periods != null) {\r\n\r\n                // loop through all the periods\r\n                for (var p = 0; p < periods.length; p++) {\r\n                    var period = periods[p];\r\n\r\n                    if (period != null && period.paused) {\r\n                        // the period is paused so we will unpause it\r\n                        this.TeacherDataService.pauseScreensChanged(period.periodId, false);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update UI items based on state, show or hide relevant menus and toolbars\r\n     * TODO: remove/rework this and put items in their own ui states?\r\n     */\r\n    processUI() {\r\n        let viewName = this.$state.$current.name;\r\n        let currentView = this.views[viewName];\r\n        if (currentView) {\r\n            this.currentViewName = currentView.name;\r\n        }\r\n\r\n        this.showGradeByStepTools = false;\r\n        this.showGradeByTeamTools = false;\r\n        this.showPeriodSelect = true;\r\n        this.workgroupId = null;\r\n\r\n        if (viewName === 'root.project') {\r\n            let nodeId = this.$state.params.nodeId;\r\n            this.showGradeByStepTools = this.ProjectService.isApplicationNode(nodeId);\r\n        } else if (viewName === 'root.team') {\r\n            this.workgroupId = parseInt(this.$state.params.workgroupId);\r\n            this.showGradeByTeamTools = true;\r\n        } else if (viewName === 'root.export') {\r\n            this.showPeriodSelect = false;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Toggle the classroom monitor main menu\r\n     */\r\n    toggleMenu() {\r\n        this.menuOpen = !this.menuOpen;\r\n    }\r\n\r\n    /**\r\n     * The user has moved the mouse so we will notify the Session Service\r\n     * so that it can refresh the session\r\n     */\r\n    mouseMoved() {\r\n        /*\r\n         * notify the Session Service that the user has moved the mouse\r\n         * so we can refresh the session\r\n         */\r\n        this.SessionService.mouseMoved();\r\n    }\r\n\r\n    // show server error alert when connection is lost\r\n    handleServerDisconnect() {\r\n        if (!this.connectionLostShown) {\r\n          this.$mdToast.show(this.connectionLostDisplay);\r\n          this.connectionLostShown = true;\r\n        }\r\n    }\r\n\r\n    // hide server error alert when connection is restored\r\n    handleServerReconnect() {\r\n        this.$mdToast.hide(this.connectionLostDisplay);\r\n        this.connectionLostShown = false;\r\n    }\r\n}\r\n\r\nClassroomMonitorController.$inject = [\r\n    '$filter',\r\n    '$mdDialog',\r\n    '$mdToast',\r\n    '$rootScope',\r\n    '$scope',\r\n    '$state',\r\n    '$window',\r\n    'ConfigService',\r\n    'NodeService',\r\n    'NotebookService',\r\n    'NotificationService',\r\n    'ProjectService',\r\n    'SessionService',\r\n    'TeacherDataService',\r\n    'TeacherWebSocketService'\r\n];\r\n\r\nexport default ClassroomMonitorController;\r\n"]}