{"version":3,"sources":["classroomMonitorController.es6"],"names":[],"mappings":"AAAA;;;;;;;;;;;;IAEM;AAEF,aAFE,0BAEF,CAAY,SAAZ,EACY,UADZ,EAEY,MAFZ,EAGY,MAHZ,EAIY,YAJZ,EAKY,UALZ,EAMY,aANZ,EAOY,cAPZ,EAQY,cARZ,EASY,kBATZ,EAUY,uBAVZ,EAUqC;;;8BAZnC,4BAYmC;;AACjC,aAAK,UAAL,GAAkB,UAAlB,CADiC;AAEjC,aAAK,MAAL,GAAc,MAAd,CAFiC;AAGjC,aAAK,MAAL,GAAc,MAAd,CAHiC;AAIjC,aAAK,YAAL,GAAoB,YAApB,CAJiC;AAKjC,aAAK,UAAL,GAAkB,UAAlB,CALiC;AAMjC,aAAK,aAAL,GAAqB,aAArB,CANiC;AAOjC,aAAK,cAAL,GAAsB,cAAtB,CAPiC;AAQjC,aAAK,cAAL,GAAsB,cAAtB,CARiC;AASjC,aAAK,kBAAL,GAA0B,kBAA1B,CATiC;AAUjC,aAAK,uBAAL,GAA+B,uBAA/B,CAViC;AAWjC,aAAK,UAAL,CAAgB,qBAAhB,EAAuC,IAAvC,CAA4C,UAAC,mBAAD,EAAyB;AACjE,kBAAK,qBAAL,GAA6B,mBAA7B,CADiE;SAAzB,CAA5C,CAXiC;;AAejC,eAAO,GAAP,CAAW,oBAAX,EAAiC,YAAM;;AAEnC,gBAAI,UAAU,UAAU,OAAV,GACT,MADS,CACF,QAAQ,OAAR,CAAgB,SAAS,IAAT,CADd,EAET,KAFS,CAEH,iBAFG,EAGT,OAHS,CAGD,wEAHC,EAIT,SAJS,CAIC,iBAJD,EAKT,EALS,CAKN,KALM,EAMT,MANS,CAMF,IANE,CAAV,CAF+B;AASnC,sBAAU,IAAV,CAAe,OAAf,EAAwB,IAAxB,CAA6B,YAAM;AAC/B,sBAAK,cAAL,CAAoB,YAApB,GAD+B;aAAN,EAE1B,YAAM;AACL,sBAAK,cAAL,CAAoB,WAApB,GADK;aAAN,CAFH,CATmC;SAAN,CAAjC;;;AAfiC,cAgCjC,CAAO,GAAP,CAAW,eAAX,EAA4B,UAAC,KAAD,EAAQ,IAAR,EAAiB;;AAEzC,kBAAK,iBAAL,GAFyC;SAAjB,CAA5B;;;AAhCiC,YAsCjC,CAAK,iBAAL,GAtCiC;KAVrC;;iBAFE;;gCAqDM;AACJ,iBAAK,MAAL,CAAY,qDAAZ;;AADI,gBAGA,MAAM,KAAK,IAAL,CAAU,OAAV,EAAmB;AACzB,wBAAQ,QAAR;aADM,EAEP,UAAC,OAAD,EAAa;AACZ,wBAAQ,SAAR,CAAkB,UAAC,iBAAD,EAAuB;AACrC,wBAAI,UAAU,IAAI,IAAJ,CAAS,CAAC,iBAAD,CAAT,EAA8B,EAAC,MAAM,UAAN,EAA/B,CAAV,CADiC;AAErC,wBAAI,SAAS,IAAI,eAAJ,CAAoB,OAApB,CAAT,CAFiC;AAGrC,wBAAI,IAAI,SAAS,aAAT,CAAuB,GAAvB,CAAJ,CAHiC;AAIrC,6BAAS,IAAT,CAAc,WAAd,CAA0B,CAA1B,EAJqC;AAKrC,sBAAE,KAAF,GAAU,eAAV,CALqC;AAMrC,sBAAE,IAAF,GAAS,MAAT,CANqC;AAOrC,sBAAE,QAAF,GAAa,YAAY,KAAZ,GAAoB,MAApB,CAPwB;AAQrC,sBAAE,KAAF;;;AARqC,0BAWrC,CAAO,UAAP,CAAkB,YAAM;AACpB,4BAAI,eAAJ,CAAoB,MAApB;AADoB,qBAAN,EAEf,IAFH,EAXqC;iBAAvB,CAAlB,CADY;aAAb,CAFC,CAHA;;;;;;;;;gCA2BD,YAAY;;;AACf,iBAAK,kBAAL,CAAwB,SAAxB,CAAkC,UAAlC,EAA8C,IAA9C,CAAmD,UAAC,MAAD,EAAY;AAC3D,oBAAI,UAAU,IAAV,EAAgB;AAChB,0BAAM,yBAAN,EADgB;AAEhB,2BAFgB;iBAApB;AAIA,oBAAI,uBAAuB,CAAvB,CALuD;AAM3D,oBAAI,4BAA4B,CAA5B,CANuD;AAO3D,oBAAI,2BAA2B,CAA3B,CAPuD;AAQ3D,oBAAI,0BAA0B,CAA1B,CARuD;AAS3D,oBAAI,qCAAqC,CAArC,CATuD;AAU3D,oBAAI,4BAA4B,EAA5B,CAVuD;AAW3D,oBAAI,4BAA4B,EAA5B,CAXuD;AAY3D,oBAAI,wBAAwB,EAAxB,CAZuD;AAa3D,oBAAI,yBAAyB,EAAzB,CAbuD;AAc3D,oBAAI,yBAAyB,EAAzB,CAduD;AAe3D,oBAAI,yBAAyB,EAAzB,CAfuD;AAgB3D,oBAAI,gCAAgC,EAAhC,CAhBuD;AAiB3D,oBAAI,QAAQ,OAAK,aAAL,CAAmB,QAAnB,EAAR,CAjBuD;;AAmB3D,oBAAI,iBAAiB,EAAjB,CAnBuD;AAoB3D,oBAAI,eAAe,mBAAf,EAAoC;AACpC,wBAAI,OAAO,EAAP;AADgC,0BAEpC,GAAS,OAAO,OAAP,GAAiB,MAAjB,CAAyB,UAAC,cAAD,EAAoB;AAClD,4BAAI,UAAU,eAAe,oBAAf,IAAuC,GAAvC,GAA6C,eAAe,yBAAf,CAA7C,GAAyF,GAAzF,GAA+F,eAAe,yBAAf,CAA/F,CADoC;AAElD,4BAAI,CAAC,KAAK,cAAL,CAAoB,OAApB,CAAD,EAA+B;;AAE/B,iCAAK,OAAL,IAAgB,cAAhB,CAF+B;AAG/B,mCAAO,IAAP,CAH+B;yBAAnC,MAIO;;AAEH,mCAAO,KAAP,CAFG;yBAJP;qBAF8B,CAAzB,CAUN,OAVM,EAAT,CAFoC;AAapC,qCAAiB,iBAAiB,KAAjB,GAAyB,MAAzB,CAbmB;iBAAxC,MAcO;AACH,qCAAiB,cAAc,KAAd,GAAsB,MAAtB,CADd;iBAdP;;AAkBA,oBAAI,YAAY,EAAZ;;AAtCuD,qBAwCtD,IAAI,WAAW,CAAX,EAAc,WAAW,OAAO,MAAP,EAAe,UAAjD,EAA6D;;AAEzD,wBAAI,MAAM,OAAO,QAAP,CAAN,CAFqD;;AAIzD,wBAAI,aAAa,CAAb,EAAgB;;AAEhB,4BAAI,sBAAJ,IAA8B,WAA9B,CAFgB;AAGhB,4BAAI,sBAAJ,IAA8B,WAA9B,CAHgB;AAIhB,4BAAI,sBAAJ,IAA8B,WAA9B,CAJgB;AAKhB,4BAAI,6BAAJ,IAAqC,UAArC,CALgB;qBAApB,MAMO;;AAEH,4BAAI,SAAS,IAAI,oBAAJ,CAAT,CAFD;AAGH,4BAAI,cAAc,IAAI,yBAAJ,CAAd,CAHD;AAIH,4BAAI,wBAAJ,IAAgC,OAAK,cAAL,CAAoB,mBAApB,CAAwC,MAAxC,CAAhC,CAJG;AAKH,4BAAI,uBAAJ,IAA+B,OAAK,cAAL,CAAoB,oBAApB,CAAyC,MAAzC,CAA/B,CALG;AAMH,4BAAI,kCAAJ,IAA0C,OAAK,cAAL,CAAoB,0CAApB,CAA+D,MAA/D,EAAuE,WAAvE,IAAsF,CAAtF;AANvC,4BAOC,cAAc,IAAI,yBAAJ,CAAd,CAPD;AAQH,4BAAI,UAAU,IAAI,qBAAJ,CAAV,CARD;AASH,4BAAI,eAAe,QAAQ,KAAR,CAAc,GAAd,CAAf,CATD;AAUH,4BAAI,sBAAJ,IAA8B,aAAa,CAAb,CAA9B,CAVG;AAWH,4BAAI,sBAAJ,IAA8B,aAAa,CAAb,KAAmB,EAAnB,CAX3B;AAYH,4BAAI,sBAAJ,IAA8B,aAAa,CAAb,KAAmB,EAAnB;;;AAZ3B,4BAeC,sBAAsB,IAAI,yBAAJ,CAAtB,CAfD;AAgBH,4BAAI,6BAAJ,IAAqC,oBAAoB,QAApB,IAAgC,EAAhC,CAhBlC;qBANP;;;AAJyD,yBA8BpD,IAAI,YAAY,CAAZ,EAAe,YAAY,IAAI,MAAJ,EAAY,WAAhD,EAA6D;AACzD,4BAAI,OAAO,IAAI,SAAJ,CAAP,CADqD;AAEzD,4BAAI,QAAO,mDAAP,KAAgB,QAAhB,EAA0B;AAC1B,mCAAO,OAAO,KAAK,SAAL,CAAe,IAAf,EAAqB,OAArB,CAA6B,IAA7B,EAAmC,IAAnC,CAAP,GAAkD,IAAlD,CADmB;yBAA9B,MAEO,IAAI,OAAO,IAAP,KAAgB,QAAhB,EAA0B;AACjC,mCAAO,OAAO,IAAP,GAAc,IAAd,CAD0B;yBAA9B;AAGP,qCAAa,OAAO,GAAP,CAP4C;qBAA7D;AASA,iCAAa,MAAb,CAvCyD;iBAA7D;;AA0CA,oBAAI,UAAU,IAAI,IAAJ,CAAS,CAAC,SAAD,CAAT,EAAsB,EAAC,MAAM,UAAN,EAAvB,CAAV,CAlFuD;AAmF3D,oBAAI,SAAS,IAAI,eAAJ,CAAoB,OAApB,CAAT,CAnFuD;AAoF3D,oBAAI,IAAI,SAAS,aAAT,CAAuB,GAAvB,CAAJ,CApFuD;AAqF3D,yBAAS,IAAT,CAAc,WAAd,CAA0B,CAA1B,EArF2D;AAsF3D,kBAAE,IAAF,GAAS,MAAT,CAtF2D;AAuF3D,kBAAE,QAAF,GAAa,cAAb,CAvF2D;AAwF3D,kBAAE,KAAF;;;AAxF2D,sBA2F3D,CAAO,UAAP,CAAkB,YAAM;AACpB,wBAAI,eAAJ,CAAoB,MAApB;AADoB,iBAAN,EAEf,IAFH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA3F2D,aAAZ,CAAnD,CADe;;;;;;;;;uCAoIJ;;;AACX,iBAAK,kBAAL,CAAwB,SAAxB,CAAkC,QAAlC,EAA4C,IAA5C,CAAiD,UAAC,MAAD,EAAY;AACzD,oBAAI,UAAU,IAAV,EAAgB;AAChB,0BAAM,yBAAN,EADgB;AAEhB,2BAFgB;iBAApB;AAIA,oBAAI,uBAAuB,CAAvB,CALqD;AAMzD,oBAAI,4BAA4B,CAA5B,CANqD;AAOzD,oBAAI,2BAA2B,CAA3B,CAPqD;AAQzD,oBAAI,0BAA0B,CAA1B,CARqD;AASzD,oBAAI,qCAAqC,CAArC,CATqD;AAUzD,oBAAI,oBAAoB,EAApB,CAVqD;AAWzD,oBAAI,4BAA4B,EAA5B,CAXqD;AAYzD,oBAAI,wBAAwB,EAAxB,CAZqD;AAazD,oBAAI,yBAAyB,EAAzB,CAbqD;AAczD,oBAAI,yBAAyB,EAAzB,CAdqD;AAezD,oBAAI,yBAAyB,EAAzB,CAfqD;AAgBzD,oBAAI,QAAQ,OAAK,aAAL,CAAmB,QAAnB,EAAR,CAhBqD;;AAkBzD,oBAAI,iBAAiB,YAAY,KAAZ,GAAoB,MAApB,CAlBoC;;AAoBzD,oBAAI,YAAY,EAAZ;;AApBqD,qBAsBpD,IAAI,WAAW,CAAX,EAAc,WAAW,OAAO,MAAP,EAAe,UAAjD,EAA6D;;AAEzD,wBAAI,MAAM,OAAO,QAAP,CAAN,CAFqD;;AAIzD,wBAAI,aAAa,CAAb,EAAgB;;AAEhB,4BAAI,sBAAJ,IAA8B,WAA9B,CAFgB;AAGhB,4BAAI,sBAAJ,IAA8B,WAA9B,CAHgB;AAIhB,4BAAI,sBAAJ,IAA8B,WAA9B,CAJgB;qBAApB,MAKO;;AAEH,4BAAI,SAAS,IAAI,oBAAJ,CAAT,CAFD;AAGH,4BAAI,cAAc,IAAI,yBAAJ,CAAd,CAHD;AAIH,4BAAI,wBAAJ,IAAgC,OAAK,cAAL,CAAoB,mBAApB,CAAwC,MAAxC,CAAhC,CAJG;AAKH,4BAAI,uBAAJ,IAA+B,OAAK,cAAL,CAAoB,oBAApB,CAAyC,MAAzC,CAA/B,CALG;AAMH,4BAAI,kCAAJ,IAA0C,OAAK,cAAL,CAAoB,0CAApB,CAA+D,MAA/D,EAAuE,WAAvE,IAAsF,CAAtF;AANvC,4BAOC,cAAc,IAAI,yBAAJ,CAAd,CAPD;AAQH,4BAAI,UAAU,IAAI,qBAAJ,CAAV,CARD;AASH,4BAAI,eAAe,QAAQ,KAAR,CAAc,GAAd,CAAf,CATD;AAUH,4BAAI,sBAAJ,IAA8B,aAAa,CAAb,CAA9B,CAVG;AAWH,4BAAI,sBAAJ,IAA8B,aAAa,CAAb,KAAmB,EAAnB,CAX3B;AAYH,4BAAI,sBAAJ,IAA8B,aAAa,CAAb,KAAmB,EAAnB,CAZ3B;qBALP;;;AAJyD,yBAyBpD,IAAI,YAAY,CAAZ,EAAe,YAAY,IAAI,MAAJ,EAAY,WAAhD,EAA6D;AACzD,4BAAI,OAAO,IAAI,SAAJ,CAAP,CADqD;AAEzD,4BAAI,QAAO,mDAAP,KAAgB,QAAhB,EAA0B;AAC1B,mCAAO,OAAO,KAAK,SAAL,CAAe,IAAf,EAAqB,OAArB,CAA6B,IAA7B,EAAmC,IAAnC,CAAP,GAAkD,IAAlD,CADmB;yBAA9B,MAEO,IAAI,OAAO,IAAP,KAAgB,QAAhB,EAA0B;AACjC,mCAAO,OAAO,IAAP,GAAc,IAAd,CAD0B;yBAA9B;AAGP,qCAAa,OAAO,GAAP,CAP4C;qBAA7D;AASA,iCAAa,MAAb,CAlCyD;iBAA7D;;AAqCA,oBAAI,UAAU,IAAI,IAAJ,CAAS,CAAC,SAAD,CAAT,EAAsB,EAAC,MAAM,UAAN,EAAvB,CAAV,CA3DqD;AA4DzD,oBAAI,SAAS,IAAI,eAAJ,CAAoB,OAApB,CAAT,CA5DqD;AA6DzD,oBAAI,IAAI,SAAS,aAAT,CAAuB,GAAvB,CAAJ,CA7DqD;AA8DzD,yBAAS,IAAT,CAAc,WAAd,CAA0B,CAA1B,EA9DyD;AA+DzD,kBAAE,IAAF,GAAS,MAAT,CA/DyD;AAgEzD,kBAAE,QAAF,GAAa,cAAb,CAhEyD;AAiEzD,kBAAE,KAAF;;;AAjEyD,sBAoEzD,CAAO,UAAP,CAAkB,YAAM;AACpB,wBAAI,eAAJ,CAAoB,MAApB;AADoB,iBAAN,EAEf,IAFH,EApEyD;aAAZ,CAAjD,CADW;;;;;;;;;;mDA+EY;;;AAGvB,gBAAI,gBAAgB,KAAK,kBAAL,CAAwB,gBAAxB,EAAhB,CAHmB;AAIvB,gBAAI,WAAW,cAAc,QAAd;;;AAJQ,gBAOnB,WAAW,KAAK,kBAAL,CAAwB,cAAxB,CAAuC,QAAvC,CAAX;;;AAPmB,gBAUnB,mBAAmB,CAAC,QAAD;;;AAVA,gBAavB,CAAK,kBAAL,CAAwB,0BAAxB,CAAmD,QAAnD,EAA6D,gBAA7D;;;AAbuB,gBAgBvB,CAAK,iBAAL,GAhBuB;;AAkBvB,gBAAI,gBAAJ,EAAsB;;AAElB,qBAAK,uBAAL,CAA6B,YAA7B,CAA0C,QAA1C,EAFkB;aAAtB,MAGO;;AAEH,qBAAK,uBAAL,CAA6B,cAA7B,CAA4C,QAA5C,EAFG;aAHP;;;AAlBuB,gBA2BvB,CAAK,kBAAL,CAAwB,aAAxB,GA3BuB;;;;;;;;;4CAiCP;;AAEhB,gBAAI,gBAAgB,KAAK,kBAAL,CAAwB,gBAAxB,EAAhB;;;AAFY,gBAKZ,WAAW,CAAC,CAAD,CALC;;AAOhB,gBAAI,iBAAiB,IAAjB,EAAuB;AACvB,2BAAW,cAAc,QAAd,CADY;aAA3B;;;AAPgB,gBAYZ,WAAW,KAAK,kBAAL,CAAwB,cAAxB,CAAuC,QAAvC,CAAX;;;AAZY,gBAeZ,QAAJ,EAAc;AACV,qBAAK,oBAAL,GADU;aAAd,MAEO,IAAI,CAAC,QAAD,EAAW;AAClB,qBAAK,kBAAL,GADkB;aAAf;;;;;;;;;6CAQU;;;AACjB,iBAAK,UAAL,CAAgB,qBAAhB,EAAuC,IAAvC,CAA4C,UAAC,mBAAD,EAAyB;AACjE,uBAAK,qBAAL,GAA6B,mBAA7B,CADiE;aAAzB,CAA5C,CADiB;;;;;;;;;+CASE;;;AACnB,iBAAK,UAAL,CAAgB,uBAAhB,EAAyC,IAAzC,CAA8C,UAAC,qBAAD,EAA2B;AACrE,uBAAK,qBAAL,GAA6B,qBAA7B,CADqE;aAA3B,CAA9C,CADmB;;;;;;;;;;qCAUV;;;;;AAKT,iBAAK,cAAL,CAAoB,UAApB,GALS;;;;WAhXX;;;AAyXN,2BAA2B,OAA3B,GAAqC,CACjC,WADiC,EAEjC,YAFiC,EAGjC,QAHiC,EAIjC,QAJiC,EAKjC,cALiC,EAMjC,YANiC,EAOjC,eAPiC,EAQjC,gBARiC,EASjC,gBATiC,EAUjC,oBAViC,EAWjC,yBAXiC,CAArC;;kBAce","file":"classroomMonitorController.js","sourcesContent":["'use strict';\n\nclass ClassroomMonitorController {\n\n    constructor($mdDialog,\n                $rootScope,\n                $scope,\n                $state,\n                $stateParams,\n                $translate,\n                ConfigService,\n                ProjectService,\n                SessionService,\n                TeacherDataService,\n                TeacherWebSocketService) {\n        this.$rootScope = $rootScope;\n        this.$scope = $scope;\n        this.$state = $state;\n        this.$stateParams = $stateParams;\n        this.$translate = $translate;\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n        this.SessionService = SessionService;\n        this.TeacherDataService = TeacherDataService;\n        this.TeacherWebSocketService = TeacherWebSocketService;\n        this.$translate('pauseStudentScreens').then((pauseStudentScreens) => {\n            this.pauseScreenButtonText = pauseStudentScreens;\n        });\n\n        $scope.$on('showSessionWarning', () => {\n            // Appending dialog to document.body\n            let confirm = $mdDialog.confirm()\n                .parent(angular.element(document.body))\n                .title('Session Timeout')\n                .content('You have been inactive for a long time. Do you want to stay logged in?')\n                .ariaLabel('Session Timeout')\n                .ok('YES')\n                .cancel('No');\n            $mdDialog.show(confirm).then(() => {\n                this.SessionService.renewSession();\n            }, () => {\n                this.SessionService.forceLogOut();\n            });\n        });\n\n        // listen for the periodChanged event\n        $scope.$on('periodChanged', (event, args) => {\n            // the period has changed so we will update the paused/unpaused button\n            this.updatePauseButton();\n        });\n\n        // update the text of the pause/unpause button\n        this.updatePauseButton();\n    };\n\n    hello() {\n        ocpu.seturl(\"//128.32.189.240:81/ocpu/user/wiser/library/wiser/R\");\n        // perform the request\n        var req = ocpu.call(\"hello\", {\n            \"name\": \"Hiroki\"\n        }, (session) => {\n            session.getStdout((returnedCSVString) => {\n                var csvBlob = new Blob([returnedCSVString], {type: 'text/csv'});\n                var csvUrl = URL.createObjectURL(csvBlob);\n                var a = document.createElement(\"a\");\n                document.body.appendChild(a);\n                a.style = \"display: none\";\n                a.href = csvUrl;\n                a.download = \"export_\" + runId + \".csv\";\n                a.click();\n\n                // timeout is required for FF.\n                window.setTimeout(() => {\n                    URL.revokeObjectURL(csvUrl);  // tell browser to release URL reference\n                }, 3000);\n            });\n        });\n    };\n\n    /**\n     * Export all or latest work for this run in CSV format\n     */\n    export(exportType) {\n        this.TeacherDataService.getExport(exportType).then((result) => {\n            if (result == null) {\n                alert(\"Error retrieving result\");\n                return;\n            }\n            var COLUMN_INDEX_NODE_ID = 1;\n            var COLUMN_INDEX_COMPONENT_ID = 2;\n            var COLUMN_INDEX_STEP_NUMBER = 4;\n            var COLUMN_INDEX_STEP_TITLE = 5;\n            var COLUMN_INDEX_COMPONENT_PART_NUMBER = 6;\n            var COLUMN_INDEX_STUDENT_DATA = 11;\n            var COLUMN_INDEX_WORKGROUP_ID = 14;\n            var COLUMN_INDEX_WISE_IDS = 18;\n            var COLUMN_INDEX_WISE_ID_1 = 18;\n            var COLUMN_INDEX_WISE_ID_2 = 19;\n            var COLUMN_INDEX_WISE_ID_3 = 20;\n            var COLUMN_INDEX_STUDENT_RESPONSE = 21;\n            var runId = this.ConfigService.getRunId();\n\n            var exportFilename = \"\";\n            if (exportType === \"latestStudentWork\") {\n                var hash = {};  // store latestStudentWork. Assume that key = (nodeId, componentId, workgroupId)\n                result = result.reverse().filter( (studentWorkRow) => {\n                    var hashKey = studentWorkRow[COLUMN_INDEX_NODE_ID] + \"_\" + studentWorkRow[COLUMN_INDEX_COMPONENT_ID] + \"_\" + studentWorkRow[COLUMN_INDEX_WORKGROUP_ID];\n                    if (!hash.hasOwnProperty(hashKey)) {\n                        // remember in hash\n                        hash[hashKey] = studentWorkRow;\n                        return true;\n                    } else {\n                        // we already have the latest, so we can disregard this studentWorkRow.\n                        return false;\n                    }\n                }).reverse();\n                exportFilename = \"latest_work_\" + runId + \".csv\";\n            } else {\n                exportFilename = \"all_work_\" + runId + \".csv\";\n            }\n\n            var csvString = \"\";  // resulting csv string\n\n            for (var rowIndex = 0; rowIndex < result.length; rowIndex++) {\n\n                var row = result[rowIndex];\n\n                if (rowIndex === 0) {\n                    // append additional header columns\n                    row[COLUMN_INDEX_WISE_ID_1] = \"WISE ID 1\";\n                    row[COLUMN_INDEX_WISE_ID_2] = \"WISE ID 2\";\n                    row[COLUMN_INDEX_WISE_ID_3] = \"WISE ID 3\";\n                    row[COLUMN_INDEX_STUDENT_RESPONSE] = \"response\";\n                } else {\n                    // for all non-header rows, fill in step numbers, titles, and component part numbers.\n                    var nodeId = row[COLUMN_INDEX_NODE_ID];\n                    var componentId = row[COLUMN_INDEX_COMPONENT_ID];\n                    row[COLUMN_INDEX_STEP_NUMBER] = this.ProjectService.getNodePositionById(nodeId);\n                    row[COLUMN_INDEX_STEP_TITLE] = this.ProjectService.getNodeTitleByNodeId(nodeId);\n                    row[COLUMN_INDEX_COMPONENT_PART_NUMBER] = this.ProjectService.getComponentPositionByNodeIdAndComponentId(nodeId, componentId) + 1; // make it 1-indexed for researchers\n                    var workgroupId = row[COLUMN_INDEX_WORKGROUP_ID];\n                    var wiseIDs = row[COLUMN_INDEX_WISE_IDS];\n                    var wiseIDsArray = wiseIDs.split(\",\");\n                    row[COLUMN_INDEX_WISE_ID_1] = wiseIDsArray[0];\n                    row[COLUMN_INDEX_WISE_ID_2] = wiseIDsArray[1] || \"\";\n                    row[COLUMN_INDEX_WISE_ID_3] = wiseIDsArray[2] || \"\";\n\n                    // get the student data JSON and extract responses into its own column\n                    var studentDataJSONCell = row[COLUMN_INDEX_STUDENT_DATA];\n                    row[COLUMN_INDEX_STUDENT_RESPONSE] = studentDataJSONCell.response || \"\";\n                }\n\n                // append row to csvString\n                for (var cellIndex = 0; cellIndex < row.length; cellIndex++) {\n                    var cell = row[cellIndex];\n                    if (typeof cell === \"object\") {\n                        cell = \"\\\"\" + JSON.stringify(cell).replace(/\"/g, '\"\"') + \"\\\"\";\n                    } else if (typeof cell === \"string\") {\n                        cell = \"\\\"\" + cell + \"\\\"\";\n                    }\n                    csvString += cell + \",\";\n                }\n                csvString += \"\\r\\n\";\n            }\n\n            var csvBlob = new Blob([csvString], {type: 'text/csv'});\n            var csvUrl = URL.createObjectURL(csvBlob);\n            var a = document.createElement(\"a\");\n            document.body.appendChild(a);\n            a.href = csvUrl;\n            a.download = exportFilename;\n            a.click();\n\n            // timeout is required for FF.\n            window.setTimeout(() => {\n                URL.revokeObjectURL(csvUrl);  // tell browser to release URL reference\n            }, 3000);\n\n            /* TODO: get OCPU working again\n            //ocpu.seturl(\"//localhost:1234/ocpu/library/wise/R\");\n            ocpu.seturl(\"http://128.32.189.240:81/ocpu/user/wiser/library/wiser/R\");\n            //perform the request\n            var request = ocpu.call(\"extractchoices\", {\n                \"csvFile\": csvFile\n            }, (session) => {\n                session.getStdout((returnedCSVString) => {\n                    var csvBlob = new Blob([returnedCSVString], {type: 'text/csv'});\n                    var csvUrl = URL.createObjectURL(csvBlob);\n                    var a = document.createElement(\"a\");\n                    document.body.appendChild(a);\n                    a.href = csvUrl;\n                    a.download = \"export_\" + runId + \".csv\";\n                    a.click();\n\n                    // timeout is required for FF.\n                    window.setTimeout(() => {\n                        URL.revokeObjectURL(csvUrl);  // tell browser to release URL reference\n                    }, 3000);\n\n                    //return returnedCSVString;\n                });\n            });\n\n            //if R returns an error, alert the error message\n            request.fail(() => {\n                alert(\"Server error: \" + request.responseText);\n            });\n            */\n        });\n    }\n\n    /**\n     * Export all events for this run in CSV format\n     */\n    exportEvents() {\n        this.TeacherDataService.getExport(\"events\").then((result) => {\n            if (result == null) {\n                alert(\"Error retrieving result\");\n                return;\n            }\n            var COLUMN_INDEX_NODE_ID = 1;\n            var COLUMN_INDEX_COMPONENT_ID = 2;\n            var COLUMN_INDEX_STEP_NUMBER = 4;\n            var COLUMN_INDEX_STEP_TITLE = 5;\n            var COLUMN_INDEX_COMPONENT_PART_NUMBER = 6;\n            var COLUMN_INDEX_DATA = 12;\n            var COLUMN_INDEX_WORKGROUP_ID = 15;\n            var COLUMN_INDEX_WISE_IDS = 19;\n            var COLUMN_INDEX_WISE_ID_1 = 19;\n            var COLUMN_INDEX_WISE_ID_2 = 20;\n            var COLUMN_INDEX_WISE_ID_3 = 21;\n            var runId = this.ConfigService.getRunId();\n\n            var exportFilename = \"events_\" + runId + \".csv\";\n\n            var csvString = \"\";  // resulting csv string\n\n            for (var rowIndex = 0; rowIndex < result.length; rowIndex++) {\n\n                var row = result[rowIndex];\n\n                if (rowIndex === 0) {\n                    // append additional header columns\n                    row[COLUMN_INDEX_WISE_ID_1] = \"WISE ID 1\";\n                    row[COLUMN_INDEX_WISE_ID_2] = \"WISE ID 2\";\n                    row[COLUMN_INDEX_WISE_ID_3] = \"WISE ID 3\";\n                } else {\n                    // for all non-header rows, fill in step numbers, titles, and component part numbers.\n                    var nodeId = row[COLUMN_INDEX_NODE_ID];\n                    var componentId = row[COLUMN_INDEX_COMPONENT_ID];\n                    row[COLUMN_INDEX_STEP_NUMBER] = this.ProjectService.getNodePositionById(nodeId);\n                    row[COLUMN_INDEX_STEP_TITLE] = this.ProjectService.getNodeTitleByNodeId(nodeId);\n                    row[COLUMN_INDEX_COMPONENT_PART_NUMBER] = this.ProjectService.getComponentPositionByNodeIdAndComponentId(nodeId, componentId) + 1; // make it 1-indexed for researchers\n                    var workgroupId = row[COLUMN_INDEX_WORKGROUP_ID];\n                    var wiseIDs = row[COLUMN_INDEX_WISE_IDS];\n                    var wiseIDsArray = wiseIDs.split(\",\");\n                    row[COLUMN_INDEX_WISE_ID_1] = wiseIDsArray[0];\n                    row[COLUMN_INDEX_WISE_ID_2] = wiseIDsArray[1] || \"\";\n                    row[COLUMN_INDEX_WISE_ID_3] = wiseIDsArray[2] || \"\";\n                }\n\n                // append row to csvString\n                for (var cellIndex = 0; cellIndex < row.length; cellIndex++) {\n                    var cell = row[cellIndex];\n                    if (typeof cell === \"object\") {\n                        cell = \"\\\"\" + JSON.stringify(cell).replace(/\"/g, '\"\"') + \"\\\"\";\n                    } else if (typeof cell === \"string\") {\n                        cell = \"\\\"\" + cell + \"\\\"\";\n                    }\n                    csvString += cell + \",\";\n                }\n                csvString += \"\\r\\n\";\n            }\n\n            var csvBlob = new Blob([csvString], {type: 'text/csv'});\n            var csvUrl = URL.createObjectURL(csvBlob);\n            var a = document.createElement(\"a\");\n            document.body.appendChild(a);\n            a.href = csvUrl;\n            a.download = exportFilename;\n            a.click();\n\n            // timeout is required for FF.\n            window.setTimeout(() => {\n                URL.revokeObjectURL(csvUrl);  // tell browser to release URL reference\n            }, 3000);\n        });\n    }\n\n    /**\n     * The pause screen button was clicked. This button is used to toggle\n     * pause screen on and off.\n     */\n    pauseScreenButtonClicked() {\n\n        // get the currently selected period\n        var currentPeriod = this.TeacherDataService.getCurrentPeriod();\n        var periodId = currentPeriod.periodId;\n\n        // get the previous value of whether the period was paused or unpaused\n        var isPaused = this.TeacherDataService.isPeriodPaused(periodId);\n\n        // toggle the value\n        var newIsPausedValue = !isPaused;\n\n        // update the run status\n        this.TeacherDataService.updatePausedRunStatusValue(periodId, newIsPausedValue);\n\n        // update the pause/unpause button text\n        this.updatePauseButton();\n\n        if (newIsPausedValue) {\n            // pause the student screens\n            this.TeacherWebSocketService.pauseScreens(periodId);\n        } else {\n            // unpause the student screens\n            this.TeacherWebSocketService.unPauseScreens(periodId);\n        }\n\n        // save the run status to the server\n        this.TeacherDataService.sendRunStatus();\n    }\n\n    /**\n     * Update the pause button to reflect the pause/unpaused state of the period\n     */\n    updatePauseButton() {\n        // get the currently selected period\n        var currentPeriod = this.TeacherDataService.getCurrentPeriod();\n\n        // default to all periods\n        var periodId = -1;\n\n        if (currentPeriod != null) {\n            periodId = currentPeriod.periodId;\n        }\n\n        // whether the period is paused or unpaused\n        var isPaused = this.TeacherDataService.isPeriodPaused(periodId);\n\n        // update the paused/unpaused button text\n        if (isPaused) {\n            this.displayUnPauseButton();\n        } else if (!isPaused) {\n            this.displayPauseButton();\n        }\n    }\n\n    /**\n     * Change the text of the button to display 'Pause Screens'\n     */\n    displayPauseButton() {\n        this.$translate('pauseStudentScreens').then((pauseStudentScreens) => {\n            this.pauseScreenButtonText = pauseStudentScreens;\n        });\n    }\n\n    /**\n     * Change the text of the button to display 'Unpause Screens'\n     */\n    displayUnPauseButton() {\n        this.$translate('unPauseStudentScreens').then((unPauseStudentScreens) => {\n            this.pauseScreenButtonText = unPauseStudentScreens;\n        });\n    }\n    \n    /**\n     * The user has moved the mouse so we will notify the Session Service\n     * so that it can refresh the session\n     */\n    mouseMoved() {\n        /*\n         * notify the Session Service that the user has moved the mouse\n         * so we can refresh the session\n         */\n        this.SessionService.mouseMoved();\n    }\n}\n\nClassroomMonitorController.$inject = [\n    '$mdDialog',\n    '$rootScope',\n    '$scope',\n    '$state',\n    '$stateParams',\n    '$translate',\n    'ConfigService',\n    'ProjectService',\n    'SessionService',\n    'TeacherDataService',\n    'TeacherWebSocketService'\n];\n\nexport default ClassroomMonitorController;\n"]}