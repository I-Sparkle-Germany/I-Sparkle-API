{"version":3,"sources":["classroomMonitorController.es6"],"names":["ClassroomMonitorController","$filter","$mdDialog","$mdToast","$rootScope","$scope","$state","$stateParams","$window","ConfigService","NotebookService","NotificationService","ProjectService","SessionService","TeacherDataService","TeacherWebSocketService","$translate","projectTitle","getProjectTitle","runId","getRunId","numberProject","menuOpen","showSideMenu","showToolbar","showStepTools","views","name","label","icon","type","active","isNotebookEnabled","connectionLostDisplay","build","template","hideDelay","connectionLostShown","$on","confirm","parent","angular","element","document","body","title","content","ariaLabel","ok","cancel","show","then","renewSession","forceLogOut","ev","alert","translations","serverUpdate","textContent","targetEvent","event","toState","toParams","fromState","fromParams","processUI","handleServerDisconnect","handleServerReconnect","logoPath","getThemePath","themePath","notifications","context","nodeId","componentId","componentType","category","data","saveEvent","onbeforeunload","periods","getRunStatus","p","length","period","paused","pauseScreensChanged","periodId","viewName","$current","currentViewName","params","isApplicationNode","mouseMoved","hide","$inject"],"mappings":"AAAA;;;;;;;;;;IAEMA,0B;AAEF,wCAAYC,OAAZ,EACYC,SADZ,EAEYC,QAFZ,EAGYC,UAHZ,EAIYC,MAJZ,EAKYC,MALZ,EAMYC,YANZ,EAOYC,OAPZ,EAQYC,aARZ,EASYC,eATZ,EAUYC,mBAVZ,EAWYC,cAXZ,EAYYC,cAZZ,EAaYC,kBAbZ,EAcYC,uBAdZ,EAcqC;AAAA;;AAAA;;AAEjC,aAAKd,OAAL,GAAeA,OAAf;AACA,aAAKE,QAAL,GAAgBA,QAAhB;AACA,aAAKC,UAAL,GAAkBA,UAAlB;AACA,aAAKC,MAAL,GAAcA,MAAd;AACA,aAAKC,MAAL,GAAcA,MAAd;AACA,aAAKC,YAAL,GAAoBA,YAApB;AACA,aAAKC,OAAL,GAAeA,OAAf;AACA,aAAKC,aAAL,GAAqBA,aAArB;AACA,aAAKC,eAAL,GAAuBA,eAAvB;AACA,aAAKC,mBAAL,GAA2BA,mBAA3B;AACA,aAAKC,cAAL,GAAsBA,cAAtB;AACA,aAAKC,cAAL,GAAsBA,cAAtB;AACA,aAAKC,kBAAL,GAA0BA,kBAA1B;AACA,aAAKC,uBAAL,GAA+BA,uBAA/B;;AAEA,aAAKC,UAAL,GAAkB,KAAKf,OAAL,CAAa,WAAb,CAAlB;;AAEA,aAAKgB,YAAL,GAAoB,KAAKL,cAAL,CAAoBM,eAApB,EAApB;AACA,aAAKC,KAAL,GAAa,KAAKV,aAAL,CAAmBW,QAAnB,EAAb;;AAEA,aAAKC,aAAL,GAAqB,IAArB,CAtBiC,CAsBN;;AAE3B,aAAKC,QAAL,GAAgB,KAAhB,CAxBiC,CAwBV;AACvB,aAAKC,YAAL,GAAoB,IAApB,CAzBiC,CAyBP;AAC1B,aAAKC,WAAL,GAAmB,IAAnB,CA1BiC,CA0BR;AACzB,aAAKC,aAAL,GAAqB,KAArB,CA3BiC,CA2BL;;AAE5B;AACA,aAAKC,KAAL,GAAa;AACT,8BAAkB;AACdC,sBAAM,KAAKX,UAAL,CAAgB,eAAhB,CADQ;AAEdY,uBAAO,KAAKZ,UAAL,CAAgB,oBAAhB,CAFO;AAGda,sBAAM,WAHQ;AAIdC,sBAAM,SAJQ;AAKdC,wBAAQ;AALM,aADT;AAQT,iCAAqB;AACjBJ,sBAAM,KAAKX,UAAL,CAAgB,aAAhB,CADW;AAEjBY,uBAAO,KAAKZ,UAAL,CAAgB,kBAAhB,CAFU;AAGjBa,sBAAM,sBAHW;AAIjBC,sBAAM,SAJW;AAKjBC,wBAAQ;AALS,aARZ;AAeT,oCAAwB;AACpBJ,sBAAM,KAAKX,UAAL,CAAgB,aAAhB,CADc;AAEpBY,uBAAO,KAAKZ,UAAL,CAAgB,kBAAhB,CAFa;AAGpBa,sBAAM,QAHc;AAIpBC,sBAAM,SAJc;AAKpBC,wBAAQ;AALY,aAff;AAsBT,8BAAkB;AACdJ,sBAAM,KAAKX,UAAL,CAAgB,cAAhB,CADQ;AAEdY,uBAAO,KAAKZ,UAAL,CAAgB,mBAAhB,CAFO;AAGda,sBAAM,oBAHQ;AAIdC,sBAAM,SAJQ;AAKdC,wBAAQ,KAAKrB,eAAL,CAAqBsB,iBAArB;AALM,aAtBT;AA6BT,2BAAe;AACXL,sBAAM,KAAKX,UAAL,CAAgB,YAAhB,CADK;AAEXY,uBAAO,KAAKZ,UAAL,CAAgB,iBAAhB,CAFI;AAGXa,sBAAM,eAHK;AAIXC,sBAAM,WAJK;AAKXC,wBAAQ;AALG,aA7BN;AAoCT,0BAAc;AACVJ,sBAAM,KAAKX,UAAL,CAAgB,eAAhB,CADI;AAEVY,uBAAO,KAAKZ,UAAL,CAAgB,oBAAhB,CAFG;AAGVa,sBAAM,eAHI;AAIVC,sBAAM,WAJI;AAKVC,wBAAQ;AALE,aApCL;AA2CT,+BAAmB;AACfJ,sBAAM,KAAKX,UAAL,CAAgB,gBAAhB,CADS;AAEfY,uBAAO,KAAKZ,UAAL,CAAgB,qBAAhB,CAFQ;AAGfa,sBAAM,MAHS;AAIfC,sBAAM,SAJS;AAKfC,wBAAQ;AALO;AA3CV,SAAb;;AAoDA;AACA,aAAKE,qBAAL,GAA6B,KAAK9B,QAAL,CAAc+B,KAAd,CAAoB;AAC7CC,sKAD6C;AAI7CC,uBAAW;AAJkC,SAApB,CAA7B;AAMA,aAAKC,mBAAL,GAA2B,KAA3B;;AAEA;AACA,aAAKhC,MAAL,CAAYiC,GAAZ,CAAgB,oBAAhB,EAAsC,YAAM;AACxC;AACA,gBAAIC,UAAUrC,UAAUqC,OAAV,GACTC,MADS,CACFC,QAAQC,OAAR,CAAgBC,SAASC,IAAzB,CADE,EAETC,KAFS,CAEH,MAAK7B,UAAL,CAAgB,iBAAhB,CAFG,EAGT8B,OAHS,CAGD,MAAK9B,UAAL,CAAgB,yBAAhB,CAHC,EAIT+B,SAJS,CAIC,MAAK/B,UAAL,CAAgB,iBAAhB,CAJD,EAKTgC,EALS,CAKN,MAAKhC,UAAL,CAAgB,KAAhB,CALM,EAMTiC,MANS,CAMF,MAAKjC,UAAL,CAAgB,IAAhB,CANE,CAAd;AAOAd,sBAAUgD,IAAV,CAAeX,OAAf,EAAwBY,IAAxB,CAA6B,YAAM;AAC/B,sBAAKtC,cAAL,CAAoBuC,YAApB;AACH,aAFD,EAEG,YAAM;AACL,sBAAKvC,cAAL,CAAoBwC,WAApB;AACH,aAJD;AAKH,SAdD;;AAgBA;AACA,aAAKhD,MAAL,CAAYiC,GAAZ,CAAgB,mBAAhB,EAAqC,UAACgB,EAAD,EAAQ;AACzC,gBAAIC,QAAQrD,UAAUqC,OAAV,GACPC,MADO,CACAC,QAAQC,OAAR,CAAgBC,SAASC,IAAzB,CADA,EAEPC,KAFO,CAEDW,aAAaC,YAFZ,EAGPC,WAHO,CAGK,MAAK1C,UAAL,CAAgB,kCAAhB,CAHL,EAIP+B,SAJO,CAIG,MAAK/B,UAAL,CAAgB,cAAhB,CAJH,EAKP2C,WALO,CAKKL,EALL,EAMPN,EANO,CAMJ,MAAKhC,UAAL,CAAgB,IAAhB,CANI,CAAZ;;AAQAd,sBAAUgD,IAAV,CAAeK,KAAf,EAAsBJ,IAAtB,CAA2B,YAAM;AAC7B;AACH,aAFD,EAEG,YAAM;AACL;AACH,aAJD;AAKH,SAdD;;AAgBA;AACA,aAAK/C,UAAL,CAAgBkC,GAAhB,CAAoB,qBAApB,EAA2C,UAACsB,KAAD,EAAQC,OAAR,EAAiBC,QAAjB,EAA2BC,SAA3B,EAAsCC,UAAtC,EAAqD;AAC5F;AACA,kBAAK1C,QAAL,GAAgB,KAAhB;;AAEA,kBAAK2C,SAAL;AACH,SALD;;AAOA;AACA,aAAK5D,MAAL,CAAYiC,GAAZ,CAAgB,oBAAhB,EAAsC,YAAM;AACxC,kBAAK4B,sBAAL;AACH,SAFD;;AAIA;AACA,aAAK7D,MAAL,CAAYiC,GAAZ,CAAgB,iBAAhB,EAAmC,YAAM;AACrC,kBAAK6B,qBAAL;AACH,SAFD;;AAIA;AACA,aAAKC,QAAL,GAAgB,KAAKxD,cAAL,CAAoByD,YAApB,KAAqC,8BAArD;;AAEA,aAAKJ,SAAL;;AAEA,aAAKK,SAAL,GAAiB,KAAK1D,cAAL,CAAoByD,YAApB,EAAjB;;AAEA,aAAKE,aAAL,GAAqB,KAAK5D,mBAAL,CAAyB4D,aAA9C;;AAEA;AACA,YAAIC,UAAU,kBAAd;AAAA,YAAkCC,SAAS,IAA3C;AAAA,YAAiDC,cAAc,IAA/D;AAAA,YAAqEC,gBAAgB,IAArF;AAAA,YACIC,WAAW,YADf;AAAA,YAC6BhB,QAAQ,gBADrC;AAAA,YACuDiB,OAAO,EAD9D;AAEA,aAAK/D,kBAAL,CAAwBgE,SAAxB,CAAkCN,OAAlC,EAA2CC,MAA3C,EAAmDC,WAAnD,EAAgEC,aAAhE,EAA+EC,QAA/E,EAAyFhB,KAAzF,EAAgGiB,IAAhG;;AAEA;AACA,aAAKrE,OAAL,CAAauE,cAAb,GAA8B,YAAM;;AAEhC;;AAEA;AACA,gBAAIC,UAAU,MAAKlE,kBAAL,CAAwBmE,YAAxB,GAAuCD,OAArD;;AAEA,gBAAIA,WAAW,IAAf,EAAqB;;AAEjB;AACA,qBAAK,IAAIE,IAAI,CAAb,EAAgBA,IAAIF,QAAQG,MAA5B,EAAoCD,GAApC,EAAyC;AACrC,wBAAIE,SAASJ,QAAQE,CAAR,CAAb;;AAEA,wBAAIE,UAAU,IAAV,IAAkBA,OAAOC,MAA7B,EAAqC;AACjC;AACA,8BAAKvE,kBAAL,CAAwBwE,mBAAxB,CAA4CF,OAAOG,QAAnD,EAA6D,KAA7D;AACH;AACJ;AACJ;AACJ,SAnBD;AAoBH;;AAED;;;;;;;;oCAIY;AACR,gBAAIC,WAAW,KAAKlF,MAAL,CAAYmF,QAAZ,CAAqB9D,IAApC;AACA,iBAAK+D,eAAL,GAAuB,KAAKhE,KAAL,CAAW8D,QAAX,EAAqB7D,IAA5C;;AAEA,gBAAI6D,aAAa,mBAAjB,EAAsC;AAClC,oBAAIf,SAAS,KAAKnE,MAAL,CAAYqF,MAAZ,CAAmBlB,MAAhC;AACA,qBAAKhD,aAAL,GAAqB,KAAKb,cAAL,CAAoBgF,iBAApB,CAAsCnB,MAAtC,CAArB;AACH,aAHD,MAGO;AACH,qBAAKhD,aAAL,GAAqB,KAArB;AACH;AACJ;;;;;AAED;;;qCAGa;AACT,iBAAKH,QAAL,GAAgB,CAAC,KAAKA,QAAtB;AACH;;AAED;;;;;;;qCAIa;AACT;;;;AAIA,iBAAKT,cAAL,CAAoBgF,UAApB;AACH;;AAED;;;;iDACyB;AACrB,gBAAI,CAAC,KAAKxD,mBAAV,EAA+B;AAC7B,qBAAKlC,QAAL,CAAc+C,IAAd,CAAmB,KAAKjB,qBAAxB;AACA,qBAAKI,mBAAL,GAA2B,IAA3B;AACD;AACJ;;AAED;;;;gDACwB;AACpB,iBAAKlC,QAAL,CAAc2F,IAAd,CAAmB,KAAK7D,qBAAxB;AACA,iBAAKI,mBAAL,GAA2B,KAA3B;AACH;;;;;;AAGLrC,2BAA2B+F,OAA3B,GAAqC,CACjC,SADiC,EAEjC,WAFiC,EAGjC,UAHiC,EAIjC,YAJiC,EAKjC,QALiC,EAMjC,QANiC,EAOjC,cAPiC,EAQjC,SARiC,EASjC,eATiC,EAUjC,iBAViC,EAWjC,qBAXiC,EAYjC,gBAZiC,EAajC,gBAbiC,EAcjC,oBAdiC,EAejC,yBAfiC,CAArC;;kBAkBe/F,0B","file":"classroomMonitorController.js","sourcesContent":["'use strict';\n\nclass ClassroomMonitorController {\n\n    constructor($filter,\n                $mdDialog,\n                $mdToast,\n                $rootScope,\n                $scope,\n                $state,\n                $stateParams,\n                $window,\n                ConfigService,\n                NotebookService,\n                NotificationService,\n                ProjectService,\n                SessionService,\n                TeacherDataService,\n                TeacherWebSocketService) {\n\n        this.$filter = $filter;\n        this.$mdToast = $mdToast;\n        this.$rootScope = $rootScope;\n        this.$scope = $scope;\n        this.$state = $state;\n        this.$stateParams = $stateParams;\n        this.$window = $window;\n        this.ConfigService = ConfigService;\n        this.NotebookService = NotebookService;\n        this.NotificationService = NotificationService;\n        this.ProjectService = ProjectService;\n        this.SessionService = SessionService;\n        this.TeacherDataService = TeacherDataService;\n        this.TeacherWebSocketService = TeacherWebSocketService;\n\n        this.$translate = this.$filter('translate');\n\n        this.projectTitle = this.ProjectService.getProjectTitle();\n        this.runId = this.ConfigService.getRunId();\n\n        this.numberProject = true; // TODO: make dynamic or remove\n\n        this.menuOpen = false; // boolean to indicate whether monitor nav menu is open\n        this.showSideMenu = true; // boolean to indicate whether to show the monitor side menu\n        this.showToolbar = true; // boolean to indicate whether to show the monitor toolbar\n        this.showStepTools = false; // boolean to indicate whether to show the step toolbar\n\n        // ui-views and their corresponding names, labels, and icons\n        this.views = {\n            'root.dashboard': {\n                name: this.$translate('dashboardView'),\n                label: this.$translate('dashboardViewLabel'),\n                icon: 'dashboard',\n                type: 'primary',\n                active: false\n            },\n            'root.nodeProgress': {\n                name: this.$translate('projectView'),\n                label: this.$translate('projectViewLabel'),\n                icon: 'assignment_turned_in',\n                type: 'primary',\n                active: true\n            },\n            'root.studentProgress': {\n                name: this.$translate('studentView'),\n                label: this.$translate('studentViewLabel'),\n                icon: 'people',\n                type: 'primary',\n                active: true\n            },\n            'root.notebooks': {\n                name: this.$translate('notebookView'),\n                label: this.$translate('notebookViewLabel'),\n                icon: 'chrome_reader_mode',\n                type: 'primary',\n                active: this.NotebookService.isNotebookEnabled()\n            },\n            'root.export': {\n                name: this.$translate('exportView'),\n                label: this.$translate('exportViewLabel'),\n                icon: 'file_download',\n                type: 'secondary',\n                active: true\n            },\n            'root.notes': {\n                name: this.$translate('notesTipsView'),\n                label: this.$translate('notesTipsViewLabel'),\n                icon: 'speaker_notes',\n                type: 'secondary',\n                active: false\n            },\n            'root.milestones': {\n                name: this.$translate('milestonesView'),\n                label: this.$translate('milestonesViewLabel'),\n                icon: 'flag',\n                type: 'primary',\n                active: true\n            }\n        };\n\n        // build server disconnect display\n        this.connectionLostDisplay = this.$mdToast.build({\n            template: `<md-toast>\n                        <span>{{ 'ERROR_CHECK_YOUR_INTERNET_CONNECTION' | translate }}</span>\n                      </md-toast>`,\n            hideDelay: 0\n        });\n        this.connectionLostShown = false;\n\n        // alert user when inactive for a long time\n        this.$scope.$on('showSessionWarning', () => {\n            // Appending dialog to document.body\n            let confirm = $mdDialog.confirm()\n                .parent(angular.element(document.body))\n                .title(this.$translate('SESSION_TIMEOUT'))\n                .content(this.$translate('SESSION_TIMEOUT_MESSAGE'))\n                .ariaLabel(this.$translate('SESSION_TIMEOUT'))\n                .ok(this.$translate('YES'))\n                .cancel(this.$translate('NO'));\n            $mdDialog.show(confirm).then(() => {\n                this.SessionService.renewSession();\n            }, () => {\n                this.SessionService.forceLogOut();\n            });\n        });\n\n        // alert user when server is going to be updated\n        this.$scope.$on('showRequestLogout', (ev) => {\n            let alert = $mdDialog.confirm()\n                .parent(angular.element(document.body))\n                .title(translations.serverUpdate)\n                .textContent(this.$translate('serverUpdateRequestLogoutMessage'))\n                .ariaLabel(this.$translate('serverUpdate'))\n                .targetEvent(ev)\n                .ok(this.$translate('ok'));\n\n            $mdDialog.show(alert).then(() => {\n                // do nothing\n            }, () => {\n                // do nothing\n            });\n        });\n\n        // listen for state change events\n        this.$rootScope.$on('$stateChangeSuccess', (event, toState, toParams, fromState, fromParams) => {\n            // close the menu when the state changes\n            this.menuOpen = false;\n\n            this.processUI();\n        });\n\n        // alert user when server loses connection\n        this.$scope.$on('serverDisconnected', () => {\n            this.handleServerDisconnect();\n        });\n\n        // remove alert when server regains connection\n        this.$scope.$on('serverConnected', () => {\n            this.handleServerReconnect();\n        });\n\n        // TODO: make dynamic, set somewhere like in config?\n        this.logoPath = this.ProjectService.getThemePath() + '/images/WISE-logo-ffffff.svg';\n\n        this.processUI();\n\n        this.themePath = this.ProjectService.getThemePath();\n\n        this.notifications = this.NotificationService.notifications;\n\n        // save event when classroom monitor session is started\n        let context = \"ClassroomMonitor\", nodeId = null, componentId = null, componentType = null,\n            category = \"Navigation\", event = \"sessionStarted\", data = {};\n        this.TeacherDataService.saveEvent(context, nodeId, componentId, componentType, category, event, data);\n\n        // perform cleanup before the clasroom monitor tab closes\n        this.$window.onbeforeunload = () => {\n\n            // unpause all the periods that are currently paused\n\n            // get all the periods\n            var periods = this.TeacherDataService.getRunStatus().periods;\n\n            if (periods != null) {\n\n                // loop through all the periods\n                for (var p = 0; p < periods.length; p++) {\n                    var period = periods[p];\n\n                    if (period != null && period.paused) {\n                        // the period is paused so we will unpause it\n                        this.TeacherDataService.pauseScreensChanged(period.periodId, false);\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Update UI items based on state, show or hide relevant menus and toolbars\n     * TODO: remove/rework this and put items in their own ui states?\n     */\n    processUI() {\n        let viewName = this.$state.$current.name;\n        this.currentViewName = this.views[viewName].name;\n\n        if (viewName === 'root.nodeProgress') {\n            let nodeId = this.$state.params.nodeId;\n            this.showStepTools = this.ProjectService.isApplicationNode(nodeId);\n        } else {\n            this.showStepTools = false;\n        }\n    };\n\n    /**\n     * Toggle the classroom monitor main menu\n     */\n    toggleMenu() {\n        this.menuOpen = !this.menuOpen;\n    }\n\n    /**\n     * The user has moved the mouse so we will notify the Session Service\n     * so that it can refresh the session\n     */\n    mouseMoved() {\n        /*\n         * notify the Session Service that the user has moved the mouse\n         * so we can refresh the session\n         */\n        this.SessionService.mouseMoved();\n    }\n\n    // show server error alert when connection is lost\n    handleServerDisconnect() {\n        if (!this.connectionLostShown) {\n          this.$mdToast.show(this.connectionLostDisplay);\n          this.connectionLostShown = true;\n        }\n    }\n\n    // hide server error alert when connection is restored\n    handleServerReconnect() {\n        this.$mdToast.hide(this.connectionLostDisplay);\n        this.connectionLostShown = false;\n    }\n}\n\nClassroomMonitorController.$inject = [\n    '$filter',\n    '$mdDialog',\n    '$mdToast',\n    '$rootScope',\n    '$scope',\n    '$state',\n    '$stateParams',\n    '$window',\n    'ConfigService',\n    'NotebookService',\n    'NotificationService',\n    'ProjectService',\n    'SessionService',\n    'TeacherDataService',\n    'TeacherWebSocketService'\n];\n\nexport default ClassroomMonitorController;\n"]}