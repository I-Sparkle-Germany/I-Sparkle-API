{"version":3,"sources":["classroomMonitorController.es6"],"names":[],"mappings":"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","file":"classroomMonitorController.js","sourcesContent":["'use strict';\n\nclass ClassroomMonitorController {\n\n    constructor($scope, $rootScope, $state, $stateParams, ConfigService, ProjectService, TeacherDataService) {\n        this.$scope = $scope;\n        this.$rootScope = $rootScope;\n        this.$state = $state;\n        this.$stateParams = $stateParams;\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n        this.TeacherDataService = TeacherDataService;\n    };\n    hello() {\n        ocpu.seturl(\"//128.32.189.240:81/ocpu/user/wiser/library/wiser/R\");\n        // perform the request\n        var req = ocpu.call(\"hello\", {\n            \"name\": \"Hiroki\"\n        }, function (session) {\n            session.getStdout(function (returnedCSVString) {\n                var csvBlob = new Blob([returnedCSVString], {type: 'text/csv'});\n                var csvUrl = URL.createObjectURL(csvBlob);\n                var a = document.createElement(\"a\");\n                document.body.appendChild(a);\n                a.style = \"display: none\";\n                a.href = csvUrl;\n                a.download = \"export_\" + runId + \".csv\";\n                a.click();\n\n                // timeout is required for FF.\n                window.setTimeout(function () {\n                    URL.revokeObjectURL(csvUrl);  // tell browser to release URL reference\n                }, 3000);\n            });\n        });\n    };\n\n    export(exportType) {\n        this.TeacherDataService.getExport(exportType).then((result) => {\n            var COLUMN_INDEX_NODE_ID = 1;\n            var COLUMN_INDEX_COMPONENT_ID = 2;\n            var COLUMN_INDEX_STEP_NUMBER = 4;\n            var COLUMN_INDEX_STEP_TITLE = 5;\n            var COLUMN_INDEX_COMPONENT_PART_NUMBER = 6;\n            var COLUMN_INDEX_STUDENT_DATA = 11;\n            var COLUMN_INDEX_WISE_IDS = 18;\n            var COLUMN_INDEX_WISE_ID_1 = 18;\n            var COLUMN_INDEX_WISE_ID_2 = 19;\n            var COLUMN_INDEX_WISE_ID_3 = 20;\n            var COLUMN_INDEX_STUDENT_RESPONSE = 21;\n\n            var csvString = \"\";\n            for (var rowIndex = 0; rowIndex < result.length; rowIndex++) {\n\n                var row = result[rowIndex];\n\n                if (rowIndex === 0) {\n                    // append additional header columns\n                    row[COLUMN_INDEX_WISE_ID_1] = \"WISE ID 1\";\n                    row[COLUMN_INDEX_WISE_ID_2] = \"WISE ID 2\";\n                    row[COLUMN_INDEX_WISE_ID_3] = \"WISE ID 3\";\n                    row[COLUMN_INDEX_STUDENT_RESPONSE] = \"response\";\n                } else {\n                    // for all non-header rows, fill in step numbers, titles, and component part numbers.\n                    var nodeId = row[COLUMN_INDEX_NODE_ID];\n                    var componentId = row[COLUMN_INDEX_COMPONENT_ID];\n                    row[COLUMN_INDEX_STEP_NUMBER] = this.ProjectService.getNodePositionById(nodeId);\n                    row[COLUMN_INDEX_STEP_TITLE] = this.ProjectService.getNodeTitleByNodeId(nodeId);\n                    row[COLUMN_INDEX_COMPONENT_PART_NUMBER] = this.ProjectService.getComponentPositionByNodeIdAndComponentId(nodeId, componentId) + 1; // make it 1-indexed for researchers\n                    var wiseIDs = row[COLUMN_INDEX_WISE_IDS];\n                    var wiseIDsArray = wiseIDs.split(\",\");\n                    row[COLUMN_INDEX_WISE_ID_1] = wiseIDsArray[0];\n                    row[COLUMN_INDEX_WISE_ID_2] = wiseIDsArray[1] || \"\";\n                    row[COLUMN_INDEX_WISE_ID_3] = wiseIDsArray[2] || \"\";\n\n                    // get the student data JSON and extract responses into its own column\n                    var studentDataJSONCell = row[COLUMN_INDEX_STUDENT_DATA];\n                    row[COLUMN_INDEX_STUDENT_RESPONSE] = studentDataJSONCell.response || \"\";\n                }\n\n                // append row to cvsString\n                for (var cellIndex = 0; cellIndex < row.length; cellIndex++) {\n                    var cell = row[cellIndex];\n                    if (typeof cell === \"object\") {\n                        cell = \"\\\"\" + JSON.stringify(cell).replace(/\"/g, '\"\"') + \"\\\"\";\n                    } else if (typeof cell === \"string\") {\n                        cell = \"\\\"\" + cell + \"\\\"\";\n                    }\n                    csvString += cell + \",\";\n                }\n                csvString += \"\\r\\n\";\n            }\n            var runId = this.ConfigService.getRunId();\n            var csvBlob = new Blob([csvString], {type: 'text/csv'});\n            var csvFile = new File([csvBlob], \"export_\" + runId + \".csv\");\n\n            //ocpu.seturl(\"//localhost:1234/ocpu/library/wise/R\");\n            ocpu.seturl(\"http://128.32.189.240:81/ocpu/user/wiser/library/wiser/R\");\n            //perform the request\n            var request = ocpu.call(\"extractchoices\", {\n                \"csvFile\": csvFile\n            }, function (session) {\n                session.getStdout(function (returnedCSVString) {\n                    var csvBlob = new Blob([returnedCSVString], {type: 'text/csv'});\n                    var csvUrl = URL.createObjectURL(csvBlob);\n                    var a = document.createElement(\"a\");\n                    document.body.appendChild(a);\n                    a.href = csvUrl;\n                    a.download = \"export_\" + runId + \".csv\";\n                    a.click();\n\n                    // timeout is required for FF.\n                    window.setTimeout(function () {\n                        URL.revokeObjectURL(csvUrl);  // tell browser to release URL reference\n                    }, 3000);\n\n                    //return returnedCSVString;\n                });\n            });\n\n            //if R returns an error, alert the error message\n            request.fail(function () {\n                alert(\"Server error: \" + request.responseText);\n            });\n        });\n    }\n}\n\nClassroomMonitorController.$inject = ['$scope', '$rootScope', '$state', '$stateParams', 'ConfigService',\n    'ProjectService', 'TeacherDataService'];\n\nexport default ClassroomMonitorController;"]}