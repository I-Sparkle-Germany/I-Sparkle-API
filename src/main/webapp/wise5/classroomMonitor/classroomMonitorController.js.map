{"version":3,"sources":["classroomMonitorController.es6"],"names":[],"mappings":"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","file":"classroomMonitorController.js","sourcesContent":["'use strict';\n\nclass ClassroomMonitorController {\n\n    constructor($scope, $rootScope, $state, $stateParams, ConfigService, ProjectService, TeacherDataService) {\n        this.$scope = $scope;\n        this.$rootScope = $rootScope;\n        this.$state = $state;\n        this.$stateParams = $stateParams;\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n        this.TeacherDataService = TeacherDataService;\n    };\n    hello() {\n        ocpu.seturl(\"//128.32.189.240:81/ocpu/user/wiser/library/wiser/R\");\n        // perform the request\n        var req = ocpu.call(\"hello\", {\n            \"name\": \"Hiroki\"\n        }, function (session) {\n            session.getStdout(function (returnedCSVString) {\n                var csvBlob = new Blob([returnedCSVString], {type: 'text/csv'});\n                var csvUrl = URL.createObjectURL(csvBlob);\n                var a = document.createElement(\"a\");\n                document.body.appendChild(a);\n                a.style = \"display: none\";\n                a.href = csvUrl;\n                a.download = \"export_\" + runId + \".csv\";\n                a.click();\n\n                // timeout is required for FF.\n                window.setTimeout(function () {\n                    URL.revokeObjectURL(csvUrl);  // tell browser to release URL reference\n                }, 3000);\n            });\n        });\n    };\n\n    export(exportType) {\n        this.TeacherDataService.getExport(exportType).then((result) => {\n            var COLUMN_INDEX_NODE_ID = 1;\n            var COLUMN_INDEX_COMPONENT_ID = 2;\n            var COLUMN_INDEX_STEP_NUMBER = 4;\n            var COLUMN_INDEX_STEP_TITLE = 5;\n            var COLUMN_INDEX_COMPONENT_PART_NUMBER = 6;\n            var COLUMN_INDEX_STUDENT_DATA = 11;\n            var COLUMN_INDEX_WISE_IDS = 18;\n            var COLUMN_INDEX_WISE_ID_1 = 18;\n            var COLUMN_INDEX_WISE_ID_2 = 19;\n            var COLUMN_INDEX_WISE_ID_3 = 20;\n            var COLUMN_INDEX_STUDENT_RESPONSE = 21;\n\n            var csvString = \"\";\n            for (var rowIndex = 0; rowIndex < result.length; rowIndex++) {\n\n                var row = result[rowIndex];\n\n                if (rowIndex === 0) {\n                    // append additional header columns\n                    row[COLUMN_INDEX_WISE_ID_1] = \"WISE ID 1\";\n                    row[COLUMN_INDEX_WISE_ID_2] = \"WISE ID 2\";\n                    row[COLUMN_INDEX_WISE_ID_3] = \"WISE ID 3\";\n                    row[COLUMN_INDEX_STUDENT_RESPONSE] = \"response\";\n                } else {\n                    // for all non-header rows, fill in step numbers, titles, and component part numbers.\n                    var nodeId = row[COLUMN_INDEX_NODE_ID];\n                    var componentId = row[COLUMN_INDEX_COMPONENT_ID];\n                    row[COLUMN_INDEX_STEP_NUMBER] = this.ProjectService.getNodePositionById(nodeId);\n                    row[COLUMN_INDEX_STEP_TITLE] = this.ProjectService.getNodeTitleByNodeId(nodeId);\n                    row[COLUMN_INDEX_COMPONENT_PART_NUMBER] = this.ProjectService.getComponentPositionByNodeIdAndComponentId(nodeId, componentId) + 1; // make it 1-indexed for researchers\n                    var wiseIDs = row[COLUMN_INDEX_WISE_IDS];\n                    var wiseIDsArray = wiseIDs.split(\",\");\n                    row[COLUMN_INDEX_WISE_ID_1] = wiseIDsArray[0];\n                    row[COLUMN_INDEX_WISE_ID_2] = wiseIDsArray[1] || \"\";\n                    row[COLUMN_INDEX_WISE_ID_3] = wiseIDsArray[2] || \"\";\n\n                    // get the student data JSON and extract responses into its own column\n                    var studentDataJSONCell = row[COLUMN_INDEX_STUDENT_DATA];\n                    row[COLUMN_INDEX_STUDENT_RESPONSE] = studentDataJSONCell.response || \"\";\n                }\n\n                // append row to cvsString\n                for (var cellIndex = 0; cellIndex < row.length; cellIndex++) {\n                    var cell = row[cellIndex];\n                    if (typeof cell === \"object\") {\n                        cell = \"\\\"\" + JSON.stringify(cell).replace(/\"/g, '\"\"') + \"\\\"\";\n                    } else if (typeof cell === \"string\") {\n                        cell = \"\\\"\" + cell + \"\\\"\";\n                    }\n                    csvString += cell + \",\";\n                }\n                csvString += \"\\r\\n\";\n            }\n            var runId = this.ConfigService.getRunId();\n            var csvBlob = new Blob([csvString], {type: 'text/csv'});\n            var csvFile = new File([csvBlob], \"export_\" + runId + \".csv\");\n\n            //ocpu.seturl(\"//localhost:1234/ocpu/library/wise/R\");\n            ocpu.seturl(\"http://128.32.189.240:81/ocpu/user/wiser/library/wiser/R\");\n            //perform the request\n            var request = ocpu.call(\"extractchoices\", {\n                \"csvFile\": csvFile\n            }, function (session) {\n                session.getStdout(function (returnedCSVString) {\n                    var csvBlob = new Blob([returnedCSVString], {type: 'text/csv'});\n                    var csvUrl = URL.createObjectURL(csvBlob);\n                    var a = document.createElement(\"a\");\n                    document.body.appendChild(a);\n                    a.href = csvUrl;\n                    a.download = \"export_\" + runId + \".csv\";\n                    a.click();\n\n                    // timeout is required for FF.\n                    window.setTimeout(function () {\n                        URL.revokeObjectURL(csvUrl);  // tell browser to release URL reference\n                    }, 3000);\n\n                    //return returnedCSVString;\n                });\n            });\n\n            //if R returns an error, alert the error message\n            request.fail(function () {\n                alert(\"Server error: \" + request.responseText);\n            });\n        });\n    }\n}\n\nClassroomMonitorController.$inject = ['$scope', '$rootScope', '$state', '$stateParams', 'ConfigService',\n    'ProjectService', 'TeacherDataService'];\n\nexport default ClassroomMonitorController;"]}