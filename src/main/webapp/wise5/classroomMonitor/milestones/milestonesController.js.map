{"version":3,"sources":["milestonesController.es6"],"names":["MilestonesController","$injector","$filter","$mdDialog","$rootScope","$scope","$state","AchievementService","ConfigService","ProjectService","StudentStatusService","TeacherDataService","TeacherWebSocketService","UtilService","moment","$translate","calendarIsOpenTemporaryStorage","itemsTemporaryStorage","workgroupsStorage","editStorage","numberOfStudentsCompletedStorage","percentageCompletedStorage","showStudentsStorage","timeDiffStorage","periodId","getCurrentPeriod","setWorkgroupsInCurrentPeriod","loadAchievements","$on","event","args","studentAchievement","addOrUpdateAchievement","data","id","updateMilestoneCompletion","currentPeriod","i","achievements","length","achievementsObject","getAchievements","isEnabled","items","a","projectAchievement","makeCopyOfJSONObject","idToOrder","params","nodeIds","n","nodeId","checked","date","percentageCompleted","result","isBefore","isSame","milestone","projectAchievements","getAchievementItems","tomorrow","add","hours","minutes","seconds","getAvailableAchievementId","name","description","type","targetDate","valueOf","icon","image","isVisible","$event","title","label","msg","yes","cancel","confirm","textContent","ariaLabel","targetEvent","ok","show","then","index","splice","saveProject","achievementId","push","achievement","workgroups","numberOfStudentsCompleted","clearTempFields","restoreTempFields","workgroupId","getDisplayUsernamesByWorkgroupId","workgroupIdsInRun","getClassmateWorkgroupIds","workgroupIds","currentId","currentPeriodId","getPeriodIdByWorkgroupId","numberOfStudentsInRun","achievementIdToAchievements","getAchievementIdToAchievementsMappings","studentAchievementsForAchievementId","workgroupIdsCompleted","achievementTimes","workgroupIdsNotCompleted","s","currentWorkgroupId","indexOf","achievementTime","w","c","workgroupObject","displayNames","completed","parseInt","template","parent","angular","element","document","body","fullscreen","clickOutsideToClose","escapeToClose","locals","controller","DialogController","close","hide","edit","action","delete","onShowWorkgroup","workgroup","setCurrentWorkgroup","go","copy","editMilestone","deleteMilestone","editMode","createMilestone","valid","save","alert","onChange","saveMilestone","$inject"],"mappings":"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","file":"milestonesController.js","sourcesContent":["'use strict';\n\nclass MilestonesController {\n\n    constructor($injector,\n                $filter,\n                $mdDialog,\n                $rootScope,\n                $scope,\n                $state,\n                AchievementService,\n                ConfigService,\n                ProjectService,\n                StudentStatusService,\n                TeacherDataService,\n                TeacherWebSocketService,\n                UtilService,\n                moment) {\n\n        this.$injector = $injector;\n        this.$filter = $filter;\n        this.$mdDialog = $mdDialog;\n        this.$rootScope = $rootScope;\n        this.$scope = $scope;\n        this.$state = $state;\n        this.AchievementService = AchievementService;\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n        this.StudentStatusService = StudentStatusService;\n        this.TeacherDataService = TeacherDataService;\n        this.TeacherWebSocketService = TeacherWebSocketService;\n        this.UtilService = UtilService;\n        this.moment = moment;\n\n        this.$translate = this.$filter('translate');\n\n        /*\n         * Arrays used to temporarily store milestone display values. We add\n         * fields to the milestone objects but we don't want to save those\n         * fields when we save the milestones to the server. We remove the\n         * fields from the milestones and then save the milestones to the\n         * server. After we save the milestones, we add the fields back into\n         * the milestones.\n         */\n        this.calendarIsOpenTemporaryStorage = [];\n        this.itemsTemporaryStorage = [];\n        this.workgroupsStorage = [];\n        this.editStorage = [];\n        this.numberOfStudentsCompletedStorage = [];\n        this.percentageCompletedStorage = [];\n        this.showStudentsStorage = [];\n        this.timeDiffStorage = [];\n\n        this.periodId = this.TeacherDataService.getCurrentPeriod().periodId;\n        this.setWorkgroupsInCurrentPeriod();\n\n        // load the achievements and perform additional calculations\n        this.loadAchievements();\n\n        // listen for the newStudentAchievement event\n        this.$rootScope.$on('newStudentAchievement', (event, args) => {\n\n            if (args) {\n                // get the student achievement that was saved to the server\n                let studentAchievement = args.studentAchievement;\n\n                if (studentAchievement != null) {\n\n                    // add the student achievement to our local copy of the student achievements\n                    this.AchievementService.addOrUpdateAchievement(studentAchievement);\n\n                    if (studentAchievement.data != null && studentAchievement.data.id != null) {\n                        // update the milestone in the UI with the new student achievement information\n                        this.updateMilestoneCompletion(studentAchievement.data.id);\n                    }\n                }\n            }\n        });\n\n        /**\n         * Listen for current period changed event\n         */\n        this.$scope.$on('currentPeriodChanged', (event, args) => {\n            this.periodId = args.currentPeriod.periodId;\n\n            // update the completion status for all the project achievements\n            for (let i = 0; i < this.achievements.length; i++) {\n                this.setWorkgroupsInCurrentPeriod();\n                this.updateMilestoneCompletion(this.achievements[i].id);\n            }\n        });\n    }\n\n    /**\n     * Load the achievements and perform additional calculations\n     */\n    loadAchievements() {\n\n        // get the project achievements object\n        var achievementsObject = this.ProjectService.getAchievements();\n\n        if (achievementsObject != null) {\n\n            if (achievementsObject.isEnabled) {\n\n                if (achievementsObject.items) {\n\n                    // get the project achievements\n                    this.achievements = achievementsObject.items;\n\n                    // loop through all the project achievements\n                    for (var a = 0; a < this.achievements.length; a++) {\n\n                        // get a project achievement\n                        var projectAchievement = this.achievements[a];\n\n                        if (projectAchievement != null) {\n\n                            // update the student completion information for this milestone\n                            this.updateMilestoneCompletion(projectAchievement.id);\n\n                            // get all the activities and steps in the project\n                            projectAchievement.items = this.UtilService.makeCopyOfJSONObject(this.ProjectService.idToOrder);\n\n                            if (projectAchievement.params != null && projectAchievement.params.nodeIds != null) {\n\n                                /*\n                                 * loop through all the node ids that are required\n                                 * to be completed for this achievement\n                                 */\n                                for (var n = 0; n < projectAchievement.params.nodeIds.length; n++) {\n                                    var nodeId = projectAchievement.params.nodeIds[n];\n\n                                    if (projectAchievement.items[nodeId] != null) {\n                                        // check the checkbox corresponding to the node id\n                                        projectAchievement.items[nodeId].checked = true;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Check if the given milestone date is before the current day (and\n     * milestone completion is less than 100%)\n     * @param date a date string or object\n     * @param percentageCompleted Number percent completed\n     * @return Boolean whether given date is before today\n     */\n    isBeforeDay(date, percentageCompleted) {\n        let result = false;\n\n        if (date && percentageCompleted < 100) {\n            result = this.moment(date).isBefore(this.moment(), 'day');\n        }\n\n        return result;\n    }\n\n    /**\n     * Check if the given milestone date is the same as the current day (and\n     * milestone completion is less than 100%)\n     * @param date a date string or object\n     * @param percentageCompleted Number percent completed\n     * @return Boolean whether given date is before today\n     */\n    isSameDay(date, percentageCompleted) {\n        let result = false;\n\n        if (date && percentageCompleted < 100) {\n            result = this.moment(date).isSame(this.moment(), 'day');\n        }\n\n        return result;\n    }\n\n    /**\n     * Create a new milestone\n     * @return a milestone object\n     */\n    createMilestone() {\n        let milestone = null;\n\n        // get the project achievements\n        let projectAchievements = this.ProjectService.getAchievementItems();\n\n        if (projectAchievements != null) {\n\n            // get the time of tomorrow at 3pm\n            let tomorrow = this.moment().add('days', 1).hours(23).minutes(11).seconds(59);\n\n            // create a new milestone object\n            milestone = {\n                id: this.AchievementService.getAvailableAchievementId(),\n                name: '',\n                description: '',\n                type: \"milestone\",\n                params: {\n                    nodeIds: [],\n                    targetDate: tomorrow.valueOf()\n                },\n                icon: {\n                    image: \"\"\n                },\n                items: this.UtilService.makeCopyOfJSONObject(this.ProjectService.idToOrder),\n                isVisible: true\n            };\n        }\n\n        return milestone;\n    }\n\n    /**\n     * Delete a milestone\n     * @param milestone the milestone to delete\n     */\n    deleteMilestone(milestone, $event) {\n\n        if (milestone) {\n            let title = milestone.name;\n            let label = this.$translate('DELETE_MILESTONE');\n            let msg = this.$translate('DELETE_MILESTONE_CONFIRM', { name: milestone.name });\n            let yes = this.$translate('YES');\n            let cancel = this.$translate('CANCEL')\n\n            let confirm = this.$mdDialog.confirm()\n                .title(title)\n                .textContent(msg)\n                .ariaLabel(label)\n                .targetEvent($event)\n                .ok(yes)\n                .cancel(cancel);\n\n            this.$mdDialog.show(confirm).then(() => {\n                let achievements = this.achievements;\n                let index = -1;\n\n                // find the matching achievement index\n                for (let i = 0; i < achievements.length; i++) {\n                    if (achievements[i].id === milestone.id) {\n                        index = i;\n                        break;\n                    }\n                }\n\n                if (index > -1) {\n                    // remove the milestone\n                    this.achievements.splice(index, 1);\n\n                    // save the project to the server\n                    this.saveProject();\n                }\n            }, () => {\n            });\n        }\n    }\n\n    saveMilestone(milestone) {\n        let index = -1;\n\n        for (let i = 0; i < this.achievements.length; i++) {\n            let achievementId = this.achievements[i].id;\n\n            if (milestone.id === achievementId) {\n                index = i;\n                this.achievements[i] = milestone;\n                break;\n            }\n        }\n\n        if (index < 0) {\n            // get the project achievements\n            let projectAchievements = this.ProjectService.getAchievementItems();\n\n            if (projectAchievements && milestone) {\n\n                // add the milestone object to the array of achievements\n                projectAchievements.push(milestone);\n            }\n        }\n\n        // save the project\n        this.saveProject();\n\n        // reload the achievements\n        this.loadAchievements();\n    }\n\n    /**\n     * Remove the temporary fields from the milestone objects and store\n     * them in temporary storage arrays so that we can load the fields back\n     * in later\n     */\n    clearTempFields() {\n\n        /*\n         * these array will store the temporary fields. the index of the arrays\n         * corresponds to the index of the achievement. for example the percentageCompletedStorage\n         * value for the first achievement will be stored in\n         * this.percentageCompletedStorage[0]. the percentageCompletedStorage value for the second\n         * achievement will be stored in this.percentageCompletedStorage[1].\n         */\n        this.itemsTemporaryStorage = [];\n        this.workgroupsStorage = [];\n        this.numberOfStudentsCompletedStorage = [];\n        this.percentageCompletedStorage = [];\n\n        // loop through all the achievements\n        for (var a = 0; a < this.achievements.length; a++) {\n\n            // get an achievement\n            var achievement = this.achievements[a];\n\n            // save the field values in the temprary storage arrays\n            this.workgroupsStorage.push(achievement.workgroups);\n            this.numberOfStudentsCompletedStorage.push(achievement.numberOfStudentsCompleted);\n            this.percentageCompletedStorage.push(achievement.percentageCompleted);\n\n            // delete the field from the achievement\n            delete achievement.items;\n            delete achievement.workgroups;\n            delete achievement.numberOfStudentsCompleted;\n            delete achievement.percentageCompleted;\n        }\n    }\n\n    /**\n     * Restore the temporary fields into the achievement objects\n     */\n    restoreTempFields() {\n\n        // loop through all the achievements\n        for (var a = 0; a < this.achievements.length; a++) {\n\n            // get an achievement\n            var achievement = this.achievements[a];\n\n            // set the fields back into the achievement object\n            achievement.items = this.itemsTemporaryStorage[a];\n            achievement.workgroups = this.workgroupsStorage[a];\n            achievement.numberOfStudentsCompleted = this.numberOfStudentsCompletedStorage[a];\n            achievement.percentageCompleted = this.percentageCompletedStorage[a];\n        }\n\n        // clear the temporary storage arrays\n        this.itemsTemporaryStorage = [];\n        this.workgroupsStorage = [];\n        this.numberOfStudentsCompletedStorage = [];\n        this.percentageCompletedStorage = [];\n    }\n\n    /**\n     * Save the project to the server\n     */\n    saveProject() {\n\n        // clear the temp fields and remember them\n        this.clearTempFields();\n\n        // save the project to the server\n        this.ProjectService.saveProject();\n\n        // restore the temp fields\n        this.restoreTempFields();\n    }\n\n    /**\n     * Get the user names for a workgroup id\n     * @param workgroupId the workgroup id\n     * @return the user names in the workgroup\n     */\n    getDisplayUsernamesByWorkgroupId(workgroupId) {\n        return this.ConfigService.getDisplayUsernamesByWorkgroupId(workgroupId);\n    }\n\n    setWorkgroupsInCurrentPeriod() {\n        // get the workgroup ids\n        let workgroupIdsInRun = this.ConfigService.getClassmateWorkgroupIds();\n        this.workgroupIds = [];\n\n        // filter out workgroups not in the current period\n        for (let i = 0; i < workgroupIdsInRun.length; i++) {\n            let currentId = workgroupIdsInRun[i];\n            let currentPeriodId = this.ConfigService.getPeriodIdByWorkgroupId(currentId);\n\n            if (this.periodId === -1 || currentPeriodId === this.periodId) {\n                this.workgroupIds.push(currentId);\n            }\n        }\n\n        // the number of students in the run\n        this.numberOfStudentsInRun = this.workgroupIds.length;\n    }\n\n    /**\n     * Update the student completion information for this milestone\n     * @param achievementId the achievement id to update\n     */\n    updateMilestoneCompletion(achievementId) {\n        if (achievementId != null) {\n\n            // loop through all the project achievements\n            for (var a = 0; a < this.achievements.length; a++) {\n                var projectAchievement = this.achievements[a];\n\n                if (achievementId == projectAchievement.id) {\n                    // we have found the milestone we want to update\n\n                    // get the student achievements\n                    var achievementIdToAchievements = this.AchievementService.getAchievementIdToAchievementsMappings();\n\n                    // get the student achievements for this achievement id\n                    var studentAchievementsForAchievementId = achievementIdToAchievements[projectAchievement.id];\n\n                    var workgroupIdsCompleted = [];\n                    var achievementTimes = [];\n                    var workgroupIdsNotCompleted = [];\n\n                    /*\n                     * loop through all the student achievements for\n                     * this achievement id\n                     */\n                    for (var s = 0; s < studentAchievementsForAchievementId.length; s++) {\n                        var studentAchievement = studentAchievementsForAchievementId[s];\n\n                        if (studentAchievement != null) {\n                            let currentWorkgroupId = studentAchievement.workgroupId;\n\n                            // check if workgroup is in current period\n                            if (this.workgroupIds.indexOf(currentWorkgroupId) > -1) {\n                                /*\n                                 * add the workgroup id to the array of workgroup ids that\n                                 * have completed the achievement\n                                 */\n                                workgroupIdsCompleted.push(currentWorkgroupId);\n\n                                // add the achievement time to the achievement times array\n                                achievementTimes.push(studentAchievement.achievementTime);\n                            }\n                        }\n                    }\n\n                    /*\n                     * loop through all the workgroup ids to find the\n                     * workgroup ids that have not completed the\n                     * achievement\n                     */\n                     for (var w = 0; w < this.workgroupIds.length; w++) {\n                        var workgroupId = this.workgroupIds[w];\n                        if (workgroupIdsCompleted.indexOf(workgroupId) == -1) {\n                            // this workgroup has not completed the achievement\n\n                            /*\n                             * add the workgroup id to the array of workgroup ids that\n                             * have not completed the achievement\n                             */\n                            workgroupIdsNotCompleted.push(workgroupId);\n                        }\n                    }\n\n                    projectAchievement.workgroups = [];\n\n                    /*\n                     * loop through all the workgroups that have\n                     * completed the achievement\n                     */\n                    for (var c = 0; c < workgroupIdsCompleted.length; c++) {\n                        var workgroupId = workgroupIdsCompleted[c];\n                        var achievementTime = achievementTimes[c];\n\n                        /*\n                         * create an object used for displaying\n                         * information about the workgroup\n                         */\n                        var workgroupObject = {\n                            workgroupId: workgroupId,\n                            displayNames: this.getDisplayUsernamesByWorkgroupId(workgroupId),\n                            achievementTime: achievementTime,\n                            completed: true\n                        };\n\n                        projectAchievement.workgroups.push(workgroupObject);\n                    }\n\n                    /*\n                     * loop through all the workgroups that have not\n                     * completed the achievement\n                     */\n                    for (var n = 0; n < workgroupIdsNotCompleted.length; n++) {\n                        var workgroupId = workgroupIdsNotCompleted[n];\n\n                        /*\n                         * create an object used for displaying\n                         * information about the workgroup\n                         */\n                        var workgroupObject = {\n                            workgroupId: workgroupId,\n                            displayNames: this.getDisplayUsernamesByWorkgroupId(workgroupId),\n                            achievementTime: null,\n                            completed: false\n                        };\n\n                        projectAchievement.workgroups.push(workgroupObject);\n                    }\n\n                    /*\n                     * calculate the number of workgroups that completed\n                     * the achievement\n                     */\n                    projectAchievement.numberOfStudentsCompleted = workgroupIdsCompleted.length;\n\n                    /*\n                     * calculate the percentage of workgroups that have\n                     * completed the achievement\n                     */\n                    projectAchievement.percentageCompleted = parseInt(100 * projectAchievement.numberOfStudentsCompleted / this.numberOfStudentsInRun);\n                }\n            }\n        }\n    }\n\n    /**\n     * Open a dialog with the milestone details (list with workgroups statuses\n     * for the given milestone)\n     * @param milestone the milestone object to show\n     * @param $event the event that triggered the function call\n     */\n    showMilestoneDetails(milestone, $event) {\n        let title = this.$translate('MILESTONE_DETAILS_TITLE', { name: milestone.name });\n        let template =\n            `<md-dialog class=\"dialog--wide\">\n                <md-toolbar>\n                    <div class=\"md-toolbar-tools\">\n                        <h2>${ title }</h2>\n                    </div>\n                </md-toolbar>\n                <md-dialog-content class=\"gray-lighter-bg md-dialog-content\">\n                    <milestone-details milestone=\"milestone\" on-show-workgroup=\"onShowWorkgroup(value)\"></milestone-details>\n                </md-dialog-content>\n                <md-dialog-actions layout=\"row\" layout-align=\"start center\">\n                    <md-button class=\"warn\"\n                               ng-click=\"delete()\"\n                               aria-label=\"{{ 'DELETE' | translate }}\">\n                        {{ 'DELETE' | translate }}\n                    </md-button>\n                    <span flex></span>\n                    <md-button class=\"md-primary\"\n                               ng-click=\"edit()\"\n                               aria-label=\"{{ 'EDIT' | translate }}\">\n                        {{ 'EDIT' | translate }}\n                    </md-button>\n                    <md-button class=\"md-primary\"\n                               ng-click=\"close()\"\n                               aria-label=\"{{ 'CLOSE' | translate }}\">\n                            {{ 'CLOSE' | translate }}\n                        </md-button>\n                    </md-dialog-actions>\n            </md-dialog>`;\n\n        // display the milestone details in a dialog\n        this.$mdDialog.show({\n            parent: angular.element(document.body),\n            template: template,\n            ariaLabel: title,\n            fullscreen: true,\n            targetEvent: $event,\n            clickOutsideToClose: true,\n            escapeToClose: true,\n            locals: {\n                $event, $event,\n                milestone: milestone\n            },\n            controller: ['$scope', '$state', '$mdDialog', 'milestone', '$event', 'TeacherDataService',\n                function DialogController($scope, $state, $mdDialog, milestone, $event, TeacherDataService) {\n                    $scope.milestone = milestone;\n                    $scope.event = $event;\n\n                    // close the popup\n                    $scope.close = function() {\n                        $mdDialog.hide();\n                    }\n\n                    // edit the milestone\n                    $scope.edit = function() {\n                        $mdDialog.hide({ milestone: $scope.milestone, action: 'edit', $event: $event });\n                    }\n\n                    // delete the milestone\n                    $scope.delete = function() {\n                        $mdDialog.hide({ milestone: $scope.milestone, action: 'delete' });\n                    }\n\n                    $scope.onShowWorkgroup = function(workgroup) {\n                        $mdDialog.hide();\n                        TeacherDataService.setCurrentWorkgroup(workgroup);\n                        $state.go('root.nodeProgress');\n                    }\n                }\n            ]\n        }).then((data) => {\n            if (data && data.action && data.milestone) {\n                if (data.action === 'edit') {\n                    let milestone = angular.copy(data.milestone);\n                    this.editMilestone(milestone, data.$event);\n                } else if (data.action === 'delete') {\n                    this.deleteMilestone(data.milestone);\n                }\n            }\n        }, () => {});;\n    }\n\n    /**\n     * Open a dialog to edit milestone details (or create a new one)\n     * @param milestone the milestone object to show\n     * @param $event the event that triggered the function call\n     */\n    editMilestone(milestone, $event) {\n        let editMode = milestone ? true : false;\n        let title = editMode ? this.$translate('EDIT_MILESTONE') : this.$translate('ADD_MILESTONE');\n\n        if (!editMode) {\n            milestone = this.createMilestone();\n        }\n\n        let template =\n            `<md-dialog class=\"dialog--wide\">\n                <md-toolbar>\n                    <div class=\"md-toolbar-tools\">\n                        <h2>${ title }</h2>\n                    </div>\n                </md-toolbar>\n                <md-dialog-content class=\"gray-lighter-bg md-dialog-content\">\n                    <milestone-edit milestone=\"milestone\" on-change=\"onChange(milestone, valid)\"></milestone-edit>\n                </md-dialog-content>\n                <md-dialog-actions layout=\"row\" layout-align=\"end center\">\n                    <md-button ng-click=\"close()\"\n                               aria-label=\"{{ 'CANCEL' | translate }}\">\n                        {{ 'CANCEL' | translate }}\n                    </md-button>\n                    <md-button class=\"md-primary\"\n                               ng-click=\"save()\"\n                               aria-label=\"{{ 'SAVE' | translate }}\">\n                            {{ 'SAVE' | translate }}\n                        </md-button>\n                    </md-dialog-actions>\n            </md-dialog>`;\n\n        // display the milestone edit form in a dialog\n        this.$mdDialog.show({\n            parent: angular.element(document.body),\n            template: template,\n            ariaLabel: title,\n            fullscreen: true,\n            targetEvent: $event,\n            clickOutsideToClose: true,\n            escapeToClose: true,\n            locals: {\n                editMode: editMode,\n                $event, $event,\n                milestone: milestone\n            },\n            controller: ['$scope', '$mdDialog', '$filter', 'milestone', 'editMode', '$event',\n                function DialogController($scope, $mdDialog, $filter, milestone, editMode, $event) {\n                    $scope.editMode = editMode;\n                    $scope.milestone = milestone;\n                    $scope.$event = $event;\n                    $scope.valid = editMode;\n\n                    $scope.$translate = $filter('translate');\n\n                    // close the popup\n                    $scope.close = function() {\n                        $mdDialog.hide({ milestone: $scope.milestone, $event: $scope.$event });\n                    }\n\n                    // save the milestone\n                    $scope.save = function() {\n                        if ($scope.valid) {\n                            $mdDialog.hide({ milestone: $scope.milestone, save: true, $event: $scope.$event });\n                        } else {\n                            alert($scope.$translate('MILESTONE_EDIT_INVALID_ALERT'));\n                        }\n                    }\n\n                    $scope.onChange = function(milestone, valid) {\n                        $scope.milestone = milestone;\n                        $scope.valid = valid;\n                    }\n                }\n            ]\n        }).then((data) => {\n            if (data) {\n                if (data.milestone && data.save) {\n                    this.saveMilestone(data.milestone);\n                }\n            }\n        }, () => {});\n    }\n}\n\nMilestonesController.$inject = [\n    '$injector',\n    '$filter',\n    '$mdDialog',\n    '$rootScope',\n    '$scope',\n    '$state',\n    'AchievementService',\n    'ConfigService',\n    'ProjectService',\n    'StudentStatusService',\n    'TeacherDataService',\n    'TeacherWebSocketService',\n    'UtilService',\n    'moment'\n];\n\nexport default MilestonesController;\n"]}