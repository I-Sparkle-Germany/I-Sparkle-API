{"version":3,"sources":["milestonesController.es6"],"names":["MilestonesController","$injector","$rootScope","$scope","$state","AchievementService","ConfigService","ProjectService","StudentStatusService","TeacherDataService","TeacherWebSocketService","UtilService","moment","calendarIsOpenTemporaryStorage","itemsTemporaryStorage","workgroupsStorage","editStorage","numberOfStudentsCompletedStorage","percentageCompletedStorage","showStudentsStorage","timeDiffStorage","loadAchievements","$on","event","args","studentAchievement","addOrUpdateAchievement","data","id","updateMilestoneCompletion","achievementsObject","getAchievements","workgroupIds","getClassmateWorkgroupIds","numberOfStudentsInRun","length","isEnabled","items","achievements","a","projectAchievement","params","targetDateTemp","Date","targetDate","timeDiff","calculateTimeDiff","edit","undefined","calendarIsOpen","makeCopyOfJSONObject","idToOrder","nodeIds","n","nodeId","checked","date","fromNow","indexOf","replace","projectAchievements","getAchievementItems","tomorrow","add","hours","minutes","seconds","newMilestone","getAvailableAchievementId","name","description","type","valueOf","icon","image","isVisible","push","saveProject","milestone","item","$key","splice","groupId","showSteps","childIds","getChildNodeIdsById","c","childId","show","index","answer","confirm","getTime","achievement","workgroups","numberOfStudentsCompleted","percentageCompleted","showStudents","clearTempFields","restoreTempFields","isGroupNode","getNodePositionById","getNodeTitleByNodeId","workgroupId","getDisplayUserNamesByWorkgroupId","achievementId","achievementIdToAchievements","getAchievementIdToAchievementsMappings","studentAchievementsForAchievementId","workgroupIdsCompleted","achievementTimes","workgroupIdsNotCompleted","s","achievementTime","w","workgroupObject","completed","parseInt","$inject"],"mappings":"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","file":"milestonesController.js","sourcesContent":["'use strict';\n\nclass MilestonesController {\n\n    constructor($injector,\n                $rootScope,\n                $scope,\n                $state,\n                AchievementService,\n                ConfigService,\n                ProjectService,\n                StudentStatusService,\n                TeacherDataService,\n                TeacherWebSocketService,\n                UtilService,\n                moment) {\n\n        this.$injector = $injector;\n        this.$rootScope = $rootScope;\n        this.$scope = $scope;\n        this.$state = $state;\n        this.AchievementService = AchievementService;\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n        this.StudentStatusService = StudentStatusService;\n        this.TeacherDataService = TeacherDataService;\n        this.TeacherWebSocketService = TeacherWebSocketService;\n        this.UtilService = UtilService;\n        this.moment = moment;\n\n        /*\n         * Arrays used to temporarily store milestone display values. We add\n         * fields to the milestone objects but we don't want to save those\n         * fields when we save the milestones to the server. We remove the\n         * fields from the milestones and then save the milestones to the\n         * server. After we save the milestones, we add the fields back into\n         * the milestones.\n         */\n        this.calendarIsOpenTemporaryStorage = [];\n        this.itemsTemporaryStorage = [];\n        this.workgroupsStorage = [];\n        this.editStorage = [];\n        this.numberOfStudentsCompletedStorage = [];\n        this.percentageCompletedStorage = [];\n        this.showStudentsStorage = [];\n        this.timeDiffStorage = [];\n\n        // load the achievements and perform additional calculations\n        this.loadAchievements();\n\n        // listen for the newStudentAchievement event\n        this.$rootScope.$on('newStudentAchievement', (event, args) => {\n\n            if (args) {\n                // get the student achievement that was saved to the server\n                let studentAchievement = args.studentAchievement;\n\n                if (studentAchievement != null) {\n\n                    // add the student achievement to our local copy of the student achievements\n                    this.AchievementService.addOrUpdateAchievement(studentAchievement);\n\n                    if (studentAchievement.data != null && studentAchievement.data.id != null) {\n                        // update the milestone in the UI with the new student achievement information\n                        this.updateMilestoneCompletion(studentAchievement.data.id);\n                    }\n                }\n            }\n        });\n    }\n\n    /**\n     * Load the achievements and perform additional calculations\n     */\n    loadAchievements() {\n\n        // get the project achievements object\n        var achievementsObject = this.ProjectService.getAchievements();\n\n        // get the workgroup ids\n        var workgroupIds = this.ConfigService.getClassmateWorkgroupIds();\n\n        // the number of students in the run\n        this.numberOfStudentsInRun = workgroupIds.length;\n\n        if (achievementsObject != null) {\n\n            if (achievementsObject.isEnabled) {\n\n                if (achievementsObject.items) {\n\n                    // get the project achievements\n                    this.achievements = achievementsObject.items;\n\n                    // loop through all the project achievements\n                    for (var a = 0; a < this.achievements.length; a++) {\n\n                        // get a project achievement\n                        var projectAchievement = this.achievements[a];\n\n                        if (projectAchievement != null) {\n\n                            // calculate the target date as a Date() object\n                            projectAchievement.params.targetDateTemp = new Date(projectAchievement.params.targetDate);\n\n                            /*\n                             * calculate the time difference between now and the\n                             * target date\n                             */\n                            var timeDiff = this.calculateTimeDiff(projectAchievement.params.targetDate);\n\n                            projectAchievement.timeDiff = timeDiff;\n\n                            if (projectAchievement.edit === null || projectAchievement.edit === undefined) {\n                                // initialize the edit field\n                                projectAchievement.edit = false;\n                            }\n\n                            if (projectAchievement.calendarIsOpen === null || projectAchievement.calendarIsOpen === undefined) {\n                                // initialize the calendarIsOpen field\n                                projectAchievement.calendarIsOpen = false;\n                            }\n\n                            // update the student completion information for this milestone\n                            this.updateMilestoneCompletion(projectAchievement.id);\n\n                            // get all the activities and steps in the project\n                            projectAchievement.items = this.UtilService.makeCopyOfJSONObject(this.ProjectService.idToOrder);\n\n                            if (projectAchievement.params != null && projectAchievement.params.nodeIds != null) {\n\n                                /*\n                                 * loop through all the node ids that are required\n                                 * to be completed for this achievement\n                                 */\n                                for (var n = 0; n < projectAchievement.params.nodeIds.length; n++) {\n                                    var nodeId = projectAchievement.params.nodeIds[n];\n\n                                    if (projectAchievement.items[nodeId] != null) {\n                                        // check the checkbox corresponding to the node id\n                                        projectAchievement.items[nodeId].checked = true;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Calculate the time difference between now and the date\n     * @param date a date in milliseconds since the epoch\n     * @return a string that contains a human readable time difference\n     * example \"2 days ago\", or \"in 3 days\"\n     */\n    calculateTimeDiff(date) {\n\n        // get the time difference from now\n        var timeDiff = this.moment(date).fromNow();\n\n        /*\n         * there seems to be a bug in moment where if the date is in the future\n         * the timeDiff will be something like \"in 3 days ago\" when it should\n         * only be \"in 3 days\". if the timeDiff string starts with \"in\", we will\n         * remove the \" ago\" from the end of the string\n         */\n        if (timeDiff.indexOf(\"in\") != -1) {\n            timeDiff = timeDiff.replace(\" ago\", \"\");\n        }\n\n        return timeDiff\n    }\n\n    /**\n     * Create a new milestone\n     */\n    createMilestone() {\n\n        // get the project achievements\n        var projectAchievements = this.ProjectService.getAchievementItems();\n\n        if (projectAchievements != null) {\n\n            // get the time of tomorrow at 3pm\n            var tomorrow = this.moment().add('days', 1).hours(15).minutes(0).seconds(0);\n\n            // create a new milestone object\n            var newMilestone = {\n                id: this.AchievementService.getAvailableAchievementId(),\n                name: '',\n                description: '',\n                type: \"milestone\",\n                params: {\n                    nodeIds: [],\n                    targetDate: tomorrow.valueOf()\n                },\n                icon: {\n                    image: \"\"\n                },\n                isVisible: true,\n                edit: true\n            };\n\n            // add the milestone object to the array of achievements\n            projectAchievements.push(newMilestone);\n\n            // reload the achievements\n            this.loadAchievements();\n\n            // save the project to the server\n            this.saveProject();\n        }\n    }\n\n    /**\n     * The edit button for a milestone was clicked\n     * @param milestone the milestone to edit\n     */\n    editMilestoneClicked(milestone) {\n        milestone.edit = true;\n    }\n\n    /**\n     * The checkbox for an activity or step was clicked\n     * @param milestone the milestone that is being edited\n     * @param item the activity or step that was clicked\n     */\n    itemClicked(milestone, item) {\n\n        if (milestone != null &&\n            milestone.params != null &&\n            milestone.params.nodeIds != null) {\n\n            // get the node ids that are currently required for the milestone\n            var nodeIds = milestone.params.nodeIds;\n\n            // get the node id of the item that was clicked\n            var nodeId = item.$key;\n\n            if (item.checked) {\n                if (nodeIds.indexOf(nodeId) == -1) {\n                    // add the node id\n                    milestone.params.nodeIds.push(nodeId);\n                }\n            } else {\n                // remove the node id\n\n                // loop through all the node ids and remove the node id\n                for (var n = nodeIds.length - 1; n >= 0; n--) {\n                    if (nodeId == nodeIds[n]) {\n                        nodeIds.splice(n, 1);\n                    }\n                }\n            }\n        }\n\n        // save the project to the server\n        this.saveProject();\n    }\n\n    /**\n     * Show the steps for an activity\n     * @param groupId the node id for the activity\n     * @param milestone the milestone object that is being edited\n     */\n    showStepsClicked(groupId, milestone) {\n\n        if (groupId != null && milestone != null) {\n\n            /*\n             * set the showSteps field to true so that we will now see the\n             * \"Hide Steps\" button\n             */\n            milestone.items[groupId].showSteps = true;\n\n            // get all the child ids of the group\n            var childIds = this.ProjectService.getChildNodeIdsById(groupId);\n\n            // loop through all the child ids\n            for (var c = 0; c < childIds.length; c++) {\n                var childId = childIds[c];\n\n                if (milestone.items[childId] != null) {\n                    // show the step\n                    milestone.items[childId].show = true;\n                }\n            }\n        }\n    }\n\n    /**\n     * Hide the steps for an activity\n     * @param groupId the node id for the activity\n     * @param milestone the milestone object that is being edited\n     */\n    hideStepsClicked(groupId, milestone) {\n\n        if (groupId != null && milestone != null) {\n\n            /*\n             * set the showSteps field to false so that we will now see the\n             * \"Show Steps\" button\n             */\n            milestone.items[groupId].showSteps = false;\n\n            // get all the child ids of the group\n            var childIds = this.ProjectService.getChildNodeIdsById(groupId);\n\n            // loop through all the child ids\n            for (var c = 0; c < childIds.length; c++) {\n                var childId = childIds[c];\n\n                if (milestone.items[childId] != null) {\n                    // hide the step\n                    milestone.items[childId].show = false;\n                }\n            }\n        }\n    }\n\n    /**\n     * Delete a milestone\n     * @param index the index of the milestone to delete\n     * @param milestone the milestone to delete\n     */\n    deleteMilestone(index, milestone) {\n\n        var name = \"\";\n\n        if (milestone != null) {\n            // get the name of the milestone\n            name = milestone.name;\n        }\n\n        // ask to make sure the author wants to delete the milestone\n        var answer = confirm(\"Are you sure you want to delete this milestone?\\n\\n\" + name);\n\n        if (answer) {\n            // remove the milestone\n            this.achievements.splice(index, 1);\n\n            // save the project to the server\n            this.saveProject();\n        }\n    }\n\n    /**\n     * The save button for a milestone was clicked\n     * @param milestone the milestone to save\n     */\n    saveMilestoneClicked(milestone) {\n\n        // do not show the edit view for the milestone anymore\n        milestone.edit = false;\n\n        // save the project to the server\n        this.saveProject();\n    }\n\n    /**\n     * The milestone due date changed\n     * @param milestone the milestone that has changed\n     */\n    milestoneDateChanged(milestone) {\n\n        // get the due date\n        milestone.params.targetDate = milestone.params.targetDateTemp.getTime();\n\n        // calculate the time difference from now to the due date\n        milestone.timeDiff = this.calculateTimeDiff(milestone.params.targetDate);\n\n        // save the project to the server\n        this.saveProject();\n    }\n\n    /**\n     * Remove the temporary fields from the milestone objects and store\n     * them in temporary storage arrays so that we can load the fields back\n     * in later\n     */\n    clearTempFields() {\n\n        /*\n         * these array will store the temporary fields. the index of the arrays\n         * corresponds to the index of the achievement. for example the calendarIsOpen\n         * value for the first achievement will be stored in\n         * this.calendarIsOpenTemporaryStorage[0]. the calendarIsOpen value for the second\n         * achievement will be stored in this.calendarIsOpenTemporaryStorage[1].\n         */\n        this.calendarIsOpenTemporaryStorage = [];\n        this.itemsTemporaryStorage = [];\n        this.workgroupsStorage = [];\n        this.editStorage = [];\n        this.numberOfStudentsCompletedStorage = [];\n        this.percentageCompletedStorage = [];\n        this.showStudentsStorage = [];\n        this.timeDiffStorage = [];\n\n        // loop through all the achievements\n        for (var a = 0; a < this.achievements.length; a++) {\n\n            // get an achievement\n            var achievement = this.achievements[a];\n\n            // save the field values in the temprary storage arrays\n            this.calendarIsOpenTemporaryStorage.push(achievement.calendarIsOpen);\n            this.itemsTemporaryStorage.push(achievement.items);\n            this.workgroupsStorage.push(achievement.workgroups);\n            this.editStorage.push(achievement.edit);\n            this.numberOfStudentsCompletedStorage.push(achievement.numberOfStudentsCompleted);\n            this.percentageCompletedStorage.push(achievement.percentageCompleted);\n            this.showStudentsStorage.push(achievement.showStudents);\n            this.timeDiffStorage.push(achievement.timeDiff);\n\n            // delete the field from the achievement\n            delete achievement.params.targetDateTemp;\n            delete achievement.calendarIsOpen;\n            delete achievement.items;\n            delete achievement.workgroups;\n            delete achievement.edit;\n            delete achievement.numberOfStudentsCompleted;\n            delete achievement.percentageCompleted;\n            delete achievement.showStudents;\n            delete achievement.timeDiff;\n        }\n    }\n\n    /**\n     * Restore the temporary fields into the achievement objects\n     */\n    restoreTempFields() {\n\n        // loop through all the achievements\n        for (var a = 0; a < this.achievements.length; a++) {\n\n            // get an achievement\n            var achievement = this.achievements[a];\n\n            // recalculate the target date object\n            achievement.params.targetDateTemp = new Date(achievement.params.targetDate);\n\n            // set the fields back into the achievement object\n            achievement.calendarIsOpen = this.calendarIsOpenTemporaryStorage[a];\n            achievement.items = this.itemsTemporaryStorage[a];\n            achievement.workgroups = this.workgroupsStorage[a];\n            achievement.edit = this.editStorage[a];\n            achievement.numberOfStudentsCompleted = this.numberOfStudentsCompletedStorage[a];\n            achievement.percentageCompleted = this.percentageCompletedStorage[a];\n            achievement.showStudents = this.showStudentsStorage[a];\n            achievement.timeDiff = this.timeDiffStorage[a];\n        }\n\n        // clear the temporary storage arrays\n        this.calendarIsOpenTemporaryStorage = [];\n        this.itemsTemporaryStorage = [];\n        this.workgroupsStorage = [];\n        this.editStorage = [];\n        this.numberOfStudentsCompletedStorage = [];\n        this.percentageCompletedStorage = [];\n        this.showStudentsStorage = [];\n        this.timeDiffStorage = [];\n    }\n\n    /**\n     * The open calendar button was clicked\n     * @param milestone the milestone that we will edit the due date for\n     */\n    openCalendar(milestone) {\n\n        // open the calendar for the milestone\n        milestone.calendarIsOpen = true;\n    };\n\n    /**\n     * The close calendar button was clicked\n     * @param milestone the milestone that we were editing\n     */\n    closeCalendar(milestone) {\n\n        // close the calendar for the milestone\n        milestone.calendarIsOpen = false;\n    }\n\n    /**\n     * Save the project to the server\n     */\n    saveProject() {\n\n        // clear the temp fields and remember them\n        this.clearTempFields();\n\n        // save the project to the server\n        this.ProjectService.saveProject();\n\n        // restore the temp fields\n        this.restoreTempFields();\n    }\n\n    /**\n     * Check if a node id is for a group\n     * @param nodeId\n     * @returns whether the node is a group node\n     */\n    isGroupNode(nodeId) {\n        return this.ProjectService.isGroupNode(nodeId);\n    };\n\n    /**\n     * Get the node position\n     * @param nodeId the node id\n     * @returns the node position\n     */\n    getNodePositionById(nodeId) {\n        return this.ProjectService.getNodePositionById(nodeId);\n    };\n\n    /**\n     * Get the node title for a node\n     * @param nodeId the node id\n     * @returns the node title\n     */\n    getNodeTitleByNodeId(nodeId) {\n        return this.ProjectService.getNodeTitleByNodeId(nodeId);\n    };\n\n    /**\n     * Get the user names for a workgroup id\n     * @param workgroupId the workgroup id\n     * @return the user names in the workgroup\n     */\n    getDisplayUserNamesByWorkgroupId(workgroupId) {\n        return this.ConfigService.getDisplayUserNamesByWorkgroupId(workgroupId);\n    }\n\n    /**\n     * Show which students have completed the milestone\n     * @param milestone the milestone\n     */\n    showStudents(milestone) {\n        milestone.showStudents = true;\n    }\n\n    /**\n     * Hide which students have completed the milestone\n     * @parma milestone the milestone\n     */\n    hideStudents(milestone) {\n        milestone.showStudents = false;\n    }\n\n    /**\n     * Update the student completion information for this milestone\n     * @param achievementId the achievement id to update\n     */\n    updateMilestoneCompletion(achievementId) {\n\n        if (achievementId != null) {\n\n            // loop through all the project achievements\n            for (var a = 0; a < this.achievements.length; a++) {\n                var projectAchievement = this.achievements[a];\n\n                if (achievementId == projectAchievement.id) {\n                    // we have found the milestone we want to update\n\n                    // get the workgroup ids\n                    var workgroupIds = this.ConfigService.getClassmateWorkgroupIds();\n\n                    // get the student achievements\n                    var achievementIdToAchievements = this.AchievementService.getAchievementIdToAchievementsMappings();\n\n                    // get the student achievements for this achievement id\n                    var studentAchievementsForAchievementId = achievementIdToAchievements[projectAchievement.id];\n\n                    var workgroupIdsCompleted = [];\n                    var achievementTimes = [];\n                    var workgroupIdsNotCompleted = [];\n\n                    /*\n                     * loop through all the student achievements for\n                     * this achievement id\n                     */\n                    for (var s = 0; s < studentAchievementsForAchievementId.length; s++) {\n                        var studentAchievement = studentAchievementsForAchievementId[s];\n\n                        if (studentAchievement != null) {\n                            /*\n                             * add the workgroup id to the array of workgroup ids that\n                             * have completed the achievement\n                             */\n                            workgroupIdsCompleted.push(studentAchievement.workgroupId);\n\n                            // add the achievement time to the achievement times array\n                            achievementTimes.push(studentAchievement.achievementTime);\n                        }\n                    }\n\n                    /*\n                     * loop through all the workgroup ids to find the\n                     * workgroup ids that have not completed the\n                     * achievement\n                     */\n                    for (var w = 0; w < workgroupIds.length; w++) {\n                        var workgroupId = workgroupIds[w];\n\n                        if (workgroupIdsCompleted.indexOf(workgroupId) == -1) {\n                            // this workgroup has not completed the achievement\n\n                            /*\n                             * add the workgroup id to the array of workgroup ids that\n                             * have not completed the achievement\n                             */\n                            workgroupIdsNotCompleted.push(workgroupId);\n                        }\n                    }\n\n                    projectAchievement.workgroups = [];\n\n                    /*\n                     * loop through all the workgroups that have\n                     * completed the achievement\n                     */\n                    for (var c = 0; c < workgroupIdsCompleted.length; c++) {\n                        var workgroupId = workgroupIdsCompleted[c];\n                        var achievementTime = achievementTimes[c];\n\n                        /*\n                         * create an object used for displaying\n                         * information about the workgroup\n                         */\n                        var workgroupObject = {\n                            workgroupId: workgroupId,\n                            achievementTime: achievementTime,\n                            completed: true\n                        };\n\n                        projectAchievement.workgroups.push(workgroupObject);\n                    }\n\n                    /*\n                     * loop through all the workgroups that have not\n                     * completed the achievement\n                     */\n                    for (var n = 0; n < workgroupIdsNotCompleted.length; n++) {\n                        var workgroupId = workgroupIdsNotCompleted[n];\n\n                        /*\n                         * create an object used for displaying\n                         * information about the workgroup\n                         */\n                        var workgroupObject = {\n                            workgroupId: workgroupId,\n                            achievementTime: null,\n                            completed: false\n                        };\n\n                        projectAchievement.workgroups.push(workgroupObject);\n                    }\n\n                    /*\n                     * calculate the number of workgroups that completed\n                     * the achievement\n                     */\n                    projectAchievement.numberOfStudentsCompleted = studentAchievementsForAchievementId.length;\n\n                    /*\n                     * calculate the percentage of workgroups that have\n                     * completed the achievement\n                     */\n                    projectAchievement.percentageCompleted = parseInt(100 * projectAchievement.numberOfStudentsCompleted / this.numberOfStudentsInRun);\n                }\n            }\n        }\n    }\n}\n\nMilestonesController.$inject = [\n    '$injector',\n    '$rootScope',\n    '$scope',\n    '$state',\n    'AchievementService',\n    'ConfigService',\n    'ProjectService',\n    'StudentStatusService',\n    'TeacherDataService',\n    'TeacherWebSocketService',\n    'UtilService',\n    'moment'\n];\n\nexport default MilestonesController;\n"]}