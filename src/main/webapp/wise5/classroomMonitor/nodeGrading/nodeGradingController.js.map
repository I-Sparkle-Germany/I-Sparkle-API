{"version":3,"sources":["nodeGradingController.es6"],"names":["NodeGradingController","$state","$stateParams","AnnotationService","ConfigService","NodeService","ProjectService","TeacherDataService","nodeId","nodeTitle","nodeContent","teacherWorkgroupId","getWorkgroupId","periods","node","getNodeById","position","getPositionById","title","workgroupIds","getClassmateWorkgroupIds","canViewStudentNames","canGradeStudentWork","role","getTeacherRole","annotationMappings","componentStateHistory","initializePeriods","document","body","scrollTop","documentElement","componentType","getComponentTemplatePath","components","isDisabled","c","length","component","lockAfterSubmit","componentId","getComponents","tempComponent","id","workgroupId","componentState","getLatestComponentStateByWorkgroupIdNodeIdAndComponentId","componentStates","getComponentStatesByWorkgroupIdAndNodeId","getUserNameByWorkgroupId","stepWorkId","type","getAnnotationByStepWorkIdAndType","annotation","saveAnnotation","getPeriodIdByWorkgroupId","allPeriodOption","periodId","periodName","push","concat","getPeriods","getCurrentPeriod","setCurrentPeriod","period","$inject"],"mappings":"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","file":"nodeGradingController.js","sourcesContent":["'use strict';\n\nclass NodeGradingController {\n\n    constructor($state, $stateParams, AnnotationService, ConfigService, NodeService, ProjectService, TeacherDataService) {\n\n        this.$state = $state;\n        this.$stateParams = $stateParams;\n        this.AnnotationService = AnnotationService;\n        this.ConfigService = ConfigService;\n        this.NodeService = NodeService;\n        this.ProjectService = ProjectService;\n        this.TeacherDataService = TeacherDataService;\n\n        this.nodeId = this.$stateParams.nodeId;\n\n        this.nodeTitle = null;\n\n        // field that will hold the node content\n        this.nodeContent = null;\n\n        this.teacherWorkgroupId = this.ConfigService.getWorkgroupId();\n\n        this.periods = [];\n\n        var node = this.ProjectService.getNodeById(this.nodeId);\n\n        if (node != null) {\n            var position = this.ProjectService.getPositionById(this.nodeId);\n\n            if (position != null) {\n                this.nodeTitle = position + ' ' + node.title;\n            } else {\n                this.nodeTitle = node.title;\n            }\n\n\n            // field that will hold the node content\n            this.nodeContent = node;\n        }\n\n        this.workgroupIds = this.ConfigService.getClassmateWorkgroupIds();\n        \n        this.canViewStudentNames = true;\n        this.canGradeStudentWork = true;\n        \n        // get the role of the teacher for the run e.g. 'owner', 'write', 'read'\n        var role = this.ConfigService.getTeacherRole(this.teacherWorkgroupId);\n        \n        if (role === 'owner') {\n            // the teacher is the owner of the run and has full access\n            this.canViewStudentNames = true;\n            this.canGradeStudentWork = true;\n        } else if (role === 'write') {\n            // the teacher is a shared teacher that can grade the student work\n            this.canViewStudentNames = true;\n            this.canGradeStudentWork = true;\n        } else if (role === 'read') {\n            // the teacher is a shared teacher that can only view the student work\n            this.canViewStudentNames = false;\n            this.canGradeStudentWork = false;\n        }\n\n        this.annotationMappings = {};\n\n        this.componentStateHistory = [];\n        // initialize the periods\n        this.initializePeriods();\n\n        // scroll to the top of the page when the page loads\n        document.body.scrollTop = document.documentElement.scrollTop = 0;\n    }\n\n    /**\n     * Get the html template for the component\n     * @param componentType the component type\n     * @return the path to the html template for the component\n     */\n    getComponentTemplatePath(componentType) {\n        return this.NodeService.getComponentTemplatePath(componentType);\n    };\n\n    /**\n     * Get the components for this node.\n     * @return an array that contains the content for the components\n     */\n    getComponents() {\n        var components = null;\n\n        if (this.nodeContent != null) {\n            components = this.nodeContent.components;\n        }\n\n        if (components != null && this.isDisabled) {\n            for (var c = 0; c < components.length; c++) {\n                var component = components[c];\n\n                component.isDisabled = true;\n            }\n        }\n\n        if (components != null && this.nodeContent.lockAfterSubmit) {\n            for (c = 0; c < components.length; c++) {\n                component = components[c];\n\n                component.lockAfterSubmit = true;\n            }\n        }\n\n        return components;\n    };\n\n    getComponentById(componentId) {\n        var component = null;\n\n        if (componentId != null) {\n            var components = this.getComponents();\n\n            if (components != null) {\n                for (var c = 0; c < components.length; c++) {\n                    var tempComponent = components[c];\n\n                    if (tempComponent != null) {\n                        if (componentId === tempComponent.id) {\n                            component = tempComponent;\n                            break;\n                        }\n                    }\n                }\n            }\n        }\n\n        return component;\n    };\n\n    /**\n     * Get the student data for a specific part\n     * @param the componentId\n     * @param the workgroupId id of Workgroup who created the component state\n     * @return the student data for the given component\n     */\n    getLatestComponentStateByWorkgroupIdAndComponentId(workgroupId,  componentId) {\n        var componentState = null;\n\n        if (workgroupId != null && componentId != null) {\n            // get the latest component state for the component\n            componentState = this.TeacherDataService.getLatestComponentStateByWorkgroupIdNodeIdAndComponentId(workgroupId, this.nodeId, componentId);\n        }\n\n        return componentState;\n    };\n\n    /**\n     * Get the student data for a specific part\n     * @param the componentId\n     * @param the workgroupId id of Workgroup who created the component state\n     * @return the student data for the given component\n     */\n    getLatestComponentStateByWorkgroupIdAndNodeIdAndComponentId(workgroupId, nodeId, componentId) {\n        var componentState = null;\n\n        if (workgroupId != null && nodeId != null && componentId != null) {\n\n            // get the latest component state for the component\n            componentState = this.TeacherDataService.getLatestComponentStateByWorkgroupIdNodeIdAndComponentId(workgroupId, nodeId, componentId);\n        }\n\n        return componentState;\n    };\n\n    getComponentStatesByWorkgroupIdAndNodeId(workgroupId, nodeId) {\n        var componentStates = this.TeacherDataService.getComponentStatesByWorkgroupIdAndNodeId(workgroupId, nodeId);\n\n        //AnnotationService.populateAnnotationMappings(this.annotationMappings, workgroupId, componentStates);\n\n        return componentStates;\n    };\n\n    getUserNameByWorkgroupId(workgroupId) {\n        return this.ConfigService.getUserNameByWorkgroupId(workgroupId);\n    };\n\n    getAnnotationByStepWorkIdAndType(stepWorkId, type) {\n        return this.AnnotationService.getAnnotationByStepWorkIdAndType(stepWorkId, type);\n    };\n\n    scoreChanged(stepWorkId) {\n        var annotation = this.annotationMappings[stepWorkId + '-score'];\n        this.AnnotationService.saveAnnotation(annotation);\n    };\n\n    commentChanged(stepWorkId) {\n        var annotation = this.annotationMappings[stepWorkId + '-comment'];\n        this.AnnotationService.saveAnnotation(annotation);\n    }\n\n    setupComponentStateHistory() {\n        this.getComponentStatesByWorkgroupIdAndNodeId()\n    };\n\n    /**\n     * Get the period id for a workgroup id\n     * @param workgroupId the workgroup id\n     * @returns the period id for the workgroup id\n     */\n    getPeriodIdByWorkgroupId(workgroupId) {\n        return this.ConfigService.getPeriodIdByWorkgroupId(workgroupId);\n    };\n\n    /**\n     * Initialize the periods\n     */\n    initializePeriods() {\n\n        // create an option for all periods\n        var allPeriodOption = {\n            periodId: -1,\n            periodName: 'All'\n        };\n\n        this.periods.push(allPeriodOption);\n\n        this.periods = this.periods.concat(this.ConfigService.getPeriods());\n\n        // set the current period if it hasn't been set yet\n        if (this.getCurrentPeriod() == null) {\n            if (this.periods != null && this.periods.length > 0) {\n                // set it to the all periods option\n                this.setCurrentPeriod(this.periods[0]);\n            }\n        }\n    };\n\n    /**\n     * Set the current period\n     * @param period the period object\n     */\n    setCurrentPeriod(period) {\n        this.TeacherDataService.setCurrentPeriod(period);\n    };\n\n    /**\n     * Get the current period\n     */\n    getCurrentPeriod() {\n        return this.TeacherDataService.getCurrentPeriod();\n    };\n}\n\nNodeGradingController.$inject = ['$state', '$stateParams', 'AnnotationService', 'ConfigService', 'NodeService', 'ProjectService', 'TeacherDataService'];\n\nexport default NodeGradingController;"]}