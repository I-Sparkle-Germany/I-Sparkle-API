{"version":3,"sources":["nodeGradingController.es6"],"names":["NodeGradingController","$filter","$mdDialog","$scope","$stateParams","AnnotationService","ConfigService","NotificationService","ProjectService","StudentStatusService","TeacherDataService","$translate","nodeId","maxScore","getMaxScoreForNode","nodeHasWork","sort","nodeGradingSort","hiddenComponents","retrieveStudentDataByNodeId","then","nodeContent","teacherWorkgroupId","getWorkgroupId","node","getNodeById","workgroups","getClassmateUserInfos","workgroupsById","workVisibilityById","workgroupInViewById","permissions","getPermissions","canViewStudentNames","setWorkgroupsById","nRubrics","getNumberOfRubricsByNodeId","document","body","scrollTop","documentElement","$on","event","args","notification","type","workgroupId","toWorkgroupId","updateWorkgroup","annotation","studentWork","context","componentId","componentType","category","data","saveEvent","l","length","i","id","init","workgroup","alertNotifications","getAlertNotificationsByWorkgroupId","hasAlert","hasNewAlert","workgroupHasNewAlert","completionStatus","getNodeCompletionStatusByWorkgroupId","hasNewWork","isVisible","getWorkgroupCompletionStatus","score","getNodeScoreByWorkgroupId","displayNames","angular","copy","getAlertNotifications","newAlert","alert","timeDismissed","isCompleted","latestWorkTime","getLatestWorkTimeByWorkgroupId","latestAnnotationTime","getLatestAnnotationTimeByWorkgroupId","studentStatus","getStudentStatusForWorkgroupId","nodeStatus","nodeStatuses","isVisited","time","componentStates","getComponentStatesByNodeId","n","componentState","serverSaveTime","annotations","getAnnotationsByNodeId","fromWorkgroupId","getScore","hasWork","status","getLatestComponentStateByWorkgroupIdNodeIdAndComponentId","getCurrentPeriod","currentPeriod","periodId","completionPercentage","getNodeCompletion","completionPct","averageScore","getNodeAverageScore","show","currentPeriodId","currentWorkgroup","getCurrentWorkgroup","parseInt","target","viewportOffsetTop","newViewportOffsetTop","getBoundingClientRect","top","delta","content","$event","stepNumberAndTitle","getNodePositionAndTitleByNodeId","rubricTitle","dialogHeader","dialogActions","dialogContent","dialogString","template","fullscreen","controller","DialogController","openInNewWindow","w","window","open","windowHeader","rubricContent","getElementById","innerHTML","windowString","write","hide","close","targetEvent","clickOutsideToClose","escapeToClose","value","orderBy","isExpandAll","inview","$inject"],"mappings":"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","file":"nodeGradingController.js","sourcesContent":["'use strict';\r\n\r\nclass NodeGradingController {\r\n\r\n    constructor($filter,\r\n                $mdDialog,\r\n                $scope,\r\n                $stateParams,\r\n                AnnotationService,\r\n                ConfigService,\r\n                NotificationService,\r\n                ProjectService,\r\n                StudentStatusService,\r\n                TeacherDataService) {\r\n\r\n        this.$filter = $filter;\r\n        this.$mdDialog = $mdDialog;\r\n        this.$scope = $scope;\r\n        this.$stateParams = $stateParams;\r\n        this.AnnotationService = AnnotationService;\r\n        this.ConfigService = ConfigService;\r\n        this.NotificationService = NotificationService;\r\n        this.ProjectService = ProjectService;\r\n        this.StudentStatusService = StudentStatusService;\r\n        this.TeacherDataService = TeacherDataService;\r\n\r\n        this.$translate = this.$filter('translate');\r\n\r\n        this.nodeId = this.$stateParams.nodeId;\r\n\r\n        // the max score for the node\r\n        this.maxScore = this.ProjectService.getMaxScoreForNode(this.nodeId);\r\n        this.nodeHasWork = this.ProjectService.nodeHasWork(this.nodeId);\r\n\r\n        this.sort = this.TeacherDataService.nodeGradingSort;\r\n\r\n        this.hiddenComponents = [];\r\n\r\n        // TODO: add loading indicator\r\n        this.TeacherDataService.retrieveStudentDataByNodeId(this.nodeId).then(result => {\r\n\r\n            // field that will hold the node content\r\n            this.nodeContent = null;\r\n\r\n            this.teacherWorkgroupId = this.ConfigService.getWorkgroupId();\r\n\r\n            var node = this.ProjectService.getNodeById(this.nodeId);\r\n\r\n            if (node != null) {\r\n\r\n                // field that will hold the node content\r\n                this.nodeContent = node;\r\n            }\r\n\r\n            this.workgroups = this.ConfigService.getClassmateUserInfos();\r\n            this.workgroupsById = {}; // object that will hold workgroup names, statuses, scores, notifications, etc.\r\n            this.workVisibilityById = {}; // object that specifies whether student work is visible for each workgroup\r\n            this.workgroupInViewById = {}; // object that holds whether the workgroup is in view or not\r\n\r\n            let permissions = this.ConfigService.getPermissions();\r\n            this.canViewStudentNames = permissions.canViewStudentNames;\r\n\r\n            this.setWorkgroupsById();\r\n\r\n            this.nRubrics = this.ProjectService.getNumberOfRubricsByNodeId(this.nodeId);\r\n\r\n            // scroll to the top of the page when the page loads\r\n            document.body.scrollTop = document.documentElement.scrollTop = 0;\r\n        });\r\n\r\n        this.$scope.$on('projectSaved', (event, args) => {\r\n            // update maxScore\r\n            this.maxScore = this.ProjectService.getMaxScoreForNode(this.nodeId);\r\n        });\r\n\r\n        this.$scope.$on('notificationAdded', (event, notification) => {\r\n            if (notification.type === 'CRaterResult') {\r\n                // there is a new CRaterResult notification\r\n                // TODO: expand to encompass other notification types that should be shown to teacher\r\n                let workgroupId = notification.toWorkgroupId;\r\n                if (this.workgroupsById[workgroupId]) {\r\n                    this.updateWorkgroup(workgroupId);\r\n                }\r\n            }\r\n        });\r\n\r\n        this.$scope.$on('notificationChanged', (event, notification) => {\r\n            if (notification.type === 'CRaterResult') {\r\n                // a CRaterResult notification has changed\r\n                // TODO: expand to encompass other notification types that should be shown to teacher\r\n                let workgroupId = notification.toWorkgroupId;\r\n                if (this.workgroupsById[workgroupId]) {\r\n                    this.updateWorkgroup(workgroupId);\r\n                }\r\n            }\r\n        });\r\n\r\n        this.$scope.$on('annotationReceived', (event, args) => {\r\n            let annotation = args.annotation;\r\n\r\n            if (annotation) {\r\n                let workgroupId = annotation.toWorkgroupId;\r\n                let nodeId = annotation.nodeId;\r\n                if (nodeId === this.nodeId && this.workgroupsById[workgroupId]) {\r\n                    // a workgroup has a new annotation for this node\r\n                    this.updateWorkgroup(workgroupId);\r\n                }\r\n            }\r\n        });\r\n\r\n        this.$scope.$on('studentWorkReceived', (event, args) => {\r\n            let studentWork = args.studentWork;\r\n\r\n            if (studentWork != null) {\r\n                let workgroupId = studentWork.workgroupId;\r\n                let nodeId = studentWork.nodeId;\r\n                if (nodeId === this.nodeId && this.workgroupsById[workgroupId]) {\r\n                    // a workgroup has a new componentState for this node\r\n                    this.updateWorkgroup(workgroupId);\r\n                }\r\n            }\r\n        });\r\n\r\n        // save event when node grading view is displayed and save the nodeId that is displayed\r\n        let context = \"ClassroomMonitor\", nodeId = this.nodeId, componentId = null, componentType = null,\r\n            category = \"Navigation\", event = \"nodeGradingViewDisplayed\", data = { nodeId: this.nodeId };\r\n        this.TeacherDataService.saveEvent(context, nodeId, componentId, componentType, category, event, data);\r\n    }\r\n\r\n    /**\r\n     * Build the workgroupsById object\r\n     */\r\n    setWorkgroupsById() {\r\n        let l = this.workgroups.length;\r\n        for (let i = 0; i < l; i++) {\r\n            let id = this.workgroups[i].workgroupId;\r\n            this.workgroupsById[id] = this.workgroups[i];\r\n            this.workVisibilityById[id] = false;\r\n\r\n            this.updateWorkgroup(id, true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update statuses, scores, notifications, etc. for a workgroup object. Also check if we need to hide student\r\n     * names because logged-in user does not have the right permissions\r\n     * @param workgroupID a workgroup ID number\r\n     * @param init Boolean whether we're in controller initialization or not\r\n     */\r\n    updateWorkgroup(workgroupId, init) {\r\n        let workgroup = this.workgroupsById[workgroupId];\r\n\r\n        if (workgroup) {\r\n            let alertNotifications = this.getAlertNotificationsByWorkgroupId(workgroupId);\r\n            workgroup.hasAlert = alertNotifications.length;\r\n            workgroup.hasNewAlert = this.workgroupHasNewAlert(alertNotifications);\r\n            let completionStatus = this.getNodeCompletionStatusByWorkgroupId(workgroupId);\r\n            workgroup.hasNewWork = completionStatus.hasNewWork;\r\n            workgroup.isVisible = completionStatus.isVisible ? 1 : 0;\r\n            workgroup.completionStatus = this.getWorkgroupCompletionStatus(completionStatus);\r\n            workgroup.score = this.getNodeScoreByWorkgroupId(workgroupId);\r\n\r\n            if (!this.canViewStudentNames) {\r\n                workgroup.displayNames = 'Student ' + workgroupId;\r\n            }\r\n\r\n            if (!init) {\r\n                this.workgroupsById[workgroupId] = angular.copy(workgroup);\r\n            }\r\n        }\r\n    }\r\n\r\n    getAlertNotificationsByWorkgroupId(workgroupId) {\r\n        let args = {};\r\n        args.nodeId = this.nodeId;\r\n        args.toWorkgroupId = workgroupId;\r\n        return this.NotificationService.getAlertNotifications(args);\r\n    }\r\n\r\n    workgroupHasNewAlert(alertNotifications) {\r\n        let newAlert = false;\r\n\r\n        let l = alertNotifications.length;\r\n        for (let i = 0; i < l; i++) {\r\n            let alert = alertNotifications[i];\r\n            if (!alert.timeDismissed) {\r\n                newAlert = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        return newAlert;\r\n    }\r\n\r\n    /**\r\n     * Returns an object with node completion status, latest work time, and latest annotation time\r\n     * for a workgroup for the current node\r\n     * @param workgroupId a workgroup ID number\r\n     * @returns Object with completion, latest work time, latest annotation time\r\n     */\r\n    getNodeCompletionStatusByWorkgroupId(workgroupId) {\r\n        let isCompleted = false;\r\n        let isVisible = false;\r\n\r\n        // TODO: store this info in the nodeStatus so we don't have to calculate every time?\r\n        let latestWorkTime = this.getLatestWorkTimeByWorkgroupId(workgroupId);\r\n\r\n        let latestAnnotationTime = this.getLatestAnnotationTimeByWorkgroupId(workgroupId);\r\n        let studentStatus = this.StudentStatusService.getStudentStatusForWorkgroupId(workgroupId);\r\n        if (studentStatus != null) {\r\n            let nodeStatus = studentStatus.nodeStatuses[this.nodeId];\r\n            if (nodeStatus) {\r\n                isVisible = nodeStatus.isVisible;\r\n                if (latestWorkTime) {\r\n                    // workgroup has at least one componentState for this node, so check if node is completed\r\n                    isCompleted = nodeStatus.isCompleted;\r\n                }\r\n\r\n                if (!this.ProjectService.nodeHasWork(this.nodeId)) {\r\n                    // the step does not generate any work so completion = visited\r\n                    isCompleted = nodeStatus.isVisited;\r\n                }\r\n            }\r\n        }\r\n\r\n        return {\r\n            isCompleted: isCompleted,\r\n            isVisible: isVisible,\r\n            latestWorkTime: latestWorkTime,\r\n            latestAnnotationTime: latestAnnotationTime\r\n        };\r\n    }\r\n\r\n    getLatestWorkTimeByWorkgroupId(workgroupId) {\r\n        let time = null;\r\n        let componentStates = this.TeacherDataService.getComponentStatesByNodeId(this.nodeId);\r\n        let n = componentStates.length-1;\r\n\r\n        // loop through component states for this node, starting with most recent\r\n        for (let i = n; i > -1; i--) {\r\n            let componentState = componentStates[i];\r\n            if (componentState.workgroupId === workgroupId) {\r\n                // componentState is for given workgroupId\r\n                time = componentState.serverSaveTime;\r\n                break;\r\n            }\r\n        }\r\n\r\n        return time;\r\n    }\r\n\r\n    getLatestAnnotationTimeByWorkgroupId(workgroupId) {\r\n        let time = null;\r\n        let annotations = this.TeacherDataService.getAnnotationsByNodeId(this.nodeId);\r\n        let n = annotations.length-1;\r\n\r\n        // loop through annotations for this node, starting with most recent\r\n        for (let i = n; i > -1; i--) {\r\n            let annotation = annotations[i];\r\n            // TODO: support checking for annotations from shared teachers\r\n            if (annotation.toWorkgroupId === workgroupId && annotation.fromWorkgroupId === this.ConfigService.getWorkgroupId()) {\r\n                time = annotation.serverSaveTime;\r\n                break;\r\n            }\r\n        }\r\n\r\n        return time;\r\n    }\r\n\r\n    /**\r\n     * Returns the score for the current node for a given workgroupID\r\n     * @param workgroupId a workgroup ID number\r\n     * @returns Number score value (defaults to -1 if workgroup has no score)\r\n     */\r\n    getNodeScoreByWorkgroupId(workgroupId) {\r\n        let score = this.AnnotationService.getScore(workgroupId, this.nodeId);\r\n        return (typeof score === 'number' ? score : -1);\r\n    }\r\n\r\n    /**\r\n     * Returns a numerical status value for a given completion status object depending on node completion\r\n     * Available status values are: 0 (not visited/no work; default), 1 (partially completed), 2 (completed)\r\n     * @param completionStatus Object\r\n     * @returns Integer status value\r\n     */\r\n    getWorkgroupCompletionStatus(completionStatus) {\r\n        let hasWork = completionStatus.latestWorkTime !== null;\r\n        let isCompleted = completionStatus.isCompleted;\r\n        let isVisible = completionStatus.isVisible;\r\n\r\n        // TODO: store this info in the nodeStatus so we don't have to calculate every time (and can use more widely)?\r\n        let status = 0; // default\r\n\r\n        if (!isVisible) {\r\n            status = -1;\r\n        } else if (isCompleted) {\r\n            status = 2;\r\n        } else if (hasWork) {\r\n            status = 1;\r\n        }\r\n\r\n        return status;\r\n    }\r\n\r\n    /**\r\n     * Get the student data for a specific part\r\n     * @param the componentId\r\n     * @param the workgroupId id of Workgroup who created the component state\r\n     * @return the student data for the given component\r\n     */\r\n    getLatestComponentStateByWorkgroupIdAndComponentId(workgroupId,  componentId) {\r\n        var componentState = null;\r\n\r\n        if (workgroupId != null && componentId != null) {\r\n            // get the latest component state for the component\r\n            componentState = this.TeacherDataService.getLatestComponentStateByWorkgroupIdNodeIdAndComponentId(workgroupId, this.nodeId, componentId);\r\n        }\r\n\r\n        return componentState;\r\n    }\r\n\r\n    /**\r\n     * Get the current period\r\n     */\r\n    getCurrentPeriod() {\r\n        return this.TeacherDataService.getCurrentPeriod();\r\n    }\r\n\r\n    /**\r\n     * Get the percentage of the class or period that has completed the node\r\n     * @param nodeId the node id\r\n     * @returns the percentage of the class or period that has completed the node\r\n     */\r\n    getNodeCompletion(nodeId) {\r\n        // get the currently selected period\r\n        let currentPeriod = this.getCurrentPeriod();\r\n        let periodId = currentPeriod.periodId;\r\n\r\n        // get the percentage of the class or period that has completed the node\r\n        let completionPercentage = this.StudentStatusService.getNodeCompletion(nodeId, periodId).completionPct;\r\n\r\n        return completionPercentage;\r\n    }\r\n\r\n    /**\r\n     * Get the average score for the node\r\n     * @param nodeId the node id\r\n     * @returns the average score for the node\r\n     */\r\n    getNodeAverageScore() {\r\n        // get the currently selected period\r\n        let currentPeriod = this.TeacherDataService.getCurrentPeriod();\r\n        let periodId = currentPeriod.periodId;\r\n\r\n        // get the average score for the node\r\n        let averageScore = this.StudentStatusService.getNodeAverageScore(this.nodeId, periodId);\r\n\r\n        if (averageScore === null) {\r\n            averageScore = 'N/A';\r\n        } else {\r\n            averageScore = this.$filter('number')(averageScore, 1);\r\n        }\r\n\r\n        return averageScore;\r\n    }\r\n\r\n    /**\r\n     * Checks whether a workgroup should be shown\r\n     * @param workgroupId the workgroupId to look for\r\n     * @returns boolean whether the workgroup should be shown\r\n     */\r\n    isWorkgroupShown(workgroupId) {\r\n        let show = false;\r\n\r\n        let currentPeriodId = this.getCurrentPeriod().periodId;\r\n        let workgroup = this.workgroupsById[workgroupId];\r\n        let periodId = workgroup.periodId;\r\n\r\n        if (currentPeriodId === -1 || currentPeriodId === periodId) {\r\n            // workgroup is in current period\r\n            let currentWorkgroup = this.TeacherDataService.getCurrentWorkgroup();\r\n            if (currentWorkgroup) {\r\n                // there is a currently selected workgroup, so check if this one matches\r\n                if (currentWorkgroup.workgroupId === parseInt(workgroupId)) {\r\n                    // workgroupIds match, so show this one\r\n                    show = true;\r\n                }\r\n            } else {\r\n                // there is no currently selected workgroup, so show this one\r\n                show = true;\r\n            }\r\n        }\r\n\r\n        return show;\r\n    }\r\n\r\n    updateScroll(target, viewportOffsetTop) {\r\n        let newViewportOffsetTop = target.getBoundingClientRect().top;\r\n        let delta = viewportOffsetTop - newViewportOffsetTop;\r\n        let scrollTop = content.scrollTop;\r\n        content.scrollTop = scrollTop - delta;\r\n    }\r\n\r\n    /**\r\n     * Show the rubric in the grading view. We will show the step rubric and the\r\n     * component rubrics.\r\n     */\r\n    showRubric($event) {\r\n\r\n        // get the step number and title\r\n        let stepNumberAndTitle = this.ProjectService.getNodePositionAndTitleByNodeId(this.nodeId);\r\n        let rubricTitle = this.$translate('STEP_INFO');\r\n\r\n        /*\r\n         * create the dialog header, actions, and content elements\r\n         */\r\n        let dialogHeader =\r\n            `<md-toolbar>\r\n                <div class=\"md-toolbar-tools\">\r\n                    <h2>${ stepNumberAndTitle }</h2>\r\n                </div>\r\n            </md-toolbar>`;\r\n\r\n        let dialogActions =\r\n            `<md-dialog-actions layout=\"row\" layout-align=\"end center\">\r\n                <md-button class=\"md-primary\" ng-click=\"openInNewWindow()\" aria-label=\"{{ 'openInNewWindow' | translate }}\">{{ 'openInNewWindow' | translate }}</md-button>\r\n                <md-button class=\"md-primary\" ng-click=\"close()\" aria-label=\"{{ 'close' | translate }}\">{{ 'close' | translate }}</md-button>\r\n            </md-dialog-actions>`;\r\n\r\n        let dialogContent =\r\n            `<md-dialog-content class=\"gray-lighter-bg\">\r\n                <div class=\"md-dialog-content\" id=\"nodeInfo_${ this.nodeId }\">\r\n                    <node-info node-id=\"${ this.nodeId }\"></node-info>\r\n                </div>\r\n            </md-dialog-content>`;\r\n\r\n        // create the dialog string\r\n        let dialogString = `<md-dialog class=\"dialog--wider\" aria-label=\"${ stepNumberAndTitle } - ${ rubricTitle }\">${ dialogHeader }${  dialogContent }${ dialogActions }</md-dialog>`;\r\n        let nodeId = this.nodeId;\r\n\r\n        // display the rubric in a popup\r\n        this.$mdDialog.show({\r\n            template : dialogString,\r\n            fullscreen: true,\r\n            controller: ['$scope', '$mdDialog',\r\n                function DialogController($scope, $mdDialog) {\r\n\r\n                    // display the rubric in a new tab\r\n                    $scope.openInNewWindow = function() {\r\n\r\n                        // open a new tab\r\n                        let w = window.open('', '_blank');\r\n\r\n                        /*\r\n                         * create the header for the new window that contains the project title\r\n                         */\r\n                        let windowHeader =\r\n                            `<md-toolbar class=\"layout-row\">\r\n                                <div class=\"md-toolbar-tools primary-bg\" style=\"color: #ffffff;\">\r\n                                    <h2>${ stepNumberAndTitle }</h2>\r\n                                </div>\r\n                            </md-toolbar>`;\r\n\r\n                        let rubricContent = document.getElementById('nodeInfo_' + nodeId).innerHTML;\r\n\r\n                        // create the window string\r\n                        let windowString =\r\n                            `<link rel='stylesheet' href='../wise5/lib/bootstrap/css/bootstrap.min.css' />\r\n                            <link rel='stylesheet' href='../wise5/themes/default/style/monitor.css'>\r\n                            <link rel='stylesheet' href='../wise5/themes/default/style/angular-material.css'>\r\n                            <link rel='stylesheet' href='../wise5/lib/summernote/dist/summernote.css' />\r\n                            <link rel=\"stylesheet\" href=\"http://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic%7CMaterial+Icons\" media=\"all\">\r\n                            <body class=\"layout-column\">\r\n                                <div class=\"layout-column\">${ windowHeader }<md-content class=\"md-padding\">${ rubricContent }</div></md-content></div>\r\n                            </body>`;\r\n\r\n                        // write the rubric content to the new tab\r\n                        w.document.write(windowString);\r\n\r\n                        // close the popup\r\n                        $mdDialog.hide();\r\n                    }\r\n\r\n                    // close the popup\r\n                    $scope.close = () => {\r\n                        $mdDialog.hide();\r\n                    }\r\n                }\r\n            ],\r\n            targetEvent: $event,\r\n            clickOutsideToClose: true,\r\n            escapeToClose: true\r\n        });\r\n    }\r\n\r\n    setSort(value) {\r\n\r\n        switch (value) {\r\n            case 'team':\r\n                if (this.sort === 'team') {\r\n                    this.sort = '-team';\r\n                } else {\r\n                    this.sort = 'team';\r\n                }\r\n                break;\r\n            case 'status':\r\n                if (this.sort === 'status') {\r\n                    this.sort = '-status';\r\n                } else {\r\n                    this.sort = 'status';\r\n                }\r\n                break;\r\n            case 'score':\r\n                if (this.sort === 'score') {\r\n                    this.sort = '-score';\r\n                } else {\r\n                    this.sort = 'score';\r\n                }\r\n                break;\r\n        }\r\n\r\n        // update value in the teacher data service so we can persist across view instances and current node changes\r\n        this.TeacherDataService.nodeGradingSort = this.sort;\r\n    }\r\n\r\n    getOrderBy() {\r\n        let orderBy = [];\r\n\r\n        switch (this.sort) {\r\n            case 'team':\r\n                orderBy = ['-isVisible', 'displayNames'];\r\n                break;\r\n            case '-team':\r\n                orderBy = ['-isVisible', '-displayNames'];\r\n                break;\r\n            case 'status':\r\n                orderBy = ['-isVisible', 'completionStatus', 'displayNames'];\r\n                break;\r\n            case '-status':\r\n                orderBy = ['-isVisible', '-completionStatus', 'displayNames'];\r\n                break;\r\n            case 'score':\r\n                orderBy = ['-isVisible', 'score', 'displayNames'];\r\n                break;\r\n            case '-score':\r\n                orderBy = ['-isVisible', '-score', 'displayNames'];\r\n                break;\r\n        }\r\n\r\n        return orderBy;\r\n    }\r\n\r\n    /**\r\n     * Expand all workgroups to show student work\r\n     */\r\n    expandAll() {\r\n\r\n        // loop through all the workgroups\r\n        for (let i = 0; i < this.workgroups.length; i++) {\r\n\r\n            // get a workgroup id\r\n            let id = this.workgroups[i].workgroupId;\r\n\r\n            // check if the workgroup is currently in view\r\n            if (this.workgroupInViewById[id]) {\r\n                // the workgroup is currently in view so we will expand it\r\n                this.workVisibilityById[id] = true;\r\n            }\r\n        }\r\n\r\n        /*\r\n         * set the boolean flag to denote that we are currently expanding\r\n         * all the workgroups\r\n         */\r\n        this.isExpandAll = true;\r\n    }\r\n\r\n    /**\r\n     * Collapse all workgroups to hide student work\r\n     */\r\n    collapseAll() {\r\n        let n = this.workgroups.length;\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            let id = this.workgroups[i].workgroupId;\r\n            this.workVisibilityById[id] = false;\r\n        }\r\n\r\n        /*\r\n         * set the boolean flag to denote that we are not currently expanding\r\n         * all the workgroups\r\n         */\r\n        this.isExpandAll = false;\r\n    }\r\n\r\n    onUpdateExpand(workgroupId, value) {\r\n        this.workVisibilityById[workgroupId] = !this.workVisibilityById[workgroupId];\r\n    }\r\n\r\n    onUpdateHiddenComponents(value) {\r\n        this.hiddenComponents = angular.copy(value);\r\n    }\r\n\r\n    /**\r\n     * A workgroup row has either come into view or gone out of view\r\n     * @param workgroupId the workgroup id that has come into view or gone out\r\n     * of view\r\n     * @param inview whether the row is in view or not\r\n     */\r\n    workgroupInView(workgroupId, inview) {\r\n\r\n        // remember whether the workgroup is in view or not\r\n        this.workgroupInViewById[workgroupId] = inview;\r\n\r\n        if (this.isExpandAll) {\r\n            // we are currently in expand all mode\r\n\r\n            if (inview) {\r\n                // the workgroup row is in view so we will expand it\r\n                this.workVisibilityById[workgroupId] = true;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nNodeGradingController.$inject = [\r\n    '$filter',\r\n    '$mdDialog',\r\n    '$scope',\r\n    '$stateParams',\r\n    'AnnotationService',\r\n    'ConfigService',\r\n    'NotificationService',\r\n    'ProjectService',\r\n    'StudentStatusService',\r\n    'TeacherDataService'\r\n];\r\n\r\nexport default NodeGradingController;\r\n"]}