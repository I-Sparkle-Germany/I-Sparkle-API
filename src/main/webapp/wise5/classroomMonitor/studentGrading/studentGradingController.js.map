{"version":3,"sources":["studentGradingController.es6"],"names":["StudentGradingController","$filter","$mdDialog","$mdMedia","$scope","$state","$stateParams","AnnotationService","ConfigService","NotificationService","ProjectService","StudentStatusService","TeacherDataService","$translate","$onInit","document","body","scrollTop","documentElement","sort","studentGradingSort","stepGradingSort","permissions","getPermissions","workgroupId","parseInt","workgroup","getUserInfoByWorkgroupId","setCurrentWorkgroup","maxScore","getMaxScoreForWorkgroupId","totalScore","getTotalScoreByWorkgroupId","projectCompletion","getStudentProjectCompletion","showNonWorkNodes","nodeIds","getFlattenedProjectAsNodeIds","nodesById","nodeVisibilityById","nodesInViewById","setNodesById","$on","event","args","updateNodeMaxScores","notification","type","toWorkgroupId","nodeId","updateNode","annotation","studentWork","currentWorkgroup","go","context","componentId","componentType","category","data","saveEvent","l","length","i","id","isApplicationNode","node","getNodeById","init","alertNotifications","getAlertNotificationsByNodeId","hasAlert","hasNewAlert","nodeHasNewAlert","completionStatus","getNodeCompletionStatusByNodeId","hasWork","nodeHasWork","hasNewWork","isVisible","getNodeCompletionStatus","score","getNodeScoreByNodeId","hasScore","getMaxScoreForNode","hasMaxScore","scorePct","toFixed","order","getOrderById","show","isNodeShown","angular","copy","getAlertNotifications","newAlert","alert","timeDismissed","isCompleted","latestWorkTime","getLatestWorkTimeByNodeId","latestAnnotationTime","getLatestAnnotationTimeByNodeId","studentStatus","getStudentStatusForWorkgroupId","nodeStatus","nodeStatuses","isVisited","status","time","componentStates","getComponentStatesByNodeId","n","componentState","serverSaveTime","annotations","getAnnotationsByNodeId","fromWorkgroupId","getWorkgroupId","getScore","getLatestComponentStateByWorkgroupIdNodeIdAndComponentId","currentStep","getCurrentStep","value","orderBy","isExpandAll","inview","$inject"],"mappings":"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","file":"studentGradingController.js","sourcesContent":["'use strict';\r\n\r\nclass StudentGradingController {\r\n\r\n    constructor($filter,\r\n                $mdDialog,\r\n                $mdMedia,\r\n                $scope,\r\n                $state,\r\n                $stateParams,\r\n                AnnotationService,\r\n                ConfigService,\r\n                NotificationService,\r\n                ProjectService,\r\n                StudentStatusService,\r\n                TeacherDataService) {\r\n        this.$filter = $filter;\r\n        this.$mdDialog = $mdDialog;\r\n        $scope.$mdMedia = $mdMedia;\r\n        this.$scope = $scope;\r\n        this.$state = $state;\r\n        this.$stateParams = $stateParams;\r\n        this.AnnotationService = AnnotationService;\r\n        this.ConfigService = ConfigService;\r\n        this.NotificationService = NotificationService;\r\n        this.ProjectService = ProjectService;\r\n        this.StudentStatusService = StudentStatusService;\r\n        this.TeacherDataService = TeacherDataService;\r\n        this.$translate = this.$filter('translate');\r\n\r\n        this.$onInit = () => {\r\n            // scroll to the top of the page\r\n            document.body.scrollTop = document.documentElement.scrollTop = 0;\r\n\r\n            this.sort = this.TeacherDataService.studentGradingSort;\r\n            this.TeacherDataService.stepGradingSort = this.sort;\r\n            this.permissions = this.ConfigService.getPermissions();\r\n            this.workgroupId = parseInt(this.$stateParams.workgroupId);\r\n            let workgroup = this.ConfigService.getUserInfoByWorkgroupId(this.workgroupId);\r\n            this.TeacherDataService.setCurrentWorkgroup(workgroup);\r\n            let maxScore = this.StudentStatusService.getMaxScoreForWorkgroupId(this.workgroupId);\r\n            this.maxScore = maxScore ? maxScore : 0;\r\n            this.totalScore = this.TeacherDataService.getTotalScoreByWorkgroupId(this.workgroupId);\r\n            this.projectCompletion = this.StudentStatusService.getStudentProjectCompletion(this.workgroupId, true);\r\n            this.showNonWorkNodes = false;\r\n            this.nodeIds = this.ProjectService.getFlattenedProjectAsNodeIds();\r\n            this.nodesById = {}; // object that will hold node names, statuses, scores, notifications, etc.\r\n            this.nodeVisibilityById = {}; // object that specifies whether student work is visible for each node\r\n            this.nodesInViewById = {}; // object that holds whether the node is in view or not\r\n\r\n            this.setNodesById();\r\n        }\r\n\r\n        this.$scope.$on('projectSaved', (event, args) => {\r\n            // project info has changed, so update max scores\r\n            this.maxScore = this.StudentStatusService.getMaxScoreForWorkgroupId(this.workgroupId);\r\n            this.updateNodeMaxScores();\r\n        });\r\n\r\n        this.$scope.$on('notificationAdded', (event, notification) => {\r\n          if (notification.type === 'CRaterResult') {\r\n              // there is a new CRaterResult notification\r\n              // TODO: expand to encompass other notification types that should be shown to teacher\r\n              let workgroupId = notification.toWorkgroupId;\r\n              let nodeId = notification.nodeId;\r\n              if (workgroupId === this.workgroupId && this.nodesById[nodeId]) {\r\n                this.updateNode(nodeId);\r\n              }\r\n          }\r\n        });\r\n\r\n        this.$scope.$on('notificationChanged', (event, notification) => {\r\n            if (notification.type === 'CRaterResult') {\r\n                // a CRaterResult notification has changed\r\n                // TODO: expand to encompass other notification types that should be shown to teacher\r\n                let workgroupId = notification.toWorkgroupId;\r\n                let nodeId = notification.nodeId;\r\n                if (workgroupId === this.workgroupId && this.nodesById[nodeId]) {\r\n                    this.updateNode(nodeId);\r\n                }\r\n            }\r\n        });\r\n\r\n        this.$scope.$on('annotationReceived', (event, args) => {\r\n            // a new annotation has been received, so update corresponding node\r\n            let annotation = args.annotation;\r\n            if (annotation) {\r\n                let workgroupId = annotation.toWorkgroupId;\r\n                let nodeId = annotation.nodeId;\r\n                if (workgroupId === this.workgroupId && this.nodesById[nodeId]) {\r\n                    this.totalScore = this.TeacherDataService.getTotalScoreByWorkgroupId(workgroupId);\r\n                    this.updateNode(nodeId);\r\n                }\r\n            }\r\n        });\r\n\r\n        this.$scope.$on('studentWorkReceived', (event, args) => {\r\n            // new student work has been received, so update corresponding node\r\n            let studentWork = args.studentWork;\r\n            if (studentWork != null) {\r\n                let workgroupId = studentWork.workgroupId;\r\n                let nodeId = studentWork.nodeId;\r\n                if (workgroupId === this.workgroupId && this.nodesById[nodeId]) {\r\n                    this.updateNode(nodeId);\r\n                }\r\n            }\r\n        });\r\n\r\n        this.$scope.$on('currentWorkgroupChanged', (event, args) => {\r\n            // the current workgroup has changed, so reload the view\r\n            let workgroup = args.currentWorkgroup;\r\n            if (workgroup != null) {\r\n                let workgroupId = workgroup.workgroupId;\r\n                if (this.workgroupId !== workgroupId) {\r\n                    this.$state.go('root.team', {workgroupId: workgroupId});\r\n                }\r\n            }\r\n        });\r\n\r\n        // save event when student grading view is displayed\r\n        let context = \"ClassroomMonitor\", nodeId = null, componentId = null, componentType = null,\r\n            category = \"Navigation\", event = \"studentGradingViewDisplayed\", data = { workgroupId: this.workgroupId };\r\n        this.TeacherDataService.saveEvent(context, nodeId, componentId, componentType, category, event, data);\r\n    }\r\n\r\n    /**\r\n     * Build the nodesById object; don't include group nodes\r\n     */\r\n    setNodesById() {\r\n        let l = this.nodeIds.length;\r\n        for (let i = 0; i < l; i++) {\r\n            let id = this.nodeIds[i];\r\n            let isApplicationNode = this.ProjectService.isApplicationNode(id);\r\n            if (isApplicationNode) {\r\n              let node = this.ProjectService.getNodeById(id);\r\n              this.nodesById[id] = node;\r\n              this.nodeVisibilityById[id] = false;\r\n              this.updateNode(id, true);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update statuses, scores, notifications, etc. for a node object\r\n     * @param nodeID a node ID number\r\n     * @param init Boolean whether we're in controller initialization or not\r\n     */\r\n    updateNode(nodeId, init) {\r\n        let node = this.nodesById[nodeId];\r\n\r\n        if (node) {\r\n            let alertNotifications = this.getAlertNotificationsByNodeId(nodeId);\r\n            node.hasAlert = alertNotifications.length > 0;\r\n            node.hasNewAlert = this.nodeHasNewAlert(alertNotifications);\r\n            let completionStatus = this.getNodeCompletionStatusByNodeId(nodeId);\r\n            node.hasWork = this.ProjectService.nodeHasWork(nodeId);\r\n            node.hasNewWork = completionStatus.hasNewWork;\r\n            node.isVisible = completionStatus.isVisible ? 1 : 0;\r\n            node.completionStatus = this.getNodeCompletionStatus(completionStatus);\r\n            node.score = this.getNodeScoreByNodeId(nodeId);\r\n            node.hasScore = node.score > -1;\r\n            node.maxScore = this.ProjectService.getMaxScoreForNode(nodeId);\r\n            if (node.maxScore > 0) {\r\n              node.hasMaxScore = true;\r\n              node.scorePct = node.score > -1 ? +((node.score / node.maxScore).toFixed(2)) : 0;\r\n            } else {\r\n              node.hasMaxScore = false;\r\n              node.scorePct = 0;\r\n            }\r\n            node.order = this.ProjectService.getOrderById(nodeId);\r\n            node.show = this.isNodeShown(nodeId);\r\n\r\n            if (!init) {\r\n                this.nodesById[nodeId] = angular.copy(node);\r\n            }\r\n        }\r\n    }\r\n\r\n    getAlertNotificationsByNodeId(nodeId) {\r\n        let args = {};\r\n        args.nodeId = nodeId;\r\n        args.toWorkgroupId = this.workgroupId;\r\n        return this.NotificationService.getAlertNotifications(args);\r\n    }\r\n\r\n    nodeHasNewAlert(alertNotifications) {\r\n        let newAlert = false;\r\n\r\n        let l = alertNotifications.length;\r\n        for (let i = 0; i < l; i++) {\r\n            let alert = alertNotifications[i];\r\n            if (!alert.timeDismissed) {\r\n                newAlert = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        return newAlert;\r\n    }\r\n\r\n    /**\r\n     * Returns an object with node completion status, latest work time, and latest annotation time\r\n     * for a workgroup for the current node\r\n     * @param nodeId a node ID number\r\n     * @returns Object with completion, latest work time, latest annotation time\r\n     */\r\n    getNodeCompletionStatusByNodeId(nodeId) {\r\n        let isCompleted = false;\r\n        let isVisible = false;\r\n\r\n        // TODO: store this info in the nodeStatus so we don't have to calculate every time?\r\n        let latestWorkTime = this.getLatestWorkTimeByNodeId(nodeId);\r\n\r\n        let latestAnnotationTime = this.getLatestAnnotationTimeByNodeId(nodeId);\r\n        let studentStatus = this.StudentStatusService.getStudentStatusForWorkgroupId(this.workgroupId);\r\n        if (studentStatus != null) {\r\n            let nodeStatus = studentStatus.nodeStatuses[nodeId];\r\n            if (nodeStatus) {\r\n                isVisible = nodeStatus.isVisible;\r\n                if (latestWorkTime) {\r\n                    // workgroup has at least one componentState for this node, so check if node is completed\r\n                    isCompleted = nodeStatus.isCompleted;\r\n                }\r\n\r\n                if (!this.ProjectService.nodeHasWork(nodeId)) {\r\n                    // the step does not generate any work so completion = visited\r\n                    isCompleted = nodeStatus.isVisited;\r\n                }\r\n            }\r\n        }\r\n\r\n        return {\r\n            isCompleted: isCompleted,\r\n            isVisible: isVisible,\r\n            latestWorkTime: latestWorkTime,\r\n            latestAnnotationTime: latestAnnotationTime\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Returns a numerical status value for a given completion status object depending on node completion\r\n     * Available status values are: 0 (not visited/no work; default), 1 (partially completed), 2 (completed)\r\n     * @param completionStatus Object\r\n     * @returns Integer status value\r\n     */\r\n    getNodeCompletionStatus(completionStatus) {\r\n        let hasWork = completionStatus.latestWorkTime !== null;\r\n        let isCompleted = completionStatus.isCompleted;\r\n        let isVisible = completionStatus.isVisible;\r\n\r\n        // TODO: store this info in the nodeStatus so we don't have to calculate every time (and can use more widely)?\r\n        let status = 0; // default\r\n\r\n        if (!isVisible) {\r\n            status = -1;\r\n        } else if (isCompleted) {\r\n            status = 2;\r\n        } else if (hasWork) {\r\n            status = 1;\r\n        }\r\n\r\n        return status;\r\n    }\r\n\r\n    getLatestWorkTimeByNodeId(nodeId) {\r\n        let time = null;\r\n        let componentStates = this.TeacherDataService.getComponentStatesByNodeId(nodeId);\r\n        let n = componentStates.length-1;\r\n\r\n        // loop through component states for this node, starting with most recent\r\n        for (let i = n; i > -1; i--) {\r\n            let componentState = componentStates[i];\r\n            if (componentState.workgroupId === this.workgroupId) {\r\n                // componentState is for given workgroupId\r\n                time = componentState.serverSaveTime;\r\n                break;\r\n            }\r\n        }\r\n\r\n        return time;\r\n    }\r\n\r\n    getLatestAnnotationTimeByNodeId(nodeId) {\r\n        let time = null;\r\n        let annotations = this.TeacherDataService.getAnnotationsByNodeId(nodeId);\r\n        let n = annotations.length-1;\r\n\r\n        // loop through annotations for this node, starting with most recent\r\n        for (let i = n; i > -1; i--) {\r\n            let annotation = annotations[i];\r\n            // TODO: support checking for annotations from shared teachers\r\n            if (annotation.toWorkgroupId === this.workgroupId && annotation.fromWorkgroupId === this.ConfigService.getWorkgroupId()) {\r\n                time = annotation.serverSaveTime;\r\n                break;\r\n            }\r\n        }\r\n\r\n        return time;\r\n    }\r\n\r\n    /**\r\n     * Returns the score for the current workgroup for a given nodeId\r\n     * @param nodeId a node ID number\r\n     * @returns Number score value (defaults to -1 if node has no score)\r\n     */\r\n    getNodeScoreByNodeId(nodeId) {\r\n        let score = this.AnnotationService.getScore(this.workgroupId, nodeId);\r\n        return (typeof score === 'number' ? score : -1);\r\n    }\r\n\r\n    /**\r\n     * Returns a numerical status value for a given completion status object depending on node completion\r\n     * Available status values are: 0 (not visited/no work; default), 1 (partially completed), 2 (completed)\r\n     * @param completionStatus Object\r\n     * @returns Integer status value\r\n     */\r\n    getWorkgroupCompletionStatus(completionStatus) {\r\n        let hasWork = completionStatus.latestWorkTime !== null;\r\n        let isCompleted = completionStatus.isCompleted;\r\n        let isVisible = completionStatus.isVisible;\r\n\r\n        // TODO: store this info in the nodeStatus so we don't have to calculate every time (and can use more widely)?\r\n        let status = 0; // default\r\n\r\n        if (!isVisible) {\r\n            status = -1;\r\n        } else if (isCompleted) {\r\n            status = 2;\r\n        } else if (hasWork) {\r\n            status = 1;\r\n        }\r\n\r\n        return status;\r\n    }\r\n\r\n    /**\r\n     * Get the student data for a specific part\r\n     * @param the componentId\r\n     * @param the nodeId id of node we're looking for\r\n     * @return the student data for the given component\r\n     */\r\n    getLatestComponentStateByNodeIdAndComponentId(nodeId,  componentId) {\r\n        var componentState = null;\r\n\r\n        if (nodeId != null && componentId != null) {\r\n            // get the latest component state for the component\r\n            componentState = this.TeacherDataService.getLatestComponentStateByWorkgroupIdNodeIdAndComponentId(this.workgroupId, nodeId, componentId);\r\n        }\r\n\r\n        return componentState;\r\n    }\r\n\r\n    /**\r\n     * Checks whether a node should be shown\r\n     * @param nodeId the node Id to look for\r\n     * @returns boolean whether the workgroup should be shown\r\n     */\r\n    isNodeShown(nodeId) {\r\n        let show = false;\r\n        let node = this.nodesById[nodeId];\r\n\r\n        if (node.isVisible && (node.hasWork || this.showNonWorkNodes)) {\r\n            let currentStep = this.TeacherDataService.getCurrentStep();\r\n            if (currentStep) {\r\n                // there is a currently selected step, so check if this one matches\r\n                if (currentStep.nodeId === parseInt(nodeId)) {\r\n                    show = true;\r\n                }\r\n            } else {\r\n                // there is no currently selected step, so show this one\r\n                show = true;\r\n            }\r\n        }\r\n\r\n        return show;\r\n    }\r\n\r\n    /**\r\n     * Gets and returns the total project score for the currently selected workgroup\r\n     * @return score object or null\r\n     */\r\n    getCurrentWorkgroupScore() {\r\n        return this.TeacherDataService.getTotalScoreByWorkgroupId(this.workgroupId);\r\n    }\r\n\r\n    setSort(value) {\r\n\r\n        switch (value) {\r\n            case 'step':\r\n                if (this.sort === 'step') {\r\n                    this.sort = '-step';\r\n                } else {\r\n                    this.sort = 'step';\r\n                }\r\n                break;\r\n            case 'status':\r\n                if (this.sort === 'status') {\r\n                    this.sort = '-status';\r\n                } else {\r\n                    this.sort = 'status';\r\n                }\r\n                break;\r\n            case 'score':\r\n                if (this.sort === 'score') {\r\n                    this.sort = '-score';\r\n                } else {\r\n                    this.sort = 'score';\r\n                }\r\n                break;\r\n        }\r\n\r\n        // update value in the teacher data service so we can persist across view instances and workgroup changes\r\n        this.TeacherDataService.studentGradingSort = this.sort;\r\n    }\r\n\r\n    getOrderBy() {\r\n        let orderBy = [];\r\n\r\n        switch (this.sort) {\r\n            case 'step':\r\n                orderBy = ['-isVisible', 'order'];\r\n                break;\r\n            case '-step':\r\n                orderBy = ['-isVisible', '-order'];\r\n                break;\r\n            case 'status':\r\n                orderBy = ['-isVisible', 'completionStatus', 'order'];\r\n                break;\r\n            case '-status':\r\n                orderBy = ['-isVisible', '-completionStatus', 'order'];\r\n                break;\r\n            case 'score':\r\n                orderBy = ['-isVisible', '-hasScore', 'scorePct', 'score', '-hasMaxScore', '-maxScore', 'order'];\r\n                break;\r\n            case '-score':\r\n                orderBy = ['-isVisible', '-hasScore', '-scorePct', 'score', '-hasMaxScore', '-maxScore', 'order'];\r\n                break;\r\n        }\r\n\r\n        return orderBy;\r\n    }\r\n\r\n    /**\r\n     * Expand all nodes to show student work\r\n     */\r\n    expandAll() {\r\n\r\n        // loop through all the workgroups\r\n        for (let i = 0; i < this.nodeIds.length; i++) {\r\n\r\n            // get a node id\r\n            let id = this.nodeIds[i];\r\n\r\n            // check if the node is currently in view\r\n            if (this.nodesInViewById[id]) {\r\n                // the node is currently in view so we will expand it\r\n                this.nodeVisibilityById[id] = true;\r\n            }\r\n        }\r\n\r\n        /*\r\n         * set the boolean flag to denote that we are currently expanding\r\n         * all the nodes\r\n         */\r\n        this.isExpandAll = true;\r\n    }\r\n\r\n    /**\r\n     * Collapse all nodes to hide student work\r\n     */\r\n    collapseAll() {\r\n        let n = this.nodeIds.length;\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            let id = this.nodeIds[i];\r\n            this.nodeVisibilityById[id] = false;\r\n        }\r\n\r\n        /*\r\n         * set the boolean flag to denote that we are not currently expanding\r\n         * all the nodes\r\n         */\r\n        this.isExpandAll = false;\r\n    }\r\n\r\n    onUpdateExpand(nodeId, value) {\r\n        this.nodeVisibilityById[nodeId] = value;\r\n    }\r\n\r\n    /**\r\n     * A node row has either come into view or gone out of view\r\n     * @param nodeId the node id that has come into view or gone out\r\n     * of view\r\n     * @param inview whether the row is in view or not\r\n     */\r\n    stepInView(nodeId, inview) {\r\n\r\n        // remember whether the node is in view or not\r\n        this.nodesInViewById[nodeId] = inview;\r\n\r\n        // if we're in expand all mode, expand node row if it's in view\r\n        if (this.isExpandAll) {\r\n            if (inview) {\r\n                this.nodeVisibilityById[nodeId] = true;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nStudentGradingController.$inject = [\r\n    '$filter',\r\n    '$mdDialog',\r\n    '$mdMedia',\r\n    '$scope',\r\n    '$state',\r\n    '$stateParams',\r\n    'AnnotationService',\r\n    'ConfigService',\r\n    'NotificationService',\r\n    'ProjectService',\r\n    'StudentStatusService',\r\n    'TeacherDataService'\r\n];\r\n\r\nexport default StudentGradingController;\r\n"]}