{"version":3,"sources":["studentGradingController.es6"],"names":["StudentGradingController","$filter","$mdDialog","$mdMedia","$scope","$state","$stateParams","orderBy","AnnotationService","ConfigService","NotificationService","ProjectService","StudentStatusService","TeacherDataService","$translate","$onInit","document","body","scrollTop","documentElement","sort","studentGradingSort","stepGradingSort","permissions","getPermissions","workgroupId","parseInt","workgroup","getUserInfoByWorkgroupId","setCurrentWorkgroup","maxScore","getMaxScoreForWorkgroupId","totalScore","getTotalScoreByWorkgroupId","projectCompletion","getStudentProjectCompletion","showNonWorkNodes","nodeIds","getFlattenedProjectAsNodeIds","nodesById","nodeVisibilityById","nodesInViewById","setNodesById","$on","event","args","updateNodeMaxScores","notification","type","toWorkgroupId","nodeId","updateNode","annotation","studentWork","currentWorkgroup","go","periodId","currentPeriod","getCurrentWorkgroup","workgroups","angular","copy","getClassmateUserInfos","n","length","i","context","componentId","componentType","category","data","saveEvent","l","id","isApplicationNode","node","getNodeById","init","alertNotifications","getAlertNotificationsByNodeId","hasAlert","hasNewAlert","nodeHasNewAlert","completionStatus","getNodeCompletionStatusByNodeId","hasWork","nodeHasWork","hasNewWork","isVisible","getNodeCompletionStatus","score","getNodeScoreByNodeId","hasScore","getMaxScoreForNode","hasMaxScore","scorePct","toFixed","order","getOrderById","show","isNodeShown","getAlertNotifications","newAlert","alert","timeDismissed","isCompleted","latestWorkTime","getLatestWorkTimeByNodeId","latestAnnotationTime","getLatestAnnotationTimeByNodeId","studentStatus","getStudentStatusForWorkgroupId","nodeStatus","nodeStatuses","isVisited","status","time","componentStates","getComponentStatesByNodeId","componentState","serverSaveTime","annotations","getAnnotationsByNodeId","fromWorkgroupId","getWorkgroupId","getScore","getLatestComponentStateByWorkgroupIdNodeIdAndComponentId","currentStep","getCurrentStep","value","isExpandAll","inview","$inject"],"mappings":"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","file":"studentGradingController.js","sourcesContent":["'use strict';\r\n\r\nclass StudentGradingController {\r\n\r\n    constructor($filter,\r\n                $mdDialog,\r\n                $mdMedia,\r\n                $scope,\r\n                $state,\r\n                $stateParams,\r\n                orderBy,\r\n                AnnotationService,\r\n                ConfigService,\r\n                NotificationService,\r\n                ProjectService,\r\n                StudentStatusService,\r\n                TeacherDataService) {\r\n        this.$filter = $filter;\r\n        this.$mdDialog = $mdDialog;\r\n        $scope.$mdMedia = $mdMedia;\r\n        this.$scope = $scope;\r\n        this.$state = $state;\r\n        this.$stateParams = $stateParams;\r\n        this.orderBy = orderBy;\r\n        this.AnnotationService = AnnotationService;\r\n        this.ConfigService = ConfigService;\r\n        this.NotificationService = NotificationService;\r\n        this.ProjectService = ProjectService;\r\n        this.StudentStatusService = StudentStatusService;\r\n        this.TeacherDataService = TeacherDataService;\r\n        this.$translate = this.$filter('translate');\r\n\r\n        this.$onInit = () => {\r\n            // scroll to the top of the page\r\n            document.body.scrollTop = document.documentElement.scrollTop = 0;\r\n\r\n            this.sort = this.TeacherDataService.studentGradingSort;\r\n            this.TeacherDataService.stepGradingSort = this.sort;\r\n            this.permissions = this.ConfigService.getPermissions();\r\n            this.workgroupId = parseInt(this.$stateParams.workgroupId);\r\n            let workgroup = this.ConfigService.getUserInfoByWorkgroupId(this.workgroupId);\r\n            this.TeacherDataService.setCurrentWorkgroup(workgroup);\r\n            let maxScore = this.StudentStatusService.getMaxScoreForWorkgroupId(this.workgroupId);\r\n            this.maxScore = maxScore ? maxScore : 0;\r\n            this.totalScore = this.TeacherDataService.getTotalScoreByWorkgroupId(this.workgroupId);\r\n            this.projectCompletion = this.StudentStatusService.getStudentProjectCompletion(this.workgroupId, true);\r\n            this.showNonWorkNodes = false;\r\n            this.nodeIds = this.ProjectService.getFlattenedProjectAsNodeIds();\r\n            this.nodesById = {}; // object that will hold node names, statuses, scores, notifications, etc.\r\n            this.nodeVisibilityById = {}; // object that specifies whether student work is visible for each node\r\n            this.nodesInViewById = {}; // object that holds whether the node is in view or not\r\n\r\n            this.setNodesById();\r\n        }\r\n\r\n        this.$scope.$on('projectSaved', (event, args) => {\r\n            // project info has changed, so update max scores\r\n            this.maxScore = this.StudentStatusService.getMaxScoreForWorkgroupId(this.workgroupId);\r\n            this.updateNodeMaxScores();\r\n        });\r\n\r\n        this.$scope.$on('notificationAdded', (event, notification) => {\r\n          if (notification.type === 'CRaterResult') {\r\n              // there is a new CRaterResult notification\r\n              // TODO: expand to encompass other notification types that should be shown to teacher\r\n              let workgroupId = notification.toWorkgroupId;\r\n              let nodeId = notification.nodeId;\r\n              if (workgroupId === this.workgroupId && this.nodesById[nodeId]) {\r\n                this.updateNode(nodeId);\r\n              }\r\n          }\r\n        });\r\n\r\n        this.$scope.$on('notificationChanged', (event, notification) => {\r\n            if (notification.type === 'CRaterResult') {\r\n                // a CRaterResult notification has changed\r\n                // TODO: expand to encompass other notification types that should be shown to teacher\r\n                let workgroupId = notification.toWorkgroupId;\r\n                let nodeId = notification.nodeId;\r\n                if (workgroupId === this.workgroupId && this.nodesById[nodeId]) {\r\n                    this.updateNode(nodeId);\r\n                }\r\n            }\r\n        });\r\n\r\n        this.$scope.$on('annotationReceived', (event, args) => {\r\n            // a new annotation has been received, so update corresponding node\r\n            let annotation = args.annotation;\r\n            if (annotation) {\r\n                let workgroupId = annotation.toWorkgroupId;\r\n                let nodeId = annotation.nodeId;\r\n                if (workgroupId === this.workgroupId && this.nodesById[nodeId]) {\r\n                    this.totalScore = this.TeacherDataService.getTotalScoreByWorkgroupId(workgroupId);\r\n                    this.updateNode(nodeId);\r\n                }\r\n            }\r\n        });\r\n\r\n        this.$scope.$on('studentWorkReceived', (event, args) => {\r\n            // new student work has been received, so update corresponding node\r\n            let studentWork = args.studentWork;\r\n            if (studentWork != null) {\r\n                let workgroupId = studentWork.workgroupId;\r\n                let nodeId = studentWork.nodeId;\r\n                if (workgroupId === this.workgroupId && this.nodesById[nodeId]) {\r\n                    this.updateNode(nodeId);\r\n                }\r\n            }\r\n        });\r\n\r\n        this.$scope.$on('currentWorkgroupChanged', (event, args) => {\r\n            let workgroup = args.currentWorkgroup;\r\n            if (workgroup != null) {\r\n                let workgroupId = workgroup.workgroupId;\r\n                if (this.workgroupId !== workgroupId) {\r\n                    // the current workgroup has changed, so reload the view\r\n                    this.$state.go('root.team', {workgroupId: workgroupId});\r\n                }\r\n            }\r\n        });\r\n\r\n        this.$scope.$on('currentPeriodChanged', (event, args) => {\r\n            let periodId = args.currentPeriod.periodId;\r\n            let currentWorkgroup = this.TeacherDataService.getCurrentWorkgroup();\r\n            if (!currentWorkgroup) {\r\n                /*\r\n                 * there is no currently selected workgroup, so set to the\r\n                 * first workgroup in the current period\r\n                 */\r\n                let workgroups = angular.copy(this.ConfigService.getClassmateUserInfos());\r\n                workgroups = this.orderBy(workgroups, 'workgroupId');\r\n                let n = workgroups.length;\r\n                for (let i = 0; i < n; i++) {\r\n                    let workgroup = workgroups[i];\r\n                    if (workgroup.periodId === periodId) {\r\n                        this.TeacherDataService.setCurrentWorkgroup(workgroup);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        // save event when student grading view is displayed\r\n        let context = \"ClassroomMonitor\", nodeId = null, componentId = null, componentType = null,\r\n            category = \"Navigation\", event = \"studentGradingViewDisplayed\", data = { workgroupId: this.workgroupId };\r\n        this.TeacherDataService.saveEvent(context, nodeId, componentId, componentType, category, event, data);\r\n    }\r\n\r\n    /**\r\n     * Build the nodesById object; don't include group nodes\r\n     */\r\n    setNodesById() {\r\n        let l = this.nodeIds.length;\r\n        for (let i = 0; i < l; i++) {\r\n            let id = this.nodeIds[i];\r\n            let isApplicationNode = this.ProjectService.isApplicationNode(id);\r\n            if (isApplicationNode) {\r\n              let node = this.ProjectService.getNodeById(id);\r\n              this.nodesById[id] = node;\r\n              this.nodeVisibilityById[id] = false;\r\n              this.updateNode(id, true);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update statuses, scores, notifications, etc. for a node object\r\n     * @param nodeID a node ID number\r\n     * @param init Boolean whether we're in controller initialization or not\r\n     */\r\n    updateNode(nodeId, init) {\r\n        let node = this.nodesById[nodeId];\r\n\r\n        if (node) {\r\n            let alertNotifications = this.getAlertNotificationsByNodeId(nodeId);\r\n            node.hasAlert = alertNotifications.length > 0;\r\n            node.hasNewAlert = this.nodeHasNewAlert(alertNotifications);\r\n            let completionStatus = this.getNodeCompletionStatusByNodeId(nodeId);\r\n            node.hasWork = this.ProjectService.nodeHasWork(nodeId);\r\n            node.hasNewWork = completionStatus.hasNewWork;\r\n            node.isVisible = completionStatus.isVisible ? 1 : 0;\r\n            node.completionStatus = this.getNodeCompletionStatus(completionStatus);\r\n            node.score = this.getNodeScoreByNodeId(nodeId);\r\n            node.hasScore = node.score > -1;\r\n            node.maxScore = this.ProjectService.getMaxScoreForNode(nodeId);\r\n            if (node.maxScore > 0) {\r\n              node.hasMaxScore = true;\r\n              node.scorePct = node.score > -1 ? +((node.score / node.maxScore).toFixed(2)) : 0;\r\n            } else {\r\n              node.hasMaxScore = false;\r\n              node.scorePct = 0;\r\n            }\r\n            node.order = this.ProjectService.getOrderById(nodeId);\r\n            node.show = this.isNodeShown(nodeId);\r\n\r\n            if (!init) {\r\n                this.nodesById[nodeId] = angular.copy(node);\r\n            }\r\n        }\r\n    }\r\n\r\n    getAlertNotificationsByNodeId(nodeId) {\r\n        let args = {};\r\n        args.nodeId = nodeId;\r\n        args.toWorkgroupId = this.workgroupId;\r\n        return this.NotificationService.getAlertNotifications(args);\r\n    }\r\n\r\n    nodeHasNewAlert(alertNotifications) {\r\n        let newAlert = false;\r\n\r\n        let l = alertNotifications.length;\r\n        for (let i = 0; i < l; i++) {\r\n            let alert = alertNotifications[i];\r\n            if (!alert.timeDismissed) {\r\n                newAlert = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        return newAlert;\r\n    }\r\n\r\n    /**\r\n     * Returns an object with node completion status, latest work time, and latest annotation time\r\n     * for a workgroup for the current node\r\n     * @param nodeId a node ID number\r\n     * @returns Object with completion, latest work time, latest annotation time\r\n     */\r\n    getNodeCompletionStatusByNodeId(nodeId) {\r\n        let isCompleted = false;\r\n        let isVisible = false;\r\n\r\n        // TODO: store this info in the nodeStatus so we don't have to calculate every time?\r\n        let latestWorkTime = this.getLatestWorkTimeByNodeId(nodeId);\r\n\r\n        let latestAnnotationTime = this.getLatestAnnotationTimeByNodeId(nodeId);\r\n        let studentStatus = this.StudentStatusService.getStudentStatusForWorkgroupId(this.workgroupId);\r\n        if (studentStatus != null) {\r\n            let nodeStatus = studentStatus.nodeStatuses[nodeId];\r\n            if (nodeStatus) {\r\n                isVisible = nodeStatus.isVisible;\r\n                if (latestWorkTime) {\r\n                    // workgroup has at least one componentState for this node, so check if node is completed\r\n                    isCompleted = nodeStatus.isCompleted;\r\n                }\r\n\r\n                if (!this.ProjectService.nodeHasWork(nodeId)) {\r\n                    // the step does not generate any work so completion = visited\r\n                    isCompleted = nodeStatus.isVisited;\r\n                }\r\n            }\r\n        }\r\n\r\n        return {\r\n            isCompleted: isCompleted,\r\n            isVisible: isVisible,\r\n            latestWorkTime: latestWorkTime,\r\n            latestAnnotationTime: latestAnnotationTime\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Returns a numerical status value for a given completion status object depending on node completion\r\n     * Available status values are: 0 (not visited/no work; default), 1 (partially completed), 2 (completed)\r\n     * @param completionStatus Object\r\n     * @returns Integer status value\r\n     */\r\n    getNodeCompletionStatus(completionStatus) {\r\n        let hasWork = completionStatus.latestWorkTime !== null;\r\n        let isCompleted = completionStatus.isCompleted;\r\n        let isVisible = completionStatus.isVisible;\r\n\r\n        // TODO: store this info in the nodeStatus so we don't have to calculate every time (and can use more widely)?\r\n        let status = 0; // default\r\n\r\n        if (!isVisible) {\r\n            status = -1;\r\n        } else if (isCompleted) {\r\n            status = 2;\r\n        } else if (hasWork) {\r\n            status = 1;\r\n        }\r\n\r\n        return status;\r\n    }\r\n\r\n    getLatestWorkTimeByNodeId(nodeId) {\r\n        let time = null;\r\n        let componentStates = this.TeacherDataService.getComponentStatesByNodeId(nodeId);\r\n        let n = componentStates.length-1;\r\n\r\n        // loop through component states for this node, starting with most recent\r\n        for (let i = n; i > -1; i--) {\r\n            let componentState = componentStates[i];\r\n            if (componentState.workgroupId === this.workgroupId) {\r\n                // componentState is for given workgroupId\r\n                time = componentState.serverSaveTime;\r\n                break;\r\n            }\r\n        }\r\n\r\n        return time;\r\n    }\r\n\r\n    getLatestAnnotationTimeByNodeId(nodeId) {\r\n        let time = null;\r\n        let annotations = this.TeacherDataService.getAnnotationsByNodeId(nodeId);\r\n        let n = annotations.length-1;\r\n\r\n        // loop through annotations for this node, starting with most recent\r\n        for (let i = n; i > -1; i--) {\r\n            let annotation = annotations[i];\r\n            // TODO: support checking for annotations from shared teachers\r\n            if (annotation.toWorkgroupId === this.workgroupId && annotation.fromWorkgroupId === this.ConfigService.getWorkgroupId()) {\r\n                time = annotation.serverSaveTime;\r\n                break;\r\n            }\r\n        }\r\n\r\n        return time;\r\n    }\r\n\r\n    /**\r\n     * Returns the score for the current workgroup for a given nodeId\r\n     * @param nodeId a node ID number\r\n     * @returns Number score value (defaults to -1 if node has no score)\r\n     */\r\n    getNodeScoreByNodeId(nodeId) {\r\n        let score = this.AnnotationService.getScore(this.workgroupId, nodeId);\r\n        return (typeof score === 'number' ? score : -1);\r\n    }\r\n\r\n    /**\r\n     * Returns a numerical status value for a given completion status object depending on node completion\r\n     * Available status values are: 0 (not visited/no work; default), 1 (partially completed), 2 (completed)\r\n     * @param completionStatus Object\r\n     * @returns Integer status value\r\n     */\r\n    getWorkgroupCompletionStatus(completionStatus) {\r\n        let hasWork = completionStatus.latestWorkTime !== null;\r\n        let isCompleted = completionStatus.isCompleted;\r\n        let isVisible = completionStatus.isVisible;\r\n\r\n        // TODO: store this info in the nodeStatus so we don't have to calculate every time (and can use more widely)?\r\n        let status = 0; // default\r\n\r\n        if (!isVisible) {\r\n            status = -1;\r\n        } else if (isCompleted) {\r\n            status = 2;\r\n        } else if (hasWork) {\r\n            status = 1;\r\n        }\r\n\r\n        return status;\r\n    }\r\n\r\n    /**\r\n     * Get the student data for a specific part\r\n     * @param the componentId\r\n     * @param the nodeId id of node we're looking for\r\n     * @return the student data for the given component\r\n     */\r\n    getLatestComponentStateByNodeIdAndComponentId(nodeId,  componentId) {\r\n        var componentState = null;\r\n\r\n        if (nodeId != null && componentId != null) {\r\n            // get the latest component state for the component\r\n            componentState = this.TeacherDataService.getLatestComponentStateByWorkgroupIdNodeIdAndComponentId(this.workgroupId, nodeId, componentId);\r\n        }\r\n\r\n        return componentState;\r\n    }\r\n\r\n    /**\r\n     * Checks whether a node should be shown\r\n     * @param nodeId the node Id to look for\r\n     * @returns boolean whether the workgroup should be shown\r\n     */\r\n    isNodeShown(nodeId) {\r\n        let show = false;\r\n        let node = this.nodesById[nodeId];\r\n\r\n        if (node.isVisible && (node.hasWork || this.showNonWorkNodes)) {\r\n            let currentStep = this.TeacherDataService.getCurrentStep();\r\n            if (currentStep) {\r\n                // there is a currently selected step, so check if this one matches\r\n                if (currentStep.nodeId === parseInt(nodeId)) {\r\n                    show = true;\r\n                }\r\n            } else {\r\n                // there is no currently selected step, so show this one\r\n                show = true;\r\n            }\r\n        }\r\n\r\n        return show;\r\n    }\r\n\r\n    /**\r\n     * Gets and returns the total project score for the currently selected workgroup\r\n     * @return score object or null\r\n     */\r\n    getCurrentWorkgroupScore() {\r\n        return this.TeacherDataService.getTotalScoreByWorkgroupId(this.workgroupId);\r\n    }\r\n\r\n    setSort(value) {\r\n\r\n        switch (value) {\r\n            case 'step':\r\n                if (this.sort === 'step') {\r\n                    this.sort = '-step';\r\n                } else {\r\n                    this.sort = 'step';\r\n                }\r\n                break;\r\n            case 'status':\r\n                if (this.sort === 'status') {\r\n                    this.sort = '-status';\r\n                } else {\r\n                    this.sort = 'status';\r\n                }\r\n                break;\r\n            case 'score':\r\n                if (this.sort === 'score') {\r\n                    this.sort = '-score';\r\n                } else {\r\n                    this.sort = 'score';\r\n                }\r\n                break;\r\n        }\r\n\r\n        // update value in the teacher data service so we can persist across view instances and workgroup changes\r\n        this.TeacherDataService.studentGradingSort = this.sort;\r\n    }\r\n\r\n    getOrderBy() {\r\n        let orderBy = [];\r\n\r\n        switch (this.sort) {\r\n            case 'step':\r\n                orderBy = ['-isVisible', 'order'];\r\n                break;\r\n            case '-step':\r\n                orderBy = ['-isVisible', '-order'];\r\n                break;\r\n            case 'status':\r\n                orderBy = ['-isVisible', 'completionStatus', '-hasNewAlert', 'order'];\r\n                break;\r\n            case '-status':\r\n                orderBy = ['-isVisible', '-completionStatus', '-hasNewAlert', 'order'];\r\n                break;\r\n            case 'score':\r\n                orderBy = ['-isVisible', '-hasScore', '-hasMaxScore', 'scorePct', '-maxScore', 'score', 'order'];\r\n                break;\r\n            case '-score':\r\n                orderBy = ['-isVisible', '-hasScore', '-hasMaxScore', '-scorePct', '-maxScore', 'score', 'order'];\r\n                break;\r\n        }\r\n\r\n        return orderBy;\r\n    }\r\n\r\n    /**\r\n     * Expand all nodes to show student work\r\n     */\r\n    expandAll() {\r\n\r\n        // loop through all the workgroups\r\n        for (let i = 0; i < this.nodeIds.length; i++) {\r\n\r\n            // get a node id\r\n            let id = this.nodeIds[i];\r\n\r\n            // check if the node is currently in view\r\n            if (this.nodesInViewById[id]) {\r\n                // the node is currently in view so we will expand it\r\n                this.nodeVisibilityById[id] = true;\r\n            }\r\n        }\r\n\r\n        /*\r\n         * set the boolean flag to denote that we are currently expanding\r\n         * all the nodes\r\n         */\r\n        this.isExpandAll = true;\r\n    }\r\n\r\n    /**\r\n     * Collapse all nodes to hide student work\r\n     */\r\n    collapseAll() {\r\n        let n = this.nodeIds.length;\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            let id = this.nodeIds[i];\r\n            this.nodeVisibilityById[id] = false;\r\n        }\r\n\r\n        /*\r\n         * set the boolean flag to denote that we are not currently expanding\r\n         * all the nodes\r\n         */\r\n        this.isExpandAll = false;\r\n    }\r\n\r\n    onUpdateExpand(nodeId, value) {\r\n        this.nodeVisibilityById[nodeId] = value;\r\n    }\r\n\r\n    /**\r\n     * A node row has either come into view or gone out of view\r\n     * @param nodeId the node id that has come into view or gone out\r\n     * of view\r\n     * @param inview whether the row is in view or not\r\n     */\r\n    stepInView(nodeId, inview) {\r\n\r\n        // remember whether the node is in view or not\r\n        this.nodesInViewById[nodeId] = inview;\r\n\r\n        // if we're in expand all mode, expand node row if it's in view\r\n        if (this.isExpandAll) {\r\n            if (inview) {\r\n                this.nodeVisibilityById[nodeId] = true;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nStudentGradingController.$inject = [\r\n    '$filter',\r\n    '$mdDialog',\r\n    '$mdMedia',\r\n    '$scope',\r\n    '$state',\r\n    '$stateParams',\r\n    'orderByFilter',\r\n    'AnnotationService',\r\n    'ConfigService',\r\n    'NotificationService',\r\n    'ProjectService',\r\n    'StudentStatusService',\r\n    'TeacherDataService'\r\n];\r\n\r\nexport default StudentGradingController;\r\n"]}