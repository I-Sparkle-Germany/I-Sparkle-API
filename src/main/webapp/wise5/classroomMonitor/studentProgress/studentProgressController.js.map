{"version":3,"sources":["studentProgressController.es6"],"names":[],"mappings":"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","file":"studentProgressController.js","sourcesContent":["'use strict';\n\nclass StudentProgressController {\n\n    constructor($rootScope,\n                $scope,\n                $state,\n                ConfigService,\n                ProjectService,\n                StudentStatusService,\n                TeacherDataService,\n                TeacherWebSocketService) {\n        this.$rootScope = $rootScope;\n        this.$scope = $scope;\n        this.$state = $state;\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n        this.StudentStatusService = StudentStatusService;\n        this.TeacherDataService = TeacherDataService;\n        this.TeacherWebSocketService = TeacherWebSocketService;\n\n        this.workgroups = this.ConfigService.getClassmateUserInfos();\n\n        this.studentStatuses = this.StudentStatusService.getStudentStatuses();\n\n        this.maxScore = this.ProjectService.getMaxScore();\n\n        this.periods = [];\n\n        // create an option for all periods\n        var allPeriodOption = {\n            periodId: -1,\n            periodName: 'All'\n        };\n\n        this.periods.push(allPeriodOption);\n\n        this.periods = this.periods.concat(this.ConfigService.getPeriods());\n\n        // set the current period if it hasn't been set yet\n        if (this.getCurrentPeriod() == null) {\n            if (this.periods != null && this.periods.length > 0) {\n                // set it to the all periods option\n                this.setCurrentPeriod(this.periods[0]);\n            }\n        }\n\n        this.studentsOnline = this.TeacherWebSocketService.getStudentsOnline();\n\n        // listen for the studentsOnlineReceived event\n        this.$rootScope.$on('studentsOnlineReceived', (event, args) => {\n            this.studentsOnline = args.studentsOnline;\n        });\n\n        // listen for the studentStatusReceived event\n        this.$rootScope.$on('studentStatusReceived', angular.bind(this, function(event, args) {\n\n            // get the workgroup id\n            var studentStatus = args.studentStatus;\n            var workgroupId = studentStatus.workgroupId;\n\n            // update the time spent for the workgroup\n            this.updateTimeSpentForWorkgroupId(workgroupId);\n\n            // refresh the view\n            this.$scope.$apply();\n        }));\n\n        // how often to update the time spent values in the view\n        this.updateTimeSpentInterval = 10000;\n\n        // mapping of workgroup id to time spent\n        this.studentTimeSpent = {};\n\n        // update the time spent values in the view\n        this.updateTimeSpent();\n\n        // update the time spent values every x seconds\n        this.updateTimeSpentIntervalId = setInterval(angular.bind(this, function() {\n            // update the time spent values in the view\n            this.updateTimeSpent();\n\n            // refresh the view\n            this.$scope.$apply();\n        }), this.updateTimeSpentInterval);\n    }\n\n    getNewNodeVisits() {\n        return this.StudentStatusService.getNewNodeVisits();\n    };\n\n    getCurrentNodeForWorkgroupId(workgroupId) {\n        return this.StudentStatusService.getCurrentNodeTitleForWorkgroupId(workgroupId);\n    };\n\n    getStudentProjectCompletion(workgroupId) {\n        return this.StudentStatusService.getStudentProjectCompletion(workgroupId);\n    };\n\n    studentRowClicked(workgroup) {\n        var workgroupId = workgroup.workgroupId;\n\n        this.$state.go('root.studentGrading', {workgroupId: workgroupId});\n    };\n\n    isWorkgroupOnline(workgroupId) {\n        return this.studentsOnline.indexOf(workgroupId) != -1;\n    };\n\n    /**\n     * Set the current period\n     * @param period the period object\n     */\n    setCurrentPeriod(period) {\n        this.TeacherDataService.setCurrentPeriod(period);\n    };\n\n    /**\n     * Get the current period\n     */\n    getCurrentPeriod() {\n        return this.TeacherDataService.getCurrentPeriod();\n    };\n\n    getStudentTotalScore(workgroupId) {\n        return this.TeacherDataService.getTotalScoreByWorkgroupId(workgroupId);\n    }\n\n    /**\n     * Get the time spent for a workgroup\n     */\n    getStudentTimeSpent(workgroupId) {\n        var timeSpent = this.studentTimeSpent[workgroupId];\n        return timeSpent;\n    }\n\n    /**\n     * Update the time spent values in the view\n     */\n    updateTimeSpent() {\n        var studentsOnline = this.studentsOnline;\n\n        if (studentsOnline != null) {\n\n            // loop through all the workgroups that are online\n            for (var s = 0; s < studentsOnline.length; s++) {\n                var workgroupId = studentsOnline[s];\n\n                if (workgroupId != null) {\n                    // update the time spent for the workgroup\n                    this.updateTimeSpentForWorkgroupId(workgroupId);\n                }\n            }\n        }\n    }\n\n    /**\n     * Update the time spent for the workgroup\n     * @workgroupId the workgroup id\n     */\n    updateTimeSpentForWorkgroupId(workgroupId) {\n\n        if (workgroupId != null) {\n            // get the current client timestamp\n            var currentClientTimestamp = new Date().getTime();\n\n            // get the student status\n            var studentStatus = this.StudentStatusService.getStudentStatusForWorkgroupId(workgroupId);\n\n            if (studentStatus != null) {\n\n                // get the time the student status was posted to the server\n                var postTimestamp = studentStatus.postTimestamp;\n\n                /*\n                 * convert the current client timestamp to a server timestamp\n                 * this is requied in cases where the client and server clocks\n                 * are not synchronized\n                 */\n                var currentServerTimestamp = this.ConfigService.convertToServerTimestamp(currentClientTimestamp);\n\n                // get the amount of time the student has been on the step\n                var timeSpent = currentServerTimestamp - postTimestamp;\n\n                // get the total amount of seconds the student has been on the step\n                var totalSeconds = Math.floor(timeSpent / 1000);\n\n                // get the hours, minutes, and seconds\n                var hours = Math.floor((totalSeconds % 86400) / 3600);\n                var minutes = Math.floor(((totalSeconds % 86400) % 3600) / 60);\n                var seconds = totalSeconds % 60;\n\n                if (hours < 0) {\n                    hours = 0;\n                }\n\n                if (minutes < 0) {\n                    minutes = 0;\n                }\n\n                if (seconds < 0) {\n                    seconds = 0;\n                }\n\n                var timeSpentText = '';\n\n                if (hours > 0) {\n                    timeSpentText += (hours + ':');\n                }\n\n                if (hours > 0) {\n                    // there are hours\n\n                    if (minutes == 0) {\n                        // fill with zeroes\n                        timeSpentText += '00:';\n                    } else if (minutes > 0 && minutes < 10) {\n                        // add a leading zero\n                        timeSpentText += '0' + minutes + ':';\n                    } else {\n                        timeSpentText += minutes + ':';\n                    }\n                } else {\n                    // there are no hours\n\n                    timeSpentText += minutes + ':';\n                }\n\n                if (seconds == 0) {\n                    // fill with zeroes\n                    timeSpentText += '00';\n                } else if (seconds > 0 && seconds < 10) {\n                    // add a leading zero\n                    timeSpentText += ('0' + seconds);\n                } else {\n                    timeSpentText += seconds;\n                }\n\n                // update the mapping of workgroup id to time spent\n                this.studentTimeSpent[workgroupId] = timeSpentText;\n            }\n        }\n    }\n}\n\nStudentProgressController.$inject = [\n    '$rootScope',\n    '$scope',\n    '$state',\n    'ConfigService',\n    'ProjectService',\n    'StudentStatusService',\n    'TeacherDataService',\n    'TeacherWebSocketService'\n];\n\nexport default StudentProgressController;\n"]}