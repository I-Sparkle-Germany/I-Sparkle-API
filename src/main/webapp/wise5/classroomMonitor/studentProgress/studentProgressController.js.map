{"version":3,"sources":["studentProgressController.es6"],"names":["StudentProgressController","$rootScope","$scope","$state","ConfigService","ProjectService","StudentStatusService","TeacherDataService","TeacherWebSocketService","teacherWorkgroupId","getWorkgroupId","sort","studentProgressSort","setCurrentWorkgroup","canViewStudentNames","canGradeStudentWork","role","getTeacherRole","isSwitchedUser","studentsOnline","getStudentsOnline","students","initializeStudents","studentStatuses","getStudentStatuses","maxScore","getMaxScore","periods","allPeriodOption","periodId","periodName","push","concat","getPeriods","getCurrentPeriod","length","setCurrentPeriod","$on","event","args","$apply","studentStatus","workgroupId","updateTimeSpentForWorkgroupId","data","indexOfWorkgroupId","indexOf","splice","currentWorkgroup","updateTimeSpentInterval","studentTimeSpent","updateTimeSpent","updateTimeSpentIntervalId","setInterval","context","nodeId","componentId","componentType","category","saveEvent","getCurrentNodePositionAndNodeTitleForWorkgroupId","getStudentProjectCompletion","workgroup","show","currentPeriod","displayNames","period","$broadcast","getTotalScoreByWorkgroupId","timeSpent","s","currentClientTimestamp","Date","getTime","getStudentStatusForWorkgroupId","postTimestamp","currentServerTimestamp","convertToServerTimestamp","totalSeconds","Math","floor","hours","minutes","seconds","timeSpentText","i","student","id","workgroups","getClassmateUserInfos","x","isOnline","isWorkgroupOnline","userName","getDisplayUserNamesByWorkgroupId","split","userIds","displayName","names","user","userId","online","location","getCurrentNodeForWorkgroupId","getStudentTimeSpent","completion","score","getStudentTotalScore","go","value","nodeGradingSort","orderBy","$inject"],"mappings":"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","file":"studentProgressController.js","sourcesContent":["'use strict';\n\nclass StudentProgressController {\n\n    constructor($rootScope,\n                $scope,\n                $state,\n                ConfigService,\n                ProjectService,\n                StudentStatusService,\n                TeacherDataService,\n                TeacherWebSocketService) {\n        this.$rootScope = $rootScope;\n        this.$scope = $scope;\n        this.$state = $state;\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n        this.StudentStatusService = StudentStatusService;\n        this.TeacherDataService = TeacherDataService;\n        this.TeacherWebSocketService = TeacherWebSocketService;\n\n        this.teacherWorkgroupId = this.ConfigService.getWorkgroupId();\n\n        // get the current sort order\n        this.sort = this.TeacherDataService.studentProgressSort;\n\n        // initialize the current workgroup\n        this.TeacherDataService.setCurrentWorkgroup(null);\n\n        this.canViewStudentNames = true;\n        this.canGradeStudentWork = true;\n\n        // get the role of the teacher for the run e.g. 'owner', 'write', 'read'\n        var role = this.ConfigService.getTeacherRole(this.teacherWorkgroupId);\n\n        if (role === 'owner') {\n            // the teacher is the owner of the run and has full access\n            this.canViewStudentNames = true;\n            this.canGradeStudentWork = true;\n        } else if (role === 'write') {\n            // the teacher is a shared teacher that can grade the student work\n            this.canViewStudentNames = true;\n            this.canGradeStudentWork = true;\n        } else if (role === 'read') {\n            // the teacher is a shared teacher that can only view the student work\n            this.canViewStudentNames = false;\n            this.canGradeStudentWork = false;\n        }\n\n        // a switched user (admin/researcher user impersonating a teacher) should not be able to view/grade\n        if (this.ConfigService.isSwitchedUser()) {\n            this.canViewStudentNames = false;\n            this.canGradeStudentWork = false;\n        }\n\n        this.studentsOnline = this.TeacherWebSocketService.getStudentsOnline();\n\n        this.students = [];\n        this.initializeStudents();\n\n        this.studentStatuses = this.StudentStatusService.getStudentStatuses();\n\n        this.maxScore = this.ProjectService.getMaxScore();\n        if (this.maxScore === null) {\n            this.maxScore = 0;\n        }\n\n        this.periods = [];\n\n        // create an option for all periods\n        var allPeriodOption = {\n            periodId: -1,\n            periodName: 'All'\n        };\n\n        this.periods.push(allPeriodOption);\n\n        this.periods = this.periods.concat(this.ConfigService.getPeriods());\n\n        // set the current period if it hasn't been set yet\n        if (this.getCurrentPeriod() == null) {\n            if (this.periods != null && this.periods.length > 0) {\n                // set it to the all periods option\n                this.setCurrentPeriod(this.periods[0]);\n            }\n        }\n\n        // listen for the studentsOnlineReceived event\n        this.$rootScope.$on('studentsOnlineReceived', (event, args) => {\n            this.studentsOnline = args.studentsOnline;\n\n            // update the students\n            this.initializeStudents();\n\n            // refresh the view\n            this.$scope.$apply();\n        });\n\n        // listen for the studentStatusReceived event\n        this.$rootScope.$on('studentStatusReceived', (event, args) => {\n            // get the workgroup id\n            let studentStatus = args.studentStatus;\n            let workgroupId = studentStatus.workgroupId;\n\n            // update the time spent for the workgroup\n            this.updateTimeSpentForWorkgroupId(workgroupId);\n\n            // update the students\n            this.initializeStudents();\n\n            // refresh the view\n            this.$scope.$apply();\n        });\n\n        // listen for the studentDisconnected event\n        this.$rootScope.$on('studentDisconnected', (event, args) => {\n            var data = args.data;\n            var workgroupId = data.workgroupId;\n\n            var studentsOnline = this.studentsOnline;\n\n            var indexOfWorkgroupId = studentsOnline.indexOf(workgroupId);\n\n            if (indexOfWorkgroupId != -1) {\n                // remove the workgroup from the students online list\n                studentsOnline.splice(indexOfWorkgroupId, 1);\n\n                // update the students\n                this.initializeStudents();\n\n                // refresh the view\n                this.$scope.$apply();\n            }\n        });\n\n        // listen for the currentWorkgroupChanged event\n        this.$scope.$on('currentWorkgroupChanged', (event, args) => {\n            this.currentWorkgroup = args.currentWorkgroup;\n        });\n\n        // how often to update the time spent values in the view\n        this.updateTimeSpentInterval = 10000;\n\n        // mapping of workgroup id to time spent\n        this.studentTimeSpent = {};\n\n        // update the time spent values in the view\n        this.updateTimeSpent();\n\n        // update the time spent values every x seconds\n        this.updateTimeSpentIntervalId = setInterval(() => {\n            // update the time spent values in the view\n            this.updateTimeSpent();\n\n            // refresh the view\n            this.$scope.$apply();\n        }, this.updateTimeSpentInterval);\n\n        // save event when student progress view is displayed\n        let context = \"ClassroomMonitor\", nodeId = null, componentId = null, componentType = null,\n            category = \"Navigation\", event = \"studentProgressViewDisplayed\", data = {};\n        this.TeacherDataService.saveEvent(context, nodeId, componentId, componentType, category, event, data);\n    }\n\n    getCurrentNodeForWorkgroupId(workgroupId) {\n        return this.StudentStatusService.getCurrentNodePositionAndNodeTitleForWorkgroupId(workgroupId);\n    };\n\n    getStudentProjectCompletion(workgroupId) {\n        return this.StudentStatusService.getStudentProjectCompletion(workgroupId);\n    };\n\n    isWorkgroupOnline(workgroupId) {\n        return this.studentsOnline.indexOf(workgroupId) != -1;\n    };\n\n    isWorkgroupShown(workgroup) {\n        let show = false;\n\n        let currentPeriod = this.getCurrentPeriod().periodId;\n\n        if (currentPeriod === -1 || workgroup.periodId === this.getCurrentPeriod().periodId) {\n            if (this.currentWorkgroup) {\n                if (workgroup.displayNames === this.currentWorkgroup.displayNames) {\n                    show = true;\n                }\n            } else {\n                show = true;\n            }\n        }\n\n        return show;\n    }\n\n    /**\n     * Set the current period\n     * @param period the period object\n     */\n    setCurrentPeriod(period) {\n        this.TeacherDataService.setCurrentPeriod(period);\n        this.$rootScope.$broadcast('periodChanged', {period: period});\n    };\n\n    /**\n     * Get the current period\n     */\n    getCurrentPeriod() {\n        return this.TeacherDataService.getCurrentPeriod();\n    };\n\n    getStudentTotalScore(workgroupId) {\n        return this.TeacherDataService.getTotalScoreByWorkgroupId(workgroupId);\n    }\n\n    /**\n     * Get the time spent for a workgroup\n     */\n    getStudentTimeSpent(workgroupId) {\n        let timeSpent = null;\n\n        if (this.studentTimeSpent) {\n            timeSpent = this.studentTimeSpent[workgroupId];\n        }\n\n        return timeSpent;\n    }\n\n    /**\n     * Update the time spent values in the view\n     */\n    updateTimeSpent() {\n        var studentsOnline = this.studentsOnline;\n\n        if (studentsOnline != null) {\n\n            // loop through all the workgroups that are online\n            for (var s = 0; s < studentsOnline.length; s++) {\n                var workgroupId = studentsOnline[s];\n\n                if (workgroupId != null) {\n                    // update the time spent for the workgroup\n                    this.updateTimeSpentForWorkgroupId(workgroupId);\n                }\n            }\n        }\n    }\n\n    /**\n     * Update the time spent for the workgroup\n     * @workgroupId the workgroup id\n     */\n    updateTimeSpentForWorkgroupId(workgroupId) {\n\n        if (workgroupId != null) {\n            // get the current client timestamp\n            var currentClientTimestamp = new Date().getTime();\n\n            // get the student status\n            var studentStatus = this.StudentStatusService.getStudentStatusForWorkgroupId(workgroupId);\n\n            if (studentStatus != null) {\n\n                // get the time the student status was posted to the server\n                var postTimestamp = studentStatus.postTimestamp;\n\n                /*\n                 * convert the current client timestamp to a server timestamp\n                 * this is requied in cases where the client and server clocks\n                 * are not synchronized\n                 */\n                var currentServerTimestamp = this.ConfigService.convertToServerTimestamp(currentClientTimestamp);\n\n                // get the amount of time the student has been on the step\n                var timeSpent = currentServerTimestamp - postTimestamp;\n\n                // get the total amount of seconds the student has been on the step\n                var totalSeconds = Math.floor(timeSpent / 1000);\n\n                // get the hours, minutes, and seconds\n                var hours = Math.floor((totalSeconds % 86400) / 3600);\n                var minutes = Math.floor(((totalSeconds % 86400) % 3600) / 60);\n                var seconds = totalSeconds % 60;\n\n                if (hours < 0) {\n                    hours = 0;\n                }\n\n                if (minutes < 0) {\n                    minutes = 0;\n                }\n\n                if (seconds < 0) {\n                    seconds = 0;\n                }\n\n                var timeSpentText = '';\n\n                if (hours > 0) {\n                    timeSpentText += (hours + ':');\n                }\n\n                if (hours > 0) {\n                    // there are hours\n\n                    if (minutes == 0) {\n                        // fill with zeroes\n                        timeSpentText += '00:';\n                    } else if (minutes > 0 && minutes < 10) {\n                        // add a leading zero\n                        timeSpentText += '0' + minutes + ':';\n                    } else {\n                        timeSpentText += minutes + ':';\n                    }\n                } else {\n                    // there are no hours\n\n                    timeSpentText += minutes + ':';\n                }\n\n                if (seconds == 0) {\n                    // fill with zeroes\n                    timeSpentText += '00';\n                } else if (seconds > 0 && seconds < 10) {\n                    // add a leading zero\n                    timeSpentText += ('0' + seconds);\n                } else {\n                    timeSpentText += seconds;\n                }\n\n                // update the mapping of workgroup id to time spent\n                //this.studentTimeSpent[workgroupId] = timeSpentText;\n\n                // update the timeSpent for the students with the matching workgroupID\n                for (let i = 0; i < this.students.length; i++) {\n                    let student = this.students[i];\n                    let id = student.workgroupId;\n\n                    if (workgroupId === id) {\n                        student.timeSpent = timeSpentText;\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Set up the array of students in the run. Split workgroups into\n     * individual student objects.\n     */\n    initializeStudents() {\n        let students = [];\n\n        // get the workgroups\n        let workgroups = this.ConfigService.getClassmateUserInfos();\n\n        // loop through all the workgroups\n        for (let x = 0; x < workgroups.length; x++) {\n            let workgroup = workgroups[x];\n\n            if (workgroup != null) {\n                let workgroupId = workgroup.workgroupId;\n                let isOnline = this.isWorkgroupOnline(workgroupId);\n\n                let userName = workgroup.userName;\n                let displayNames = this.ConfigService.getDisplayUserNamesByWorkgroupId(workgroupId).split(', ');\n                let userIds = workgroup.userIds;\n\n                for (let i = 0; i < userIds.length; i++) {\n                    let id = userIds[i];\n                    let displayName = '';\n\n                    if (this.canViewStudentNames) {\n                        // put user display name in 'lastName, firstName' order\n                        let names = displayNames[i].split(' ');\n                        displayName = names[1] + ', ' + names[0];\n                    } else {\n                        displayName = 'Student ' + id;\n                    }\n\n                    let user = {\n                        userId: id,\n                        periodId: workgroup.periodId,\n                        periodName: workgroup.periodName,\n                        workgroupId: workgroup.workgroupId,\n                        displayNames: displayName,\n                        userName: displayName,\n                        online: isOnline,\n                        location: this.getCurrentNodeForWorkgroupId(workgroup.workgroupId),\n                        timeSpent: this.getStudentTimeSpent(workgroup.workgroupId),\n                        completion: this.getStudentProjectCompletion(workgroup.workgroupId),\n                        score: this.getStudentTotalScore(workgroup.workgroupId)\n                    };\n                    students.push(user);\n                }\n\n            }\n        }\n\n        this.students = students;\n    }\n\n    showWorkgroupProjectView(workgroup) {\n        this.TeacherDataService.setCurrentWorkgroup(workgroup);\n        this.$state.go('root.nodeProgress');\n    }\n\n    setSort(value) {\n        if (this.sort === value) {\n            this.sort = '-' + value;\n        } else {\n            this.sort = value;\n        }\n\n        // update value in the teacher data service so we can persist across views\n        this.TeacherDataService.nodeGradingSort = this.sort;\n    }\n\n    getOrderBy() {\n        let orderBy = [];\n\n        switch (this.sort) {\n            case 'team':\n                orderBy = ['workgroupId', 'userName'];\n                break;\n            case '-team':\n                orderBy = ['-workgroupId', 'userName'];\n                break;\n            case 'student':\n                orderBy = ['userName', 'workgroupId'];\n                break;\n            case '-student':\n                orderBy = ['-userName', 'workgroupId'];\n                break;\n            case 'score':\n                orderBy = ['score', 'userName'];\n                break;\n            case '-score':\n                orderBy = ['-score', 'userName'];\n                break;\n            case 'completion':\n                orderBy = ['completion', 'userName'];\n                break;\n            case '-completion':\n                orderBy = ['-completion', 'userName'];\n                break;\n            case 'location':\n                orderBy = ['location', 'userName'];\n                break;\n            case '-location':\n                orderBy = ['-location', 'userName'];\n                break;\n            case 'time':\n                orderBy = ['-online', '-timeSpent', 'userName'];\n                break;\n            case '-time':\n                orderBy = ['-online', 'timeSpent', 'userName'];\n                break;\n            case 'online':\n                orderBy = ['online', 'userName'];\n                break;\n            case '-online':\n                orderBy = ['-online', 'userName'];\n                break;\n        }\n\n        return orderBy;\n    }\n}\n\nStudentProgressController.$inject = [\n    '$rootScope',\n    '$scope',\n    '$state',\n    'ConfigService',\n    'ProjectService',\n    'StudentStatusService',\n    'TeacherDataService',\n    'TeacherWebSocketService'\n];\n\nexport default StudentProgressController;\n"]}