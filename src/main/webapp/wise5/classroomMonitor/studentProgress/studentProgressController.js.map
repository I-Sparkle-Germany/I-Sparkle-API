{"version":3,"sources":["studentProgressController.es6"],"names":["StudentProgressController","$rootScope","$scope","$state","ConfigService","ProjectService","StudentStatusService","TeacherDataService","TeacherWebSocketService","teacherWorkgroupId","getWorkgroupId","sort","studentProgressSort","setCurrentWorkgroup","permissions","getPermissions","studentsOnline","getStudentsOnline","students","initializeStudents","periods","allPeriodOption","periodId","periodName","push","concat","getPeriods","getCurrentPeriod","length","setCurrentPeriod","$on","event","args","studentStatus","workgroupId","updateTimeSpentForWorkgroupId","updateStudents","data","indexOfWorkgroupId","indexOf","splice","currentWorkgroup","updateTimeSpentInterval","studentTimeSpent","updateTimeSpent","updateTimeSpentIntervalId","setInterval","$apply","context","nodeId","componentId","componentType","category","saveEvent","getCurrentNodePositionAndNodeTitleForWorkgroupId","getStudentProjectCompletion","workgroup","show","currentPeriod","displayNames","period","$broadcast","getTotalScoreByWorkgroupId","timeSpent","s","currentClientTimestamp","Date","getTime","getStudentStatusForWorkgroupId","postTimestamp","currentServerTimestamp","convertToServerTimestamp","totalSeconds","Math","floor","hours","minutes","seconds","timeSpentText","i","student","id","workgroups","getClassmateUserInfos","x","isOnline","isWorkgroupOnline","userName","getDisplayUserNamesByWorkgroupId","split","userIds","maxScore","getMaxScoreForWorkgroupId","displayName","canViewStudentNames","names","user","userId","online","location","getCurrentNodeForWorkgroupId","getStudentTimeSpent","completion","score","getStudentTotalScore","go","value","nodeGradingSort","orderBy","$inject"],"mappings":"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","file":"studentProgressController.js","sourcesContent":["'use strict';\r\n\r\nclass StudentProgressController {\r\n\r\n    constructor($rootScope,\r\n                $scope,\r\n                $state,\r\n                ConfigService,\r\n                ProjectService,\r\n                StudentStatusService,\r\n                TeacherDataService,\r\n                TeacherWebSocketService) {\r\n        this.$rootScope = $rootScope;\r\n        this.$scope = $scope;\r\n        this.$state = $state;\r\n        this.ConfigService = ConfigService;\r\n        this.ProjectService = ProjectService;\r\n        this.StudentStatusService = StudentStatusService;\r\n        this.TeacherDataService = TeacherDataService;\r\n        this.TeacherWebSocketService = TeacherWebSocketService;\r\n\r\n        this.teacherWorkgroupId = this.ConfigService.getWorkgroupId();\r\n\r\n        // get the current sort order\r\n        this.sort = this.TeacherDataService.studentProgressSort;\r\n\r\n        // initialize the current workgroup\r\n        this.TeacherDataService.setCurrentWorkgroup(null);\r\n\r\n        // get the teacher permissions\r\n        this.permissions = this.ConfigService.getPermissions();\r\n\r\n        this.studentsOnline = this.TeacherWebSocketService.getStudentsOnline();\r\n\r\n        this.students = [];\r\n        this.initializeStudents();\r\n\r\n        this.periods = [];\r\n\r\n        // create an option for all periods\r\n        var allPeriodOption = {\r\n            periodId: -1,\r\n            periodName: 'All'\r\n        };\r\n\r\n        this.periods.push(allPeriodOption);\r\n\r\n        this.periods = this.periods.concat(this.ConfigService.getPeriods());\r\n\r\n        // set the current period if it hasn't been set yet\r\n        if (this.getCurrentPeriod() == null) {\r\n            if (this.periods != null && this.periods.length > 0) {\r\n                // set it to the all periods option\r\n                this.setCurrentPeriod(this.periods[0]);\r\n            }\r\n        }\r\n\r\n        // listen for the studentsOnlineReceived event\r\n        this.$rootScope.$on('studentsOnlineReceived', (event, args) => {\r\n            this.studentsOnline = args.studentsOnline;\r\n\r\n            // update the students\r\n            this.initializeStudents();\r\n        });\r\n\r\n        // listen for the studentStatusReceived event\r\n        this.$rootScope.$on('studentStatusReceived', (event, args) => {\r\n            // get the workgroup id\r\n            let studentStatus = args.studentStatus;\r\n            let workgroupId = studentStatus.workgroupId;\r\n\r\n            // update the time spent for the workgroup\r\n            this.updateTimeSpentForWorkgroupId(workgroupId);\r\n\r\n            // update students in the workgroup\r\n            this.updateStudents(workgroupId);\r\n        });\r\n\r\n        // listen for the studentDisconnected event\r\n        this.$rootScope.$on('studentDisconnected', (event, args) => {\r\n            var data = args.data;\r\n            var workgroupId = data.workgroupId;\r\n\r\n            var studentsOnline = this.studentsOnline;\r\n\r\n            var indexOfWorkgroupId = studentsOnline.indexOf(workgroupId);\r\n\r\n            if (indexOfWorkgroupId != -1) {\r\n                // remove the workgroup from the students online list\r\n                studentsOnline.splice(indexOfWorkgroupId, 1);\r\n\r\n                // update students in the workgroup\r\n                this.updateStudents(workgroupId);\r\n            }\r\n        });\r\n\r\n        // listen for the currentWorkgroupChanged event\r\n        this.$scope.$on('currentWorkgroupChanged', (event, args) => {\r\n            this.currentWorkgroup = args.currentWorkgroup;\r\n        });\r\n\r\n        // how often to update the time spent values in the view\r\n        this.updateTimeSpentInterval = 10000;\r\n\r\n        // mapping of workgroup id to time spent\r\n        this.studentTimeSpent = {};\r\n\r\n        // update the time spent values in the view\r\n        this.updateTimeSpent();\r\n\r\n        // update the time spent values every x seconds\r\n        this.updateTimeSpentIntervalId = setInterval(() => {\r\n            // update the time spent values in the view\r\n            this.updateTimeSpent();\r\n\r\n            // refresh the view\r\n            this.$scope.$apply();\r\n        }, this.updateTimeSpentInterval);\r\n\r\n        // save event when student progress view is displayed\r\n        let context = \"ClassroomMonitor\", nodeId = null, componentId = null, componentType = null,\r\n            category = \"Navigation\", event = \"studentProgressViewDisplayed\", data = {};\r\n        this.TeacherDataService.saveEvent(context, nodeId, componentId, componentType, category, event, data);\r\n    }\r\n\r\n    getCurrentNodeForWorkgroupId(workgroupId) {\r\n        return this.StudentStatusService.getCurrentNodePositionAndNodeTitleForWorkgroupId(workgroupId);\r\n    };\r\n\r\n    /**\r\n     * Get project completion data for the given workgroup (only include nodes\r\n     * with student work)\r\n     * @param workgroupId the workgroup id\r\n     * @return object with completed, total, and percent completed (integer\r\n     * between 0 and 100)\r\n     */\r\n    getStudentProjectCompletion(workgroupId) {\r\n        return this.StudentStatusService.getStudentProjectCompletion(workgroupId, true);\r\n    };\r\n\r\n    isWorkgroupOnline(workgroupId) {\r\n        return this.studentsOnline.indexOf(workgroupId) != -1;\r\n    };\r\n\r\n    isWorkgroupShown(workgroup) {\r\n        let show = false;\r\n\r\n        let currentPeriod = this.getCurrentPeriod().periodId;\r\n\r\n        if (currentPeriod === -1 || workgroup.periodId === this.getCurrentPeriod().periodId) {\r\n            if (this.currentWorkgroup) {\r\n                if (workgroup.displayNames === this.currentWorkgroup.displayNames) {\r\n                    show = true;\r\n                }\r\n            } else {\r\n                show = true;\r\n            }\r\n        }\r\n\r\n        return show;\r\n    }\r\n\r\n    /**\r\n     * Set the current period\r\n     * @param period the period object\r\n     */\r\n    setCurrentPeriod(period) {\r\n        this.TeacherDataService.setCurrentPeriod(period);\r\n        this.$rootScope.$broadcast('periodChanged', {period: period});\r\n    };\r\n\r\n    /**\r\n     * Get the current period\r\n     */\r\n    getCurrentPeriod() {\r\n        return this.TeacherDataService.getCurrentPeriod();\r\n    };\r\n\r\n    getStudentTotalScore(workgroupId) {\r\n        return this.TeacherDataService.getTotalScoreByWorkgroupId(workgroupId);\r\n    }\r\n\r\n    /**\r\n     * Get the time spent for a workgroup\r\n     */\r\n    getStudentTimeSpent(workgroupId) {\r\n        let timeSpent = null;\r\n\r\n        if (this.studentTimeSpent) {\r\n            timeSpent = this.studentTimeSpent[workgroupId];\r\n        }\r\n\r\n        return timeSpent;\r\n    }\r\n\r\n    /**\r\n     * Update the time spent values in the view\r\n     */\r\n    updateTimeSpent() {\r\n        var studentsOnline = this.studentsOnline;\r\n\r\n        if (studentsOnline != null) {\r\n\r\n            // loop through all the workgroups that are online\r\n            for (var s = 0; s < studentsOnline.length; s++) {\r\n                var workgroupId = studentsOnline[s];\r\n\r\n                if (workgroupId != null) {\r\n                    // update the time spent for the workgroup\r\n                    this.updateTimeSpentForWorkgroupId(workgroupId);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update the time spent for the workgroup\r\n     * @workgroupId the workgroup id\r\n     */\r\n    updateTimeSpentForWorkgroupId(workgroupId) {\r\n\r\n        if (workgroupId != null) {\r\n            // get the current client timestamp\r\n            var currentClientTimestamp = new Date().getTime();\r\n\r\n            // get the student status\r\n            var studentStatus = this.StudentStatusService.getStudentStatusForWorkgroupId(workgroupId);\r\n\r\n            if (studentStatus != null) {\r\n\r\n                // get the time the student status was posted to the server\r\n                var postTimestamp = studentStatus.postTimestamp;\r\n\r\n                /*\r\n                 * convert the current client timestamp to a server timestamp\r\n                 * this is requied in cases where the client and server clocks\r\n                 * are not synchronized\r\n                 */\r\n                var currentServerTimestamp = this.ConfigService.convertToServerTimestamp(currentClientTimestamp);\r\n\r\n                // get the amount of time the student has been on the step\r\n                var timeSpent = currentServerTimestamp - postTimestamp;\r\n\r\n                // get the total amount of seconds the student has been on the step\r\n                var totalSeconds = Math.floor(timeSpent / 1000);\r\n\r\n                // get the hours, minutes, and seconds\r\n                var hours = Math.floor((totalSeconds % 86400) / 3600);\r\n                var minutes = Math.floor(((totalSeconds % 86400) % 3600) / 60);\r\n                var seconds = totalSeconds % 60;\r\n\r\n                if (hours < 0) {\r\n                    hours = 0;\r\n                }\r\n\r\n                if (minutes < 0) {\r\n                    minutes = 0;\r\n                }\r\n\r\n                if (seconds < 0) {\r\n                    seconds = 0;\r\n                }\r\n\r\n                var timeSpentText = '';\r\n\r\n                if (hours > 0) {\r\n                    timeSpentText += (hours + ':');\r\n                }\r\n\r\n                if (hours > 0) {\r\n                    // there are hours\r\n\r\n                    if (minutes == 0) {\r\n                        // fill with zeroes\r\n                        timeSpentText += '00:';\r\n                    } else if (minutes > 0 && minutes < 10) {\r\n                        // add a leading zero\r\n                        timeSpentText += '0' + minutes + ':';\r\n                    } else {\r\n                        timeSpentText += minutes + ':';\r\n                    }\r\n                } else {\r\n                    // there are no hours\r\n\r\n                    timeSpentText += minutes + ':';\r\n                }\r\n\r\n                if (seconds == 0) {\r\n                    // fill with zeroes\r\n                    timeSpentText += '00';\r\n                } else if (seconds > 0 && seconds < 10) {\r\n                    // add a leading zero\r\n                    timeSpentText += ('0' + seconds);\r\n                } else {\r\n                    timeSpentText += seconds;\r\n                }\r\n\r\n                // update the mapping of workgroup id to time spent\r\n                //this.studentTimeSpent[workgroupId] = timeSpentText;\r\n\r\n                // update the timeSpent for the students with the matching workgroupID\r\n                for (let i = 0; i < this.students.length; i++) {\r\n                    let student = this.students[i];\r\n                    let id = student.workgroupId;\r\n\r\n                    if (workgroupId === id) {\r\n                        student.timeSpent = timeSpentText;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set up the array of students in the run. Split workgroups into\r\n     * individual student objects.\r\n     */\r\n    initializeStudents() {\r\n        let students = [];\r\n\r\n        // get the workgroups\r\n        let workgroups = this.ConfigService.getClassmateUserInfos();\r\n\r\n        // loop through all the workgroups\r\n        for (let x = 0; x < workgroups.length; x++) {\r\n            let workgroup = workgroups[x];\r\n\r\n            if (workgroup != null) {\r\n                let workgroupId = workgroup.workgroupId;\r\n                let isOnline = this.isWorkgroupOnline(workgroupId);\r\n\r\n                let userName = workgroup.userName;\r\n                let displayNames = this.ConfigService.getDisplayUserNamesByWorkgroupId(workgroupId).split(', ');\r\n                let userIds = workgroup.userIds;\r\n                let maxScore = this.StudentStatusService.getMaxScoreForWorkgroupId(workgroupId);\r\n                maxScore = maxScore ? maxScore : 0;\r\n\r\n                for (let i = 0; i < userIds.length; i++) {\r\n                    let id = userIds[i];\r\n                    let displayName = '';\r\n\r\n                    if (this.permissions.canViewStudentNames) {\r\n                        // put user display name in 'lastName, firstName' order\r\n                        let names = displayNames[i].split(' ');\r\n                        displayName = names[1] + ', ' + names[0];\r\n                    } else {\r\n                        displayName = id;\r\n                    }\r\n\r\n                    let user = {\r\n                        userId: id,\r\n                        periodId: workgroup.periodId,\r\n                        periodName: workgroup.periodName,\r\n                        workgroupId: workgroupId,\r\n                        displayNames: displayName,\r\n                        userName: displayName,\r\n                        online: isOnline,\r\n                        location: this.getCurrentNodeForWorkgroupId(workgroupId),\r\n                        timeSpent: this.getStudentTimeSpent(workgroupId),\r\n                        completion: this.getStudentProjectCompletion(workgroupId),\r\n                        score: this.getStudentTotalScore(workgroupId),\r\n                        maxScore: maxScore\r\n                    };\r\n                    students.push(user);\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        this.students = students;\r\n    }\r\n\r\n    /**\r\n     * Update student progress data for students with the given workgroup id\r\n     * @param workgroupId\r\n     */\r\n    updateStudents(workgroupId) {\r\n        let isOnline = this.isWorkgroupOnline(workgroupId);\r\n        let location = this.getCurrentNodeForWorkgroupId(workgroupId);\r\n        let timeSpent = this.getStudentTimeSpent(workgroupId);\r\n        let completion = this.getStudentProjectCompletion(workgroupId);\r\n        let score = this.getStudentTotalScore(workgroupId);\r\n        let maxScore = this.StudentStatusService.getMaxScoreForWorkgroupId(workgroupId);\r\n        maxScore = maxScore ? maxScore : 0;\r\n\r\n        for (let i = 0; i < this.students.length; i++) {\r\n            let student = this.students[i];\r\n\r\n            if (student.workgroupId === workgroupId) {\r\n                student.isOnline = isOnline;\r\n                student.location = location;\r\n                student.timeSpent = timeSpent;\r\n                student.completion = completion;\r\n                student.score = score;\r\n                student.maxScore = maxScore;\r\n            }\r\n        }\r\n    }\r\n\r\n    showStudentGradingView(workgroup) {\r\n        this.$state.go('root.student', {workgroupId: workgroup.workgroupId});\r\n    }\r\n\r\n    setSort(value) {\r\n        if (this.sort === value) {\r\n            this.sort = '-' + value;\r\n        } else {\r\n            this.sort = value;\r\n        }\r\n\r\n        // update value in the teacher data service so we can persist across views\r\n        this.TeacherDataService.nodeGradingSort = this.sort;\r\n    }\r\n\r\n    getOrderBy() {\r\n        let orderBy = [];\r\n\r\n        switch (this.sort) {\r\n            case 'team':\r\n                orderBy = ['workgroupId', 'userName'];\r\n                break;\r\n            case '-team':\r\n                orderBy = ['-workgroupId', 'userName'];\r\n                break;\r\n            case 'student':\r\n                orderBy = ['userName', 'workgroupId'];\r\n                break;\r\n            case '-student':\r\n                orderBy = ['-userName', 'workgroupId'];\r\n                break;\r\n            case 'score':\r\n                orderBy = ['score', 'userName'];\r\n                break;\r\n            case '-score':\r\n                orderBy = ['-score', 'userName'];\r\n                break;\r\n            case 'completion':\r\n                orderBy = ['completion', 'userName'];\r\n                break;\r\n            case '-completion':\r\n                orderBy = ['-completion', 'userName'];\r\n                break;\r\n            case 'location':\r\n                orderBy = ['location', 'userName'];\r\n                break;\r\n            case '-location':\r\n                orderBy = ['-location', 'userName'];\r\n                break;\r\n            case 'time':\r\n                orderBy = ['-online', '-timeSpent', 'userName'];\r\n                break;\r\n            case '-time':\r\n                orderBy = ['-online', 'timeSpent', 'userName'];\r\n                break;\r\n            case 'online':\r\n                orderBy = ['online', 'userName'];\r\n                break;\r\n            case '-online':\r\n                orderBy = ['-online', 'userName'];\r\n                break;\r\n        }\r\n\r\n        return orderBy;\r\n    }\r\n}\r\n\r\nStudentProgressController.$inject = [\r\n    '$rootScope',\r\n    '$scope',\r\n    '$state',\r\n    'ConfigService',\r\n    'ProjectService',\r\n    'StudentStatusService',\r\n    'TeacherDataService',\r\n    'TeacherWebSocketService'\r\n];\r\n\r\nexport default StudentProgressController;\r\n"]}