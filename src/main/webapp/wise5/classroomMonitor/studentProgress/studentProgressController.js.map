{"version":3,"sources":["studentProgressController.es6"],"names":["StudentProgressController","$rootScope","$scope","$state","ConfigService","ProjectService","StudentStatusService","TeacherDataService","TeacherWebSocketService","teacherWorkgroupId","getWorkgroupId","sort","studentProgressSort","setCurrentWorkgroup","permissions","getPermissions","studentsOnline","getStudentsOnline","students","initializeStudents","$on","event","args","studentStatus","workgroupId","updateTimeSpentForWorkgroupId","updateTeam","data","indexOfWorkgroupId","indexOf","splice","currentWorkgroup","updateTimeSpentInterval","studentTimeSpent","updateTimeSpent","updateTimeSpentIntervalId","setInterval","$apply","context","nodeId","componentId","componentType","category","saveEvent","getCurrentNodePositionAndNodeTitleForWorkgroupId","getStudentProjectCompletion","workgroup","show","currentPeriod","getCurrentPeriod","periodId","getTotalScoreByWorkgroupId","timeSpent","s","length","currentClientTimestamp","Date","getTime","getStudentStatusForWorkgroupId","postTimestamp","currentServerTimestamp","convertToServerTimestamp","totalSeconds","Math","floor","hours","minutes","seconds","timeSpentText","i","teams","team","id","workgroups","getClassmateUserInfos","x","username","displayNames","getDisplayUsernamesByWorkgroupId","periodName","push","isOnline","isWorkgroupOnline","location","getCurrentNodeForWorkgroupId","getStudentTimeSpent","completion","score","getStudentTotalScore","maxScore","getMaxScoreForWorkgroupId","scorePct","go","value","orderBy","$inject"],"mappings":"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","file":"studentProgressController.js","sourcesContent":["'use strict';\n\nclass StudentProgressController {\n\n    constructor($rootScope,\n                $scope,\n                $state,\n                ConfigService,\n                ProjectService,\n                StudentStatusService,\n                TeacherDataService,\n                TeacherWebSocketService) {\n        this.$rootScope = $rootScope;\n        this.$scope = $scope;\n        this.$state = $state;\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n        this.StudentStatusService = StudentStatusService;\n        this.TeacherDataService = TeacherDataService;\n        this.TeacherWebSocketService = TeacherWebSocketService;\n\n        this.teacherWorkgroupId = this.ConfigService.getWorkgroupId();\n\n        // get the current sort order\n        this.sort = this.TeacherDataService.studentProgressSort;\n\n        // initialize the current workgroup to null\n        this.TeacherDataService.setCurrentWorkgroup(null);\n\n        // get the teacher permissions\n        this.permissions = this.ConfigService.getPermissions();\n\n        this.studentsOnline = this.TeacherWebSocketService.getStudentsOnline();\n        this.students = [];\n        this.initializeStudents();\n\n        // listen for the studentsOnlineReceived event\n        this.$rootScope.$on('studentsOnlineReceived', (event, args) => {\n            this.studentsOnline = args.studentsOnline;\n\n            // update the students\n            this.initializeStudents();\n        });\n\n        // listen for the studentStatusReceived event\n        this.$rootScope.$on('studentStatusReceived', (event, args) => {\n            // get the workgroup id\n            let studentStatus = args.studentStatus;\n            let workgroupId = studentStatus.workgroupId;\n\n            // update the time spent for the workgroup\n            this.updateTimeSpentForWorkgroupId(workgroupId);\n\n            // update team data\n            this.updateTeam(workgroupId);\n        });\n\n        // listen for the studentDisconnected event\n        this.$rootScope.$on('studentDisconnected', (event, args) => {\n            var data = args.data;\n            var workgroupId = data.workgroupId;\n\n            var studentsOnline = this.studentsOnline;\n\n            var indexOfWorkgroupId = studentsOnline.indexOf(workgroupId);\n\n            if (indexOfWorkgroupId != -1) {\n                // remove the workgroup from the students online list\n                studentsOnline.splice(indexOfWorkgroupId, 1);\n\n                // update team data\n                this.updateTeam(workgroupId);\n            }\n        });\n\n        // listen for the currentWorkgroupChanged event\n        this.$scope.$on('currentWorkgroupChanged', (event, args) => {\n            this.currentWorkgroup = args.currentWorkgroup;\n        });\n\n        // how often to update the time spent values in the view\n        this.updateTimeSpentInterval = 10000;\n\n        // mapping of workgroup id to time spent\n        this.studentTimeSpent = {};\n\n        // update the time spent values in the view\n        this.updateTimeSpent();\n\n        // update the time spent values every x seconds\n        this.updateTimeSpentIntervalId = setInterval(() => {\n            // update the time spent values in the view\n            this.updateTimeSpent();\n\n            // refresh the view\n            this.$scope.$apply();\n        }, this.updateTimeSpentInterval);\n\n        // save event when student progress view is displayed\n        let context = \"ClassroomMonitor\", nodeId = null, componentId = null, componentType = null,\n            category = \"Navigation\", event = \"studentProgressViewDisplayed\", data = {};\n        this.TeacherDataService.saveEvent(context, nodeId, componentId, componentType, category, event, data);\n    }\n\n    getCurrentNodeForWorkgroupId(workgroupId) {\n        return this.StudentStatusService.getCurrentNodePositionAndNodeTitleForWorkgroupId(workgroupId);\n    };\n\n    /**\n     * Get project completion data for the given workgroup (only include nodes\n     * with student work)\n     * @param workgroupId the workgroup id\n     * @return object with completed, total, and percent completed (integer\n     * between 0 and 100)\n     */\n    getStudentProjectCompletion(workgroupId) {\n        return this.StudentStatusService.getStudentProjectCompletion(workgroupId, true);\n    };\n\n    isWorkgroupOnline(workgroupId) {\n        return this.studentsOnline.indexOf(workgroupId) != -1;\n    };\n\n    isWorkgroupShown(workgroup) {\n        let show = false;\n\n        let currentPeriod = this.TeacherDataService.getCurrentPeriod().periodId;\n\n        if (currentPeriod === -1 || workgroup.periodId === currentPeriod) {\n            if (this.currentWorkgroup) {\n                if (workgroup.workgroupId === this.currentWorkgroup.workgroupId) {\n                    show = true;\n                }\n            } else {\n                show = true;\n            }\n        }\n\n        return show;\n    }\n\n    getStudentTotalScore(workgroupId) {\n        return this.TeacherDataService.getTotalScoreByWorkgroupId(workgroupId);\n    }\n\n    /**\n     * Get the time spent for a workgroup\n     */\n    getStudentTimeSpent(workgroupId) {\n        let timeSpent = null;\n\n        if (this.studentTimeSpent) {\n            timeSpent = this.studentTimeSpent[workgroupId];\n        }\n\n        return timeSpent;\n    }\n\n    /**\n     * Update the time spent values in the view\n     */\n    updateTimeSpent() {\n        var studentsOnline = this.studentsOnline;\n\n        if (studentsOnline != null) {\n\n            // loop through all the workgroups that are online\n            for (var s = 0; s < studentsOnline.length; s++) {\n                var workgroupId = studentsOnline[s];\n\n                if (workgroupId != null) {\n                    // update the time spent for the workgroup\n                    this.updateTimeSpentForWorkgroupId(workgroupId);\n                }\n            }\n        }\n    }\n\n    /**\n     * Update the time spent for the workgroup\n     * @workgroupId the workgroup id\n     */\n    updateTimeSpentForWorkgroupId(workgroupId) {\n\n        if (workgroupId != null) {\n            // get the current client timestamp\n            var currentClientTimestamp = new Date().getTime();\n\n            // get the student status\n            var studentStatus = this.StudentStatusService.getStudentStatusForWorkgroupId(workgroupId);\n\n            if (studentStatus != null) {\n\n                // get the time the student status was posted to the server\n                var postTimestamp = studentStatus.postTimestamp;\n\n                /*\n                 * convert the current client timestamp to a server timestamp\n                 * this is requied in cases where the client and server clocks\n                 * are not synchronized\n                 */\n                var currentServerTimestamp = this.ConfigService.convertToServerTimestamp(currentClientTimestamp);\n\n                // get the amount of time the student has been on the step\n                var timeSpent = currentServerTimestamp - postTimestamp;\n\n                // get the total amount of seconds the student has been on the step\n                var totalSeconds = Math.floor(timeSpent / 1000);\n\n                // get the hours, minutes, and seconds\n                var hours = Math.floor((totalSeconds % 86400) / 3600);\n                var minutes = Math.floor(((totalSeconds % 86400) % 3600) / 60);\n                var seconds = totalSeconds % 60;\n\n                if (hours < 0) {\n                    hours = 0;\n                }\n\n                if (minutes < 0) {\n                    minutes = 0;\n                }\n\n                if (seconds < 0) {\n                    seconds = 0;\n                }\n\n                var timeSpentText = '';\n\n                if (hours > 0) {\n                    timeSpentText += (hours + ':');\n                }\n\n                if (hours > 0) {\n                    // there are hours\n\n                    if (minutes == 0) {\n                        // fill with zeroes\n                        timeSpentText += '00:';\n                    } else if (minutes > 0 && minutes < 10) {\n                        // add a leading zero\n                        timeSpentText += '0' + minutes + ':';\n                    } else {\n                        timeSpentText += minutes + ':';\n                    }\n                } else {\n                    // there are no hours\n\n                    timeSpentText += minutes + ':';\n                }\n\n                if (seconds == 0) {\n                    // fill with zeroes\n                    timeSpentText += '00';\n                } else if (seconds > 0 && seconds < 10) {\n                    // add a leading zero\n                    timeSpentText += ('0' + seconds);\n                } else {\n                    timeSpentText += seconds;\n                }\n\n                // update the mapping of workgroup id to time spent\n                //this.studentTimeSpent[workgroupId] = timeSpentText;\n\n                // update the timeSpent for the team with the matching workgroupID\n                for (let i = 0; i < this.teams.length; i++) {\n                    let team = this.teams[i];\n                    let id = team.workgroupId;\n\n                    if (workgroupId === id) {\n                        team.timeSpent = timeSpentText;\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Set up the array of workgroups in the run\n     */\n    initializeStudents() {\n        this.teams = [];\n\n        // get the workgroups\n        let workgroups = this.ConfigService.getClassmateUserInfos();\n\n        // loop through all the workgroups\n        for (let x = 0; x < workgroups.length; x++) {\n            let workgroup = workgroups[x];\n\n            if (workgroup != null) {\n                let workgroupId = workgroup.workgroupId;\n                let username = workgroup.username;\n                let displayNames = this.ConfigService.getDisplayUsernamesByWorkgroupId(workgroupId);\n                let team = {\n                    periodId: workgroup.periodId,\n                    periodName: workgroup.periodName,\n                    workgroupId: workgroupId,\n                    username: displayNames\n                };\n                this.teams.push(team);\n                this.updateTeam(workgroupId);\n            }\n        }\n    }\n\n    /**\n     * Update data for team with the given workgroup id\n     * @param workgroupId\n     */\n    updateTeam(workgroupId) {\n        let isOnline = this.isWorkgroupOnline(workgroupId);\n        let location = this.getCurrentNodeForWorkgroupId(workgroupId);\n        let timeSpent = this.getStudentTimeSpent(workgroupId);\n        let completion = this.getStudentProjectCompletion(workgroupId);\n        let score = this.getStudentTotalScore(workgroupId);\n        let maxScore = this.StudentStatusService.getMaxScoreForWorkgroupId(workgroupId);\n        maxScore = maxScore ? maxScore : 0;\n\n        for (let i = 0; i < this.teams.length; i++) {\n            let team = this.teams[i];\n\n            if (team.workgroupId === workgroupId) {\n                team.isOnline = isOnline;\n                team.location = location;\n                team.timeSpent = timeSpent;\n                team.completion = completion;\n                team.score = score;\n                team.maxScore = maxScore;\n                team.scorePct = maxScore ? (score/maxScore) : score;\n            }\n        }\n    }\n\n    showStudentGradingView(workgroup) {\n        this.$state.go('root.team', {workgroupId: workgroup.workgroupId});\n    }\n\n    setSort(value) {\n        if (this.sort === value) {\n            this.sort = '-' + value;\n        } else {\n            this.sort = value;\n        }\n\n        // update value in the teacher data service so we can persist across views\n        this.TeacherDataService.studentProgressSort = this.sort;\n    }\n\n    getOrderBy() {\n        let orderBy = [];\n\n        switch (this.sort) {\n            case 'team':\n                orderBy = ['workgroupId', 'username'];\n                break;\n            case '-team':\n                orderBy = ['-workgroupId', 'username'];\n                break;\n            case 'student':\n                orderBy = ['username', 'workgroupId'];\n                break;\n            case '-student':\n                orderBy = ['-username', 'workgroupId'];\n                break;\n            case 'score':\n                orderBy = ['scorePct', 'username'];\n                break;\n            case '-score':\n                orderBy = ['-scorePct', 'username'];\n                break;\n            case 'completion':\n                orderBy = ['completion.completionPct', 'username'];\n                break;\n            case '-completion':\n                orderBy = ['-completion.completionPct', 'username'];\n                break;\n            case 'location':\n                orderBy = ['location', 'username'];\n                break;\n            case '-location':\n                orderBy = ['-location', 'username'];\n                break;\n            case 'time':\n                orderBy = ['-online', '-timeSpent', 'username'];\n                break;\n            case '-time':\n                orderBy = ['-online', 'timeSpent', 'username'];\n                break;\n            case 'online':\n                orderBy = ['online', 'username'];\n                break;\n            case '-online':\n                orderBy = ['-online', 'username'];\n                break;\n        }\n\n        return orderBy;\n    }\n}\n\nStudentProgressController.$inject = [\n    '$rootScope',\n    '$scope',\n    '$state',\n    'ConfigService',\n    'ProjectService',\n    'StudentStatusService',\n    'TeacherDataService',\n    'TeacherWebSocketService'\n];\n\nexport default StudentProgressController;\n"]}