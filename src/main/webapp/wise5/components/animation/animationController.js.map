{"version":3,"sources":["animationController.es6"],"names":["AnimationController","$filter","$mdDialog","$q","$rootScope","$scope","$timeout","AnimationService","AnnotationService","ConfigService","CRaterService","NodeService","NotebookService","NotificationService","ProjectService","StudentAssetService","StudentDataService","UtilService","studentResponse","attachments","onlyShowWork","latestAnnotations","messageDialog","idToSVGObject","themePath","getThemePath","tinymceOptions","menubar","plugins","toolbar","autoresize_bottom_margin","autoresize_min_height","image_advtab","content_css","setup","ed","on","e","$","target","editorContainer","addClass","parent","id","removeClass","connectedComponentUpdateOnOptions","value","text","allowedConnectedComponentTypes","type","originalComponentContent","width","height","pixelsPerXUnit","pixelsPerYUnit","dataXOriginInPixels","dataYOriginInPixels","animationState","coordinateSystem","idToAnimationState","realTimePerDataTime","speedSliderValue","componentState","svgId","nodeId","componentId","initializeCoordinates","mode","isPromptVisible","isSaveButtonVisible","componentContent","showSaveButton","isSubmitButtonVisible","showSubmitButton","getLatestComponentAnnotations","workgroupId","isDisabled","summernoteRubricId","summernoteRubricHTML","rubric","insertAssetString","$translate","InsertAssetButton","createInsertAssetButton","summernoteRubricOptions","disableDragAndDrop","buttons","insertAssetButton","updateAdvancedAuthoringView","$watch","authoringComponentContent","bind","newValue","oldValue","injectAssetPaths","submitCounter","isDirty","isSubmitDirty","starterSentence","removeAllObjects","hasShowWorkConnectedComponent","handleConnectedComponents","componentStateHasStudentWork","setStudentWork","hasConnectedComponent","maxSubmitCount","isSubmitButtonDisabled","calculateDisabled","$parent","nodeController","registerComponentController","angular","animationController","getComponentState","isSubmit","deferred","defer","getState","action","createComponentState","then","resolve","promise","$on","event","args","submitTriggeredBy","submit","studentWork","$emit","isAutoSave","serverSaveTime","clientSaveTime","convertToClientTimestamp","setSaveMessage","lockIfNecessary","annotation","annotationNodeId","annotationComponentId","assetItem","fileName","assetsDirectoryPath","getProjectAssetsDirectoryPath","fullAssetPath","summernoteId","targetObject","image","imageMovingLeft","imageMovingRight","isImage","summernote","isVideo","videoElement","document","createElement","controls","innerHTML","authoringViewComponentChanged","hide","handleConnectedComponentStudentDataChanged","connectedComponent","connectedComponentParams","componentType","updateObjectDatasFromDataSources","showAdvancedAuthoring","script","retrieveScript","Function","call","$broadcast","widthInPixels","widthInUnits","heightInPixels","heightInUnits","draw","SVG","createObjects","objects","o","length","object","label","svgObject","initializeObjectPosition","load","x","pixelX","y","pixelY","data","dataX","dataY","dataXToPixelX","dataYToPixelY","isUsingCartesianCoordinateSystem","convertToCartesianCoordinateSystem","attr","firstDataPoint","firstDataPointT","t","firstDataPointX","firstDataPointY","firstDataPointXInPixels","firstDataPointYInPixels","initializeObjectImages","initializeObjectPositions","animateObject","timerText","fill","dataSource","updateObjectDataFromDataSource","getLatestComponentStateByNodeIdAndComponentId","setDataFromGraphComponentState","setDataFromTableComponentState","trialIndex","seriesIndex","tColumnIndex","xColumnIndex","yColumnIndex","studentData","trials","trial","series","singleSeries","seriesData","d","seriesDataPoint","animationDataPoint","push","thisAnimationController","currentDataPoint","xPixel","yPixel","nextDataPoint","nextT","nextX","nextY","nextXPixel","nextYPixel","tDiff","animate","during","pos","morph","eased","situation","elapsedTime","displayAndBroadcastTime","after","dynamicallyCalculatedImage","getImageBasedOnMovement","move","afterAll","checkIfAllAnimatingIsDone","currentTime","Date","getTime","lastBroadcastTime","displayTime","parseInt","showTime","currentX","currentY","imageMovingUp","imageMovingDown","areAnyObjectsAnimating","$digest","response","processLatestSubmit","latestState","performSubmit","numberOfSubmitsLeft","message","alert","confirm","incrementSubmitCounter","isLockAfterSubmit","getComponentId","createNewComponentState","copy","createComponentStateAdditionalProcessing","performCRaterScoring","isCRaterScoreOnSubmit","isCRaterScoreOnSave","isCRaterScoreOnChange","cRaterItemType","getCRaterItemType","cRaterItemId","getCRaterItemId","cRaterRequestType","cRaterResponseId","show","template","escapeToClose","makeCRaterRequest","result","annotations","score","concepts","previousScore","autoScoreAnnotationData","maxAutoScore","getMaxScoreForComponent","autoGrader","autoScoreAnnotation","createAutoScoreAnnotation","annotationGroupForScore","enableGlobalAnnotations","globalAnnotationSettings","globalAnnotationMaxCount","getGlobalAnnotationGroupByScore","globalAnnotationGroupsByNodeIdAndComponentId","getAllGlobalAnnotationGroups","annotationGroupCreatedTime","isGlobal","unGlobalizeCriteria","map","params","criteriaCreatedTimestamp","merge","autoComment","cRater","enableMultipleAttemptScoringRules","getMultipleAttemptCRaterFeedbackTextByScore","getCRaterFeedbackTextByScore","autoCommentAnnotationData","autoCommentAnnotation","createAutoCommentAnnotation","comment","enableNotifications","notificationForScore","getNotificationByScore","sendNotificationForScore","isPopup","hasAdditionalProcessingFunctions","additionalProcessingFunctions","getAdditionalProcessingFunctions","allPromises","i","additionalProcessingFunction","all","runId","getRunId","periodId","getPeriodId","toWorkgroupId","getWorkgroupId","lockAfterSubmit","componentStates","getComponentStatesByNodeIdAndComponentId","isSubmitted","isWorkSubmitted","attachment","indexOf","splice","studentDataChanged","studentAsset","copyAssetForReference","copiedAsset","studentAssetId","iconURL","prompt","showPreviousWorkPrompt","numRows","numColumns","importPreviousWorkNodeId","importPreviousWorkComponentId","importWorkNodeId","importWorkComponentId","importWorkComponentState","populatedComponentState","populateComponentState","nodeAuthoringController","authoringViewNodeChanged","editedComponentContent","fromJson","authoringComponentContentJSONString","replaceComponent","showSaveErrorAdvancedAuthoring","stepNodeIds","getNodeIds","nodePositionAndTitle","getNodePositionAndTitleByNodeId","components","getComponentsByNodeId","isApplicationNode","toJson","time","saveMessage","isCRaterEnabled","isCRaterScoreOnExit","exitListener","scoringRules","newScoringRule","feedbackText","index","scoringRule","answer","notificationSettings","notifications","newNotification","notificationType","enableCriteria","scoreSequence","isAmbient","dismissCode","isNotifyTeacher","isNotifyStudent","notificationMessageToStudent","notificationMessageToTeacher","multipleAttemptScoringRules","newMultipleAttemptScoringRule","multipleAttemptScoringRule","currentScore","notification","enableCRater","itemType","itemId","scoreOn","showScore","showFeedback","setShowSubmitButtonValue","component","componentHasWork","html","removeAbsoluteAssetPaths","insertWISELinks","newConnectedComponent","updateOn","connectedComponents","startAnimation","pause","play","jumpToEnd","clearQueue","stop","resetButtonClicked","keys","Object","k","key","remove","newObject","generateKey","newDataPoint","dataPoint","getComponentByNodeIdAndComponentId","tags","tag","c","makeCopyOfJSONObject","mergedComponentState","createMergedComponentState","mergedResponse","authoringAutomaticallySetConnectedComponentComponentIdIfPossible","numberOfAllowedComponents","allowedComponent","isConnectedComponentTypeAllowed","connectedComponentType","a","allowedConnectedComponentType","showJSONAuthoring","jsonStringChanged","advancedAuthoringViewComponentChanged","$inject"],"mappings":"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","file":"animationController.js","sourcesContent":["'use strict';\n\nimport ComponentController from '../componentController';\nimport 'svg.js';\n\nclass AnimationController extends ComponentController {\n  constructor($filter,\n      $mdDialog,\n      $q,\n      $rootScope,\n      $scope,\n      $timeout,\n      AnimationService,\n      AnnotationService,\n      ConfigService,\n      CRaterService,\n      NodeService,\n      NotebookService,\n      NotificationService,\n      ProjectService,\n      StudentAssetService,\n      StudentDataService,\n      UtilService) {\n    super($filter, $mdDialog, $rootScope, $scope,\n        AnnotationService, ConfigService, NodeService,\n        NotebookService, ProjectService, StudentAssetService,\n        StudentDataService, UtilService);\n    this.$q = $q;\n    this.$timeout = $timeout;\n    this.AnimationService = AnimationService;\n    this.CRaterService = CRaterService;\n    this.NotificationService = NotificationService;\n\n    // holds the text that the student has typed\n    this.studentResponse = '';\n\n    // holds student attachments like assets\n    this.attachments = [];\n\n    // whether we're only showing the student work\n    // TODO: refactor. do we need this?\n    this.onlyShowWork = false;\n\n    // the latest annotations\n    this.latestAnnotations = null;\n\n    // used to hold a message dialog if we need to use one\n    this.messageDialog = null;\n\n    // mapping from object id to svg object\n    this.idToSVGObject = {};\n\n    //var scope = this;\n    let themePath = this.ProjectService.getThemePath();\n\n    // TODO: make toolbar items and plugins customizable by authors (OR strip down to only special characters, support for equations)\n    // Rich text editor options\n    this.tinymceOptions = {\n      //onChange: function(e) {\n      //scope.studentDataChanged();\n      //},\n      menubar: false,\n      plugins: 'link image media autoresize', //imagetools\n      toolbar: 'undo redo | bold italic | superscript subscript | bullist numlist | alignleft aligncenter alignright | link image media',\n      autoresize_bottom_margin: '0',\n      autoresize_min_height: '100',\n      image_advtab: true,\n      content_css: themePath + '/style/tinymce.css',\n      setup: function (ed) {\n        ed.on('focus', function (e) {\n          $(e.target.editorContainer).addClass('input--focused').parent().addClass('input-wrapper--focused');\n          $('label[for=\"' + e.target.id + '\"]').addClass('input-label--focused');\n        });\n\n        ed.on('blur', function (e) {\n          $(e.target.editorContainer).removeClass('input--focused').parent().removeClass('input-wrapper--focused');\n          $('label[for=\"' + e.target.id + '\"]').removeClass('input-label--focused');\n        });\n      }\n    };\n\n    // the options for when to update this component from a connected component\n    this.connectedComponentUpdateOnOptions = [\n      {\n        value: 'change',\n        text: 'Change'\n      },\n      {\n        value: 'submit',\n        text: 'Submit'\n      }\n    ];\n\n    // the component types we are allowed to connect to\n    this.allowedConnectedComponentTypes = [\n      {\n        type: 'Animation'\n      },\n      {\n        type: 'Graph'\n      }\n    ];\n\n    /*\n     * get the original component content. this is used when showing\n     * previous work from another component.\n     */\n    this.originalComponentContent = this.$scope.originalComponentContent;\n\n    // the default width and height\n    this.width = 800;\n    this.height = 600;\n\n    // the default pixels per unit\n    this.pixelsPerXUnit = 1;\n    this.pixelsPerYUnit = 1;\n\n    // the default data origin in pixels\n    this.dataXOriginInPixels = 0;\n    this.dataYOriginInPixels = 0;\n\n    // the current state of the animation ('playing', 'paused', or 'stopped')\n    this.animationState = 'stopped';\n\n    // the coordinate system to use ('screen' or 'cartesian')\n    this.coordinateSystem = 'screen';\n\n    // mapping from id to whether the object is animating\n    this.idToAnimationState = {};\n\n    /*\n     * milliseconds per data time\n     * example\n     * The data time can be labelled with any unit of time such as seconds,\n     * minutes, hours, days, years, etc.\n     * If realTimePerDataTime is 100, that means for 1 data time, 100\n     * milliseconds will pass in real time.\n     */\n    this.realTimePerDataTime = 100;\n\n    // the speed slider value\n    this.speedSliderValue = 3;\n\n    // get the component state from the scope\n    var componentState = this.$scope.componentState;\n\n    // get the svg id\n    this.svgId = 'svg_' + this.nodeId + '_' + this.componentId;\n\n    // initialize all the coordinates\n    this.initializeCoordinates();\n\n    if (this.mode === 'student') {\n      this.isPromptVisible = true;\n      this.isSaveButtonVisible = this.componentContent.showSaveButton;\n      this.isSubmitButtonVisible = this.componentContent.showSubmitButton;\n\n      // get the latest annotations\n      this.latestAnnotations = this.AnnotationService.getLatestComponentAnnotations(this.nodeId, this.componentId, this.workgroupId);\n    } else if (this.mode === 'grading') {\n\n      // get the svg id\n      if (componentState != null) {\n        this.svgId = 'svg_' + this.nodeId + '_' + this.componentId + '_' + componentState.id;\n      } else {\n\n        this.svgId = 'svg_' + this.nodeId + '_' + this.componentId + '_' + this.workgroupId;\n      }\n\n      this.isPromptVisible = true;\n      this.isSaveButtonVisible = false;\n      this.isSubmitButtonVisible = false;\n      this.isDisabled = true;\n    } else if (this.mode === 'onlyShowWork') {\n      this.onlyShowWork = true;\n      this.isPromptVisible = false;\n      this.isSaveButtonVisible = false;\n      this.isSubmitButtonVisible = false;\n      this.isDisabled = true;\n    } else if (this.mode === 'showPreviousWork') {\n      this.isPromptVisible = true;\n      this.isSaveButtonVisible = false;\n      this.isSubmitButtonVisible = false;\n      this.isDisabled = true;\n    } else if (this.mode === 'authoring') {\n      this.isPromptVisible = true;\n      this.isSaveButtonVisible = this.componentContent.showSaveButton;\n      this.isSubmitButtonVisible = this.componentContent.showSubmitButton;\n\n      // generate the summernote rubric element id\n      this.summernoteRubricId = 'summernoteRubric_' + this.nodeId + '_' + this.componentId;\n\n      // set the component rubric into the summernote rubric\n      this.summernoteRubricHTML = this.componentContent.rubric;\n\n      // the tooltip text for the insert WISE asset button\n      var insertAssetString = this.$translate('INSERT_ASSET');\n\n      /*\n       * create the custom button for inserting WISE assets into\n       * summernote\n       */\n      var InsertAssetButton = this.UtilService.createInsertAssetButton(this, null, this.nodeId, this.componentId, 'rubric', insertAssetString);\n\n      /*\n       * the options that specifies the tools to display in the\n       * summernote prompt\n       */\n      this.summernoteRubricOptions = {\n        toolbar: [\n          ['style', ['style']],\n          ['font', ['bold', 'underline', 'clear']],\n          ['fontname', ['fontname']],\n          ['fontsize', ['fontsize']],\n          ['color', ['color']],\n          ['para', ['ul', 'ol', 'paragraph']],\n          ['table', ['table']],\n          ['insert', ['link', 'video']],\n          ['view', ['fullscreen', 'codeview', 'help']],\n          ['customButton', ['insertAssetButton']]\n        ],\n        height: 300,\n        disableDragAndDrop: true,\n        buttons: {\n          insertAssetButton: InsertAssetButton\n        }\n      };\n\n      this.updateAdvancedAuthoringView();\n\n      $scope.$watch(function() {\n        return this.authoringComponentContent;\n      }.bind(this), function(newValue, oldValue) {\n        // inject the asset paths into the new component content\n        this.componentContent = this.ProjectService.injectAssetPaths(newValue);\n\n        /*\n         * reset the values so that the preview is refreshed with\n         * the new content\n         */\n        this.submitCounter = 0;\n        this.studentResponse = '';\n        this.latestAnnotations = null;\n        this.isDirty = false;\n        this.isSubmitDirty = false;\n        this.isSaveButtonVisible = this.componentContent.showSaveButton;\n        this.isSubmitButtonVisible = this.componentContent.showSubmitButton;\n\n        if (this.componentContent.starterSentence != null) {\n          /*\n           * the student has not done any work and there is a starter sentence\n           * so we will populate the textarea with the starter sentence\n           */\n          this.studentResponse = this.componentContent.starterSentence;\n        }\n\n        // remove all the old objects\n        this.removeAllObjects();\n\n        // initialize all the coordinates\n        this.initializeCoordinates();\n\n        // re-render the svg div\n        this.setup();\n      }.bind(this), true);\n    }\n\n    if (this.mode == 'student') {\n      if (this.UtilService.hasShowWorkConnectedComponent(this.componentContent)) {\n        // we will show work from another component\n        this.handleConnectedComponents();\n      }  else if (this.AnimationService.componentStateHasStudentWork(componentState, this.componentContent)) {\n        /*\n         * the student has work so we will populate the work into this\n         * component\n         */\n        this.setStudentWork(componentState);\n      } else if (this.UtilService.hasConnectedComponent(this.componentContent)) {\n        // we will import work from another component\n        this.handleConnectedComponents();\n      }\n    } else {\n      // populate the student work into this component\n      this.setStudentWork(componentState);\n    }\n\n    // check if the student has used up all of their submits\n    if (this.componentContent.maxSubmitCount != null && this.submitCounter >= this.componentContent.maxSubmitCount) {\n      /*\n       * the student has used up all of their chances to submit so we\n       * will disable the submit button\n       */\n      this.isSubmitButtonDisabled = true;\n    }\n\n    // check if we need to lock this component\n    this.calculateDisabled();\n\n    if (this.$scope.$parent.nodeController != null) {\n      // register this component with the parent node\n      this.$scope.$parent.nodeController.registerComponentController(this.$scope, this.componentContent);\n    }\n\n    /*\n     * Call the setup() function after a timeout so that angular has a\n     * chance to set the svg element id before we start using it. If we\n     * don't wait for the timeout, the svg id won't be set when we try\n     * to start referencing the svg element.\n     */\n    this.$timeout(angular.bind(this, this.setup));\n\n    /**\n     * Returns true iff there is student work that hasn't been saved yet\n     */\n    this.$scope.isDirty = function() {\n      return this.$scope.animationController.isDirty;\n    }.bind(this);\n\n    /**\n     * Get the component state from this component. The parent node will\n     * call this function to obtain the component state when it needs to\n     * save student data.\n     * @param isSubmit boolean whether the request is coming from a submit\n     * action (optional; default is false)\n     * @return a promise of a component state containing the student data\n     */\n    this.$scope.getComponentState = function(isSubmit) {\n      var deferred = this.$q.defer();\n      let getState = false;\n      let action = 'change';\n\n      if (isSubmit) {\n        if (this.$scope.animationController.isSubmitDirty) {\n          getState = true;\n          action = 'submit';\n        }\n      } else {\n        if (this.$scope.animationController.isDirty) {\n          getState = true;\n          action = 'save';\n        }\n      }\n\n      if (getState) {\n        // create a component state populated with the student data\n        this.$scope.animationController.createComponentState(action).then((componentState) => {\n          deferred.resolve(componentState);\n        });\n      } else {\n        /*\n         * the student does not have any unsaved changes in this component\n         * so we don't need to save a component state for this component.\n         * we will immediately resolve the promise here.\n         */\n        deferred.resolve();\n      }\n\n      return deferred.promise;\n    }.bind(this);\n\n    /**\n     * The parent node submit button was clicked\n     */\n    this.$scope.$on('nodeSubmitClicked', function(event, args) {\n\n      // get the node id of the node\n      var nodeId = args.nodeId;\n\n      // make sure the node id matches our parent node\n      if (this.nodeId === nodeId) {\n\n        // trigger the submit\n        var submitTriggeredBy = 'nodeSubmitButton';\n        this.submit(submitTriggeredBy);\n      }\n    }.bind(this));\n\n    /**\n     * Listen for the 'studentWorkSavedToServer' event which is fired when\n     * we receive the response from saving a component state to the server\n     */\n    this.$scope.$on('studentWorkSavedToServer', angular.bind(this, function(event, args) {\n\n      let componentState = args.studentWork;\n\n      // check that the component state is for this component\n      if (componentState && this.nodeId === componentState.nodeId\n        && this.componentId === componentState.componentId) {\n\n        // set isDirty to false because the component state was just saved and notify node\n        this.isDirty = false;\n        this.$scope.$emit('componentDirty', {componentId: this.componentId, isDirty: false});\n\n        let isAutoSave = componentState.isAutoSave;\n        let isSubmit = componentState.isSubmit;\n        let serverSaveTime = componentState.serverSaveTime;\n        let clientSaveTime = this.ConfigService.convertToClientTimestamp(serverSaveTime);\n\n        // set save message\n        if (isSubmit) {\n          this.setSaveMessage(this.$translate('SUBMITTED'), clientSaveTime);\n\n          this.lockIfNecessary();\n\n          // set isSubmitDirty to false because the component state was just submitted and notify node\n          this.isSubmitDirty = false;\n          this.$scope.$emit('componentSubmitDirty', {componentId: this.componentId, isDirty: false});\n        } else if (isAutoSave) {\n          this.setSaveMessage(this.$translate('AUTO_SAVED'), clientSaveTime);\n        } else {\n          this.setSaveMessage(this.$translate('SAVED'), clientSaveTime);\n        }\n      }\n    }));\n\n    /**\n     * Listen for the 'annotationSavedToServer' event which is fired when\n     * we receive the response from saving an annotation to the server\n     */\n    this.$scope.$on('annotationSavedToServer', (event, args) => {\n\n      if (args != null ) {\n\n        // get the annotation that was saved to the server\n        var annotation = args.annotation;\n\n        if (annotation != null) {\n\n          // get the node id and component id of the annotation\n          var annotationNodeId = annotation.nodeId;\n          var annotationComponentId = annotation.componentId;\n\n          // make sure the annotation was for this component\n          if (this.nodeId === annotationNodeId &&\n            this.componentId === annotationComponentId) {\n\n            // get latest score and comment annotations for this component\n            this.latestAnnotations = this.AnnotationService.getLatestComponentAnnotations(this.nodeId, this.componentId, this.workgroupId);\n          }\n        }\n      }\n    });\n\n    /**\n     * Listen for the 'exitNode' event which is fired when the student\n     * exits the parent node. This will perform any necessary cleanup\n     * when the student exits the parent node.\n     */\n    this.$scope.$on('exitNode', function(event, args) {\n\n    }.bind(this));\n\n    /*\n     * Listen for the assetSelected event which occurs when the user\n     * selects an asset from the choose asset popup\n     */\n    this.$scope.$on('assetSelected', (event, args) => {\n\n      if (args != null) {\n\n        // make sure the event was fired for this component\n        if (args.nodeId == this.nodeId && args.componentId == this.componentId) {\n          // the asset was selected for this component\n          var assetItem = args.assetItem;\n\n          if (assetItem != null) {\n            var fileName = assetItem.fileName;\n\n            if (fileName != null) {\n              /*\n               * get the assets directory path\n               * e.g.\n               * /wise/curriculum/3/\n               */\n              var assetsDirectoryPath = this.ConfigService.getProjectAssetsDirectoryPath();\n              var fullAssetPath = assetsDirectoryPath + '/' + fileName;\n\n              var summernoteId = '';\n\n              if (args.target == 'prompt') {\n                // the target is the summernote prompt element\n                summernoteId = 'summernotePrompt_' + this.nodeId + '_' + this.componentId;\n              } else if (args.target == 'rubric') {\n                // the target is the summernote rubric element\n                summernoteId = 'summernoteRubric_' + this.nodeId + '_' + this.componentId;\n              } else if (args.target == 'image') {\n                // the target is the image\n                if (args.targetObject != null) {\n                  args.targetObject.image = fileName;\n                }\n              } else if (args.target == 'imageMovingLeft') {\n                // the target is the image moving left\n                if (args.targetObject != null) {\n                  args.targetObject.imageMovingLeft = fileName;\n                }\n              } else if (args.target == 'imageMovingRight') {\n                // the target is the image moving right\n                if (args.targetObject != null) {\n                  args.targetObject.imageMovingRight = fileName;\n                }\n              }\n\n              if (summernoteId != '') {\n                if (this.UtilService.isImage(fileName)) {\n                  /*\n                   * move the cursor back to its position when the asset chooser\n                   * popup was clicked\n                   */\n                  $('#' + summernoteId).summernote('editor.restoreRange');\n                  $('#' + summernoteId).summernote('editor.focus');\n\n                  // add the image html\n                  $('#' + summernoteId).summernote('insertImage', fullAssetPath, fileName);\n                } else if (this.UtilService.isVideo(fileName)) {\n                  /*\n                   * move the cursor back to its position when the asset chooser\n                   * popup was clicked\n                   */\n                  $('#' + summernoteId).summernote('editor.restoreRange');\n                  $('#' + summernoteId).summernote('editor.focus');\n\n                  // insert the video element\n                  var videoElement = document.createElement('video');\n                  videoElement.controls = 'true';\n                  videoElement.innerHTML = '<source ng-src=\"' + fullAssetPath + '\" type=\"video/mp4\">';\n                  $('#' + summernoteId).summernote('insertNode', videoElement);\n                }\n              }\n            }\n          }\n        }\n      }\n\n      // the authoring component content has changed so we will save the project\n      this.authoringViewComponentChanged();\n\n      // close the popup\n      this.$mdDialog.hide();\n    });\n\n    /**\n     * A connected component has changed its student data so we will\n     * perform any necessary changes to this component\n     * @param connectedComponent the connected component\n     * @param connectedComponentParams the connected component params\n     * @param componentState the student data from the connected\n     * component that has changed\n     */\n    this.$scope.handleConnectedComponentStudentDataChanged = (connectedComponent, connectedComponentParams, componentState) => {\n\n      if (connectedComponent != null && componentState != null) {\n\n        // get the component type that has changed\n        var componentType = connectedComponent.type;\n\n        if (componentType === 'Graph') {\n\n          // update the object datas\n          this.updateObjectDatasFromDataSources(componentState);\n        }\n      }\n    };\n\n    /*\n     * The advanced button for a component was clicked. If the button was\n     * for this component, we will show the advanced authoring.\n     */\n    this.$scope.$on('componentAdvancedButtonClicked', (event, args) => {\n      if (args != null) {\n        let componentId = args.componentId;\n        if (this.componentId === componentId) {\n          this.showAdvancedAuthoring = !this.showAdvancedAuthoring;\n        }\n      }\n    });\n\n    // load script for this component, if any\n    let script = this.componentContent.script;\n    if (script != null) {\n      this.ProjectService.retrieveScript(script).then((script) => {\n        new Function(script).call(this);\n      });\n    }\n\n    this.$rootScope.$broadcast('doneRenderingComponent', { nodeId: this.nodeId, componentId: this.componentId });\n  }\n\n  /**\n   * Initialize the coordinates of the svg div\n   */\n  initializeCoordinates() {\n\n    if (this.componentContent.widthInPixels != null && this.componentContent.widthInPixels != '') {\n      // get the width of the canvas in pixels\n      this.width = this.componentContent.widthInPixels;\n\n      // get the ratio of pixels per x unit\n      this.pixelsPerXUnit = this.componentContent.widthInPixels / this.componentContent.widthInUnits;\n    }\n\n    if (this.componentContent.heightInPixels != null && this.componentContent.heightInPixels != '') {\n      // get the height of the canvas in pixels\n      this.height = this.componentContent.heightInPixels;\n\n      // get the ratio of pixels per y unit\n      this.pixelsPerYUnit = this.componentContent.heightInPixels / this.componentContent.heightInUnits;\n    }\n\n    if (this.componentContent.dataXOriginInPixels != null && this.componentContent.dataXOriginInPixels != '') {\n      // get the data x origin in pixels\n      this.dataXOriginInPixels = this.componentContent.dataXOriginInPixels;\n    }\n\n    if (this.componentContent.dataYOriginInPixels != null && this.componentContent.dataYOriginInPixels != '') {\n      // get the data y origin in pixels\n      this.dataYOriginInPixels = this.componentContent.dataYOriginInPixels;\n    }\n\n    if (this.componentContent.coordinateSystem != null && this.componentContent.coordinateSystem != '') {\n      // get the coordinate system\n      this.coordinateSystem = this.componentContent.coordinateSystem;\n    }\n  }\n\n  /**\n   * Setup the objects\n   */\n  setup() {\n    // get the svg.js draw handle\n    this.draw = SVG(this.svgId);\n\n    // create the objects\n    this.createObjects();\n\n    // if an object uses data from another data source, update its data\n    this.updateObjectDatasFromDataSources();\n  }\n\n  /**\n   * Create the objects in the svg world\n   */\n  createObjects() {\n\n    if (this.componentContent != null) {\n\n      // get the objects\n      let objects = this.componentContent.objects;\n\n      if (objects != null) {\n\n        // loop through all the objects\n        for (let o = 0; o < objects.length; o++) {\n          let object = objects[o];\n\n          if (object != null) {\n            let id = object.id;\n            let type = object.type;\n            let label = object.label;\n\n            let svgObject = null;\n\n            if (type == 'image') {\n              // get the image file name\n              let image = object.image;\n\n              // get the width and the height\n              let width = object.width;\n              let height = object.height;\n\n              // create the image in the svg world\n              svgObject = this.draw.image(image, width, height);\n            } else if (type == 'text') {\n\n              /*\n               * if the text field is null, change it to an empty\n               * string otherwise this.draw.text(null) will return\n               * an empty string and cause problems later\n               */\n              if (object.text == null) {\n                object.text = '';\n              }\n\n              // get the text\n              let text = object.text;\n\n              // create the text object in the svg world\n              svgObject = this.draw.text(text);\n            }\n\n            // add an entry in our id to svg object mapping\n            this.idToSVGObject[id] = svgObject;\n\n            // add an entry in our id to animation state mapping\n            this.idToAnimationState[id] = false;\n\n            // initialize the svg object position\n            this.initializeObjectPosition(object);\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Initialize the object images\n   */\n  initializeObjectImages() {\n    if (this.componentContent != null) {\n\n      // get the objects\n      let objects = this.componentContent.objects;\n\n      if (objects != null) {\n\n        // loop through all the objects\n        for (let o = 0; o < objects.length; o++) {\n          let object = objects[o];\n\n          let id = object.id;\n          let type = object.type;\n\n          // get the image file name\n          let image = object.image;\n\n          if (type == 'image') {\n            // the object is an image\n\n            // get the svg object\n            let svgObject = this.idToSVGObject[id];\n\n            // load the image into the svg object\n            svgObject.load(image);\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Initialize the object positions\n   */\n  initializeObjectPositions() {\n    if (this.componentContent != null) {\n\n      // get the objects\n      let objects = this.componentContent.objects;\n\n      if (objects != null) {\n\n        // loop through all the objects\n        for (let o = 0; o < objects.length; o++) {\n          let object = objects[o];\n\n          // initialize the object position\n          this.initializeObjectPosition(object);\n        }\n      }\n    }\n  }\n\n  /**\n   * Convert a data x value to a pixel x value\n   * @param x an x value in data units\n   * @return the x value converted to a pixel coordinate\n   */\n  dataXToPixelX(x) {\n\n    // default the pixel x to start at the data x origin\n    let pixelX = this.dataXOriginInPixels;\n\n    if (x != null) {\n\n      // convert the x value to pixels and shift it by the x origin\n      pixelX += x * this.pixelsPerXUnit;\n    }\n\n    return pixelX;\n  }\n\n  /**\n   * Convert a data y value to a pixel y value\n   * @param y an y value in data units\n   * @return the y value converted to a pixel coordinate\n   */\n  dataYToPixelY(y) {\n\n    // default the pixel y to start at the data y origin\n    let pixelY = this.dataYOriginInPixels;\n\n    if (y != null) {\n      // convert the y value to pixels and shift it by the y origin\n      pixelY += y * this.pixelsPerYUnit;\n    }\n\n    return pixelY;\n  }\n\n  /**\n   * Initialize the object position in the svg world\n   * @param object the authored object\n   */\n  initializeObjectPosition(object) {\n    let id = object.id;\n    let label = object.label;\n    let data = object.data;\n    let dataX = object.dataX;\n    let dataY = object.dataY;\n    let pixelX = object.pixelX;\n    let pixelY = object.pixelY;\n\n    let x = 0;\n    let y = 0;\n\n    if (dataX != null) {\n      // the dataX position was provided\n\n      // convert the data x value to a pixel x value\n      x = this.dataXToPixelX(dataX);\n    } else if (pixelX != null) {\n      // the pixelX position was provided\n      x = pixelX;\n    }\n\n    if (dataY != null) {\n      // the dataY position was provided\n\n      // convert the data y value to a pixel y value\n      y = this.dataYToPixelY(dataY);\n    } else if (pixelY != null) {\n      // the pixelY position was provided\n      y = pixelY;\n    }\n\n    if (this.isUsingCartesianCoordinateSystem()) {\n      /*\n       * we are using the cartesian coordinate system so we need to modify\n       * the y value\n       */\n      y = this.convertToCartesianCoordinateSystem(y);\n    }\n\n    // get the svg object\n    let svgObject = this.idToSVGObject[id];\n\n    if (svgObject != null) {\n\n      // set the x and y pixel position\n      svgObject.attr({ x: x, y: y });\n\n      if (data != null && data.length > 0) {\n        // there is data for this object\n\n        // get the first data point\n        var firstDataPoint = data[0];\n\n        if (firstDataPoint != null) {\n\n          let firstDataPointT = firstDataPoint.t;\n          let firstDataPointX = firstDataPoint.x;\n          let firstDataPointY = firstDataPoint.y;\n\n          if (firstDataPointT === 0) {\n            /*\n             * there is a first data point with t == 0 so we will\n             * use it as the starting position\n             */\n\n            if (firstDataPointX != null && firstDataPointX != '' && typeof firstDataPointX != 'undefined') {\n              // convert the data x value to a pixel x value\n              let firstDataPointXInPixels = this.dataXToPixelX(firstDataPointX);\n              svgObject.attr('x', firstDataPointXInPixels);\n            }\n\n            if (firstDataPointY != null && firstDataPointY != '' && typeof firstDataPointY != 'undefined') {\n              // convert the data y value to a pixel y value\n              let firstDataPointYInPixels = this.dataYToPixelY(firstDataPointY);\n\n              if (this.isUsingCartesianCoordinateSystem()) {\n                /*\n                 * we are using the cartesian coordinate system so we need to modify\n                 * the y value\n                 */\n                firstDataPointYInPixels = this.convertToCartesianCoordinateSystem(firstDataPointYInPixels);\n              }\n\n              svgObject.attr('y', firstDataPointYInPixels);\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Start the animation\n   */\n  startAnimation() {\n\n    // set the images back to their starting images in case they have changed\n    this.initializeObjectImages();\n\n    // put the objects in their starting positions\n    this.initializeObjectPositions();\n\n    if (this.componentContent != null) {\n\n      let objects = this.componentContent.objects;\n\n      if (objects != null) {\n\n        // loop through all the objects\n        for (let o = 0; o < objects.length; o++) {\n          let object = objects[o];\n\n          if (object != null) {\n\n            // animate the object\n            this.animateObject(object);\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Show the time on the svg div\n   * @param t the time\n   */\n  showTime(t) {\n\n    if (this.timerText == null) {\n      // initialize the timer text\n      this.timerText = this.draw.text('0').attr({ fill: '#f03' });\n    }\n\n    // get the width of the svg div\n    let width = this.width;\n\n    // set the x position near the top right of the svg div\n    let x = width - 30;\n    let y = 0;\n\n    // set the text that the student will see\n    this.timerText.text(t + '');\n\n    if (t >= 10) {\n      // shift the text to the left if there are two digits\n      x = width - 38;\n    } else if (t >= 100) {\n      // shift the text to the left more if there are three digits\n      x = width - 46;\n    }\n\n    // set the position of the text\n    this.timerText.attr({ x: x, y: y });\n  }\n\n  /**\n   * Update the object data from their data source\n   * @param componentState (optional) a component state which may be the\n   * data source for one of the objects\n   */\n  updateObjectDatasFromDataSources(componentState) {\n\n    if (this.componentContent != null) {\n\n      let objects = this.componentContent.objects;\n\n      if (objects != null) {\n\n        // loop through all the objects\n        for (let o = 0; o < objects.length; o++) {\n          let object = objects[o];\n\n          if (object != null) {\n\n            if (object.dataSource != null) {\n              // the object gets its data from a data source\n              this.updateObjectDataFromDataSource(object, componentState);\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Update the data from its data source\n   * @param object update the data for this object\n   * @param componentState (optional) The component state to get the data\n   * from. If this is not provided, we will look up the latest component\n   * state.\n   */\n  updateObjectDataFromDataSource(object, componentState) {\n\n    if (object != null) {\n\n      // get the data source details\n      let dataSource = object.dataSource;\n\n      if (dataSource != null) {\n        let nodeId = dataSource.nodeId;\n        let componentId = dataSource.componentId;\n\n        if (componentState == null) {\n          // the component state was not passed in so we will get it\n          componentState = this.StudentDataService.getLatestComponentStateByNodeIdAndComponentId(nodeId, componentId);\n        }\n\n        if (componentState != null && nodeId == componentState.nodeId && componentId == componentState.componentId) {\n          // the component state matches the data source\n\n          if (componentState.componentType == 'Graph') {\n            this.setDataFromGraphComponentState(object, componentState);\n          } else if (componentState.componentType == 'Table') {\n            this.setDataFromTableComponentState(object, componentState);\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Get the data from the graph component state\n   * @param object set the data into this object\n   * @param componentState\n   */\n  setDataFromGraphComponentState(object, componentState) {\n    if (object != null) {\n\n      // get the data source specification\n      let dataSource = object.dataSource;\n\n      if (dataSource != null) {\n        let nodeId = dataSource.nodeId;\n        let componentId = dataSource.componentId;\n        let trialIndex = dataSource.trialIndex;\n        let seriesIndex = dataSource.seriesIndex;\n        let tColumnIndex = dataSource.tColumnIndex;\n        let xColumnIndex = dataSource.xColumnIndex;\n        let yColumnIndex = dataSource.yColumnIndex;\n\n        if (componentState != null && nodeId == componentState.nodeId && componentId == componentState.componentId) {\n          // the component state matches the data source\n\n          let studentData = componentState.studentData;\n\n          if (studentData != null) {\n            let trials = studentData.trials;\n\n            if (trials != null) {\n\n              // get the trial we ant\n              let trial = trials[trialIndex];\n\n              if (trial != null) {\n                let series = trial.series;\n\n                if (series != null) {\n\n                  // get the series we want\n                  let singleSeries = series[seriesIndex];\n\n                  if (singleSeries != null) {\n                    let seriesData = singleSeries.data;\n\n                    if (seriesData != null) {\n\n                      // array to store our animation data\n                      let data = [];\n\n                      // loop through all the points in the series\n                      for (let d = 0; d < seriesData.length; d++) {\n                        let seriesDataPoint = seriesData[d];\n\n                        // create a data point\n                        let animationDataPoint = {};\n\n                        if (tColumnIndex != null) {\n                          // get the t value\n                          animationDataPoint.t = seriesDataPoint[tColumnIndex];\n                        }\n\n                        if (xColumnIndex != null) {\n                          // get the x value\n                          animationDataPoint.x = seriesDataPoint[xColumnIndex];\n                        }\n\n                        if (yColumnIndex != null) {\n                          // get the y value\n                          animationDataPoint.y = seriesDataPoint[yColumnIndex];\n                        }\n\n                        // add the data point to the array\n                        data.push(animationDataPoint);\n                      }\n\n                      // set the data into the object\n                      object.data = data;\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  setDataFromTableComponentState() {\n\n  }\n\n  /**\n   * Move the object\n   * @param object the authored object\n   */\n  animateObject(object) {\n\n    if (object != null) {\n      let id = object.id;\n      let data = object.data;\n\n      if (data != null) {\n\n        // get the svg object\n        let svgObject = this.idToSVGObject[id];\n\n        if (svgObject != null) {\n\n          /*\n           * this will hold SVG.FX object that is returned from\n           * calling animate()\n           */\n          let animateObject = null;\n\n          let thisAnimationController = this;\n\n          // loop through all the data\n          for (let d = 0; d < data.length; d++) {\n\n            // get the current point\n            let currentDataPoint = data[d];\n            let t = currentDataPoint.t;\n            let x = currentDataPoint.x;\n            let y = currentDataPoint.y;\n            let image = currentDataPoint.image;\n\n            // convert the data values to pixels\n            let xPixel = this.dataXToPixelX(x);\n            let yPixel = this.dataYToPixelY(y);\n\n            // get the next point\n            let nextDataPoint = data[d + 1];\n            let nextT = null;\n            let nextX = null;\n            let nextY = null;\n            let nextXPixel = null;\n            let nextYPixel = null;\n\n            if (nextDataPoint != null) {\n              nextT = nextDataPoint.t;\n              nextX = nextDataPoint.x;\n              nextY = nextDataPoint.y;\n\n              // convert the data values to pixels\n              nextXPixel = this.dataXToPixelX(nextX);\n              nextYPixel = this.dataYToPixelY(nextY);\n            }\n\n            if (this.isUsingCartesianCoordinateSystem()) {\n              /*\n               * we are using the cartesian coordinate system so we need to modify\n               * the y value\n               */\n              yPixel = this.convertToCartesianCoordinateSystem(yPixel);\n              nextYPixel = this.convertToCartesianCoordinateSystem(nextYPixel);\n            }\n\n            // set the animation state to true for the object\n            this.idToAnimationState[id] = true;\n\n            let tDiff = 0;\n\n            if (nextT != null && nextT != '') {\n              /*\n               * calculate the time difference so we know how long we should make\n               * it take to move to the new position\n               */\n              tDiff = nextT - t;\n            }\n\n            if (d == 0) {\n              // this is the first data point\n\n              if (t == 0) {\n                /*\n                 * immediately set the position since we are at\n                 * time 0\n                 */\n\n                // set the position\n                svgObject.attr({ x: xPixel, y: yPixel });\n              } else {\n                /*\n                 * the first data point is not at time 0 so we will\n                 * need to wait until time t before we set the\n                 * position of the object\n                 */\n                animateObject = svgObject.animate(t * this.realTimePerDataTime).during(function(pos, morph, eased, situation) {\n\n                  // calculate the amount of time that has elapsed\n                  let elapsedTime = t * pos;\n\n                  // display and broadcast the elapsed time\n                  thisAnimationController.displayAndBroadcastTime(elapsedTime);\n                }).after(function() {\n                  // set the position\n                  this.attr({ x: xPixel, y: yPixel });\n                });\n              }\n            }\n\n            if (image != null && image != '') {\n              /*\n               * there is an image specified for this data point\n               * so we will change to that image\n               */\n\n              if (animateObject == null) {\n                /*\n                 * there is no animateObject yet so we will\n                 * change the image immediately\n                 */\n                svgObject.load(image);\n              } else {\n                /*\n                 * change the image after all the existing\n                 * animations\n                 */\n                animateObject = animateObject.after(function() {\n                  this.load(image);\n                });\n              }\n            } else if (nextDataPoint != null) {\n              /*\n               * there is a next data point so we will see if we\n               * can determine what image to show based upon the\n               * movement of the object\n               */\n\n              // get the image to show based upon the movement\n              let dynamicallyCalculatedImage = this.getImageBasedOnMovement(object, currentDataPoint, nextDataPoint);\n\n              if (dynamicallyCalculatedImage != null) {\n                if (animateObject == null) {\n                  /*\n                   * there is no animateObject yet so we will\n                   * change the image immediately\n                   */\n                  svgObject.load(dynamicallyCalculatedImage);\n                } else {\n                  /*\n                   * change the image after all the existing\n                   * animations\n                   */\n                  animateObject = animateObject.after(function() {\n                    this.load(dynamicallyCalculatedImage);\n                  });\n                }\n              }\n            }\n\n            if (d != data.length - 1) {\n              // this is a data point that is not the last\n\n              // move the image to the next position\n              animateObject = svgObject.animate(tDiff * this.realTimePerDataTime).move(nextXPixel, nextYPixel).during(function(pos, morph, eased, situation) {\n\n                // calculate the elapsed time\n                let elapsedTime = t + (tDiff * pos);\n\n                // display and broadcast the elapsed time\n                thisAnimationController.displayAndBroadcastTime(elapsedTime);\n              });\n            }\n\n            if (d == data.length - 1) {\n              // this is the last data point\n\n              // after all the animations are done on the object we will perform some processing\n              animateObject = animateObject.afterAll(() => {\n\n                /*\n                 * we are done animating this object so we will\n                 * set the animation state to false for the\n                 * object\n                 */\n                this.idToAnimationState[id] = false;\n\n                // check if all svg objects are done animating\n                this.checkIfAllAnimatingIsDone();\n              });\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Display and broadcast the time\n   * @param t the time\n   */\n  displayAndBroadcastTime(t) {\n\n    let currentTime = new Date().getTime();\n\n    if (this.lastBroadcastTime == null) {\n      this.lastBroadcastTime = currentTime;\n    }\n\n    if (currentTime - this.lastBroadcastTime > 100) {\n      /*\n       * Remove the digits after the first decimal place.\n       * example\n       * 12.817 will be changed to 12.8\n       */\n      let displayTime = parseInt(t * 10) / 10;\n\n      // show the time on the svg div\n      this.showTime(displayTime);\n\n      // create a component state with the time in it\n      let componentState = {};\n      componentState.t = t;\n\n      /*\n       * broadcast the component state with the time in it\n       * so other components can know the elapsed time\n       */\n      this.$scope.$emit('componentStudentDataChanged', {nodeId: this.nodeId, componentId: this.componentId, componentState: componentState});\n\n      this.lastBroadcastTime = currentTime;\n    }\n  }\n\n  /**\n   * Get the image based upon the movement of the object\n   * @param object the object that is being moved\n   * @param currentDataPoint the current data point\n   * @param nextDataPoint the next data point\n   */\n  getImageBasedOnMovement(object, currentDataPoint, nextDataPoint) {\n\n    let image = null;\n\n    if (currentDataPoint != null && nextDataPoint != null) {\n\n      let currentX = currentDataPoint.x;\n      let currentY = currentDataPoint.y;\n\n      let nextX = nextDataPoint.x;\n      let nextY = nextDataPoint.y;\n\n      if (currentY == nextY) {\n        // there is no change in y\n\n        if (currentX == nextX) {\n          // there is no change in x\n\n          // the image is staying in place\n        } else if (currentX < nextX) {\n          // x is moving to the right\n          if (object.imageMovingRight != null && object.imageMovingRight != '') {\n            image = object.imageMovingRight;\n          }\n        } else if (currentX > nextX) {\n          // x is moving to the left\n          if (object.imageMovingLeft != null && object.imageMovingLeft != '') {\n            image = object.imageMovingLeft;\n          }\n        }\n      } else if (currentX == nextX) {\n        // there is no change in x\n\n        if (currentY == nextY) {\n          // there is no change in y\n\n          // the image is staying in place\n        } else if (currentY < nextY) {\n          // y is getting larger\n\n          if (this.isUsingCartesianCoordinateSystem()) {\n            // y is moving up\n            if (object.imageMovingUp != null && object.imageMovingUp != '') {\n              image = object.imageMovingUp;\n            }\n          } else {\n            // y is moving down\n            if (object.imageMovingDown != null && object.imageMovingDown != '') {\n              image = object.imageMovingDown;\n            }\n          }\n        } else if (currentY > nextY) {\n          // y is getting smaller\n\n          if (this.isUsingCartesianCoordinateSystem()) {\n            // y is moving down\n            if (object.imageMovingDown != null && object.imageMovingDown != '') {\n              image = object.imageMovingDown;\n            }\n          } else {\n            // y is moving up\n            if (object.imageMovingUp != null && object.imageMovingUp != '') {\n              image = object.imageMovingUp;\n            }\n          }\n        }\n      } else {\n        // there is a change in x and y\n\n        // TODO: fill out these if/else cases by setting the appropriate image\n\n        if (currentX < nextX && currentY < nextY) {\n          // x is getting larger and y is getting larger\n\n          if (this.isUsingCartesianCoordinateSystem()) {\n            // the image is moving up to the right\n          } else {\n            // the image is moving down to the right\n          }\n        } else if (currentX < nextX && currentY > nextY) {\n          // x is getting larger and y is getting smaller\n\n          if (this.isUsingCartesianCoordinateSystem()) {\n            // the image is moving down to the right\n          } else {\n            // the image is moving up to the right\n          }\n        } else if (currentX > nextX && currentY > nextY) {\n          // x is getting smaller and y is getting smaller\n\n          if (this.isUsingCartesianCoordinateSystem()) {\n            // the image is moving down to the left\n          } else {\n            // the image is moving up to the left\n          }\n        } else if (currentX > nextX && currentY < nextY) {\n          // x is getting smaller and y is getting larger\n\n          if (this.isUsingCartesianCoordinateSystem()) {\n            // the image is moving up to the right\n          } else {\n            // the image is moving down to the right\n          }\n        }\n      }\n    }\n\n    return image;\n  }\n\n  /**\n   * Check if all svg objects are done animating. If there are not svg objects\n   * animating, we will set the animationState to 'stopped'.\n   */\n  checkIfAllAnimatingIsDone() {\n\n    // check if there are any other objects that are still animating\n    if (!this.areAnyObjectsAnimating()) {\n      // there are no objects animating\n\n      // set the animation state to 'stopped'\n      this.animationState = 'stopped';\n\n      // perform a digest after a timeout so that the buttons update\n      this.$timeout(() => {\n        this.$scope.$digest();\n      });\n    }\n  }\n\n  /**\n   * Populate the student work into the component\n   * @param componentState the component state to populate into the component\n   */\n  setStudentWork(componentState) {\n\n    if (componentState != null) {\n      var studentData = componentState.studentData;\n\n      if (studentData != null) {\n        var response = studentData.response;\n\n        if (response != null) {\n          // populate the text the student previously typed\n          this.studentResponse = response;\n        }\n\n        var submitCounter = studentData.submitCounter;\n\n        if (submitCounter != null) {\n          // populate the submit counter\n          this.submitCounter = submitCounter;\n        }\n\n        var attachments = studentData.attachments;\n\n        if (attachments != null) {\n          this.attachments = attachments;\n        }\n\n        this.processLatestSubmit();\n      }\n    }\n  };\n\n  /**\n   * Check if latest component state is a submission and set isSubmitDirty accordingly\n   */\n  processLatestSubmit() {\n    let latestState = this.StudentDataService.getLatestComponentStateByNodeIdAndComponentId(this.nodeId, this.componentId);\n\n    if (latestState) {\n      let serverSaveTime = latestState.serverSaveTime;\n      let clientSaveTime = this.ConfigService.convertToClientTimestamp(serverSaveTime);\n      if (latestState.isSubmit) {\n        // latest state is a submission, so set isSubmitDirty to false and notify node\n        this.isSubmitDirty = false;\n        this.$scope.$emit('componentSubmitDirty', {componentId: this.componentId, isDirty: false});\n        // set save message\n        this.setSaveMessage(this.$translate('LAST_SUBMITTED'), clientSaveTime);\n      } else {\n        // latest state is not a submission, so set isSubmitDirty to true and notify node\n        this.isSubmitDirty = true;\n        this.$scope.$emit('componentSubmitDirty', {componentId: this.componentId, isDirty: true});\n        // set save message\n        this.setSaveMessage(this.$translate('LAST_SAVED'), clientSaveTime);\n      }\n    }\n  };\n\n  /**\n   * A submit was triggered by the component submit button or node submit button\n   * @param submitTriggeredBy what triggered the submit\n   * e.g. 'componentSubmitButton' or 'nodeSubmitButton'\n   */\n  submit(submitTriggeredBy) {\n\n    if (this.isSubmitDirty) {\n      // the student has unsubmitted work\n\n      var performSubmit = true;\n\n      if (this.componentContent.maxSubmitCount != null) {\n        // there is a max submit count\n\n        // calculate the number of submits this student has left\n        var numberOfSubmitsLeft = this.componentContent.maxSubmitCount - this.submitCounter;\n\n        var message = '';\n\n        if (numberOfSubmitsLeft <= 0) {\n\n          // the student does not have any more chances to submit\n          alert(this.$translate('animation.youHaveNoMoreChances'));\n          performSubmit = false;\n        } else if (numberOfSubmitsLeft == 1) {\n\n          // ask the student if they are sure they want to submit\n          message = this.$translate('animation.youHaveOneChance', {numberOfSubmitsLeft: numberOfSubmitsLeft});\n          //message = 'You have ' + numberOfSubmitsLeft + ' chance to receive feedback on your answer so this this should be your best work.\\n\\nAre you ready to receive feedback on this answer?';\n          performSubmit = confirm(message);\n        } else if (numberOfSubmitsLeft > 1) {\n\n          // ask the student if they are sure they want to submit\n          message = this.$translate('animation.youHaveMultipleChances', {numberOfSubmitsLeft: numberOfSubmitsLeft});\n          //message = 'You have ' + numberOfSubmitsLeft + ' chances to receive feedback on your answer so this this should be your best work.\\n\\nAre you ready to receive feedback on this answer?';\n          performSubmit = confirm(message);\n        }\n      }\n\n      if (performSubmit) {\n\n        /*\n         * set isSubmit to true so that when the component state is\n         * created, it will know that is a submit component state\n         * instead of just a save component state\n         */\n        this.isSubmit = true;\n        this.incrementSubmitCounter();\n\n        // check if the student has used up all of their submits\n        if (this.componentContent.maxSubmitCount != null && this.submitCounter >= this.componentContent.maxSubmitCount) {\n          /*\n           * the student has used up all of their submits so we will\n           * disable the submit button\n           */\n          this.isSubmitButtonDisabled = true;\n        }\n\n        if (this.mode === 'authoring') {\n          /*\n           * we are in authoring mode so we will set values appropriately\n           * here because the 'componentSubmitTriggered' event won't\n           * work in authoring mode\n           */\n          this.isDirty = false;\n          this.isSubmitDirty = false;\n          this.createComponentState('submit');\n        }\n\n        if (submitTriggeredBy == null || submitTriggeredBy === 'componentSubmitButton') {\n          // tell the parent node that this component wants to submit\n          this.$scope.$emit('componentSubmitTriggered', {nodeId: this.nodeId, componentId: this.componentId});\n        } else if (submitTriggeredBy === 'nodeSubmitButton') {\n          // nothing extra needs to be performed\n        }\n      } else {\n        /*\n         * the student has cancelled the submit so if a component state\n         * is created, it will just be a regular save and not submit\n         */\n        this.isSubmit = false;\n      }\n    }\n  }\n\n  lockIfNecessary() {\n    // check if we need to lock the component after the student submits\n    if (this.isLockAfterSubmit()) {\n      this.isDisabled = true;\n    }\n  };\n\n  /**\n   * Called when the student changes their work\n   */\n  studentDataChanged() {\n    /*\n     * set the dirty flags so we will know we need to save or submit the\n     * student work later\n     */\n    this.isDirty = true;\n    this.$scope.$emit('componentDirty', {componentId: this.componentId, isDirty: true});\n\n    this.isSubmitDirty = true;\n    this.$scope.$emit('componentSubmitDirty', {componentId: this.componentId, isDirty: true});\n\n    // clear out the save message\n    this.setSaveMessage('', null);\n\n    // get this part id\n    var componentId = this.getComponentId();\n\n    /*\n     * the student work in this component has changed so we will tell\n     * the parent node that the student data will need to be saved.\n     * this will also notify connected parts that this component's student\n     * data has changed.\n     */\n    var action = 'change';\n\n    // create a component state populated with the student data\n    this.createComponentState(action).then((componentState) => {\n      this.$scope.$emit('componentStudentDataChanged', {nodeId: this.nodeId, componentId: componentId, componentState: componentState});\n    });\n  };\n\n  /**\n   * Create a new component state populated with the student data\n   * @param action the action that is triggering creating of this component state\n   * e.g. 'submit', 'save', 'change'\n   * @return a promise that will return a component state\n   */\n  createComponentState(action) {\n\n    var deferred = this.$q.defer();\n\n    // create a new component state\n    var componentState = this.NodeService.createNewComponentState();\n\n    // set the response into the component state\n    var studentData = {};\n\n    studentData.attachments = angular.copy(this.attachments);  // create a copy without reference to original array\n\n    // set the submit counter\n    studentData.submitCounter = this.submitCounter;\n\n    // set the flag for whether the student submitted this work\n    componentState.isSubmit = this.isSubmit;\n\n    // set the student data into the component state\n    componentState.studentData = studentData;\n\n    /*\n     * reset the isSubmit value so that the next component state\n     * doesn't maintain the same value\n     */\n    this.isSubmit = false;\n\n    /*\n     * perform any additional processing that is required before returning\n     * the component state\n     */\n    this.createComponentStateAdditionalProcessing(deferred, componentState, action);\n\n    return deferred.promise;\n  };\n\n  /**\n   * Perform any additional processing that is required before returning the\n   * component state\n   * Note: this function must call deferred.resolve() otherwise student work\n   * will not be saved\n   * @param deferred a deferred object\n   * @param componentState the component state\n   * @param action the action that we are creating the component state for\n   * e.g. 'submit', 'save', 'change'\n   */\n  createComponentStateAdditionalProcessing(deferred, componentState, action) {\n\n    var performCRaterScoring = false;\n\n    // determine if we need to perform CRater scoring\n    if (action == 'submit' && componentState.isSubmit) {\n      if (this.isCRaterScoreOnSubmit(this.componentContent)) {\n        performCRaterScoring = true;\n      }\n    } else if (action == 'save') {\n      if (this.isCRaterScoreOnSave(this.componentContent)) {\n        performCRaterScoring = true;\n      }\n    } else if (action == 'change' || action == null) {\n      if (this.isCRaterScoreOnChange(this.componentContent)) {\n        performCRaterScoring = true;\n      }\n    }\n\n    if (performCRaterScoring) {\n      // we need to perform CRater scoring\n\n      var cRaterItemType = this.CRaterService.getCRaterItemType(this.componentContent);\n      var cRaterItemId = this.CRaterService.getCRaterItemId(this.componentContent);\n      var cRaterRequestType = 'scoring';\n      var cRaterResponseId = new Date().getTime();\n      var studentData = this.studentResponse;\n\n      /*\n       * display a dialog message while the student waits for their work\n       * to be scored by CRater\n       */\n      this.$mdDialog.show({\n        template: '<md-dialog aria-label=\"' + this.$translate('animation.pleaseWait') + '\"><md-dialog-content><div class=\"md-dialog-content\">' + this.$translate('animation.pleaseWaitWeAreScoringYourWork') + '</div></md-dialog-content></md-dialog>',\n        escapeToClose: false\n      });\n\n      // make the CRater request to score the student data\n      this.CRaterService.makeCRaterRequest(cRaterItemType, cRaterItemId, cRaterRequestType, cRaterResponseId, studentData).then((result) => {\n\n        if (result != null) {\n\n          // get the CRater response\n          var data = result.data;\n\n          if (data != null) {\n\n            /*\n             * annotations we put in the component state will be\n             * removed from the component state and saved separately\n             */\n            componentState.annotations = [];\n\n            // get the CRater score\n            let score = data.score;\n            let concepts = data.concepts;\n            let previousScore = null;\n\n            if (score != null) {\n\n              // create the auto score annotation\n              let autoScoreAnnotationData = {};\n              autoScoreAnnotationData.value = score;\n              autoScoreAnnotationData.maxAutoScore = this.ProjectService.getMaxScoreForComponent(this.nodeId, this.componentId);\n              autoScoreAnnotationData.concepts = concepts;\n              autoScoreAnnotationData.autoGrader = 'cRater';\n\n              let autoScoreAnnotation = this.createAutoScoreAnnotation(autoScoreAnnotationData);\n\n              let annotationGroupForScore = null;\n\n              if (this.$scope.$parent.nodeController != null) {\n                // get the previous score and comment annotations\n                let latestAnnotations = this.$scope.$parent.nodeController.getLatestComponentAnnotations(this.componentId);\n\n                if (latestAnnotations != null && latestAnnotations.score != null &&\n                  latestAnnotations.score.data != null) {\n\n                  // get the previous score annotation value\n                  previousScore = latestAnnotations.score.data.value;\n                }\n\n                if (this.componentContent.enableGlobalAnnotations && this.componentContent.globalAnnotationSettings != null) {\n\n                  let globalAnnotationMaxCount = 0;\n                  if (this.componentContent.globalAnnotationSettings.globalAnnotationMaxCount != null) {\n                    globalAnnotationMaxCount = this.componentContent.globalAnnotationSettings.globalAnnotationMaxCount;\n                  }\n                  // get the annotation properties for the score that the student got.\n                  annotationGroupForScore = this.ProjectService.getGlobalAnnotationGroupByScore(this.componentContent, previousScore, score);\n\n                  // check if we need to apply this globalAnnotationSetting to this annotation: we don't need to if we've already reached the maxCount\n                  if (annotationGroupForScore != null) {\n                    let globalAnnotationGroupsByNodeIdAndComponentId = this.AnnotationService.getAllGlobalAnnotationGroups(this.nodeId, this.componentId);\n                    annotationGroupForScore.annotationGroupCreatedTime = autoScoreAnnotation.clientSaveTime;  // save annotation creation time\n\n                    if (globalAnnotationGroupsByNodeIdAndComponentId.length >= globalAnnotationMaxCount) {\n                      // we've already applied this annotation properties to maxCount annotations, so we don't need to apply it any more.\n                      annotationGroupForScore = null;\n                    }\n                  }\n\n                  if (annotationGroupForScore != null && annotationGroupForScore.isGlobal && annotationGroupForScore.unGlobalizeCriteria != null) {\n                    // check if this annotation is global and what criteria needs to be met to un-globalize.\n                    annotationGroupForScore.unGlobalizeCriteria.map( (unGlobalizeCriteria) => {\n                      // if the un-globalize criteria is time-based (e.g. isVisitedAfter, isRevisedAfter, isVisitedAndRevisedAfter, etc), store the timestamp of this annotation in the criteria\n                      // so we can compare it when we check for criteria satisfaction.\n                      if (unGlobalizeCriteria.params != null) {\n                        unGlobalizeCriteria.params.criteriaCreatedTimestamp = autoScoreAnnotation.clientSaveTime;  // save annotation creation time to criteria\n                      }\n                    });\n                  }\n\n                  if (annotationGroupForScore != null) {\n                    // copy over the annotation properties into the autoScoreAnnotation's data\n                    angular.merge(autoScoreAnnotation.data, annotationGroupForScore);\n                  }\n                }\n              }\n\n              componentState.annotations.push(autoScoreAnnotation);\n\n              if (this.mode === 'authoring') {\n                if (this.latestAnnotations == null) {\n                  this.latestAnnotations = {};\n                }\n\n                /*\n                 * we are in the authoring view so we will set the\n                 * latest score annotation manually\n                 */\n                this.latestAnnotations.score = autoScoreAnnotation;\n              }\n\n              var autoComment = null;\n\n              // get the submit counter\n              var submitCounter = this.submitCounter;\n\n              if (this.componentContent.cRater.enableMultipleAttemptScoringRules && submitCounter > 1) {\n                /*\n                 * this step has multiple attempt scoring rules and this is\n                 * a subsequent submit\n                 */\n                // get the feedback based upon the previous score and current score\n                autoComment = this.CRaterService.getMultipleAttemptCRaterFeedbackTextByScore(this.componentContent, previousScore, score);\n              } else {\n                // get the feedback text\n                autoComment = this.CRaterService.getCRaterFeedbackTextByScore(this.componentContent, score);\n              }\n\n              if (autoComment != null) {\n                // create the auto comment annotation\n                var autoCommentAnnotationData = {};\n                autoCommentAnnotationData.value = autoComment;\n                autoCommentAnnotationData.concepts = concepts;\n                autoCommentAnnotationData.autoGrader = 'cRater';\n\n                var autoCommentAnnotation = this.createAutoCommentAnnotation(autoCommentAnnotationData);\n\n                if (this.componentContent.enableGlobalAnnotations) {\n                  if (annotationGroupForScore != null) {\n                    // copy over the annotation properties into the autoCommentAnnotation's data\n                    angular.merge(autoCommentAnnotation.data, annotationGroupForScore);\n                  }\n                }\n                componentState.annotations.push(autoCommentAnnotation);\n\n                if (this.mode === 'authoring') {\n                  if (this.latestAnnotations == null) {\n                    this.latestAnnotations = {};\n                  }\n\n                  /*\n                   * we are in the authoring view so we will set the\n                   * latest comment annotation manually\n                   */\n                  this.latestAnnotations.comment = autoCommentAnnotation;\n                }\n              }\n              if (this.componentContent.enableNotifications) {\n                // get the notification properties for the score that the student got.\n                let notificationForScore = this.ProjectService.getNotificationByScore(this.componentContent, previousScore, score);\n\n                if (notificationForScore != null) {\n                  notificationForScore.score = score;\n                  notificationForScore.nodeId = this.nodeId;\n                  notificationForScore.componentId = this.componentId;\n                  this.NotificationService.sendNotificationForScore(notificationForScore);\n                }\n              }\n\n              // display global annotations dialog if needed\n              if (this.componentContent.enableGlobalAnnotations && annotationGroupForScore != null && annotationGroupForScore.isGlobal && annotationGroupForScore.isPopup) {\n                this.$scope.$emit('displayGlobalAnnotations');\n              }\n            }\n          }\n        }\n\n        /*\n         * hide the dialog that tells the student to wait since\n         * the work has been scored.\n         */\n        this.$mdDialog.hide();\n\n        // resolve the promise now that we are done performing additional processing\n        deferred.resolve(componentState);\n      });\n    } else if (this.ProjectService.hasAdditionalProcessingFunctions(this.nodeId, this.componentId)) {\n      // if there are any additionalProcessingFunctions for this node and component, call all of them\n      let additionalProcessingFunctions = this.ProjectService.getAdditionalProcessingFunctions(this.nodeId, this.componentId);\n      let allPromises = [];\n      for (let i = 0; i < additionalProcessingFunctions.length; i++) {\n        let additionalProcessingFunction = additionalProcessingFunctions[i];\n        let defer = this.$q.defer();\n        let promise = defer.promise;\n        allPromises.push(promise);\n        additionalProcessingFunction(defer, componentState, action);\n      }\n      this.$q.all(allPromises).then(() => {\n        deferred.resolve(componentState);\n      });\n    } else {\n      /*\n       * we don't need to perform any additional processing so we can resolve\n       * the promise immediately\n       */\n      deferred.resolve(componentState);\n    }\n  }\n\n  /**\n   * Create an auto score annotation\n   * @param runId the run id\n   * @param periodId the period id\n   * @param nodeId the node id\n   * @param componentId the component id\n   * @param toWorkgroupId the student workgroup id\n   * @param data the annotation data\n   * @returns the auto score annotation\n   */\n  createAutoScoreAnnotation(data) {\n\n    var runId = this.ConfigService.getRunId();\n    var periodId = this.ConfigService.getPeriodId();\n    var nodeId = this.nodeId;\n    var componentId = this.componentId;\n    var toWorkgroupId = this.ConfigService.getWorkgroupId();\n\n    // create the auto score annotation\n    var annotation = this.AnnotationService.createAutoScoreAnnotation(runId, periodId, nodeId, componentId, toWorkgroupId, data);\n\n    return annotation;\n  }\n\n  /**\n   * Create an auto comment annotation\n   * @param runId the run id\n   * @param periodId the period id\n   * @param nodeId the node id\n   * @param componentId the component id\n   * @param toWorkgroupId the student workgroup id\n   * @param data the annotation data\n   * @returns the auto comment annotation\n   */\n  createAutoCommentAnnotation(data) {\n\n    var runId = this.ConfigService.getRunId();\n    var periodId = this.ConfigService.getPeriodId();\n    var nodeId = this.nodeId;\n    var componentId = this.componentId;\n    var toWorkgroupId = this.ConfigService.getWorkgroupId();\n\n    // create the auto comment annotation\n    var annotation = this.AnnotationService.createAutoCommentAnnotation(runId, periodId, nodeId, componentId, toWorkgroupId, data);\n\n    return annotation;\n  }\n\n  /**\n   * Check if we need to lock the component\n   */\n  calculateDisabled() {\n\n    // get the component content\n    var componentContent = this.componentContent;\n\n    if (componentContent != null) {\n\n      // check if the parent has set this component to disabled\n      if (componentContent.isDisabled) {\n        this.isDisabled = true;\n      } else if (componentContent.lockAfterSubmit) {\n        // we need to lock the component after the student has submitted\n\n        // get the component states for this component\n        var componentStates = this.StudentDataService.getComponentStatesByNodeIdAndComponentId(this.nodeId, this.componentId);\n\n        // check if any of the component states were submitted\n        var isSubmitted = this.NodeService.isWorkSubmitted(componentStates);\n\n        if (isSubmitted) {\n          // the student has submitted work for this component\n          this.isDisabled = true;\n        }\n      }\n    }\n  };\n\n  /**\n   * Check whether we need to lock the component after the student\n   * submits an answer.\n   */\n  isLockAfterSubmit() {\n    var result = false;\n\n    if (this.componentContent != null) {\n\n      // check the lockAfterSubmit field in the component content\n      if (this.componentContent.lockAfterSubmit) {\n        result = true;\n      }\n    }\n\n    return result;\n  };\n\n  removeAttachment(attachment) {\n    if (this.attachments.indexOf(attachment) != -1) {\n      this.attachments.splice(this.attachments.indexOf(attachment), 1);\n      this.studentDataChanged();\n      // YOU ARE NOW FREEEEEEEEE!\n    }\n  };\n\n  /**\n   * Attach student asset to this Component's attachments\n   * @param studentAsset\n   */\n  attachStudentAsset(studentAsset) {\n    if (studentAsset != null) {\n      this.StudentAssetService.copyAssetForReference(studentAsset).then( (copiedAsset) => {\n        if (copiedAsset != null) {\n          var attachment = {\n            studentAssetId: copiedAsset.id,\n            iconURL: copiedAsset.iconURL\n          };\n\n          this.attachments.push(attachment);\n          this.studentDataChanged();\n        }\n      });\n    }\n  };\n\n  /**\n   * Get the prompt to show to the student\n   */\n  getPrompt() {\n    var prompt = null;\n\n    if (this.originalComponentContent != null) {\n      // this is a show previous work component\n\n      if (this.originalComponentContent.showPreviousWorkPrompt) {\n        // show the prompt from the previous work component\n        prompt = this.componentContent.prompt;\n      } else {\n        // show the prompt from the original component\n        prompt = this.originalComponentContent.prompt;\n      }\n    } else if (this.componentContent != null) {\n      prompt = this.componentContent.prompt;\n    }\n\n    return prompt;\n  };\n\n  /**\n   * Get the number of rows for the textarea\n   */\n  getNumRows() {\n    var numRows = null;\n\n    if (this.componentContent != null) {\n      numRows = this.componentContent.numRows;\n    }\n\n    return numRows;\n  };\n\n  /**\n   * Get the number of columns for the textarea\n   */\n  getNumColumns() {\n    var numColumns = null;\n\n    if (this.componentContent != null) {\n      numColumns = this.componentContent.numColumns;\n    }\n\n    return numColumns;\n  };\n\n  /**\n   * Get the text the student typed\n   */\n  getResponse() {\n    var response = null;\n\n    if (this.studentResponse != null) {\n      response = this.studentResponse;\n    }\n\n    return response;\n  };\n\n  /**\n   * Import work from another component\n   */\n  importWork() {\n\n    // get the component content\n    var componentContent = this.componentContent;\n\n    if (componentContent != null) {\n\n      // get the import previous work node id and component id\n      var importPreviousWorkNodeId = componentContent.importPreviousWorkNodeId;\n      var importPreviousWorkComponentId = componentContent.importPreviousWorkComponentId;\n\n      if (importPreviousWorkNodeId == null || importPreviousWorkNodeId == '') {\n\n        /*\n         * check if the node id is in the field that we used to store\n         * the import previous work node id in\n         */\n        if (componentContent.importWorkNodeId != null && componentContent.importWorkNodeId != '') {\n          importPreviousWorkNodeId = componentContent.importWorkNodeId;\n        }\n      }\n\n      if (importPreviousWorkComponentId == null || importPreviousWorkComponentId == '') {\n\n        /*\n         * check if the component id is in the field that we used to store\n         * the import previous work component id in\n         */\n        if (componentContent.importWorkComponentId != null && componentContent.importWorkComponentId != '') {\n          importPreviousWorkComponentId = componentContent.importWorkComponentId;\n        }\n      }\n\n      if (importPreviousWorkNodeId != null && importPreviousWorkComponentId != null) {\n\n        // get the latest component state for this component\n        var componentState = this.StudentDataService.getLatestComponentStateByNodeIdAndComponentId(this.nodeId, this.componentId);\n\n        /*\n         * we will only import work into this component if the student\n         * has not done any work for this component\n         */\n        if(componentState == null) {\n          // the student has not done any work for this component\n\n          // get the latest component state from the component we are importing from\n          var importWorkComponentState = this.StudentDataService.getLatestComponentStateByNodeIdAndComponentId(importPreviousWorkNodeId, importPreviousWorkComponentId);\n\n          if (importWorkComponentState != null) {\n            /*\n             * populate a new component state with the work from the\n             * imported component state\n             */\n            var populatedComponentState = this.AnimationService.populateComponentState(importWorkComponentState);\n\n            // populate the component state into this component\n            this.setStudentWork(populatedComponentState);\n\n            // make the work dirty so that it gets saved\n            this.studentDataChanged();\n          }\n        }\n      }\n    }\n  };\n\n  /**\n   * Get the component id\n   * @return the component id\n   */\n  getComponentId() {\n    return this.componentContent.id;\n  };\n\n  /**\n   * The component has changed in the regular authoring view so we will save the project\n   */\n  authoringViewComponentChanged() {\n\n    // update the JSON string in the advanced authoring view textarea\n    this.updateAdvancedAuthoringView();\n\n    /*\n     * notify the parent node that the content has changed which will save\n     * the project to the server\n     */\n    this.$scope.$parent.nodeAuthoringController.authoringViewNodeChanged();\n  };\n\n  /**\n   * The component has changed in the advanced authoring view so we will update\n   * the component and save the project.\n   */\n  advancedAuthoringViewComponentChanged() {\n\n    try {\n      /*\n       * create a new component by converting the JSON string in the advanced\n       * authoring view into a JSON object\n       */\n      var editedComponentContent = angular.fromJson(this.authoringComponentContentJSONString);\n\n      // replace the component in the project\n      this.ProjectService.replaceComponent(this.nodeId, this.componentId, editedComponentContent);\n\n      // set the new component into the controller\n      this.componentContent = editedComponentContent;\n\n      /*\n       * notify the parent node that the content has changed which will save\n       * the project to the server\n       */\n      this.$scope.$parent.nodeAuthoringController.authoringViewNodeChanged();\n    } catch(e) {\n      this.$scope.$parent.nodeAuthoringController.showSaveErrorAdvancedAuthoring();\n    }\n  };\n\n  /**\n   * Get all the step node ids in the project\n   * @returns all the step node ids\n   */\n  getStepNodeIds() {\n    var stepNodeIds = this.ProjectService.getNodeIds();\n\n    return stepNodeIds;\n  }\n\n  /**\n   * Get the step number and title\n   * @param nodeId get the step number and title for this node\n   * @returns the step number and title\n   */\n  getNodePositionAndTitleByNodeId(nodeId) {\n    var nodePositionAndTitle = this.ProjectService.getNodePositionAndTitleByNodeId(nodeId);\n\n    return nodePositionAndTitle;\n  }\n\n  /**\n   * Get the components in a step\n   * @param nodeId get the components in the step\n   * @returns the components in the step\n   */\n  getComponentsByNodeId(nodeId) {\n    var components = this.ProjectService.getComponentsByNodeId(nodeId);\n\n    return components;\n  }\n\n  /**\n   * Check if a node is a step node\n   * @param nodeId the node id to check\n   * @returns whether the node is an application node\n   */\n  isApplicationNode(nodeId) {\n    var result = this.ProjectService.isApplicationNode(nodeId);\n\n    return result;\n  }\n\n  /**\n   * Update the component JSON string that will be displayed in the advanced authoring view textarea\n   */\n  updateAdvancedAuthoringView() {\n    this.authoringComponentContentJSONString = angular.toJson(this.authoringComponentContent, 4);\n  };\n\n  /**\n   * Set the message next to the save button\n   * @param message the message to display\n   * @param time the time to display\n   */\n  setSaveMessage(message, time) {\n    this.saveMessage.text = message;\n    this.saveMessage.time = time;\n  };\n\n  /**\n   * Check if CRater is enabled for this component\n   * @returns whether CRater is enabled for this component\n   */\n  isCRaterEnabled() {\n    var result = false;\n\n    if (this.CRaterService.isCRaterEnabled(this.componentContent)) {\n      result = true;\n    }\n\n    return result;\n  }\n\n  /**\n   * Check if CRater is set to score on save\n   * @returns whether CRater is set to score on save\n   */\n  isCRaterScoreOnSave() {\n    var result = false;\n\n    if (this.CRaterService.isCRaterScoreOnSave(this.componentContent)) {\n      result = true;\n    }\n\n    return result;\n  }\n\n  /**\n   * Check if CRater is set to score on submit\n   * @returns whether CRater is set to score on submit\n   */\n  isCRaterScoreOnSubmit() {\n    var result = false;\n\n    if (this.CRaterService.isCRaterScoreOnSubmit(this.componentContent)) {\n      result = true;\n    }\n\n    return result;\n  }\n\n  /**\n   * Check if CRater is set to score on change\n   * @returns whether CRater is set to score on change\n   */\n  isCRaterScoreOnChange() {\n    var result = false;\n\n    if (this.CRaterService.isCRaterScoreOnChange(this.componentContent)) {\n      result = true;\n    }\n\n    return result;\n  }\n\n  /**\n   * Check if CRater is set to score when the student exits the step\n   * @returns whether CRater is set to score when the student exits the step\n   */\n  isCRaterScoreOnExit() {\n    var result = false;\n\n    if (this.CRaterService.isCRaterScoreOnExit(this.componentContent)) {\n      result = true;\n    }\n\n    return result;\n  }\n\n  /**\n   * Register the the listener that will listen for the exit event\n   * so that we can perform saving before exiting.\n   */\n  registerExitListener() {\n\n    /*\n     * Listen for the 'exit' event which is fired when the student exits\n     * the VLE. This will perform saving before the VLE exits.\n     */\n    this.exitListener = this.$scope.$on('exit', (event, args) => {\n\n    });\n  };\n\n  /**\n   * Add a scoring rule\n   */\n  authoringAddScoringRule() {\n\n    if (this.authoringComponentContent.cRater != null &&\n      this.authoringComponentContent.cRater.scoringRules != null) {\n\n      // create a scoring rule object\n      var newScoringRule = {};\n      newScoringRule.score = '';\n      newScoringRule.feedbackText = '';\n\n      // add the new scoring rule object\n      this.authoringComponentContent.cRater.scoringRules.push(newScoringRule);\n\n      /*\n       * the author has made changes so we will save the component\n       * content\n       */\n      this.authoringViewComponentChanged();\n    }\n  }\n\n  /**\n   * Move a scoring rule up\n   * @param index the index of the scoring rule\n   */\n  authoringViewScoringRuleUpClicked(index) {\n\n    if (this.authoringComponentContent.cRater != null &&\n      this.authoringComponentContent.cRater.scoringRules != null) {\n\n      // make sure the scoring rule is not already at the top\n      if (index != 0) {\n        // the scoring rule is not at the top so we can move it up\n\n        // get the scoring rule\n        var scoringRule = this.authoringComponentContent.cRater.scoringRules[index];\n\n        // remove the scoring rule\n        this.authoringComponentContent.cRater.scoringRules.splice(index, 1);\n\n        // add the scoring rule back at the position one index back\n        this.authoringComponentContent.cRater.scoringRules.splice(index - 1, 0, scoringRule);\n\n        /*\n         * the author has made changes so we will save the component\n         * content\n         */\n        this.authoringViewComponentChanged();\n      }\n    }\n  }\n\n  /**\n   * Move a scoring rule down\n   * @param index the index of the scoring rule\n   */\n  authoringViewScoringRuleDownClicked(index) {\n\n    if (this.authoringComponentContent.cRater != null &&\n      this.authoringComponentContent.cRater.scoringRules != null) {\n\n      // make sure the scoring rule is not already at the end\n      if (index != this.authoringComponentContent.cRater.scoringRules.length - 1) {\n\n        // get the scoring rule\n        var scoringRule = this.authoringComponentContent.cRater.scoringRules[index];\n\n        // remove the scoring rule\n        this.authoringComponentContent.cRater.scoringRules.splice(index, 1);\n\n        // add the scoring rule back at the position one index forward\n        this.authoringComponentContent.cRater.scoringRules.splice(index + 1, 0, scoringRule);\n\n        /*\n         * the author has made changes so we will save the component\n         * content\n         */\n        this.authoringViewComponentChanged();\n      }\n    }\n  }\n\n  /**\n   * Delete a scoring rule\n   * @param index the index of the scoring rule\n   */\n  authoringViewScoringRuleDeleteClicked(index) {\n\n    if (this.authoringComponentContent.cRater != null &&\n      this.authoringComponentContent.cRater.scoringRules != null) {\n\n      // get the scoring rule\n      var scoringRule = this.authoringComponentContent.cRater.scoringRules[index];\n\n      if (scoringRule != null) {\n\n        // get the score and feedback text\n        var score = scoringRule.score;\n        var feedbackText = scoringRule.feedbackText;\n\n        // make sure the author really wants to delete the scoring rule\n        //var answer = confirm('Are you sure you want to delete this scoring rule?\\n\\nScore: ' + score + '\\n\\n' + 'Feedback Text: ' + feedbackText);\n        var answer = confirm(this.$translate('animation.areYouSureYouWantToDeleteThisScoringRule', {score: score, feedbackText: feedbackText}));\n\n        if (answer) {\n          // the author answered yes to delete the scoring rule\n          this.authoringComponentContent.cRater.scoringRules.splice(index, 1);\n\n          /*\n           * the author has made changes so we will save the component\n           * content\n           */\n          this.authoringViewComponentChanged();\n        }\n      }\n    }\n  }\n\n  /**\n   * Add a new notification. Currently assumes this is a notification based on CRaterResult, but\n   * we can add different types in the future.\n   */\n  authoringAddNotification() {\n\n    if (this.authoringComponentContent.notificationSettings != null &&\n      this.authoringComponentContent.notificationSettings.notifications != null) {\n\n      // create a new notification\n      let newNotification = {\n        notificationType: 'CRaterResult',\n        enableCriteria: {\n          scoreSequence: ['', '']\n        },\n        isAmbient: false,\n        dismissCode: 'apple',\n        isNotifyTeacher: true,\n        isNotifyStudent: true,\n        notificationMessageToStudent: '{{username}}, ' + this.$translate('animation.youGotAScoreOf') + ' {{score}}. ' + this.$translate('animation.pleaseTalkToYourTeacher') + '.',\n        notificationMessageToTeacher: '{{username}} ' + this.$translate('animation.gotAScoreOf') + ' {{score}}.'\n      };\n\n      // add the new notification\n      this.authoringComponentContent.notificationSettings.notifications.push(newNotification);\n\n      // the author has made changes so we will save the component content\n      this.authoringViewComponentChanged();\n    }\n  }\n\n  /**\n   * Add a multiple attempt scoring rule\n   */\n  authoringAddMultipleAttemptScoringRule() {\n\n    if (this.authoringComponentContent.cRater != null &&\n      this.authoringComponentContent.cRater.multipleAttemptScoringRules != null) {\n\n      // create a new multiple attempt scoring rule\n      var newMultipleAttemptScoringRule = {};\n      newMultipleAttemptScoringRule.scoreSequence = ['', ''];\n      newMultipleAttemptScoringRule.feedbackText = '';\n\n      // add the new multiple attempt scoring rule\n      this.authoringComponentContent.cRater.multipleAttemptScoringRules.push(newMultipleAttemptScoringRule);\n\n      /*\n       * the author has made changes so we will save the component\n       * content\n       */\n      this.authoringViewComponentChanged();\n    }\n  }\n\n  /**\n   * Move a multiple attempt scoring rule up\n   * @param index\n   */\n  authoringViewMultipleAttemptScoringRuleUpClicked(index) {\n\n    if (this.authoringComponentContent.cRater != null &&\n      this.authoringComponentContent.cRater.multipleAttemptScoringRules != null) {\n\n      // make sure the multiple attempt scoring rule is not already at the top\n      if (index != 0) {\n        // the multiple attempt scoring rule is not at the top\n\n        // get the multiple attempt scoring rule\n        var multipleAttemptScoringRule = this.authoringComponentContent.cRater.multipleAttemptScoringRules[index];\n\n        // remove the multiple attempt scoring rule\n        this.authoringComponentContent.cRater.multipleAttemptScoringRules.splice(index, 1);\n\n        // add the multiple attempt scoring rule back at the position one index back\n        this.authoringComponentContent.cRater.multipleAttemptScoringRules.splice(index - 1, 0, multipleAttemptScoringRule);\n\n        /*\n         * the author has made changes so we will save the component\n         * content\n         */\n        this.authoringViewComponentChanged();\n      }\n    }\n  }\n\n  /**\n   * Move a multiple attempt scoring rule down\n   * @param index the index of the multiple attempt scoring rule\n   */\n  authoringViewMultipleAttemptScoringRuleDownClicked(index) {\n\n    if (this.authoringComponentContent.cRater != null &&\n      this.authoringComponentContent.cRater.multipleAttemptScoringRules != null) {\n\n      // make sure the multiple attempt scoring rule is not at the end\n      if (index != this.authoringComponentContent.cRater.multipleAttemptScoringRules.length - 1) {\n        // the multiple attempt scoring rule is not at the end\n\n        // get the multiple attempt scoring rule\n        var multipleAttemptScoringRule = this.authoringComponentContent.cRater.multipleAttemptScoringRules[index];\n\n        // remove the multiple attempt scoring rule\n        this.authoringComponentContent.cRater.multipleAttemptScoringRules.splice(index, 1);\n\n        // add the multiple attempt scoring rule back at the position one index forward\n        this.authoringComponentContent.cRater.multipleAttemptScoringRules.splice(index + 1, 0, multipleAttemptScoringRule);\n\n        /*\n         * the author has made changes so we will save the component\n         * content\n         */\n        this.authoringViewComponentChanged();\n      }\n    }\n  }\n\n  /**\n   * Delete a multiple attempt scoring rule\n   * @param index the index of the mulitple attempt scoring rule\n   */\n  authoringViewMultipleAttemptScoringRuleDeleteClicked(index) {\n\n    if (this.authoringComponentContent.cRater != null &&\n      this.authoringComponentContent.cRater.multipleAttemptScoringRules != null) {\n\n      // get the multiple attempt scoring rule\n      var multipleAttemptScoringRule = this.authoringComponentContent.cRater.multipleAttemptScoringRules[index];\n\n      if (multipleAttemptScoringRule != null) {\n\n        // get the score sequence\n        var scoreSequence = multipleAttemptScoringRule.scoreSequence;\n        var previousScore = '';\n        var currentScore = '';\n\n        if (scoreSequence != null) {\n          previousScore = scoreSequence[0];\n          currentScore = scoreSequence[1];\n        }\n\n        // get the feedback text\n        var feedbackText = multipleAttemptScoringRule.feedbackText;\n\n        // make sure the author really wants to delete the multiple attempt scoring rule\n        var answer = confirm(this.$translate('animation.areYouSureYouWantToDeleteThisMultipleAttemptScoringRule', {previousScore: previousScore, currentScore: currentScore, feedbackText: feedbackText}));\n\n        if (answer) {\n          // the author answered yes to delete the multiple attempt scoring rule\n          this.authoringComponentContent.cRater.multipleAttemptScoringRules.splice(index, 1);\n\n          /*\n           * the author has made changes so we will save the component\n           * content\n           */\n          this.authoringViewComponentChanged();\n        }\n      }\n    }\n  }\n\n  /**\n   * Move a notification up\n   * @param index of the notification\n   */\n  authoringViewNotificationUpClicked(index) {\n\n    if (this.authoringComponentContent.notificationSettings != null &&\n      this.authoringComponentContent.notificationSettings.notifications != null) {\n\n      // make sure the notification is not already at the top\n      if (index != 0) {\n        // the notification is not at the top\n\n        // get the notification\n        var notification = this.authoringComponentContent.notificationSettings.notifications[index];\n\n        // remove the notification\n        this.authoringComponentContent.notificationSettings.notifications.splice(index, 1);\n\n        // add the notification back at the position one index back\n        this.authoringComponentContent.notificationSettings.notifications.splice(index - 1, 0, notification);\n\n        // the author has made changes so we will save the component content\n        this.authoringViewComponentChanged();\n      }\n    }\n  }\n\n  /**\n   * Move a notification down\n   * @param index the index of the notification\n   */\n  authoringViewNotificationDownClicked(index) {\n\n    if (this.authoringComponentContent.notificationSettings != null &&\n      this.authoringComponentContent.notificationSettings.notifications != null) {\n\n      // make sure the notification is not at the end\n      if (index != this.authoringComponentContent.notificationSettings.notifications.length - 1) {\n        // the notification is not at the end\n\n        // get the notification\n        var notification = this.authoringComponentContent.notificationSettings.notifications[index];\n\n        // remove the notification\n        this.authoringComponentContent.notificationSettings.notifications.splice(index, 1);\n\n        // add the notification back at the position one index forward\n        this.authoringComponentContent.notificationSettings.notifications.splice(index + 1, 0, notification);\n\n        // the author has made changes so we will save the component content\n        this.authoringViewComponentChanged();\n      }\n    }\n  }\n\n  /**\n   * Delete a notification\n   * @param index the index of the notification\n   */\n  authoringViewNotificationDeleteClicked(index) {\n\n    if (this.authoringComponentContent.notificationSettings != null &&\n      this.authoringComponentContent.notificationSettings.notifications != null) {\n\n      // get the notification\n      var notification = this.authoringComponentContent.notificationSettings.notifications[index];\n\n      if (notification != null) {\n\n        // get the score sequence\n        var scoreSequence = notification.enableCriteria.scoreSequence;\n        var previousScore = '';\n        var currentScore = '';\n\n        if (scoreSequence != null) {\n          previousScore = scoreSequence[0];\n          currentScore = scoreSequence[1];\n        }\n\n        // make sure the author really wants to delete the notification\n        var answer = confirm(this.$translate('animation.areYouSureYouWantToDeleteThisNotification', {previousScore: previousScore, currentScore: currentScore}));\n\n        if (answer) {\n          // the author answered yes to delete the notification\n          this.authoringComponentContent.notificationSettings.notifications.splice(index, 1);\n\n          // the author has made changes so we will save the component content\n          this.authoringViewComponentChanged();\n        }\n      }\n    }\n  }\n\n  /**\n   * The \"Enable CRater\" checkbox was clicked\n   */\n  authoringViewEnableCRaterClicked() {\n\n    if (this.authoringComponentContent.enableCRater) {\n      // CRater was turned on\n\n      if (this.authoringComponentContent.cRater == null) {\n        /*\n         * the cRater object does not exist in the component content\n         * so we will create it\n         */\n\n        // create the cRater object\n        var cRater = {};\n        cRater.itemType = 'CRATER';\n        cRater.itemId = '';\n        cRater.scoreOn = 'submit';\n        cRater.showScore = true;\n        cRater.showFeedback = true;\n        cRater.scoringRules = [];\n        cRater.enableMultipleAttemptScoringRules = false;\n        cRater.multipleAttemptScoringRules = []\n\n        // set the cRater object into the component content\n        this.authoringComponentContent.cRater = cRater;\n      }\n\n      // turn on the submit button\n      //this.authoringComponentContent.showSubmitButton = true;\n      this.setShowSubmitButtonValue(true);\n    } else {\n      // CRater was turned off\n\n      // turn off the submit button\n      this.setShowSubmitButtonValue(false);\n    }\n\n    /*\n     * the author has made changes so we will save the component\n     * content\n     */\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * The \"Enable Multiple Attempt Feedback\" checkbox was clicked\n   */\n  enableMultipleAttemptScoringRulesClicked() {\n\n    // get the cRater object from the component content\n    var cRater = this.authoringComponentContent.cRater;\n\n    if (cRater != null && cRater.multipleAttemptScoringRules == null) {\n      /*\n       * the multiple attempt scoring rules array does not exist so\n       * we will create it\n       */\n      cRater.multipleAttemptScoringRules = [];\n    }\n\n    /*\n     * the author has made changes so we will save the component\n     * content\n     */\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * The \"Enable Notifications\" checkbox was clicked\n   */\n  authoringViewEnableNotificationsClicked() {\n\n    if (this.authoringComponentContent.enableNotifications) {\n      // Notifications was turned on\n\n      if (this.authoringComponentContent.notificationSettings == null) {\n        /*\n         * the NotificationSettings object does not exist in the component content\n         * so we will create it\n         */\n        this.authoringComponentContent.notificationSettings = {\n          notifications: []\n        };\n      }\n    }\n\n    /*\n     * the author has made changes so we will save the component\n     * content\n     */\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Check if a component generates student work\n   * @param component the component\n   * @return whether the component generates student work\n   */\n  componentHasWork(component) {\n    var result = true;\n\n    if (component != null) {\n      result = this.ProjectService.componentHasWork(component);\n    }\n\n    return result;\n  }\n\n  /**\n   * Returns all the revisions made by this user for the specified component\n   */\n  getRevisions() {\n    // get the component states for this component\n    return this.StudentDataService.getComponentStatesByNodeIdAndComponentId(this.nodeId, this.componentId);\n  };\n\n  /**\n   * The author has changed the rubric\n   */\n  summernoteRubricHTMLChanged() {\n\n    // get the summernote rubric html\n    var html = this.summernoteRubricHTML;\n\n    /*\n     * remove the absolute asset paths\n     * e.g.\n     * <img src='https://wise.berkeley.edu/curriculum/3/assets/sun.png'/>\n     * will be changed to\n     * <img src='sun.png'/>\n     */\n    html = this.ConfigService.removeAbsoluteAssetPaths(html);\n\n    /*\n     * replace <a> and <button> elements with <wiselink> elements when\n     * applicable\n     */\n    html = this.UtilService.insertWISELinks(html);\n\n    // update the component rubric\n    this.authoringComponentContent.rubric = html;\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Add a connected component\n   */\n  addConnectedComponent() {\n\n    /*\n     * create the new connected component object that will contain a\n     * node id and component id\n     */\n    var newConnectedComponent = {};\n    newConnectedComponent.nodeId = this.nodeId;\n    newConnectedComponent.componentId = null;\n    newConnectedComponent.updateOn = 'change';\n\n    // initialize the array of connected components if it does not exist yet\n    if (this.authoringComponentContent.connectedComponents == null) {\n      this.authoringComponentContent.connectedComponents = [];\n    }\n\n    // add the connected component\n    this.authoringComponentContent.connectedComponents.push(newConnectedComponent);\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Delete a connected component\n   * @param index the index of the component to delete\n   */\n  deleteConnectedComponent(index) {\n\n    if (this.authoringComponentContent.connectedComponents != null) {\n      this.authoringComponentContent.connectedComponents.splice(index, 1);\n    }\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Set the show submit button value\n   * @param show whether to show the submit button\n   */\n  setShowSubmitButtonValue(show) {\n\n    if (show == null || show == false) {\n      // we are hiding the submit button\n      this.authoringComponentContent.showSaveButton = false;\n      this.authoringComponentContent.showSubmitButton = false;\n    } else {\n      // we are showing the submit button\n      this.authoringComponentContent.showSaveButton = true;\n      this.authoringComponentContent.showSubmitButton = true;\n    }\n\n    /*\n     * notify the parent node that this component is changing its\n     * showSubmitButton value so that it can show save buttons on the\n     * step or sibling components accordingly\n     */\n    this.$scope.$emit('componentShowSubmitButtonValueChanged', {nodeId: this.nodeId, componentId: this.componentId, showSubmitButton: show});\n  }\n\n  /**\n   * The showSubmitButton value has changed\n   */\n  showSubmitButtonValueChanged() {\n\n    /*\n     * perform additional processing for when we change the showSubmitButton\n     * value\n     */\n    this.setShowSubmitButtonValue(this.authoringComponentContent.showSubmitButton);\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * The play button was clicked\n   */\n  playButtonClicked() {\n\n    // set the animation state\n    this.animationState = 'playing';\n\n    // start the animation\n    this.startAnimation();\n  }\n\n  /**\n   * The pause button was clicked\n   */\n  pauseButtonClicked() {\n\n    // set the animation state\n    this.animationState = 'paused';\n\n    if (this.componentContent != null) {\n\n      // get the objects\n      let objects = this.componentContent.objects;\n\n      if (objects != null) {\n\n        // loop through all the objects\n        for (let o = 0; o < objects.length; o++) {\n          let object = objects[o];\n\n          if (object != null) {\n            let id = object.id;\n\n            // get the svg object\n            let svgObject = this.idToSVGObject[id];\n\n            if (svgObject != null) {\n\n              // pause the object from animating\n              svgObject.pause();\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * The resume button was clicked\n   */\n  resumeButtonClicked() {\n\n    // set the animation state\n    this.animationState = 'playing';\n\n    if (this.componentContent != null) {\n\n      // get the objects\n      let objects = this.componentContent.objects;\n\n      if (objects != null) {\n\n        // loop through all the objects\n        for (let o = 0; o < objects.length; o++) {\n          let object = objects[o];\n\n          if (object != null) {\n            let id = object.id;\n\n            // get the svg object\n            let svgObject = this.idToSVGObject[id];\n\n            if (svgObject != null) {\n              /*\n               * Check if the object still needs to be animated or\n               * if it has already finished performing all of its\n               * animation. We only need to play it if it still\n               * has more animating.\n               */\n              if (this.idToAnimationState[id]) {\n                // resume playing the object animation\n                svgObject.play();\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * The reset button was clicked\n   */\n  resetButtonClicked() {\n\n    // set the animation state\n    this.animationState = 'stopped';\n\n    if (this.componentContent != null) {\n\n      // get the objects\n      let objects = this.componentContent.objects;\n\n      if (objects != null) {\n\n        // loop through all the objects\n        for (let o = 0; o < objects.length; o++) {\n          let object = objects[o];\n\n          if (object != null) {\n            let id = object.id;\n\n            // get the svg object\n            let svgObject = this.idToSVGObject[id];\n\n            if (svgObject != null) {\n\n              let jumpToEnd = true;\n              let clearQueue = true;\n\n              /*\n               * Check if the object still needs to be animated or\n               * if it has already finished performing all of its\n               * animation. We only need to play it if it still\n               * has more animating.\n               */\n              if (this.idToAnimationState[id]) {\n                /*\n                 * We need to play it in case it is currently paused.\n                 * There is a minor bug in the animation library\n                 * which is caused if you pause an animation and\n                 * then stop the animation. Then if you try to play the\n                 * animation, the animation will not play. We avoid\n                 * this problem by making sure the object animation\n                 * is playing when we stop it.\n                 */\n                svgObject.play();\n              }\n\n              // stop the object from animating\n              svgObject.stop(jumpToEnd, clearQueue);\n            }\n          }\n        }\n      }\n    }\n\n    this.$timeout(() => {\n      // set the display time to 0\n      this.displayAndBroadcastTime(0);\n\n      // set the images back to their starting images in case they have changed\n      this.initializeObjectImages();\n\n      // put the objects in their starting positions\n      this.initializeObjectPositions();\n    }, 100);\n  }\n\n  /**\n   * Check if any of the objects are animating\n   * @return whether any of the objects are animating\n   */\n  areAnyObjectsAnimating() {\n\n    if (this.componentContent != null) {\n\n      // get the objects\n      let objects = this.componentContent.objects;\n\n      if (objects != null) {\n\n        // loop through all the objects\n        for (let o = 0; o < objects.length; o++) {\n          let object = objects[o];\n\n          if (object != null) {\n            let id = object.id;\n\n            /*\n             * check if the object still needs to be animated or if\n             * it has already finished performing all of its\n             * animating\n             */\n            if (this.idToAnimationState[id]) {\n              // an object is animating\n              return true;\n            }\n          }\n        }\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Whether we are using the cartesian coordinate system\n   * @return whether we are using the cartesian coordinate system\n   */\n  isUsingCartesianCoordinateSystem() {\n\n    if (this.coordinateSystem == 'cartesian') {\n      // we are using the cartesian coordinate system\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Convert the y value to the cartesian coordinate system\n   * @param y the pixel y value in the screen coordinate system\n   * @return the pixel y value in the cartesian coordinate system\n   */\n  convertToCartesianCoordinateSystem(y) {\n    return this.height - y;\n  }\n\n  /**\n   * The student changed the speed slider value\n   */\n  speedSliderChanged() {\n\n    if (this.speedSliderValue == 1) {\n      this.realTimePerDataTime = 10000;\n    } else if (this.speedSliderValue == 2) {\n      this.realTimePerDataTime = 1000;\n    } else if (this.speedSliderValue == 3) {\n      this.realTimePerDataTime = 100;\n    } else if (this.speedSliderValue == 4) {\n      this.realTimePerDataTime = 10;\n    } else if (this.speedSliderValue == 5) {\n      this.realTimePerDataTime = 1;\n    }\n\n    // reset the animation\n    this.resetButtonClicked();\n  }\n\n  /**\n   * Remove all the objects from the svg div\n   */\n  removeAllObjects() {\n\n    if (this.idToSVGObject != null) {\n\n      // get all the object ids\n      var keys = Object.keys(this.idToSVGObject);\n\n      if (keys != null) {\n\n        // loop through all the keys\n        for (var k = 0; k < keys.length; k++) {\n          var key = keys[k];\n\n          // get the svg object\n          var svgObject = this.idToSVGObject[key];\n\n          if (svgObject != null) {\n            // remove the svg object from the svg div\n            svgObject.remove();\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Add a new object\n   */\n  authoringAddObjectClicked() {\n\n    // initialize the objects array if necessary\n    if (this.authoringComponentContent.objects == null) {\n      this.authoringComponentContent.objects = [];\n    }\n\n    // create a new object\n    var newObject = {};\n    newObject.id = this.UtilService.generateKey(10);\n    newObject.type = 'image';\n\n    // add the object to our array of objects\n    this.authoringComponentContent.objects.push(newObject);\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Add a data point to an object\n   * @param object add a data point to this object\n   */\n  authoringAddDataPointClicked(object) {\n    if (object != null) {\n\n      if (object.dataSource != null) {\n        // the object already has a data source\n\n        // ask the user if they are sure they want to delete the data source\n        var answer = confirm('You can only have Data Points or a Data Source. If you add a Data Point, the Data Source will be deleted. Are you sure you want to add a Data Point?');\n\n        if (answer) {\n          // the author answered yes to delete the data source\n          delete object.dataSource;\n\n          // initialize the data array if necessary\n          if (object.data == null) {\n            object.data = [];\n          }\n\n          // create a new data point\n          var newDataPoint = {};\n\n          // add the new data point\n          object.data.push(newDataPoint);\n        }\n      } else {\n        // the object does not have a data source so we can add a data point\n\n        // initialize the data array if necessary\n        if (object.data == null) {\n          object.data = [];\n        }\n\n        // create a new data point\n        var newDataPoint = {};\n\n        // add the new data point\n        object.data.push(newDataPoint);\n      }\n    }\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Delete a data point from an object\n   * @param object the object to delete a data point from\n   * @param index the index of the data point to delete\n   */\n  authoringDeleteObjectDataPointClicked(object, index) {\n\n    if (object != null && object.data != null) {\n\n      // ask the author if they are sure they want to delete the point\n      var answer = confirm(this.$translate('animation.areYouSureYouWantToDeleteThisDataPoint'));\n\n      if (answer) {\n        // delete the data point at the given index\n        object.data.splice(index, 1);\n\n        // the authoring component content has changed so we will save the project\n        this.authoringViewComponentChanged();\n      }\n    }\n  }\n\n  /**\n   * Move a data point up\n   * @param object the object the data point belongs to\n   * @param index the index of the data point in the object\n   */\n  authoringMoveObjectDataPointUpClicked(object, index) {\n    if (object != null && object.data != null) {\n\n      if (index > 0) {\n        // the data point is not at the top so we can move it up\n\n        // remember the data point we are moving\n        var dataPoint = object.data[index];\n\n        // remove the data point at the given index\n        object.data.splice(index, 1);\n\n        // insert the data point back in at one index back\n        object.data.splice(index - 1, 0, dataPoint);\n      }\n\n      // the authoring component content has changed so we will save the project\n      this.authoringViewComponentChanged();\n    }\n  }\n\n  /**\n   * Move a data point down\n   * @param object the object the data point belongs to\n   * @param index the index of the data point in the object\n   */\n  authoringMoveObjectDataPointDownClicked(object, index) {\n    if (object != null && object.data != null) {\n\n      if (index < object.data.length - 1) {\n        // the data point is not at the bottom so we can move it down\n\n        // remember the data point we are moving\n        var dataPoint = object.data[index];\n\n        // remove the data point at the given index\n        object.data.splice(index, 1);\n\n        // insert the data point back in at one index forward\n        object.data.splice(index + 1, 0, dataPoint);\n      }\n\n      // the authoring component content has changed so we will save the project\n      this.authoringViewComponentChanged();\n    }\n  }\n\n  /**\n   * Move an object up\n   * @param index the index of the object\n   */\n  authoringMoveObjectUpClicked(index) {\n\n    if (this.authoringComponentContent != null) {\n\n      var objects = this.authoringComponentContent.objects;\n\n      if (objects != null) {\n\n        if (index > 0) {\n          // the object is not at the top so we can move it up\n\n          // remember the object we are moving\n          var object = objects[index];\n\n          // remove the object\n          objects.splice(index, 1);\n\n          // insert the object back in at one index back\n          objects.splice(index - 1, 0, object);\n        }\n      }\n    }\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Move an object down\n   * @param index the index of the object\n   */\n  authoringMoveObjectDownClicked(index) {\n\n    if (this.authoringComponentContent != null) {\n\n      var objects = this.authoringComponentContent.objects;\n\n      if (objects != null) {\n\n        if (index < objects.length - 1) {\n          // the object is not at the bottom so we can move it down\n\n          // remember the object we are moving\n          var object = objects[index];\n\n          // remove the object\n          objects.splice(index, 1);\n\n          // insert the object back in at one index forward\n          objects.splice(index + 1, 0, object);\n        }\n      }\n    }\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Delete an object\n   * @param index the index of the object\n   */\n  authoringDeleteObjectClicked(index) {\n\n    if (this.authoringComponentContent != null) {\n\n      var answer = confirm(this.$translate('animation.areYouSureYouWantToDeleteThisObject'));\n\n      if (answer) {\n        var objects = this.authoringComponentContent.objects;\n\n        if (objects != null) {\n          // remove the object from the array of objects\n          objects.splice(index, 1);\n        }\n      }\n    }\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Get a component\n   * @param nodeId the node id\n   * @param componentId the component id\n   */\n  getComponentByNodeIdAndComponentId(nodeId, componentId) {\n    return this.ProjectService.getComponentByNodeIdAndComponentId(nodeId, componentId);\n  }\n\n  /**\n   * The add data source button was clicked\n   * @param object the object we will add the data source to\n   */\n  authoringAddDataSourceClicked(object) {\n\n    if (object != null && object.data != null && object.data.length > 0) {\n      /*\n       * the object has data so we will ask the author if they are sure\n       * they want to add a data source which will remove the data\n       */\n\n      var answer = confirm('You can only have Data Points or a Data Source. If you add a Data Source, the Data Points will be deleted. Are you sure you want to add a Data Source?');\n\n      if (answer) {\n        // the author answered yes to delete the data points\n\n        // delete the data points\n        delete object.data;\n\n        // add the data source\n        object.dataSource = {};\n      }\n    } else {\n      // there are no data points so we can add the data source\n\n      // delete the data points\n      delete object.data;\n\n      // add the data source\n      object.dataSource = {};\n    }\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * The delete data source button was clicked\n   * @param object the object to delete the data source from\n   */\n  authoringDeleteDataSourceClicked(object) {\n\n    // ask the author if they are sure they want to delete the data source\n    var answer = confirm('Are you sure you want to delete the Data Source?');\n\n    if (answer) {\n      // the author answered yes to delete the data source\n      delete object.dataSource;\n    }\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * The data source node has changed\n   * @param object the object that has changed\n   */\n  dataSourceNodeChanged(object) {\n\n    if (object != null) {\n\n      // remember the node id\n      var nodeId = object.dataSource.nodeId;\n\n      // clear the dataSource object except for the node id\n      object.dataSource = {\n        nodeId: nodeId\n      }\n    }\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * The data source component has changed\n   * @param object the object that has changed\n   */\n  dataSourceComponentChanged(object) {\n\n    if (object != null) {\n\n      // remember the node id and component id\n      var nodeId = object.dataSource.nodeId;\n      var componentId = object.dataSource.componentId;\n\n      // get the component\n      var component = this.getComponentByNodeIdAndComponentId(nodeId, componentId);\n\n      // clear the dataSource object except for the node id and component id\n      object.dataSource = {\n        nodeId: nodeId,\n        componentId: componentId\n      };\n\n      if (component != null && component.type == 'Graph') {\n        // set the default parameters for a graph data source\n        object.dataSource.trialIndex = 0;\n        object.dataSource.seriesIndex = 0;\n        object.dataSource.tColumnIndex = 0;\n        object.dataSource.xColumnIndex = 1;\n      }\n    }\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Show the asset popup to allow the author to choose the image\n   */\n  chooseImage(object) {\n\n    // generate the parameters\n    var params = {};\n    params.isPopup = true;\n    params.nodeId = this.nodeId;\n    params.componentId = this.componentId;\n    params.target = 'image';\n    params.targetObject = object;\n\n    // display the asset chooser\n    this.$rootScope.$broadcast('openAssetChooser', params);\n  }\n\n  /**\n   * Show the asset popup to allow the author to choose the image moving left\n   * @param object the object to set the image moving left\n   */\n  chooseImageMovingLeft(object) {\n\n    // generate the parameters\n    var params = {};\n    params.isPopup = true;\n    params.nodeId = this.nodeId;\n    params.componentId = this.componentId;\n    params.target = 'imageMovingLeft';\n    params.targetObject = object;\n\n    // display the asset chooser\n    this.$rootScope.$broadcast('openAssetChooser', params);\n  }\n\n  /**\n   * Show the asset popup to allow the author to choose the image moving right\n   * @param object the object to set the image moving right\n   */\n  chooseImageMovingRight(object) {\n\n    // generate the parameters\n    var params = {};\n    params.isPopup = true;\n    params.nodeId = this.nodeId;\n    params.componentId = this.componentId;\n    params.target = 'imageMovingRight';\n    params.targetObject = object;\n\n    // display the asset chooser\n    this.$rootScope.$broadcast('openAssetChooser', params);\n  }\n\n  /**\n   * The type for an object changed\n   * @param object the object that changed\n   */\n  authoringObjectTypeChanged(object) {\n\n    if (object != null) {\n      if (object.type == 'image') {\n        // the type changed to an image so we will delete the text field\n        delete object.text;\n      } else if (object.type == 'text') {\n        // the type changed to text so we will delete the image fields\n        delete object.image;\n        delete object.width;\n        delete object.height;\n        delete object.imageMovingLeft;\n        delete object.imageMovingRight;\n        delete object.imageMovingUp;\n        delete object.imageMovingDown;\n      }\n    }\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Add a tag\n   */\n  addTag() {\n\n    if (this.authoringComponentContent.tags == null) {\n      // initialize the tags array\n      this.authoringComponentContent.tags = [];\n    }\n\n    // add a tag\n    this.authoringComponentContent.tags.push('');\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Move a tag up\n   * @param index the index of the tag to move up\n   */\n  moveTagUp(index) {\n\n    if (index > 0) {\n      // the index is not at the top so we can move it up\n\n      // remember the tag\n      let tag = this.authoringComponentContent.tags[index];\n\n      // remove the tag\n      this.authoringComponentContent.tags.splice(index, 1);\n\n      // insert the tag one index back\n      this.authoringComponentContent.tags.splice(index - 1, 0, tag);\n    }\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Move a tag down\n   * @param index the index of the tag to move down\n   */\n  moveTagDown(index) {\n\n    if (index < this.authoringComponentContent.tags.length - 1) {\n      // the index is not at the bottom so we can move it down\n\n      // remember the tag\n      let tag = this.authoringComponentContent.tags[index];\n\n      // remove the tag\n      this.authoringComponentContent.tags.splice(index, 1);\n\n      // insert the tag one index forward\n      this.authoringComponentContent.tags.splice(index + 1, 0, tag);\n    }\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Delete a tag\n   * @param index the index of the tag to delete\n   */\n  deleteTag(index) {\n\n    // ask the author if they are sure they want to delete the tag\n    let answer = confirm(this.$translate('areYouSureYouWantToDeleteThisTag'));\n\n    if (answer) {\n      // the author answered yes to delete the tag\n\n      // remove the tag\n      this.authoringComponentContent.tags.splice(index, 1);\n    }\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Import any work we need from connected components\n   */\n  handleConnectedComponents() {\n\n    // get the connected components\n    var connectedComponents = this.componentContent.connectedComponents;\n\n    if (connectedComponents != null) {\n\n      var componentStates = [];\n\n      // loop through all the connected components\n      for (var c = 0; c < connectedComponents.length; c++) {\n        var connectedComponent = connectedComponents[c];\n\n        if (connectedComponent != null) {\n          var nodeId = connectedComponent.nodeId;\n          var componentId = connectedComponent.componentId;\n          var type = connectedComponent.type;\n\n          if (type == 'showWork') {\n            // we are getting the work from this student\n\n            // get the latest component state from the component\n            var componentState = this.StudentDataService.getLatestComponentStateByNodeIdAndComponentId(nodeId, componentId);\n\n            if (componentState != null) {\n              componentStates.push(this.UtilService.makeCopyOfJSONObject(componentState));\n            }\n\n            // we are showing work so we will not allow the student to edit it\n            this.isDisabled = true;\n          } else if (type == 'importWork' || type == null) {\n            // we are getting the work from this student\n\n            // get the latest component state from the component\n            var componentState = this.StudentDataService.getLatestComponentStateByNodeIdAndComponentId(nodeId, componentId);\n\n            if (componentState != null) {\n              componentStates.push(this.UtilService.makeCopyOfJSONObject(componentState));\n            }\n          }\n        }\n      }\n\n      // merge the student responses from all the component states\n      var mergedComponentState = this.createMergedComponentState(componentStates);\n\n      // set the student work into the component\n      this.setStudentWork(mergedComponentState);\n\n      // make the work dirty so that it gets saved\n      this.studentDataChanged();\n    }\n  }\n\n  /**\n   * Create a component state with the merged student data\n   * @param componentStates an array of component states\n   * @return a component state with the merged student data\n   */\n  createMergedComponentState(componentStates) {\n    let mergedComponentState = this.NodeService.createNewComponentState();\n    if (componentStates != null) {\n      let mergedResponse = '';\n      for (let c = 0; c < componentStates.length; c++) {\n        let componentState = componentStates[c];\n        if (componentState != null) {\n          let studentData = componentState.studentData;\n          if (studentData != null) {\n\n          }\n        }\n      }\n      if (mergedResponse != null && mergedResponse != '') {\n        mergedComponentState.studentData = {};\n      }\n    }\n    return mergedComponentState;\n  }\n\n  /**\n   * Add a connected component\n   */\n  authoringAddConnectedComponent() {\n\n    /*\n     * create the new connected component object that will contain a\n     * node id and component id\n     */\n    var newConnectedComponent = {};\n    newConnectedComponent.nodeId = this.nodeId;\n    newConnectedComponent.componentId = null;\n    newConnectedComponent.type = null;\n    this.authoringAutomaticallySetConnectedComponentComponentIdIfPossible(newConnectedComponent);\n\n    // initialize the array of connected components if it does not exist yet\n    if (this.authoringComponentContent.connectedComponents == null) {\n      this.authoringComponentContent.connectedComponents = [];\n    }\n\n    // add the connected component\n    this.authoringComponentContent.connectedComponents.push(newConnectedComponent);\n\n    // the authoring component content has changed so we will save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Automatically set the component id for the connected component if there\n   * is only one viable option.\n   * @param connectedComponent the connected component object we are authoring\n   */\n  authoringAutomaticallySetConnectedComponentComponentIdIfPossible(connectedComponent) {\n    if (connectedComponent != null) {\n      let components = this.getComponentsByNodeId(connectedComponent.nodeId);\n      if (components != null) {\n        let numberOfAllowedComponents = 0;\n        let allowedComponent = null;\n        for (let component of components) {\n          if (component != null) {\n            if (this.isConnectedComponentTypeAllowed(component.type) &&\n                component.id != this.componentId) {\n              // we have found a viable component we can connect to\n              numberOfAllowedComponents += 1;\n              allowedComponent = component;\n            }\n          }\n        }\n\n        if (numberOfAllowedComponents == 1) {\n          /*\n           * there is only one viable component to connect to so we\n           * will use it\n           */\n          connectedComponent.componentId = allowedComponent.id;\n          connectedComponent.type = 'importWork';\n        }\n      }\n    }\n  }\n\n  /**\n   * Delete a connected component\n   * @param index the index of the component to delete\n   */\n  authoringDeleteConnectedComponent(index) {\n\n    // ask the author if they are sure they want to delete the connected component\n    let answer = confirm(this.$translate('areYouSureYouWantToDeleteThisConnectedComponent'));\n\n    if (answer) {\n      // the author answered yes to delete\n\n      if (this.authoringComponentContent.connectedComponents != null) {\n        this.authoringComponentContent.connectedComponents.splice(index, 1);\n      }\n\n      // the authoring component content has changed so we will save the project\n      this.authoringViewComponentChanged();\n    }\n  }\n\n  /**\n   * Get the connected component type\n   * @param connectedComponent get the component type of this connected component\n   * @return the connected component type\n   */\n  authoringGetConnectedComponentType(connectedComponent) {\n\n    var connectedComponentType = null;\n\n    if (connectedComponent != null) {\n\n      // get the node id and component id of the connected component\n      var nodeId = connectedComponent.nodeId;\n      var componentId = connectedComponent.componentId;\n\n      // get the component\n      var component = this.ProjectService.getComponentByNodeIdAndComponentId(nodeId, componentId);\n\n      if (component != null) {\n        // get the component type\n        connectedComponentType = component.type;\n      }\n    }\n\n    return connectedComponentType;\n  }\n\n  /**\n   * The connected component node id has changed\n   * @param connectedComponent the connected component that has changed\n   */\n  authoringConnectedComponentNodeIdChanged(connectedComponent) {\n    if (connectedComponent != null) {\n      connectedComponent.componentId = null;\n      connectedComponent.type = null;\n      this.authoringAutomaticallySetConnectedComponentComponentIdIfPossible(connectedComponent);\n\n      // the authoring component content has changed so we will save the project\n      this.authoringViewComponentChanged();\n    }\n  }\n\n  /**\n   * The connected component component id has changed\n   * @param connectedComponent the connected component that has changed\n   */\n  authoringConnectedComponentComponentIdChanged(connectedComponent) {\n\n    if (connectedComponent != null) {\n\n      // default the type to import work\n      connectedComponent.type = 'importWork';\n\n      // the authoring component content has changed so we will save the project\n      this.authoringViewComponentChanged();\n    }\n  }\n\n  /**\n   * The connected component type has changed\n   * @param connectedComponent the connected component that changed\n   */\n  authoringConnectedComponentTypeChanged(connectedComponent) {\n\n    if (connectedComponent != null) {\n\n      if (connectedComponent.type == 'importWork') {\n        /*\n         * the type has changed to import work\n         */\n      } else if (connectedComponent.type == 'showWork') {\n        /*\n         * the type has changed to show work\n         */\n      }\n\n      // the authoring component content has changed so we will save the project\n      this.authoringViewComponentChanged();\n    }\n  }\n\n  /**\n   * Check if we are allowed to connect to this component type\n   * @param componentType the component type\n   * @return whether we can connect to the component type\n   */\n  isConnectedComponentTypeAllowed(componentType) {\n\n    if (componentType != null) {\n\n      let allowedConnectedComponentTypes = this.allowedConnectedComponentTypes;\n\n      // loop through the allowed connected component types\n      for (let a = 0; a < allowedConnectedComponentTypes.length; a++) {\n        let allowedConnectedComponentType = allowedConnectedComponentTypes[a];\n\n        if (allowedConnectedComponentType != null) {\n          if (componentType == allowedConnectedComponentType.type) {\n            // the component type is allowed\n            return true;\n          }\n        }\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * The show JSON button was clicked to show or hide the JSON authoring\n   */\n  showJSONButtonClicked() {\n    // toggle the JSON authoring textarea\n    this.showJSONAuthoring = !this.showJSONAuthoring;\n\n    if (this.jsonStringChanged && !this.showJSONAuthoring) {\n      /*\n       * the author has changed the JSON and has just closed the JSON\n       * authoring view so we will save the component\n       */\n      this.advancedAuthoringViewComponentChanged();\n\n      // scroll to the top of the component\n      this.$rootScope.$broadcast('scrollToComponent', { componentId: this.componentId });\n\n      this.jsonStringChanged = false;\n    }\n  }\n\n  /**\n   * The author has changed the JSON manually in the advanced view\n   */\n  authoringJSONChanged() {\n    this.jsonStringChanged = true;\n  }\n};\n\nAnimationController.$inject = [\n  '$filter',\n  '$mdDialog',\n  '$q',\n  '$rootScope',\n  '$scope',\n  '$timeout',\n  'AnimationService',\n  'AnnotationService',\n  'ConfigService',\n  'CRaterService',\n  'NodeService',\n  'NotebookService',\n  'NotificationService',\n  'ProjectService',\n  'StudentAssetService',\n  'StudentDataService',\n  'UtilService'\n];\n\nexport default AnimationController;\n"]}