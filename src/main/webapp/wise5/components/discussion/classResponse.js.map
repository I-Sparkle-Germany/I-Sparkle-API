{"version":3,"sources":["classResponse.es6"],"names":["ClassResponseController","$scope","$element","$filter","StudentStatusService","ConfigService","$translate","urlMatcher","$watch","response","replies","length","newValue","oldValue","injectLinksIntoReplies","toggleExpanded","injectLinksIntoResponse","studentData","responseText","injectLinks","reply","replace","match","matchUrl","startsWith","workgroupId","getAvatarColorForWorkgroupId","$event","keyCode","replyText","submitButtonClicked","submitbuttonclicked","r","componentState","answer","confirm","deletebuttonclicked","undodeletebuttonclicked","open","expanded","$clist","$","element","find","setTimeout","animate","scrollTop","height","time","convertToClientTimestamp","$inject","ClassResponseComponentOptions","bindings","mode","studentdatachanged","isdisabled","templateUrl","controller"],"mappings":"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","sourcesContent":["'use strict';\n\nclass ClassResponseController {\n  constructor($scope, $element, $filter, StudentStatusService, ConfigService) {\n    this.$scope = $scope;\n    this.$element = $element;\n    this.$filter = $filter;\n    this.StudentStatusService = StudentStatusService;\n    this.ConfigService = ConfigService;\n\n    this.$translate = this.$filter('translate');\n    this.urlMatcher = /((http:\\/\\/www\\.|https:\\/\\/www\\.|http:\\/\\/|https:\\/\\/)?[a-z0-9]+([\\-\\.]{1}[a-z0-9]+)*\\.[a-z]{2,5}(:[0-9]{1,5})?(\\/.*)?)/g;\n\n    this.$scope.$watch(\n      () => { return this.response.replies.length; },\n      (newValue, oldValue) => {\n        if (newValue !== oldValue) {\n          this.injectLinksIntoReplies();\n          this.toggleExpanded(true);\n        }\n      }\n    );\n\n    this.injectLinksIntoResponse();\n    this.injectLinksIntoReplies();\n  }\n\n  injectLinksIntoResponse() {\n    this.response.studentData.responseText = this.injectLinks(this.response.studentData.response);\n  }\n\n  injectLinksIntoReplies() {\n    for (const reply of this.response.replies) {\n      if (reply.studentData.responseText == null) {\n        reply.studentData.responseText = this.injectLinks(reply.studentData.response);\n      }\n    }\n  }\n\n  injectLinks(response) {\n    return response.replace(this.urlMatcher, (match) => {\n      let matchUrl = match;\n      if (!match.startsWith('http')) {\n        matchUrl = '//' + match;\n      }\n      return `<a href=\"${matchUrl}\" target=\"_blank\">${match}</a>`;\n    });\n  }\n\n  getAvatarColorForWorkgroupId(workgroupId) {\n    return this.ConfigService.getAvatarColorForWorkgroupId(workgroupId);\n  }\n\n  replyEntered($event, response) {\n    if ($event.keyCode === 13) {\n      if (response.replyText) {\n        this.submitButtonClicked(response);\n      }\n    }\n  }\n\n  submitButtonClicked(response) {\n    // call the callback function in discussionController\n    this.submitbuttonclicked({r: response});\n  }\n\n  /**\n   * The delete button was clicked on a student post\n   * @param componentState the student component state\n   */\n  deleteButtonClicked(componentState) {\n\n    var answer = confirm(this.$translate(\"discussion.areYouSureYouWantToDeleteThisPost\"));\n\n    if (answer) {\n      // the teacher has answered yes to delete\n\n      // tell the discussionController to delete the post\n      this.deletebuttonclicked({componentState: componentState});\n    }\n  }\n\n  /**\n   * The undo delete button was clicked on a student post\n   * @param componentState the student component state\n   */\n  undoDeleteButtonClicked(componentState) {\n\n    var answer = confirm(this.$translate(\"discussion.areYouSureYouWantToShowThisPost\"));\n\n    if (answer) {\n      // the teacher has answered yes to undo the delete\n\n      // tell the discussionController to undo the delete of the post\n      this.undodeletebuttonclicked({componentState: componentState});\n    }\n  }\n\n  toggleExpanded(open) {\n    if (open) {\n      this.expanded = true;\n    } else {\n      this.expanded = !this.expanded;\n    }\n\n    if (this.expanded) {\n      var $clist = $(this.element).find('.discussion-comments__list');\n      setTimeout(function () {\n        $clist.animate({scrollTop: $clist.height()}, 250);\n      }, 250);\n    }\n  }\n\n  adjustClientSaveTime(time) {\n    return this.ConfigService.convertToClientTimestamp(time);\n  }\n}\n\nClassResponseController.$inject = ['$scope','$element','$filter','StudentStatusService','ConfigService'];\n\nconst ClassResponseComponentOptions = {\n  bindings: {\n    response: '=',\n    mode: '=',\n    deletebuttonclicked: '&',\n    undodeletebuttonclicked: '&',\n    submitbuttonclicked: '&',\n    studentdatachanged: '&',\n    isdisabled: '='\n  },\n  templateUrl: 'wise5/components/discussion/classResponse.html',\n  controller: 'ClassResponseController as classResponseCtrl'\n};\n\nexport { ClassResponseController, ClassResponseComponentOptions };\n"],"file":"classResponse.js"}