{"version":3,"sources":["discussionService.es6"],"names":["DiscussionService","$http","$rootScope","$q","ConfigService","NotificationService","StudentDataService","TeacherDataService","UtilService","component","id","generateKey","type","prompt","showSaveButton","showSubmitButton","isStudentAttachmentEnabled","gateClassmateResponses","componentToCopy","createComponent","componentStateFromOtherComponent","otherComponentType","componentState","createComponentState","studentData","runId","periodId","nodeId","componentId","angular","bind","resolve","reject","httpParams","method","url","getConfigParam","params","getStudentWork","then","result","classmateData","data","componentStates","componentEvents","nodeEvents","c","length","response","workgroupId","allPosts","topLevelComponentIdsFound","getComponentStatesByWorkgroupIdAndComponentId","componentStateIdReplyingTo","indexOf","concat","getPostAndAllReplies","push","componentStateId","postAndAllReplies","componentStatesForNodeId","getComponentStatesByComponentId","tempComponentState","$inject"],"mappings":"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","file":"discussionService.js","sourcesContent":["import NodeService from '../../services/nodeService';\n\nclass DiscussionService extends NodeService {\n    constructor($http,\n                $rootScope,\n                $q,\n                ConfigService,\n                NotificationService,\n                StudentDataService,\n                TeacherDataService,\n                UtilService) {\n        super();\n\n        this.$http = $http;\n        this.$rootScope = $rootScope;\n        this.$q = $q;\n        this.ConfigService = ConfigService;\n        this.NotificationService = NotificationService;\n        this.StudentDataService = StudentDataService;\n        this.TeacherDataService = TeacherDataService;\n        this.UtilService = UtilService;\n    }\n\n    /**\n     * Create a Discussion component object\n     * @returns a new Discussion component object\n     */\n    createComponent() {\n        var component = {};\n        component.id = this.UtilService.generateKey();\n        component.type = 'Discussion';\n        component.prompt = 'Enter prompt here';\n        component.showSaveButton = false;\n        component.showSubmitButton = true;\n        component.isStudentAttachmentEnabled = true;\n        component.gateClassmateResponses = true;\n        return component;\n    }\n\n    /**\n     * Copies an existing Discussion component object\n     * @returns a copied Discussion component object\n     */\n    copyComponent(componentToCopy) {\n        var component = this.createComponent();\n        component.prompt = componentToCopy.prompt;\n        component.showSaveButton = componentToCopy.showSaveButton;\n        component.showSubmitButton = componentToCopy.showSubmitButton;\n        component.isStudentAttachmentEnabled = componentToCopy.isStudentAttachmentEnabled;\n        component.gateClassmateResponses = componentToCopy.gateClassmateResponses;\n        return component;\n    }\n\n    populateComponentState(componentStateFromOtherComponent, otherComponentType) {\n        var componentState = null;\n\n        if (componentStateFromOtherComponent != null && otherComponentType != null) {\n            componentState = StudentDataService.createComponentState();\n\n            if (otherComponentType === 'OpenResponse') {\n                componentState.studentData = componentStateFromOtherComponent.studentData;\n            }\n        }\n\n        return componentState;\n    };\n\n    getClassmateResponses(runId, periodId, nodeId, componentId) {\n\n        if (runId != null && periodId != null && nodeId != null && componentId != null) {\n            return this.$q(angular.bind(this, function(resolve, reject) {\n\n                var httpParams = {};\n                httpParams.method = 'GET';\n                httpParams.url = this.ConfigService.getConfigParam('studentDataURL');\n\n                var params = {};\n                params.runId = runId;\n                params.periodId = periodId;\n                params.nodeId = nodeId;\n                params.componentId = componentId;\n                params.getStudentWork = true;\n                httpParams.params = params;\n\n                this.$http(httpParams).then(angular.bind(this, function(result) {\n                    var classmateData = result.data;\n\n                    //console.log(classmateData);\n\n                    resolve(classmateData);\n                }));\n            }));\n        }\n    };\n\n    /**\n     * Check if the component was completed\n     * @param component the component object\n     * @param componentStates the component states for the specific component\n     * @param componentEvents the events for the specific component\n     * @param nodeEvents the events for the parent node of the component\n     * @returns whether the component was completed\n     */\n    isCompleted(component, componentStates, componentEvents, nodeEvents) {\n        var result = false;\n\n        if (componentStates != null) {\n\n            // loop through all the component states\n            for (var c = 0; c < componentStates.length; c++) {\n\n                // the component state\n                var componentState = componentStates[c];\n\n                // get the student data from the component state\n                var studentData = componentState.studentData;\n\n                if (studentData != null) {\n                    var response = studentData.response;\n\n                    if (response != null) {\n                        // there is a response so the component is completed\n                        result = true;\n                        break;\n                    }\n                }\n            }\n        }\n\n        return result;\n    };\n\n    /**\n     * Get all the posts associated with a workgroup id. This will\n     * get all the posts and replies that the workgroup posted\n     * or replied to as well as all the other replies classmates made.\n     * @param componentId the component id\n     * @param workgroupId the workgroup id\n     * @returns an array containing all the component states for\n     * top level posts and replies that are associated with the\n     * workgroup\n     */\n    getPostsAssociatedWithWorkgroupId(componentId, workgroupId) {\n        var allPosts = [];\n\n        var topLevelComponentIdsFound = [];\n\n        // get all the component states for the workgroup id\n        var componentStates = this.TeacherDataService.getComponentStatesByWorkgroupIdAndComponentId(workgroupId, componentId);\n\n        if (componentStates != null) {\n\n            // loop through all the component states\n            for (var c = 0; c < componentStates.length; c++) {\n\n                var componentState = componentStates[c];\n\n                if (componentState != null) {\n                    var studentData = componentState.studentData;\n\n                    if (studentData != null) {\n                        if (studentData.componentStateIdReplyingTo == null) {\n\n                            // check if we have already added the top level post\n                            if (topLevelComponentIdsFound.indexOf(componentState.id) == -1) {\n                                // we haven't found the top level post yet so\n\n                                /*\n                                 * the component state is a top level post so we will\n                                 * get the post and all the replies to the post\n                                 */\n                                allPosts = allPosts.concat(this.getPostAndAllReplies(componentId, componentState.id));\n\n                                topLevelComponentIdsFound.push(componentState.id);\n                            }\n                        } else {\n\n                            // check if we have already added the top level post\n                            if (topLevelComponentIdsFound.indexOf(studentData.componentStateIdReplyingTo) == -1) {\n                                // we haven't found the top level post yet so\n\n                                /*\n                                 * the component state is a reply so we will get the\n                                 * top level post and all the replies to it\n                                 */\n                                allPosts = allPosts.concat(this.getPostAndAllReplies(componentId, studentData.componentStateIdReplyingTo));\n\n                                topLevelComponentIdsFound.push(studentData.componentStateIdReplyingTo);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        return allPosts;\n    }\n\n    /**\n     * Get the top level post and all the replies to it\n     * @param componentId the component id\n     * @param componentStateId the component state id\n     * @returns an array containing the top level post and all the replies\n     */\n    getPostAndAllReplies(componentId, componentStateId) {\n        var postAndAllReplies = [];\n\n        // get all the component states for the node\n        var componentStatesForNodeId = this.TeacherDataService.getComponentStatesByComponentId(componentId);\n\n        for (var c = 0; c < componentStatesForNodeId.length; c++) {\n            var tempComponentState = componentStatesForNodeId[c];\n\n            if (tempComponentState != null) {\n                if (componentStateId === tempComponentState.id) {\n                    // we have found the top level post\n                    postAndAllReplies.push(tempComponentState);\n                } else {\n                    // check if the component state is a reply to the post we are looking for\n                    var studentData = tempComponentState.studentData;\n\n                    if (studentData != null) {\n                        var componentStateIdReplyingTo = studentData.componentStateIdReplyingTo;\n\n                        if (componentStateIdReplyingTo != null) {\n                            if (componentStateId === componentStateIdReplyingTo) {\n                                // this is a reply to the post we are looking for\n                                postAndAllReplies.push(tempComponentState);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        return postAndAllReplies;\n    };\n}\n\nDiscussionService.$inject = [\n    '$http',\n    '$rootScope',\n    '$q',\n    'ConfigService',\n    'NotificationService',\n    'StudentDataService',\n    'TeacherDataService',\n    'UtilService'\n];\n\nexport default DiscussionService;\n"]}