<link rel="stylesheet" type="text/css" href="wise5/lib/drawingTool/drawing-tool.css">
<style>
    .toolsDiv {
        padding: 10px 10px 10px 10px;
    }
</style>
<div ng-controller='DrawController as drawController' flex>
    <div ng-if='drawController.mode === "authoring" && !drawController.authoringComponentContent.showPreviousWork'>
        <md-input-container style='width: 100%; margin-bottom: 0px;'>
            <label>{{ 'PROMPT' | translate }}</label>
            <textarea ng-model='drawController.authoringComponentContent.prompt'
                      ng-change='drawController.authoringViewComponentChanged()'
                      ng-model-options='{ debounce: 1000 }'
                      rows='3'
                      placeholder='{{ "enterPromptHere" | translate }}'>
            </textarea>
        </md-input-container>
        <div style='height: 60px;'>
            <md-input-container>
                <label>{{ 'BACKGROUND_IMAGE' | translate }} ({{ 'OPTIONAL' | translate }})</label>
                <input size='100'
                       ng-model='drawController.authoringComponentContent.background'
                       ng-change='drawController.authoringViewBackgroundChanged()'/>
            </md-input-container>
            <md-button class='topButton md-raised md-primary' ng-click='drawController.chooseBackgroundImage()'>
                <md-icon>insert_photo</md-icon>
                <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'chooseAnImage' | translate }}</md-tooltip>
            </md-button>
        </div>
        <div style='height: 60px;'>
            <md-input-container>
                <label>{{ 'draw.canvasWidth' | translate }} ({{ 'OPTIONAL' | translate }})</label>
                <input type='number'
                       style='width: 200'
                       ng-model='drawController.authoringComponentContent.width'
                       ng-change='drawController.authoringViewWidthChanged()'/>
            </md-input-container>
            <md-input-container>
                <label>{{ 'draw.canvasHeight' | translate }} ({{ 'OPTIONAL' | translate }})</label>
                <input type='number'
                       style='width: 200'
                       ng-model='drawController.authoringComponentContent.height'
                       ng-change='drawController.authoringViewWidthChanged()'/>
            </md-input-container>
        </div>
        <br/>
        <md-button class='topButton md-raised md-primary' ng-click='drawController.authoringEnableAllToolsButtonClicked()'>
            <md-icon>check</md-icon>
            <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'draw.enableAllTools' | translate }}</md-tooltip>
        </md-button>
        <md-button class='topButton md-raised md-primary' ng-click='drawController.authoringDisableAllToolsButtonClicked()'>
            <md-icon>check_box_outline_blank</md-icon>
            <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'draw.disableAllTools' | translate }}</md-tooltip>
        </md-button>
        <br/>
        <div layout='row'>
            <div class='toolsDiv'>
                <md-checkbox class='md-primary'
                             ng-model='drawController.authoringComponentContent.tools.select'
                             ng-change='drawController.authoringViewToolClicked()'>
                    {{ 'draw.selectTool' | translate }}
                </md-checkbox>
                <br/>
                <md-checkbox class='md-primary'
                             ng-model='drawController.authoringComponentContent.tools.line'
                             ng-change='drawController.authoringViewToolClicked()'>
                    {{ 'draw.lineTool' | translate }}
                </md-checkbox>
                <br/>
                <md-checkbox class='md-primary'
                             ng-model='drawController.authoringComponentContent.tools.shape'
                             ng-change='drawController.authoringViewToolClicked()'>
                    {{ 'draw.shapeTool' | translate }}
                </md-checkbox>
                <br/>
                <md-checkbox class='md-primary'
                             ng-model='drawController.authoringComponentContent.tools.freeHand'
                             ng-change='drawController.authoringViewToolClicked()'>
                    {{ 'draw.freeHandTool' | translate }}
                </md-checkbox>
            </div>
            <div class='toolsDiv'>
                <md-checkbox class='md-primary'
                             ng-model='drawController.authoringComponentContent.tools.text'
                             ng-change='drawController.authoringViewToolClicked()'>
                    {{ 'draw.textTool' | translate }}
                </md-checkbox>
                <br/>
                <md-checkbox class='md-primary'
                             ng-model='drawController.authoringComponentContent.tools.stamp'
                             ng-change='drawController.authoringViewToolClicked()'>
                    {{ 'draw.stampTool' | translate }}
                </md-checkbox>
                <br/>
                <md-checkbox class='md-primary'
                             ng-model='drawController.authoringComponentContent.tools.clone'
                             ng-change='drawController.authoringViewToolClicked()'>
                    {{ 'draw.cloneTool' | translate }}
                </md-checkbox>
                <br/>
                <md-checkbox class='md-primary'
                             ng-model='drawController.authoringComponentContent.tools.strokeColor'
                             ng-change='drawController.authoringViewToolClicked()'>
                    {{ 'draw.strokeColorTool' | translate }}
                </md-checkbox>
            </div>
            <div class='toolsDiv'>
                <md-checkbox class='md-primary'
                             ng-model='drawController.authoringComponentContent.tools.fillColor'
                             ng-change='drawController.authoringViewToolClicked()'>
                    {{ 'draw.fillColorTool' | translate }}
                </md-checkbox>
                <br/>
                <md-checkbox class='md-primary'
                             ng-model='drawController.authoringComponentContent.tools.strokeWidth'
                             ng-change='drawController.authoringViewToolClicked()'>
                    {{ 'draw.strokeWidthTool' | translate }}
                </md-checkbox>
                <br/>
                <md-checkbox class='md-primary'
                             ng-model='drawController.authoringComponentContent.tools.sendBack'
                             ng-change='drawController.authoringViewToolClicked()'>
                    {{ 'draw.sendBackTool' | translate }}
                </md-checkbox>
                <br/>
                <md-checkbox class='md-primary'
                             ng-model='drawController.authoringComponentContent.tools.sendForward'
                             ng-change='drawController.authoringViewToolClicked()'>
                    {{ 'draw.sendForwardTool' | translate }}
                </md-checkbox>
            </div>
            <div class='toolsDiv'>
                <md-checkbox class='md-primary'
                             ng-model='drawController.authoringComponentContent.tools.undo'
                             ng-change='drawController.authoringViewToolClicked()'>
                    {{ 'draw.undoTool' | translate }}
                </md-checkbox>
                <br/>
                <md-checkbox class='md-primary'
                             ng-model='drawController.authoringComponentContent.tools.redo'
                             ng-change='drawController.authoringViewToolClicked()'>
                    {{ 'draw.redoTool' | translate }}
                </md-checkbox>
                <br/>
                <md-checkbox class='md-primary'
                             ng-model='drawController.authoringComponentContent.tools.delete'
                             ng-change='drawController.authoringViewToolClicked()'>
                    {{ 'draw.deleteTool' | translate }}
                </md-checkbox>
            </div>
        </div>
        <div ng-show='drawController.authoringComponentContent.tools.stamp'>
            <p>{{ 'draw.stamps' | translate }}</p>
            <br/>
            <div ng-show='drawController.authoringComponentContent.stamps.Stamps.length == 0'>
                {{ 'draw.thereAreNoStampsClickTheAddStampButtonToAddAStamp' | translate }}
            </div>
            <div ng-repeat='stamp in drawController.authoringComponentContent.stamps.Stamps track by $index'
                 style='height: 60'>
                <md-input-container>
                    <label></label>
                    <input size='50'
                           ng-model='drawController.authoringComponentContent.stamps.Stamps[$index]'
                           ng-change='drawController.authoringViewComponentChanged()'
                           placeholder='{{ "chooseAnImage" | translate }}'/>
                </md-input-container>
                <md-button class='topButton md-raised md-primary'
                           ng-click='drawController.chooseStampImage($index)'>
                    <md-icon>insert_photo</md-icon>
                    <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'chooseAnImage' | translate }}</md-tooltip>
                </md-button>
                <md-button class='topButton md-raised md-primary'
                           ng-click='drawController.authoringStampUpClicked($index)'>
                    <md-icon>arrow_upward</md-icon>
                    <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'UP' | translate }}</md-tooltip>
                </md-button>
                <md-button class='topButton md-raised md-primary'
                           ng-click='drawController.authoringStampDownClicked($index)'>
                    <md-icon>arrow_downward</md-icon>
                    <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'DOWN' | translate }}</md-tooltip>
                </md-button>
                <md-button class='topButton md-raised md-primary'
                           ng-click='drawController.authoringDeleteStampClicked($index)'>
                    <md-icon>delete</md-icon>
                    <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'DELETE' | translate }}</md-tooltip>
                </md-button>
            </div>
            <br/>
            <md-button class='topButton md-raised md-primary'
                       ng-click='drawController.authoringAddStampButtonClicked()'>
                <md-icon>library_add</md-icon>
                <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'draw.addStamp' | translate }}</md-tooltip>
            </md-button>
        </div>
        <md-button class='topButton md-raised md-primary' ng-click='drawController.authoringSaveStarterDrawData()'>
            <md-icon>create</md-icon>
            <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'draw.saveStarterDrawing' | translate }}</md-tooltip>
        </md-button>
        <md-button class='topButton md-raised md-primary' ng-click='drawController.authoringDeleteStarterDrawData()'>
            <md-icon>delete_sweep</md-icon>
            <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'draw.deleteStarterDrawing' | translate }}</md-tooltip>
        </md-button>
    </div>
    <div ng-if='drawController.mode === "authoring"'>
        <md-button class='topButton md-raised md-primary' ng-click='drawController.showAdvancedAuthoring = !drawController.showAdvancedAuthoring'>
            <md-icon>build</md-icon>
            <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ "ADVANCED" | translate }}</md-tooltip>
        </md-button>
        <br/>
        <div ng-show='drawController.showAdvancedAuthoring'>
            {{ 'SHOW_SAVE_BUTTON' | translate }}:
            <input type='checkbox'
                   ng-model='drawController.authoringComponentContent.showSaveButton'
                   ng-change='drawController.authoringViewComponentChanged()'/>
            <br/>
            {{ 'SHOW_SUBMIT_BUTTON' | translate }}:
            <input type='checkbox'
                   ng-model='drawController.authoringComponentContent.showSubmitButton'
                   ng-change='drawController.showSubmitButtonValueChanged()'/>
            <div ng-show='drawController.authoringComponentContent.showSubmitButton'
                 style='display:inline'>
                <span>{{ 'MAX_SUBMIT' | translate }}:</span>
                <input type='number'
                       ng-model='drawController.authoringComponentContent.maxSubmitCount'
                       ng-change='drawController.authoringViewComponentChanged()'/>
            </div>
            <br/>
            {{ 'MAX_SCORE' | translate }}:
            <input type='number'
                   ng-model='drawController.authoringComponentContent.maxScore'
                   ng-change='drawController.authoringViewComponentChanged()'
                   ng-model-options='{ debounce: 1000 }'
                   style='width: 3em'/>
            <br/>
            {{ 'COMPONENT_WIDTH' | translate }}:
            <input type='number'
                   ng-model='drawController.authoringComponentContent.componentWidth'
                   ng-change='drawController.authoringViewComponentChanged()'
                   ng-model-options='{ debounce: 1000 }'
                   style='width: 3em'/>
            <br/>
            <div ng-if='drawController.mode === "authoring"'>
                {{ 'IMPORT_PREVIOUS_WORK' | translate }}:
                <input type='checkbox'
                       ng-model='drawController.authoringComponentContent.importPreviousWork'
                       ng-click='drawController.authoringImportPreviousWorkClicked()'
                       ng-change='drawController.authoringViewComponentChanged()'/>
            </div>
            <div ng-if='drawController.mode === "authoring" && drawController.authoringComponentContent.importPreviousWork'>
                {{ 'IMPORT_PREVIOUS_WORK_STEP' | translate }}:
                <select ng-model='drawController.authoringComponentContent.importPreviousWorkNodeId'
                        ng-change='drawController.authoringImportPreviousWorkNodeIdChanged()'>
                    <option></option>
                    <option ng-repeat='item in drawController.idToOrder | toArray | orderBy : "order"'
                            value='{{item.$key}}'
                            ng-if='drawController.isApplicationNode(item.$key)'>{{drawController.getNodePositionAndTitleByNodeId(item.$key)}}</option>
                </select>
                <br/>
                {{ 'IMPORT_PREVIOUS_WORK_COMPONENT' | translate }}:
                <select ng-model='drawController.authoringComponentContent.importPreviousWorkComponentId'
                        ng-change='drawController.authoringImportPreviousWorkComponentIdChanged()'
                        ng-options='component.id as component.type disable when !drawController.componentHasWork(component) for component in drawController.getComponentsByNodeId(drawController.authoringComponentContent.importPreviousWorkNodeId)'>
                    <option></option>
                </select>
            </div>
            <div ng-if='drawController.mode === "authoring"'>
                {{ 'SHOW_PREVIOUS_WORK' | translate }}:
                <input type='checkbox'
                       ng-model='drawController.authoringComponentContent.showPreviousWork'
                       ng-click='drawController.authoringShowPreviousWorkClicked()'
                       ng-change='drawController.authoringViewComponentChanged()'/>
            </div>
            <div ng-if='drawController.mode === "authoring" && drawController.authoringComponentContent.showPreviousWork'>
                {{ 'SHOW_PREVIOUS_WORK_STEP' | translate }}:
                <select ng-model='drawController.authoringComponentContent.showPreviousWorkNodeId'
                        ng-change='drawController.authoringShowPreviousWorkNodeIdChanged()'>
                    <option></option>
                    <option ng-repeat='item in drawController.idToOrder | toArray | orderBy : "order"'
                            value='{{item.$key}}'
                            ng-if='drawController.isApplicationNode(item.$key)'>{{drawController.getNodePositionAndTitleByNodeId(item.$key)}}</option>
                </select>
                <br/>
                {{ 'SHOW_PREVIOUS_WORK_COMPONENT' | translate }}:
                <select ng-model='drawController.authoringComponentContent.showPreviousWorkComponentId'
                        ng-change='drawController.authoringShowPreviousWorkComponentIdChanged()'
                        ng-options='component.id as component.type disable when !drawController.componentHasWork(component) for component in drawController.getComponentsByNodeId(drawController.authoringComponentContent.showPreviousWorkNodeId)'>
                    <option></option>
                </select>
                <br/>
                {{ 'SHOW_PREVIOUS_WORK_PROMPT' | translate }}:
                <input type='checkbox'
                       ng-model='drawController.authoringComponentContent.showPreviousWorkPrompt'
                       ng-change='drawController.authoringViewComponentChanged()'/>
            </div>
            <div ng-if='drawController.mode === "authoring"'>
                <button ng-click='drawController.addConnectedComponent()'>{{ 'ADD_CONNECTED_COMPONENT' | translate }}</button>
                <div ng-repeat='connectedComponent in drawController.authoringComponentContent.connectedComponents track by $index'>
                    <table border='1'>
                        <tr>
                            <td style='padding:5'>
                                {{ 'CONNECTED_COMPONENT' | translate }}
                            </td>
                            <td style='padding:5'>
                                <div style='display:none'>
                                    {{ 'NODE_ID' | translate }}:
                                    <select ng-model='connectedComponent.nodeId'
                                            ng-change='drawController.authoringViewComponentChanged()'>
                                        <option></option>
                                        <option ng-repeat='item in drawController.idToOrder | toArray | orderBy : "order"'
                                                value='{{item.$key}}'
                                                ng-if='drawController.isApplicationNode(item.$key)'>{{drawController.getNodePositionAndTitleByNodeId(item.$key)}}</option>
                                    </select>
                                </div>
                                <div>
                                    {{ 'COMPONENT_ID' | translate }}:
                                    <select ng-model='connectedComponent.componentId'
                                            ng-change='drawController.authoringViewComponentChanged()'>
                                        <option></option>
                                        <option ng-repeat='(componentIndex, component) in drawController.getComponentsByNodeId(connectedComponent.nodeId)'
                                                ng-disabled='!drawController.componentHasWork(component)'
                                                value='{{component.id}}'>
                                            {{componentIndex + 1}}. {{component.type}}
                                        </option>
                                    </select>
                                </div>
                            </td>
                            <td style='padding:5'>
                                <select ng-model='connectedComponent.updateOn'
                                        ng-change='drawController.authoringViewComponentChanged()'>
                                        <option ng-repeat='updateOnOption in drawController.connectedComponentUpdateOnOptions'
                                                value='{{updateOnOption.value}}'>
                                            {{updateOnOption.text}}
                                        </option>
                                </select>
                            </td>
                            <td style='padding:5'>
                                <button ng-click='drawController.deleteConnectedComponent($index)'>{{ 'DELETE' | translate }}</button>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div ng-if='drawController.mode === "authoring"'>
                <button ng-click='drawController.showRubricAuthoring = !drawController.showRubricAuthoring'>
                    {{ 'EDIT_COMPONENT_RUBRIC' | translate }}
                </button>
                <div ng-show='drawController.showRubricAuthoring'>
                    <summernote id='{{drawController.summernoteRubricId}}'
                                ng-model='drawController.summernoteRubricHTML'
                                ng-change='drawController.summernoteRubricHTMLChanged()'
                                config='drawController.summernoteRubricOptions'
                                ng-model-options='{ debounce: 1000 }'
                                rows='10'
                                cols='100'>
                    </summernote>
                </div>
            </div>
            <div ng-if='drawController.mode === "authoring"'>
                <button ng-click='drawController.showJSON = !drawController.showJSON'>
                        {{ 'SHOW_JSON' | translate }}
                </button>
                <br/>
                <div ng-show='drawController.showJSON'>
                    <textarea ng-model='drawController.authoringComponentContentJSONString'
                              ng-change='drawController.advancedAuthoringViewComponentChanged()'
                              ng-model-options="{ updateOn: 'blur' }"
                              rows='30'
                              cols='100'></textarea>
                </div>
            </div>
        </div>
        <br/>
    </div>
    <div ng-style='drawController.mode === "authoring" && {"border": "1px solid black", "padding": "20px"}'>
        <div ng-if='drawController.mode === "authoring"'>
            <h5>{{ 'PREVIEW' | translate }}</h5>
        </div>
        <div class="component__prompt">
            <div class="component__prompt__content"><compile data='drawController.getPrompt()'></compile></div>
            <possible-score max-score="drawController.componentContent.maxScore"
                            ng-if="drawController.mode === 'student' && !drawController.latestAnnotations.score"></possible-score>
        </div>
        <div class="component__actions" layout="row">
            <md-button class="md-accent" ng-show="drawController.isStudentAttachmentEnabled"
                       ng-click="nodeController.showStudentAssets($event, component.id, drawController.isDisabled)">
                <md-icon>image</md-icon> {{ 'draw.insertFile' | translate }}
            </md-button>
        </div>
        <md-button class="md-accent"
                ng-click="drawController.resetButtonClicked()"
                ng-show="drawController.isResetButtonVisible">
                <md-icon> restore </md-icon> {{ 'RESET' | translate }}
        </md-button>
        <md-button class="md-accent md-primary"
                ng-click='drawController.snipDrawing($event)'
                ng-if='drawController.showSnipDrawingButton()'>
            <md-icon> content_cut </md-icon> {{ 'ADD_TO_NOTEBOOK' | translate:{label:drawController.notebookConfig.label} }}
        </md-button>
        <div data-drop="true"
             jqyoui-droppable="{onDrop: 'drawController.dropCallback(item, $index)'}">
            <div id="{{drawController.drawingToolId}}"></div>
            <!--
            <h2>API examples:</h2>
            <div>
              <button id="set-background">Set background</button>
              <input type="text" id="background-src" value="https://ccshutterbugtest.s3.amazonaws.com/7a72684bb7e.png" size="70" />
              <button id="resize-background">Resize background to canvas</button>
              <button id="resize-canvas">Resize cavas to background</button>
              <button id="shrink-background">Shrink background to cavas</button>
            </div>
            <div>
              <button id="clear">Clear</button>
              <button id="save">Save</button>
              <button id="load" disabled>Load</button>
            </div>
            -->
        </div>
        <md-button class="revision md-icon-button" ng-click='nodeController.showRevisions($event, component.id)'
                   ng-if="nodeController.getRevisions(component.id).length > 1">
            <md-icon> history </md-icon>
            <md-tooltip md-direction="top">{{nodeController.getRevisions(component.id).length}} {{ 'draw.versions' | translate }}</md-tooltip>
        </md-button>
        <div ng-if="drawController.isSaveButtonVisible || drawController.isSubmitButtonVisible"
             class="component__actions" layout="row" layout-align="start center">
            <md-button class="md-raised md-primary"
                       ng-click='drawController.saveButtonClicked()'
                       ng-disabled='drawController.isDisabled || !drawController.isDirty'
                       ng-show='drawController.isSaveButtonVisible'>{{ 'SAVE' | translate }}</md-button>
            <md-button class="md-raised md-primary"
                       ng-click='drawController.submitButtonClicked()'
                       ng-disabled='drawController.isDisabled || !drawController.isSubmitDirty || drawController.isSubmitButtonDisabled'
                       ng-show='drawController.isSubmitButtonVisible'>{{ 'SUBMIT' | translate }}</md-button>
            <span ng-show="drawController.saveMessage.text"
                  class="component__actions__info md-caption">
                  {{drawController.saveMessage.text}} <span class="component__actions__more"><md-tooltip md-direction="top">{{ drawController.saveMessage.time | amDateFormat:'ddd, MMM D YYYY, h:mm a' }}</md-tooltip><span am-time-ago="drawController.saveMessage.time"></span></span>
            </span>
        </div>
        <component-annotations ng-if="drawController.mode === 'student'"
                               annotations='drawController.latestAnnotations'
                               max-score="drawController.componentContent.maxScore"></component-annotations>
        <component-grading ng-if="drawController.mode === 'grading'"
                          node-id='drawController.nodeId'
                          component-id='drawController.componentId'
                          max-score="drawController.componentContent.maxScore"
                          from-workgroup-id='teacherWorkgroupId'
                          to-workgroup-id='workgroupId'
                          component-state-id='componentState.id'
                          active="true"></component-grading>
    </div>
</div>
