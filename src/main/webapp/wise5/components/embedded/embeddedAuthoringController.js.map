{"version":3,"sources":["embeddedAuthoringController.es6"],"names":["EmbeddedAuthoringController","$filter","$mdDialog","$q","$rootScope","$scope","$sce","$timeout","$window","AnnotationService","ConfigService","EmbeddedService","NodeService","NotebookService","ProjectService","StudentAssetService","StudentDataService","UtilService","allowedConnectedComponentTypes","type","$watch","authoringComponentContent","bind","newValue","oldValue","componentContent","injectAssetPaths","isSaveButtonVisible","showSaveButton","isSubmitButtonVisible","showSubmitButton","width","height","setURL","url","$on","event","args","nodeId","componentId","assetItem","fileName","assetsDirectoryPath","getProjectAssetsDirectoryPath","fullAssetPath","summernoteId","target","isImage","$","summernote","isVideo","videoElement","document","createElement","controls","innerHTML","hide","authoringViewComponentChanged","params","isPopup","$broadcast","$inject"],"mappings":"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","file":"embeddedAuthoringController.js","sourcesContent":["'use strict';\n\nimport EmbeddedController from \"./embeddedController\";\nimport html2canvas from 'html2canvas';\nimport iframeResizer from 'iframe-resizer';\n\nclass EmbeddedAuthoringController extends EmbeddedController {\n  constructor($filter,\n              $mdDialog,\n              $q,\n              $rootScope,\n              $scope,\n              $sce,\n              $timeout,\n              $window,\n              AnnotationService,\n              ConfigService,\n              EmbeddedService,\n              NodeService,\n              NotebookService,\n              ProjectService,\n              StudentAssetService,\n              StudentDataService,\n              UtilService) {\n    super($filter,\n      $mdDialog,\n      $q,\n      $rootScope,\n      $scope,\n      $sce,\n      $timeout,\n      $window,\n      AnnotationService,\n      ConfigService,\n      EmbeddedService,\n      NodeService,\n      NotebookService,\n      ProjectService,\n      StudentAssetService,\n      StudentDataService,\n      UtilService);\n\n    this.allowedConnectedComponentTypes = [\n      { type: 'Animation' },\n      { type: 'AudioOscillator' },\n      { type: 'ConceptMap' },\n      { type: 'Discussion' },\n      { type: 'Draw' },\n      { type: 'Embedded' },\n      { type: 'Graph' },\n      { type: 'Label' },\n      { type: 'Match' },\n      { type: 'MultipleChoice' },\n      { type: 'OpenResponse' },\n      { type: 'Table' }\n    ];\n\n    $scope.$watch(function() {\n      return this.authoringComponentContent;\n    }.bind(this), function(newValue, oldValue) {\n      this.componentContent = this.ProjectService.injectAssetPaths(newValue);\n      this.isSaveButtonVisible = this.componentContent.showSaveButton;\n      this.isSubmitButtonVisible = this.componentContent.showSubmitButton;\n      this.width = this.componentContent.width ? this.componentContent.width : '100%';\n      this.height = this.componentContent.height ? this.componentContent.height : '100%';\n      this.setURL(this.componentContent.url);\n    }.bind(this), true);\n\n    /*\n     * Listen for the assetSelected event which occurs when the user\n     * selects an asset from the choose asset popup\n     */\n    this.$scope.$on('assetSelected', (event, args) => {\n      if (args != null) {\n        if (args.nodeId == this.nodeId && args.componentId == this.componentId) {\n          var assetItem = args.assetItem;\n          if (assetItem != null) {\n            var fileName = assetItem.fileName;\n            if (fileName != null) {\n              // get the assets directory path, e.g. /wise/curriculum/3/\n              var assetsDirectoryPath = this.ConfigService.getProjectAssetsDirectoryPath();\n              var fullAssetPath = assetsDirectoryPath + '/' + fileName;\n              var summernoteId = '';\n\n              if (args.target == 'prompt') {\n                summernoteId = 'summernotePrompt_' + this.nodeId + '_' + this.componentId;\n              } else if (args.target == 'rubric') {\n                summernoteId = 'summernoteRubric_' + this.nodeId + '_' + this.componentId;\n              }\n\n              if (summernoteId != '') {\n                if (this.UtilService.isImage(fileName)) {\n                  /*\n                   * move the cursor back to its position when the asset chooser\n                   * popup was clicked\n                   */\n                  $('#' + summernoteId).summernote('editor.restoreRange');\n                  $('#' + summernoteId).summernote('editor.focus');\n                  $('#' + summernoteId).summernote('insertImage', fullAssetPath, fileName);\n                } else if (this.UtilService.isVideo(fileName)) {\n                  /*\n                   * move the cursor back to its position when the asset chooser\n                   * popup was clicked\n                   */\n                  $('#' + summernoteId).summernote('editor.restoreRange');\n                  $('#' + summernoteId).summernote('editor.focus');\n\n                  var videoElement = document.createElement('video');\n                  videoElement.controls = 'true';\n                  videoElement.innerHTML = '<source ng-src=\"' + fullAssetPath + '\" type=\"video/mp4\">';\n                  $('#' + summernoteId).summernote('insertNode', videoElement);\n                }\n              }\n            }\n          }\n        }\n      }\n\n      this.$mdDialog.hide();\n    });\n\n    /* TODO geoffreykwan we're listening to assetSelected twice?\n     * Listen for the assetSelected event which occurs when the user\n     * selects an asset from the choose asset popup\n     */\n    this.$scope.$on('assetSelected', (event, args) => {\n      if (args != null) {\n        if (args.nodeId == this.nodeId && args.componentId == this.componentId) {\n          var assetItem = args.assetItem;\n          if (assetItem != null) {\n            var fileName = assetItem.fileName;\n            if (fileName != null) {\n              if (args.target == 'modelFile') {\n                this.authoringComponentContent.url = fileName;\n                this.authoringViewComponentChanged();\n              }\n            }\n          }\n        }\n      }\n      this.$mdDialog.hide();\n    });\n  }\n\n  /**\n   * Show the asset popup to allow the author to choose the model file\n   */\n  chooseModelFile() {\n    var params = {};\n    params.isPopup = true;\n    params.nodeId = this.nodeId;\n    params.componentId = this.componentId;\n    params.target = 'modelFile';\n    this.$rootScope.$broadcast('openAssetChooser', params);\n  }\n}\n\nEmbeddedAuthoringController.$inject = [\n  '$filter',\n  '$mdDialog',\n  '$q',\n  '$rootScope',\n  '$scope',\n  '$sce',\n  '$timeout',\n  '$window',\n  'AnnotationService',\n  'ConfigService',\n  'EmbeddedService',\n  'NodeService',\n  'NotebookService',\n  'ProjectService',\n  'StudentAssetService',\n  'StudentDataService',\n  'UtilService'\n];\n\nexport default EmbeddedAuthoringController;\n"]}