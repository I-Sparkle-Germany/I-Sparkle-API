{"version":3,"sources":["embeddedService.es6"],"names":["EmbeddedService","$filter","$q","StudentAssetService","StudentDataService","UtilService","$translate","component","type","url","height","componentStates","componentEvents","nodeEvents","isCompletedFieldInComponentState","componentState","studentData","isCompleted","event","componentContent","deferred","defer","iframe","$","componentId","length","modelElement","contents","find","then","canvas","base64Image","toDataURL","imageObject","getImageObjectFromBase64String","uploadAsset","asset","resolve","promise","ComponentService","$inject"],"mappings":"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","sourcesContent":["import ComponentService from '../componentService';\nimport html2canvas from 'html2canvas';\n\nclass EmbeddedService extends ComponentService {\n  constructor(\n      $filter,\n      $q,\n      StudentAssetService,\n      StudentDataService,\n      UtilService) {\n    super($filter, StudentDataService, UtilService);\n    this.$q = $q;\n    this.StudentAssetService = StudentAssetService;\n  }\n\n  getComponentTypeLabel() {\n    return this.$translate('embedded.componentTypeLabel');\n  }\n\n  createComponent() {\n    const component = super.createComponent();\n    component.type = 'Embedded';\n    component.url = '';\n    component.height = 600;\n    return component;\n  }\n\n  isCompleted(component, componentStates, componentEvents, nodeEvents) {\n    let isCompletedFieldInComponentState = false;\n    if (componentStates != null) {\n      for (let componentState of componentStates) {\n        const studentData = componentState.studentData;\n        if (studentData != null && studentData.isCompleted != null) {\n          if (studentData.isCompleted === true) {\n            return true;\n          }\n          isCompletedFieldInComponentState = true;\n        }\n      }\n    }\n\n    if (isCompletedFieldInComponentState === false) {\n      /*\n       * the isCompleted field was not set into the component state so\n       * we will look for events to determine isCompleted\n       */\n      if (nodeEvents != null) {\n        for (let event of nodeEvents) {\n          if (event.event === 'nodeEntered') {\n            return true;\n          }\n        }\n      }\n    }\n    return false;\n  }\n\n  componentHasWork(component) {\n    return false;\n  }\n\n  componentStateHasStudentWork(componentState, componentContent) {\n    return componentState.studentData != null;\n  }\n\n  /**\n   * The component state has been rendered in a <component></component> element\n   * and now we want to take a snapshot of the work.\n   * @param componentState The component state that has been rendered.\n   * @return A promise that will return an image object.\n   */\n  generateImageFromRenderedComponentState(componentState) {\n    const deferred = this.$q.defer();\n    const iframe = $('#componentApp_' + componentState.componentId);\n    if (iframe != null && iframe.length > 0) {\n      let modelElement = iframe.contents().find('html');\n      if (modelElement != null && modelElement.length > 0) {\n        modelElement = modelElement[0];\n        html2canvas(modelElement).then((canvas) => {\n          const base64Image = canvas.toDataURL('image/png');\n          const imageObject = this.UtilService.getImageObjectFromBase64String(base64Image);\n          this.StudentAssetService.uploadAsset(imageObject).then((asset) => {\n            deferred.resolve(asset);\n          });\n        });\n      }\n    }\n    return deferred.promise;\n  }\n}\n\nEmbeddedService.$inject = [\n  '$filter',\n  '$q',\n  'StudentAssetService',\n  'StudentDataService',\n  'UtilService'\n];\n\nexport default EmbeddedService;\n"],"file":"embeddedService.js"}