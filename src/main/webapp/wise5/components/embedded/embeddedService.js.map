{"version":3,"sources":["embeddedService.es6"],"names":["EmbeddedService","$filter","$q","StudentAssetService","StudentDataService","UtilService","$translate","component","type","url","componentStates","componentEvents","nodeEvents","isCompletedFieldInComponentState","componentState","studentData","isCompleted","event","componentContent","deferred","defer","iframe","$","componentId","length","modelElement","contents","find","then","canvas","base64Image","toDataURL","imageObject","getImageObjectFromBase64String","uploadAsset","asset","resolve","promise","ComponentService","$inject"],"mappings":"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","file":"embeddedService.js","sourcesContent":["import ComponentService from '../componentService';\nimport html2canvas from 'html2canvas';\n\nclass EmbeddedService extends ComponentService {\n  constructor(\n      $filter,\n      $q,\n      StudentAssetService,\n      StudentDataService,\n      UtilService) {\n    super($filter, StudentDataService, UtilService);\n    this.$q = $q;\n    this.StudentAssetService = StudentAssetService;\n  }\n\n  getComponentTypeLabel() {\n    return this.$translate('embedded.componentTypeLabel');\n  }\n\n  createComponent() {\n    const component = super.createComponent();\n    component.type = 'Embedded';\n    component.url = '';\n    return component;\n  }\n\n  isCompleted(component, componentStates, componentEvents, nodeEvents) {\n    let isCompletedFieldInComponentState = false;\n    if (componentStates != null) {\n      for (let componentState of componentStates) {\n        const studentData = componentState.studentData;\n        if (studentData != null && studentData.isCompleted != null) {\n          if (studentData.isCompleted === true) {\n            return true;\n          }\n          isCompletedFieldInComponentState = true;\n        }\n      }\n    }\n\n    if (isCompletedFieldInComponentState === false) {\n      /*\n       * the isCompleted field was not set into the component state so\n       * we will look for events to determine isCompleted\n       */\n      if (nodeEvents != null) {\n        for (let event of nodeEvents) {\n          if (event.event === 'nodeEntered') {\n            return true;\n          }\n        }\n      }\n    }\n    return false;\n  }\n\n  componentHasWork(component) {\n    return false;\n  }\n\n  componentStateHasStudentWork(componentState, componentContent) {\n    return componentState.studentData != null;\n  }\n\n  /**\n   * The component state has been rendered in a <component></component> element\n   * and now we want to take a snapshot of the work.\n   * @param componentState The component state that has been rendered.\n   * @return A promise that will return an image object.\n   */\n  generateImageFromRenderedComponentState(componentState) {\n    const deferred = this.$q.defer();\n    const iframe = $('#componentApp_' + componentState.componentId);\n    if (iframe != null && iframe.length > 0) {\n      let modelElement = iframe.contents().find('html');\n      if (modelElement != null && modelElement.length > 0) {\n        modelElement = modelElement[0];\n        html2canvas(modelElement).then((canvas) => {\n          const base64Image = canvas.toDataURL('image/png');\n          const imageObject = this.UtilService.getImageObjectFromBase64String(base64Image);\n          this.StudentAssetService.uploadAsset(imageObject).then((asset) => {\n            deferred.resolve(asset);\n          });\n        });\n      }\n    }\n    return deferred.promise;\n  }\n}\n\nEmbeddedService.$inject = [\n  '$filter',\n  '$q',\n  'StudentAssetService',\n  'StudentDataService',\n  'UtilService'\n];\n\nexport default EmbeddedService;\n"]}