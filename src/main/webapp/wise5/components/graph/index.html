<div ng-controller='GraphController as graphController' flex>
    <listen-for-delete-keypress>
        <div>
            <div ng-if='graphController.mode === "authoring"'>
                <textarea ng-model='graphController.authoringComponentContent.prompt'
                          ng-change='graphController.authoringViewComponentChanged()'
                          ng-model-options='{ debounce: 1000 }'
                          rows='10'
                          cols='100'></textarea>
                <br/>
                Graph Title: <input ng-model='graphController.authoringComponentContent.title'
                                    ng-change='graphController.authoringViewComponentChanged()'
                                    ng-model-options='{ debounce: 1000 }'
                                    size='30'/>
                Graph Type: <input ng-model='graphController.authoringComponentContent.graphType'
                                   ng-model-options='{ debounce: 1000 }'
                                   ng-change='graphController.authoringViewComponentChanged()'/>
                <br/>
                Graph Width: <input type='number'
                                    ng-model='graphController.authoringComponentContent.width'
                                    ng-model-options='{ debounce: 1000 }'
                                    ng-change='graphController.authoringViewComponentChanged()'/>
                Graph Height: <input type='number'
                                     ng-model='graphController.authoringComponentContent.height'
                                     ng-model-options='{ debounce: 1000 }'
                                     ng-change='graphController.authoringViewComponentChanged()'/>
                <br/>
                X Axis Title: <input ng-model='graphController.authoringComponentContent.xAxis.title.text'
                                     ng-model-options='{ debounce: 1000 }'
                                     ng-change='graphController.authoringViewComponentChanged()'/>
                X Min: <input type='number'
                              ng-model='graphController.authoringComponentContent.xAxis.min'
                              ng-model-options='{ debounce: 1000 }'
                              ng-change='graphController.authoringViewComponentChanged()'/>
                X Max: <input type='number'
                              ng-model='graphController.authoringComponentContent.xAxis.max'
                              ng-model-options='{ debounce: 1000 }'
                              ng-change='graphController.authoringViewComponentChanged()'/>
                <br/>
                <br/>
                Y Axis Title: <input ng-model='graphController.authoringComponentContent.yAxis.title.text'
                                     ng-model-options='{ debounce: 1000 }'
                                     ng-change='graphController.authoringViewComponentChanged()'/>
                Y Min: <input type='number'
                              ng-model='graphController.authoringComponentContent.yAxis.min'
                              ng-model-options='{ debounce: 1000 }'
                              ng-change='graphController.authoringViewComponentChanged()'/>
                Y Max: <input type='number'
                              ng-model='graphController.authoringComponentContent.yAxis.max'
                              ng-model-options='{ debounce: 1000 }'
                              ng-change='graphController.authoringViewComponentChanged()'/>
                <br/>
                <br/>
                Enable Trials <input type='checkbox'
                                     ng-model='graphController.authoringComponentContent.enableTrials'
                                     ng-change='graphController.authoringViewEnableTrialsClicked()'/>
                <br/>
                Enable File Upload <input type='checkbox'
                                     ng-model='graphController.authoringComponentContent.enableFileUpload'
                                     ng-change='graphController.authoringViewComponentChanged()'/>
                <br/>
                <div ng-show='graphController.authoringComponentContent.enableTrials'>
                    Can Student Create Trials <input type='checkbox'
                                                     ng-model='graphController.authoringComponentContent.canCreateNewTrials'
                                                     ng-show='graphController.authoringComponentContent.enableTrials'
                                                     ng-change='graphController.authoringViewComponentChanged()'/>
                    <br/>
                    Can Student Delete Trials <input type='checkbox'
                                                     ng-model='graphController.authoringComponentContent.canDeleteTrials'
                                                     ng-show='graphController.authoringComponentContent.enableTrials'
                                                     ng-change='graphController.authoringViewComponentChanged()'/>
                    <br/>
                    Hide Existing Trials On New Trial <input type='checkbox'
                                                             ng-model='graphController.authoringComponentContent.hideAllTrialsOnNewTrial'
                                                             ng-show='graphController.authoringComponentContent.enableTrials'
                                                             ng-change='graphController.authoringViewComponentChanged()'/>
                </div>
                <br/>
                Series
                <button ng-click='graphController.authoringAddSeriesClicked()'>Add Series</button>
                <div ng-repeat='series in graphController.authoringComponentContent.series track by $index'
                     style='border: 1px solid black'>
                    Name: <input ng-model='series.name'
                                 ng-change='graphController.authoringViewComponentChanged()'
                                 ng-model-options='{ debounce: 1000 }'
                                 size='30'/>
                    <br/>
                    Color: <input ng-model='series.color'
                                  ng-model-options='{ debounce: 1000 }'
                                  ng-change='graphController.authoringViewComponentChanged()'/>
                    <br/>
                    Symbol: <input ng-model='series.marker.symbol'
                                   ng-model-options='{ debounce: 1000 }'
                                   ng-change='graphController.authoringViewComponentChanged()'/>
                    <br/>
                    Can Student Edit: <input type='checkbox'
                                             ng-model='series.canEdit'
                                             ng-model-options='{ debounce: 1000 }'
                                             ng-change='graphController.authoringViewComponentChanged()'/>
                    <br/>
                    <button ng-click='graphController.authoringDeleteSeriesClicked($index)'>Delete Series</button>
                </div>
                <br/>
                Max Score:
                <input type='number'
                       ng-model='graphController.authoringComponentContent.maxScore'
                       ng-change='graphController.authoringViewComponentChanged()'
                       ng-model-options='{ debounce: 1000 }'
                       style='width: 3em'/>
                <br/>
                Show Previous Work Step:
                <select ng-model='graphController.authoringComponentContent.showPreviousWorkNodeId'
                        ng-change='graphController.authoringShowPreviousWorkNodeIdChanged()'>
                    <option></option>
                    <option ng-repeat='item in graphController.idToOrder | toArray | orderBy : "order"'
                            value='{{item.$key}}'
                            ng-if='graphController.isApplicationNode(item.$key)'>{{graphController.getNodePositionAndTitleByNodeId(item.$key)}}</option>
                </select>
                <br/>
                Show Previous Work Component:
                <select ng-model='graphController.authoringComponentContent.showPreviousWorkComponentId'
                        ng-change='graphController.authoringViewComponentChanged()'>
                    <option></option>
                    <option ng-repeat='component in graphController.getComponentsByNodeId(graphController.authoringComponentContent.showPreviousWorkNodeId)' value='{{component.id}}'>{{component.type}}</option>
                </select>
                <br/>
                Show Previous Work Prompt:
                <input type='checkbox'
                       ng-model='graphController.authoringComponentContent.showPreviousWorkPrompt'
                       ng-change='graphController.authoringViewComponentChanged()'/>
                <br/>
                <textarea ng-model='graphController.authoringComponentContentJSONString'
                          ng-change='graphController.advancedAuthoringViewComponentChanged()'
                          ng-model-options='{ debounce: 1000 }'
                          rows='10'
                          cols='100'></textarea>
            </div>
            <div class="component__prompt">
                <div class="component__prompt__content"><compile data='graphController.getPrompt()'></compile></div>
                <possible-score max-score="graphController.componentContent.maxScore"
                                ng-if="graphController.mode === 'student' && !graphController.latestAnnotations.score"></possible-score>
            </div>
            <input type="file"
                   accept=".csv"
                   ng-show="graphController.componentContent.enableFileUpload"
                   onchange="angular.element(this).scope().fileUploadChanged(this)"/>
            <hr />
            <div class="component__actions">
                <md-input-container ng-if='graphController.componentContent.enableTrials'>
                    <label>Select trials to show</label>
                    <md-select ng-model="graphController.trialIdsToShow"
                               ng-change='graphController.trialIdsToShowChanged()'
                               md-selected-text="graphController.selectedTrialsText"
                               class="graph-select"
                               multiple>
                        <md-option ng-repeat="trial in graphController.trials" ng-value="trial.id">
                            <span>{{trial.name}}</span>
                            <md-button ng-click='graphController.deleteTrial($index)'
                                       ng-if='graphController.componentContent.canDeleteTrials'
                                       aria-label="Delete trial"
                                       class="md-icon-button">
                                <md-icon> delete </md-icon>
                            </md-button>
                        </md-option>
                    </md-select>
                </md-input-container>
                <md-input-container ng-if="graphController.componentContent.enableTrials && graphController.showSelectActiveTrials()">
                    <label>Select trial to edit</label>
                    <md-select ng-model="graphController.activeTrial"
                               ng-change='graphController.activeTrialChanged()'
                               class="graph-select">
                        <md-option ng-repeat="trial in graphController.trials"
                                   ng-value="trial"
                                   ng-if="trial.show && graphController.canEditTrial(trial)">
                            {{trial.name}}
                        </md-option>
                    </md-select>
                </md-input-container>
                <md-input-container ng-if="graphController.showSelectSeries()">
                    <label>Select series to edit</label>
                    <md-select ng-model="graphController.activeSeries"
                               ng-change='graphController.activeSeriesChanged()'
                               class="graph-select">
                        <md-option ng-repeat="series in graphController.series"
                                   ng-value="series">
                            {{series.name}}
                        </md-option>
                    </md-select>
                </md-input-container>
                <md-button class="md-accent"
                           ng-click='graphController.resetSeries()'
                           ng-if='graphController.showResetSeriesButton() && graphController.activeSeries.canEdit'>
                    <md-icon> restore </md-icon> Reset Series
                </md-button>
            </div>
            <div class="component__actions">
                <md-button class="md-accent"
                           ng-click='graphController.newTrial()'
                           ng-show='graphController.componentContent.canCreateNewTrials'>
                    <md-icon> add </md-icon> New Trial
                </md-button>
                <md-button class="md-accent"
                           ng-click='graphController.resetGraph()'
                           ng-show='graphController.showResetGraphButton()'>
                    <md-icon> restore </md-icon> Reset Graph
                </md-button>
                <md-button class="md-accent md-primary"
                        ng-click='graphController.snipDrawing($event)'
                        ng-if='graphController.showSnipDrawingButton()'>
                    <md-icon> content_cut </md-icon>  {{ 'addToNotebook' | translate:{label:graphController.notebookConfig.label} }}
                </md-button>
                <md-button class="md-accent" ng-if="graphController.isStudentAttachmentEnabled"
                           ng-click="nodeController.showStudentAssets($event, component.id, graphController.isDisabled)">
                    <md-icon>image</md-icon> Import Data
                </md-button>
            </div>
            <highchart id="{{graphController.chartId}}" config="graphController.chartConfig"></highchart>
            <div class="component__actions" layout="row" layout-align="start center">
                <md-button class="md-raised md-primary"
                           ng-click='graphController.submitButtonClicked()'
                           ng-if='graphController.showSubmitButton()'
                           ng-disabled='graphController.isDisabled || !graphController.isSubmitDirty'>Submit</md-button>
                <md-button class="md-primary"
                           ng-class="{'md-raised': !graphController.showSubmitButton()}"
                           ng-click='graphController.saveButtonClicked()'
                           ng-if='graphController.showSaveButton()'
                           ng-disabled='graphController.isDisabled || !graphController.isDirty'>Save</md-button>
                <span ng-if="graphController.showSaveButton() || graphController.showSubmitButton()"
                          ng-show="graphController.saveMessage.text"
                          class="component__actions__info md-caption">
                          {{graphController.saveMessage.text}} <span class="component__actions__more"><md-tooltip md-direction="top">{{ graphController.saveMessage.time | amDateFormat:'ddd, MMM D YYYY, h:mm a' }}</md-tooltip><span am-time-ago="graphController.saveMessage.time"></span></span>
                </span>
            </div>
            <component-annotations ng-if="graphController.mode === 'student'"
                                   annotations='graphController.latestAnnotations'
                                   max-score="graphController.componentContent.maxScore"></component-annotations>
        </div>
        <div ng-if='graphController.mode === "grading"'>
            <annotation ng-if='graphController.componentContent.maxScore > -1'
                        type='score'
                        mode='graphController.mode'
                        node-id='graphController.nodeId'
                        component-id='graphController.componentId'
                        from-workgroup-id='teacherWorkgroupId'
                        to-workgroup-id='workgroupId'
                        component-state-id='componentState.id'
                        active='true'></annotation>
            <br ng-if='graphController.componentContent.maxScore > -1'/>
            <annotation type='comment'
                        mode='graphController.mode'
                        node-id='graphController.nodeId'
                        component-id='graphController.componentId'
                        from-workgroup-id='teacherWorkgroupId'
                        to-workgroup-id='workgroupId'
                        component-state-id='componentState.id'
                        active='true'></annotation>
        </div>
    </listen-for-delete-keypress>
</div>
