<style>
    {{labelController.nodeContent.style}}
    .studentButton {
        min-width: 50;
        max-width: 50;
    }
</style>

<div class='openResponse' ng-controller='LabelController as labelController' flex>
    <div ng-if='labelController.mode === "authoring" && !labelController.authoringComponentContent.showPreviousWork'>
        <md-input-container style='width:100%'>
            <label>{{ 'PROMPT' | translate }}</label>
            <textarea rows='3'
                    ng-model='labelController.authoringComponentContent.prompt'
                    ng-change='labelController.authoringViewComponentChanged()'
                    ng-model-options='{ debounce: 1000 }'
                    placeholder='{{ "enterPromptHere" | translate }}'>
            </textarea>
        </md-input-container>
        <div style='height: 60px;'>
            <md-input-container>
                <label>{{ 'BACKGROUND_IMAGE' | translate }}</label>
                <input size='100'
                       ng-model='labelController.authoringComponentContent.backgroundImage'
                       ng-change='labelController.authoringViewComponentChanged()'/>
            </md-input-container>
            <md-button class='topButton md-raised md-primary' ng-click='labelController.chooseBackgroundImage()'>
                <md-icon>insert_photo</md-icon>
                <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'chooseAnImage' | translate }}</md-tooltip>
            </md-button>
        </div>
        <div style='height: 60px;'>
            <md-input-container>
                <label>{{ 'label.canvasWidth' | translate }}</label>
                <input type='number'
                       style='width: 200'
                       ng-model='labelController.authoringComponentContent.width'
                       ng-change='labelController.authoringViewComponentChanged()'/>
            </md-input-container>
            <md-input-container>
                <label>{{ 'label.canvasHeight' | translate }}</label>
                <input type='number'
                       style='width: 200'
                       ng-model='labelController.authoringComponentContent.height'
                       ng-change='labelController.authoringViewComponentChanged()'/>
            </md-input-container>
        </div>
        <div>
            <md-checkbox class='md-primary'
                         ng-model='labelController.authoringComponentContent.canCreateLabels'
                         ng-change='labelController.authoringViewComponentChanged()'>
                {{ 'label.canStudentCreateLabels' | translate }}
            </md-checkbox>
            <br/>
            <md-checkbox class='md-primary'
                         ng-model='labelController.authoringComponentContent.canDeleteLabels'
                         ng-change='labelController.authoringViewComponentChanged()'>
                {{ 'label.canStudentDeleteLabels' | translate }}
            </md-checkbox>
            <br/>
            <md-checkbox class='md-primary'
                         ng-model='labelController.authoringComponentContent.enableStudentUploadBackground'
                         ng-change='labelController.authoringViewComponentChanged()'>
                {{ 'label.allowStudentToUploadImageForBackground' | translate }}
            </md-checkbox>
        </div>
        <div>
            <div layout='row'>
                <h6>{{ 'label.starterLabels' | translate }}</h6>
                <md-button class='topButton md-raised md-primary'
                           ng-click='labelController.authoringAddLabelClicked()'>
                    <md-icon>add</md-icon>
                    <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'label.addStarterLabel' | translate }}</md-tooltip>
                </md-button>
            </div>
            <div ng-show='labelController.authoringComponentContent.labels == null || labelController.authoringComponentContent.labels.length == 0'>
                {{ 'label.thereAreNoStarterLabels' | translate }}
            </div>
            <div ng-repeat='label in labelController.authoringComponentContent.labels track by $index'
                 style='border: 2px solid #dddddd; border-radius: 5px; margin-bottom: 10px; padding: 20px 20px 10px 20px;'>
                <div style='height: 60;'>
                    <md-input-container style='margin-right: 20;'>
                        <label>{{ 'TEXT' | translate }}</label>
                        <input ng-model='label.text'
                               ng-change='labelController.authoringViewComponentChanged()'
                               ng-model-options='{ debounce: 1000 }'
                               size='50'
                               placeholder='{{ "label.enterLabelTextHere" | translate }}'/>
                    </md-input-container>
                    <md-input-container>
                        <label>{{ 'label.color' | translate }}</label>
                        <input ng-model='label.color'
                               ng-change='labelController.authoringViewComponentChanged()'
                               ng-model-options='{ debounce: 1000 }'/>
                    </md-input-container>
                    <md-button class='topButton md-raised md-primary'
                               ng-click='labelController.openColorViewer()'>
                        <md-icon>palette</md-icon>
                        <md-tooltip md-direction='top' class='projectButtonTooltip'>
                            {{ 'label.viewColors' | translate }}
                        </md-tooltip>
                    </md-button>
                </div>
                <div style='height: 60;'>
                    <md-input-container style='margin-right: 20;'>
                        <span>{{ 'label.pointLocation' | translate }}</span>
                    </md-input-container>
                    <md-input-container style='margin-right: 20;'>
                        <label>{{ 'label.x' | translate }}</label>
                        <input type='number'
                               ng-model='label.pointX'
                               ng-change='labelController.authoringViewComponentChanged()'
                               ng-model-options='{ debounce: 1000 }'/>
                    </md-input-container>
                    <md-input-container>
                        <label>{{ 'label.y' | translate }}</label>
                        <input type='number'
                               ng-model='label.pointY'
                               ng-change='labelController.authoringViewComponentChanged()'
                               ng-model-options='{ debounce: 1000 }'/>
                    </md-input-container>
                </div>
                <div style='height: 60;' layout='row'>
                    <md-input-container style='margin-right: 20;'>
                        <span>{{ 'label.textLocation' | translate }}</span> <span><md-icon>announcement</md-icon><md-tooltip md-direction='bottom'>({{ 'label.relativeToTextLocation' | translate }})</md-tooltip></span>
                    </md-input-container>
                    <md-input-container style='margin-right: 20;'>
                        <label>{{ 'label.x' | translate }}</label>
                        <input type='number'
                               ng-model='label.textX'
                               ng-change='labelController.authoringViewComponentChanged()'
                               ng-model-options='{ debounce: 1000 }'/>
                    </md-input-container>
                    <md-input-container>
                        <label>{{ 'label.y' | translate }}</label>
                        <input type='number'
                               ng-model='label.textY'
                               ng-change='labelController.authoringViewComponentChanged()'
                               ng-model-options='{ debounce: 1000 }'/>
                    </md-input-container>
                    <span flex></span>
                    <md-button class='moveComponentButton md-raised md-primary'
                               style='margin-top: 20;'
                               ng-click='labelController.authoringDeleteLabelClicked($index, label)'>
                        <md-icon>delete</md-icon>
                        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'label.deleteLabel' | translate }}</md-tooltip>
                    </md-button>
                </div>
            </div>
        </div>
        <md-button class='topButton md-raised md-primary'
                   ng-click='labelController.saveStarterLabels()'>
            <md-icon>create</md-icon>
            <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'label.saveStarterLabels' | translate }}</md-tooltip>
        </md-button>
        <md-button class='topButton md-raised md-primary'
                   ng-click='labelController.deleteStarterLabels()'>
            <md-icon>delete_sweep</md-icon>
            <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'label.deleteStarterLabels' | translate }}</md-tooltip>
        </md-button>
    </div>
    <div ng-if='labelController.mode === "authoring"'>
        <md-button class='topButton md-raised md-primary' ng-click='labelController.showAdvancedAuthoring = !labelController.showAdvancedAuthoring'>
            <md-icon>build</md-icon>
            <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ "ADVANCED" | translate }}</md-tooltip>
        </md-button>
        <br/>
        <div ng-show='labelController.showAdvancedAuthoring'>
            {{ 'SHOW_SAVE_BUTTON' | translate }}:
            <input type='checkbox'
                   ng-model='labelController.authoringComponentContent.showSaveButton'
                   ng-change='labelController.authoringViewComponentChanged()'/>
            <br/>
            {{ 'SHOW_SUBMIT_BUTTON' | translate }}:
            <input type='checkbox'
                   ng-model='labelController.authoringComponentContent.showSubmitButton'
                   ng-change='labelController.showSubmitButtonValueChanged()'/>
            <div ng-show='labelController.authoringComponentContent.showSubmitButton'
                 style='display:inline'>
                <span>{{ 'MAX_SUBMIT' | translate }}:</span>
                <input type='number'
                       ng-model='labelController.authoringComponentContent.maxSubmitCount'
                       ng-change='labelController.authoringViewComponentChanged()'/>
            </div>
            <br/>
            {{ 'MAX_SCORE' | translate }}:
            <input type='number'
                   ng-model='labelController.authoringComponentContent.maxScore'
                   ng-change='labelController.authoringViewComponentChanged()'
                   ng-model-options='{ debounce: 1000 }'
                   style='width: 3em'/>
            <br/>
            {{ 'COMPONENT_WIDTH' | translate }}:
            <input type='number'
                   ng-model='labelController.authoringComponentContent.componentWidth'
                   ng-change='labelController.authoringViewComponentChanged()'
                   ng-model-options='{ debounce: 1000 }'
                   style='width: 3em'/>
            <br/>
            <div ng-if='labelController.mode === "authoring"'>
                {{ 'IMPORT_PREVIOUS_WORK' | translate }}:
                <input type='checkbox'
                       ng-model='labelController.authoringComponentContent.importPreviousWork'
                       ng-click='labelController.authoringImportPreviousWorkClicked()'
                       ng-change='labelController.authoringViewComponentChanged()'/>
            </div>
            <div ng-if='labelController.mode === "authoring" && labelController.authoringComponentContent.importPreviousWork'>
                {{ 'IMPORT_PREVIOUS_WORK_STEP' | translate }}:
                <select ng-model='labelController.authoringComponentContent.importPreviousWorkNodeId'
                        ng-change='labelController.authoringImportPreviousWorkNodeIdChanged()'>
                    <option></option>
                    <option ng-repeat='item in labelController.idToOrder | toArray | orderBy : "order"'
                            value='{{item.$key}}'
                            ng-if='labelController.isApplicationNode(item.$key)'>{{labelController.getNodePositionAndTitleByNodeId(item.$key)}}</option>
                </select>
                <br/>
                {{ 'IMPORT_PREVIOUS_WORK_COMPONENT' | translate }}:
                <select ng-model='labelController.authoringComponentContent.importPreviousWorkComponentId'
                        ng-change='labelController.authoringImportPreviousWorkComponentIdChanged()'
                        ng-options='component.id as component.type disable when !labelController.componentHasWork(component) for component in labelController.getComponentsByNodeId(labelController.authoringComponentContent.importPreviousWorkNodeId)'>
                    <option></option>
                </select>
            </div>
            <div ng-if='labelController.mode === "authoring"'>
                {{ 'SHOW_PREVIOUS_WORK' | translate }}:
                <input type='checkbox'
                       ng-model='labelController.authoringComponentContent.showPreviousWork'
                       ng-click='labelController.authoringShowPreviousWorkClicked()'
                       ng-change='labelController.authoringViewComponentChanged()'/>
            </div>
            <div ng-if='labelController.mode === "authoring" && labelController.authoringComponentContent.showPreviousWork'>
                {{ 'SHOW_PREVIOUS_WORK_STEP' | translate }}:
                <select ng-model='labelController.authoringComponentContent.showPreviousWorkNodeId'
                        ng-change='labelController.authoringShowPreviousWorkNodeIdChanged()'>
                    <option></option>
                    <option ng-repeat='item in labelController.idToOrder | toArray | orderBy : "order"'
                            value='{{item.$key}}'
                            ng-if='labelController.isApplicationNode(item.$key)'>{{labelController.getNodePositionAndTitleByNodeId(item.$key)}}</option>
                </select>
                <br/>
                {{ 'SHOW_PREVIOUS_WORK_COMPONENT' | translate }}:
                <select ng-model='labelController.authoringComponentContent.showPreviousWorkComponentId'
                        ng-change='labelController.authoringShowPreviousWorkComponentIdChanged()'
                        ng-options='component.id as component.type disable when !labelController.componentHasWork(component) for component in labelController.getComponentsByNodeId(labelController.authoringComponentContent.showPreviousWorkNodeId)'>
                    <option></option>
                </select>
                <br/>
                {{ 'SHOW_PREVIOUS_WORK_PROMPT' | translate }}:
                <input type='checkbox'
                       ng-model='labelController.authoringComponentContent.showPreviousWorkPrompt'
                       ng-change='labelController.authoringViewComponentChanged()'/>
            </div>
            <div ng-if='labelController.mode === "authoring"'>
                <button ng-click='labelController.addConnectedComponent()'>{{ 'ADD_CONNECTED_COMPONENT' | translate }}</button>
                <div ng-repeat='connectedComponent in labelController.authoringComponentContent.connectedComponents track by $index'>
                    <table border='1'>
                        <tr>
                            <td style='padding:5'>
                                {{ 'CONNECTED_COMPONENT' | translate }}
                            </td>
                            <td style='padding:5'>
                                <div style='display:none'>
                                    {{ 'NODE_ID' | translate }}:
                                    <select ng-model='connectedComponent.nodeId'
                                            ng-change='labelController.authoringViewComponentChanged()'>
                                        <option></option>
                                        <option ng-repeat='item in labelController.idToOrder | toArray | orderBy : "order"'
                                                value='{{item.$key}}'
                                                ng-if='labelController.isApplicationNode(item.$key)'>{{labelController.getNodePositionAndTitleByNodeId(item.$key)}}</option>
                                    </select>
                                </div>
                                <div>
                                    {{ 'COMPONENT_ID' | translate }}:
                                    <select ng-model='connectedComponent.componentId'
                                            ng-change='labelController.authoringViewComponentChanged()'>
                                        <option></option>
                                        <option ng-repeat='(componentIndex, component) in labelController.getComponentsByNodeId(connectedComponent.nodeId)'
                                                ng-disabled='!labelController.componentHasWork(component)'
                                                value='{{component.id}}'>
                                            {{componentIndex + 1}}. {{component.type}}
                                        </option>
                                    </select>
                                </div>
                            </td>
                            <td style='padding:5'>
                                <select ng-model='connectedComponent.updateOn'
                                        ng-change='labelController.authoringViewComponentChanged()'>
                                        <option ng-repeat='updateOnOption in labelController.connectedComponentUpdateOnOptions'
                                                value='{{updateOnOption.value}}'>
                                            {{updateOnOption.text}}
                                        </option>
                                </select>
                            </td>
                            <td style='padding:5'>
                                <button ng-click='labelController.deleteConnectedComponent($index)'>{{ 'DELETE' | translate }}</button>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div ng-if='labelController.mode === "authoring"'>
                <button ng-click='labelController.showRubricAuthoring = !labelController.showRubricAuthoring'>
                    {{ 'EDIT_COMPONENT_RUBRIC' | translate }}
                </button>
                <div ng-show='labelController.showRubricAuthoring'>
                    <summernote id='{{labelController.summernoteRubricId}}'
                                ng-model='labelController.summernoteRubricHTML'
                                ng-change='labelController.summernoteRubricHTMLChanged()'
                                config='labelController.summernoteRubricOptions'
                                ng-model-options='{ debounce: 1000 }'
                                rows='10'
                                cols='100'>
                    </summernote>
                </div>
            </div>
            <div ng-if='labelController.mode === "authoring"'>
                <button ng-click='labelController.showJSON = !labelController.showJSON'>
                        {{ 'SHOW_JSON' | translate }}
                </button>
                <br/>
                <div ng-show='labelController.showJSON'>
                    <textarea ng-model='labelController.authoringComponentContentJSONString'
                              ng-change='labelController.advancedAuthoringViewComponentChanged()'
                              ng-model-options="{ updateOn: 'blur' }"
                              rows='20'
                              cols='100'></textarea>
                </div>
            </div>
        </div>
        <br/>
    </div>
    <div ng-style='labelController.mode === "authoring" && {"border": "1px solid black", "padding": "20px"}'>
        <div ng-if='labelController.mode === "authoring"'>
            <h5>{{ 'PREVIEW' | translate }}</h5>
        </div>
        <div ng-switch="labelController.mode">
            <div ng-switch-when="grading|gradingRevision" ng-switch-when-separator="|" layout="row" layout-wrap>
                <div flex="100" flex-gt-sm="66" layout="column" class="component--grading__response">
                    <div class="component--grading__response__content">
                        <div id="canvasParent_{{labelController.canvasId}}" ng-if="labelController.$scope.componentState">
                            <canvas id="{{labelController.canvasId}}" width="800" height="600" style="border:1px solid black;"></canvas>
                        </div>
                    </div>
                    <span flex></span>
                    <component-revisions-info node-id="labelController.nodeId"
                                              component-id="labelController.componentId"
                                              max-score="labelController.componentContent.maxScore"
                                              to-workgroup-id="workgroupId"
                                              component-state="componentState"
                                              active="labelController.mode === 'grading'"></component-revisions-info>
                </div>
                <div flex="100" flex-gt-sm="33" class="component--grading__annotations">
                    <component-grading node-id="labelController.nodeId"
                                       component-id="labelController.componentId"
                                       max-score="labelController.componentContent.maxScore"
                                       from-workgroup-id="teacherWorkgroupId"
                                       to-workgroup-id="workgroupId"
                                       component-state-id="componentState.id"
                                       show-all-annotations="labelController.mode !== 'grading'"
                                       is-disabled="labelController.mode !== 'grading'"></component-grading>
                </div>
            </div>
            <div ng-switch-default>
                <div class="component__prompt">
                    <div class="component__prompt__content"><compile data='labelController.getPrompt()'></compile></div>
                    <possible-score max-score="labelController.componentContent.maxScore"
                                    ng-if="labelController.mode === 'student' && !labelController.latestAnnotations.score"></possible-score>
                </div>
                <div class="input-wrapper">
                    <md-button class="studentButton md-raised md-primary"
                               ng-click="labelController.newLabelButtonClicked()"
                               ng-disabled="labelController.isDisabled"
                               ng-if="labelController.showNewLabelButton() && !labelController.createLabelMode && labelController.selectedLabel == null">
                        <md-icon>add</md-icon>
                        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'label.addNewLabel' | translate }}</md-tooltip>
                    </md-button>
                    <span ng-show="labelController.createLabelMode">{{ 'label.clickOnTheImageOr' | translate }}</span>
                    <md-button class="studentButton md-raised md-primary"
                               ng-click="labelController.cancelButtonClicked()"
                               ng-disabled="labelController.isDisabled"
                               ng-if="labelController.showCancelButton()">
                        <md-icon>clear</md-icon>
                        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'CANCEL' | translate }}<md-tooltip>
                    </md-button>
                    <span ng-show="labelController.createLabelMode">{{ 'label.toCancel' | translate }}</span>
                    <span ng-show="labelController.editLabelMode">{{ 'label.labelText' | translate }}:</span>
                    <input type="text"
                           id="editLabelTextInput"
                           ng-model="labelController.selectedLabel.text.text"
                           ng-show="labelController.editLabelMode"
                           ng-change="labelController.selectedLabelTextChanged(labelController.selectedLabel.text, labelController.selectedLabel.text.text)"
                           size="50"/>
                    <md-button class="studentButton md-raised md-primary"
                               ng-click="labelController.saveLabelButtonClicked()"
                               ng-disabled="labelController.isDisabled"
                               ng-show="labelController.editLabelMode">
                        <md-icon>done</md-icon>
                        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'SAVE' | translate }}</md-tooltip>
                    </md-button>
                    <md-button class="studentButton md-raised md-primary"
                               ng-click="labelController.cancelLabelButtonClicked()"
                               ng-disabled="labelController.isDisabled"
                               ng-show="labelController.editLabelMode">
                        <md-icon>clear</md-icon>
                        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'CANCEL' | translate }}</md-tooltip>
                    </md-button>
                    <md-button class="studentButton md-raised md-primary"
                               ng-click="labelController.deleteLabelButtonClicked()"
                               ng-disabled="labelController.isDisabled"
                               ng-show="labelController.editLabelMode">
                        <md-icon>delete</md-icon>
                        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'DELETE' | translate }}</md-tooltip>
                    </md-button>
                    <md-button class="studentButton md-accent md-primary"
                            ng-click='labelController.snipImage($event)'
                            ng-if='labelController.showSnipImageButton()'>
                        <md-icon> content_cut </md-icon>
                        <md-tooltip md-direction='top' class='projectButtonTooltip'>{{ 'ADD_TO_NOTEBOOK' | translate:{label:labelController.notebookConfig.label} }}</md-tooltip>
                    </md-button>
                    <br/>
                    <div ng-show="labelController.componentContent.enableStudentUploadBackground">
                        {{ 'label.uploadBackgroundImage' | translate }}:
                        <input type="file"
                               ng-show="labelController.componentContent.enableStudentUploadBackground"
                               onchange="angular.element(this).scope().fileUploadChanged(this)"
                               style="display:inline"/>
                    </div>
                    <br/>
                    <div id="canvasParent_{{labelController.canvasId}}">
                        <canvas id="{{labelController.canvasId}}" width="800" height="600" style="border:1px solid black;"></canvas>
                    </div>
                </div>
                    <div class="component__actions" ng-show="labelController.attachments.length && labelController.isStudentAttachmentEnabled" layout="row" layout-wrap="true">
                        <div class="component__add-attachment">
                            <md-button class="md-accent"
                                       ng-click="nodeController.showStudentAssets($event, component.id, labelController.isDisabled)">
                                <md-icon>image</md-icon> <span>{{ 'label.addFile' | translate }}</span>
                            </md-button>
                        </div>
                        <div class="component__attachment" ng-repeat="attachment in labelController.attachments">
                            <img ng-src="{{attachment.iconURL}}" class="component__attachment__content" />
                            <md-button class="component__attachment__delete" ng-click='labelController.removeAttachment(attachment)' title="Remove file"><md-icon>cancel</md-icon></md-button>
                        </div>
                    </div>
                    <div ng-if="labelController.isSaveButtonVisible || labelController.isSubmitButtonVisible"
                         class="component__actions" layout="row" layout-align="start center">
                        <md-button class="md-raised md-primary"
                                   ng-click='labelController.saveButtonClicked()'
                                   ng-if='labelController.isSaveButtonVisible'
                                   ng-disabled='labelController.isDisabled || !labelController.isDirty'>{{ 'SAVE' | translate }}</md-button>
                        <md-button class="md-raised md-primary"
                                   ng-click='labelController.submitButtonClicked()'
                                   ng-if='labelController.isSubmitButtonVisible'
                                   ng-disabled='labelController.isDisabled || !labelController.isSubmitDirty || labelController.isSubmitButtonDisabled'>{{ 'SUBMIT' | translate }}</md-button>
                        <span ng-show="labelController.saveMessage.text"
                              class="component__actions__info md-caption">
                            {{labelController.saveMessage.text}} <span class="component__actions__more"><md-tooltip md-direction="top">{{ labelController.saveMessage.time | amDateFormat:'ddd, MMM D YYYY, h:mm a' }}</md-tooltip><span am-time-ago="labelController.saveMessage.time"></span></span>
                        </span>
                    </div>
                    <component-annotations ng-if="labelController.mode === 'student' || labelController.mode === 'authoring'"
                                           annotations='labelController.latestAnnotations'
                                           max-score="labelController.componentContent.maxScore"></component-annotations>
                </div>
            </div>
        </div>
    </div>
</div>
