{"version":3,"sources":["matchAuthoringController.es6"],"names":["MatchAuthoringController","$filter","$mdDialog","$mdMedia","$q","$rootScope","$scope","AnnotationService","ConfigService","dragulaService","MatchService","NodeService","NotebookService","ProjectService","StudentAssetService","StudentDataService","UtilService","allowedConnectedComponentTypes","type","$watch","authoringComponentContent","bind","newValue","oldValue","componentContent","injectAssetPaths","isHorizontal","horizontal","isSaveButtonVisible","showSaveButton","isSubmitButtonVisible","showSubmitButton","isCorrect","submitCounter","isDisabled","isSubmitButtonDisabled","initializeChoices","initializeBuckets","$on","event","args","nodeId","componentId","assetItem","fileName","assetsDirectoryPath","getProjectAssetsDirectoryPath","fullAssetPath","target","summernoteId","$","summernote","isImage","isVideo","videoElement","document","createElement","controls","innerHTML","choiceObject","targetObject","value","authoringViewComponentChanged","bucketObject","hide","newChoice","id","generateKey","choices","push","addChoiceToFeedback","newBucket","buckets","addBucketToFeedback","index","choice","splice","feedback","f","length","bucketFeedback","bucketFeedbackChoices","tempChoice","answer","confirm","$translate","deletedChoice","choiceId","removeChoiceFromFeedback","bucket","deletedBucket","bucketId","removeBucketFromFeedback","feedbackText","feedbackObject","createFeedbackObject","c","position","incorrectPositionFeedback","show","componentHasFeedback","setShowSubmitButtonValue","tempFeedback","tempChoices","params","isPopup","$broadcast","$inject"],"mappings":"AAAA;;;;;;;;AAEA;;;;;;;;;;;;IAEMA,wB;;;AACJ,oCAAYC,OAAZ,EACYC,SADZ,EAEYC,QAFZ,EAGYC,EAHZ,EAIYC,UAJZ,EAKYC,MALZ,EAMYC,iBANZ,EAOYC,aAPZ,EAQYC,cARZ,EASYC,YATZ,EAUYC,WAVZ,EAWYC,eAXZ,EAYYC,cAZZ,EAaYC,mBAbZ,EAcYC,kBAdZ,EAeYC,WAfZ,EAeyB;AAAA;;AAAA,oJACjBf,OADiB,EAErBC,SAFqB,EAGrBC,QAHqB,EAIrBC,EAJqB,EAKrBC,UALqB,EAMrBC,MANqB,EAOrBC,iBAPqB,EAQrBC,aARqB,EASrBC,cATqB,EAUrBC,YAVqB,EAWrBC,WAXqB,EAYrBC,eAZqB,EAarBC,cAbqB,EAcrBC,mBAdqB,EAerBC,kBAfqB,EAgBrBC,WAhBqB;;AAkBvB,UAAKC,8BAAL,GAAsC,CACpC;AACEC,YAAM;AADR,KADoC,CAAtC;;AAMAZ,WAAOa,MAAP,CAAc,YAAW;AACvB,aAAO,KAAKC,yBAAZ;AACD,KAFa,CAEZC,IAFY,OAAd,EAEc,UAASC,QAAT,EAAmBC,QAAnB,EAA6B;AACzC,WAAKC,gBAAL,GAAwB,KAAKX,cAAL,CAAoBY,gBAApB,CAAqCH,QAArC,CAAxB;AACA,WAAKI,YAAL,GAAoB,KAAKF,gBAAL,CAAsBG,UAA1C;AACA,WAAKC,mBAAL,GAA2B,KAAKJ,gBAAL,CAAsBK,cAAjD;AACA,WAAKC,qBAAL,GAA6B,KAAKN,gBAAL,CAAsBO,gBAAnD;AACA,WAAKC,SAAL,GAAiB,IAAjB;AACA,WAAKC,aAAL,GAAqB,CAArB;AACA,WAAKC,UAAL,GAAkB,KAAlB;AACA,WAAKC,sBAAL,GAA8B,KAA9B;AACA,WAAKC,iBAAL;AACA,WAAKC,iBAAL;AACD,KAXa,CAWZhB,IAXY,OAFd,EAac,IAbd;;AAeA,UAAKf,MAAL,CAAYgC,GAAZ,CAAgB,eAAhB,EAAiC,UAACC,KAAD,EAAQC,IAAR,EAAiB;AAChD,UAAIA,KAAKC,MAAL,IAAe,MAAKA,MAApB,IAA8BD,KAAKE,WAAL,IAAoB,MAAKA,WAA3D,EAAwE;AACtE,YAAMC,YAAYH,KAAKG,SAAvB;AACA,YAAMC,WAAWD,UAAUC,QAA3B;AACA,YAAMC,sBAAsB,MAAKrC,aAAL,CAAmBsC,6BAAnB,EAA5B;AACA,YAAMC,gBAAgBF,sBAAsB,GAAtB,GAA4BD,QAAlD;AACA,YAAIJ,KAAKQ,MAAL,IAAe,QAAf,IAA2BR,KAAKQ,MAAL,IAAe,QAA9C,EAAwD;AACtD,cAAIC,eAAe,EAAnB;AACA,cAAIT,KAAKQ,MAAL,IAAe,QAAnB,EAA6B;AAC3BC,2BAAe,sBAAsB,MAAKR,MAA3B,GAAoC,GAApC,GAA0C,MAAKC,WAA9D;AACD,WAFD,MAEO,IAAIF,KAAKQ,MAAL,IAAe,QAAnB,EAA6B;AAClCC,2BAAe,sBAAsB,MAAKR,MAA3B,GAAoC,GAApC,GAA0C,MAAKC,WAA9D;AACD;AACD,cAAIO,gBAAgB,EAApB,EAAwB;AACtB;;;;AAIAC,cAAE,MAAMD,YAAR,EAAsBE,UAAtB,CAAiC,qBAAjC;AACAD,cAAE,MAAMD,YAAR,EAAsBE,UAAtB,CAAiC,cAAjC;;AAEA,gBAAI,MAAKnC,WAAL,CAAiBoC,OAAjB,CAAyBR,QAAzB,CAAJ,EAAwC;AACtCM,gBAAE,MAAMD,YAAR,EAAsBE,UAAtB,CAAiC,aAAjC,EAAgDJ,aAAhD,EAA+DH,QAA/D;AACD,aAFD,MAEO,IAAI,MAAK5B,WAAL,CAAiBqC,OAAjB,CAAyBT,QAAzB,CAAJ,EAAwC;AAC7C,kBAAMU,eAAeC,SAASC,aAAT,CAAuB,OAAvB,CAArB;AACAF,2BAAaG,QAAb,GAAwB,MAAxB;AACAH,2BAAaI,SAAb,GAAyB,qBAAqBX,aAArB,GAAqC,qBAA9D;AACAG,gBAAE,MAAMD,YAAR,EAAsBE,UAAtB,CAAiC,YAAjC,EAA+CG,YAA/C;AACD;AACF;AACF,SAxBD,MAwBO,IAAId,KAAKQ,MAAL,IAAe,QAAnB,EAA6B;AAClC,cAAMW,eAAenB,KAAKoB,YAA1B;AACAD,uBAAaE,KAAb,GAAqB,eAAejB,QAAf,GAA0B,KAA/C;AACA,gBAAKkB,6BAAL;AACD,SAJM,MAIA,IAAItB,KAAKQ,MAAL,IAAe,QAAnB,EAA6B;AAClC,cAAMe,eAAevB,KAAKoB,YAA1B;AACAG,uBAAaF,KAAb,GAAqB,eAAejB,QAAf,GAA0B,KAA/C;AACA,gBAAKkB,6BAAL;AACD;AACF;AACD,YAAK5D,SAAL,CAAe8D,IAAf;AACD,KAzCD;AAvCuB;AAiFxB;;AAED;;;;;;;yCAGqB;;AAEnB;AACA,UAAIC,YAAY,EAAhB;AACAA,gBAAUC,EAAV,GAAe,KAAKlD,WAAL,CAAiBmD,WAAjB,CAA6B,EAA7B,CAAf;AACAF,gBAAUJ,KAAV,GAAkB,EAAlB;AACAI,gBAAU/C,IAAV,GAAiB,QAAjB;;AAEA;AACA,WAAKE,yBAAL,CAA+BgD,OAA/B,CAAuCC,IAAvC,CAA4CJ,SAA5C;;AAEA;AACA,WAAKK,mBAAL,CAAyBL,UAAUC,EAAnC;;AAEA;AACA,WAAKJ,6BAAL;AACD;;AAED;;;;;;yCAGqB;;AAEnB;AACA,UAAIS,YAAY,EAAhB;AACAA,gBAAUL,EAAV,GAAe,KAAKlD,WAAL,CAAiBmD,WAAjB,CAA6B,EAA7B,CAAf;AACAI,gBAAUV,KAAV,GAAkB,EAAlB;AACAU,gBAAUrD,IAAV,GAAiB,QAAjB;;AAEA;AACA,WAAKE,yBAAL,CAA+BoD,OAA/B,CAAuCH,IAAvC,CAA4CE,SAA5C;;AAEA;AACA,WAAKE,mBAAL,CAAyBF,UAAUL,EAAnC;;AAEA;AACA,WAAKJ,6BAAL;AACD;;AAED;;;;;;;0CAIsBY,K,EAAO;;AAE3B,UAAIA,SAAS,CAAb,EAAgB;AACd;;AAEA;AACA,YAAIC,SAAS,KAAKvD,yBAAL,CAA+BgD,OAA/B,CAAuCM,KAAvC,CAAb;;AAEA,YAAIC,UAAU,IAAd,EAAoB;;AAElB;AACA,eAAKvD,yBAAL,CAA+BgD,OAA/B,CAAuCQ,MAAvC,CAA8CF,KAA9C,EAAqD,CAArD;;AAEA;AACA,eAAKtD,yBAAL,CAA+BgD,OAA/B,CAAuCQ,MAAvC,CAA8CF,QAAQ,CAAtD,EAAyD,CAAzD,EAA4DC,MAA5D;AACD;;AAED;;;;AAIA,YAAIE,WAAW,KAAKzD,yBAAL,CAA+ByD,QAA9C;;AAEA,YAAIA,YAAY,IAAhB,EAAsB;;AAEpB;AACA,eAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAID,SAASE,MAA7B,EAAqCD,GAArC,EAA0C;AACxC,gBAAIE,iBAAiBH,SAASC,CAAT,CAArB;;AAEA,gBAAIE,kBAAkB,IAAtB,EAA4B;;AAE1B;AACA,kBAAIC,wBAAwBD,eAAeZ,OAA3C;;AAEA,kBAAIa,yBAAyB,IAA7B,EAAmC;;AAEjC;AACA,oBAAIC,aAAaD,sBAAsBP,KAAtB,CAAjB;;AAEA,oBAAIQ,cAAc,IAAlB,EAAwB;AACtB;AACAD,wCAAsBL,MAAtB,CAA6BF,KAA7B,EAAoC,CAApC;;AAEA;AACAO,wCAAsBL,MAAtB,CAA6BF,QAAQ,CAArC,EAAwC,CAAxC,EAA2CQ,UAA3C;AACD;AACF;AACF;AACF;AACF;;AAED;AACA,aAAKpB,6BAAL;AACD;AACF;;AAED;;;;;;;4CAIwBY,K,EAAO;;AAE7B,UAAIA,QAAQ,KAAKtD,yBAAL,CAA+BgD,OAA/B,CAAuCW,MAAvC,GAAgD,CAA5D,EAA+D;AAC7D;;AAEA;AACA,YAAIJ,SAAS,KAAKvD,yBAAL,CAA+BgD,OAA/B,CAAuCM,KAAvC,CAAb;;AAEA,YAAIC,UAAU,IAAd,EAAoB;;AAElB;AACA,eAAKvD,yBAAL,CAA+BgD,OAA/B,CAAuCQ,MAAvC,CAA8CF,KAA9C,EAAqD,CAArD;;AAEA;AACA,eAAKtD,yBAAL,CAA+BgD,OAA/B,CAAuCQ,MAAvC,CAA8CF,QAAQ,CAAtD,EAAyD,CAAzD,EAA4DC,MAA5D;AACD;;AAED;;;;AAIA,YAAIE,WAAW,KAAKzD,yBAAL,CAA+ByD,QAA9C;;AAEA,YAAIA,YAAY,IAAhB,EAAsB;;AAEpB;AACA,eAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAID,SAASE,MAA7B,EAAqCD,GAArC,EAA0C;AACxC,gBAAIE,iBAAiBH,SAASC,CAAT,CAArB;;AAEA,gBAAIE,kBAAkB,IAAtB,EAA4B;;AAE1B;AACA,kBAAIC,wBAAwBD,eAAeZ,OAA3C;;AAEA,kBAAIa,yBAAyB,IAA7B,EAAmC;;AAEjC;AACA,oBAAIC,aAAaD,sBAAsBP,KAAtB,CAAjB;;AAEA,oBAAIQ,cAAc,IAAlB,EAAwB;AACtB;AACAD,wCAAsBL,MAAtB,CAA6BF,KAA7B,EAAoC,CAApC;;AAEA;AACAO,wCAAsBL,MAAtB,CAA6BF,QAAQ,CAArC,EAAwC,CAAxC,EAA2CQ,UAA3C;AACD;AACF;AACF;AACF;AACF;;AAED;AACA,aAAKpB,6BAAL;AACD;AACF;;AAED;;;;;;;0CAIsBY,K,EAAO;;AAE3B;AACA,UAAIS,SAASC,QAAQ,KAAKC,UAAL,CAAgB,2CAAhB,CAAR,CAAb;;AAEA,UAAIF,MAAJ,EAAY;;AAEV;AACA,YAAIG,gBAAgB,KAAKlE,yBAAL,CAA+BgD,OAA/B,CAAuCQ,MAAvC,CAA8CF,KAA9C,EAAqD,CAArD,CAApB;;AAEA,YAAIY,iBAAiB,IAAjB,IAAyBA,cAAcP,MAAd,GAAuB,CAApD,EAAuD;;AAErD;AACAO,0BAAgBA,cAAc,CAAd,CAAhB;;AAEA;AACA,cAAIC,WAAWD,cAAcpB,EAA7B;;AAEA;AACA,eAAKsB,wBAAL,CAA8BD,QAA9B;AACD;;AAED;AACA,aAAKzB,6BAAL;AACD;AACF;;AAED;;;;;;;0CAIsBY,K,EAAO;;AAE3B,UAAIA,QAAQ,CAAZ,EAAe;AACb;;AAEA;AACA,YAAIe,SAAS,KAAKrE,yBAAL,CAA+BoD,OAA/B,CAAuCE,KAAvC,CAAb;;AAEA,YAAIe,UAAU,IAAd,EAAoB;;AAElB;AACA,eAAKrE,yBAAL,CAA+BoD,OAA/B,CAAuCI,MAAvC,CAA8CF,KAA9C,EAAqD,CAArD;;AAEA;AACA,eAAKtD,yBAAL,CAA+BoD,OAA/B,CAAuCI,MAAvC,CAA8CF,QAAQ,CAAtD,EAAyD,CAAzD,EAA4De,MAA5D;AACD;;AAED;;;;;;AAMA,YAAIT,iBAAiB,KAAK5D,yBAAL,CAA+ByD,QAA/B,CAAwCH,QAAQ,CAAhD,CAArB;;AAEA,YAAIM,kBAAkB,IAAtB,EAA4B;;AAE1B;AACA,eAAK5D,yBAAL,CAA+ByD,QAA/B,CAAwCD,MAAxC,CAA+CF,QAAQ,CAAvD,EAA0D,CAA1D;;AAEA;AACA,eAAKtD,yBAAL,CAA+ByD,QAA/B,CAAwCD,MAAxC,CAA+CF,KAA/C,EAAsD,CAAtD,EAAyDM,cAAzD;AACD;;AAED;AACA,aAAKlB,6BAAL;AACD;AACF;;AAED;;;;;;;4CAIwBY,K,EAAO;;AAE7B,UAAIA,QAAQ,KAAKtD,yBAAL,CAA+BoD,OAA/B,CAAuCO,MAAvC,GAAgD,CAA5D,EAA+D;AAC7D;;AAEA;AACA,YAAIU,SAAS,KAAKrE,yBAAL,CAA+BoD,OAA/B,CAAuCE,KAAvC,CAAb;;AAEA,YAAIe,UAAU,IAAd,EAAoB;;AAElB;AACA,eAAKrE,yBAAL,CAA+BoD,OAA/B,CAAuCI,MAAvC,CAA8CF,KAA9C,EAAqD,CAArD;;AAEA;AACA,eAAKtD,yBAAL,CAA+BoD,OAA/B,CAAuCI,MAAvC,CAA8CF,QAAQ,CAAtD,EAAyD,CAAzD,EAA4De,MAA5D;AACD;;AAED;;;;;;AAMA,YAAIT,iBAAiB,KAAK5D,yBAAL,CAA+ByD,QAA/B,CAAwCH,QAAQ,CAAhD,CAArB;;AAEA,YAAIM,kBAAkB,IAAtB,EAA4B;;AAE1B;AACA,eAAK5D,yBAAL,CAA+ByD,QAA/B,CAAwCD,MAAxC,CAA+CF,QAAQ,CAAvD,EAA0D,CAA1D;;AAEA;AACA,eAAKtD,yBAAL,CAA+ByD,QAA/B,CAAwCD,MAAxC,CAA+CF,QAAQ,CAAvD,EAA0D,CAA1D,EAA6DM,cAA7D;AACD;;AAED;AACA,aAAKlB,6BAAL;AACD;AACF;;AAED;;;;;;;0CAIsBY,K,EAAO;;AAE3B;AACA,UAAIS,SAASC,QAAQ,KAAKC,UAAL,CAAgB,2CAAhB,CAAR,CAAb;;AAEA,UAAIF,MAAJ,EAAY;;AAEV;AACA,YAAIO,gBAAgB,KAAKtE,yBAAL,CAA+BoD,OAA/B,CAAuCI,MAAvC,CAA8CF,KAA9C,EAAqD,CAArD,CAApB;;AAEA,YAAIgB,iBAAiB,IAAjB,IAAyBA,cAAcX,MAAd,GAAuB,CAApD,EAAuD;;AAErD;AACAW,0BAAgBA,cAAc,CAAd,CAAhB;;AAEA;AACA,cAAIC,WAAWD,cAAcxB,EAA7B;;AAEA;AACA,eAAK0B,wBAAL,CAA8BD,QAA9B;AACD;;AAED;AACA,aAAK7B,6BAAL;AACD;AACF;;AAED;;;;;;;wCAIoByB,Q,EAAU;;AAE5B;AACA,UAAIV,WAAW,KAAKzD,yBAAL,CAA+ByD,QAA9C;;AAEA,UAAIA,YAAY,IAAhB,EAAsB;;AAEpB;;;;AAIA,aAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAID,SAASE,MAA7B,EAAqCD,GAArC,EAA0C;AACxC;AACA,cAAIE,iBAAiBH,SAASC,CAAT,CAArB;;AAEA,cAAIE,kBAAkB,IAAtB,EAA4B;;AAE1B;AACA,gBAAIZ,UAAUY,eAAeZ,OAA7B;;AAEA,gBAAIyB,eAAe,EAAnB;AACA,gBAAI7D,YAAY,KAAhB;;AAEA;AACA,gBAAI8D,iBAAiB,KAAKC,oBAAL,CAA0BR,QAA1B,EAAoCM,YAApC,EAAkD7D,SAAlD,CAArB;;AAEA;AACAoC,oBAAQC,IAAR,CAAayB,cAAb;AACD;AACF;AACF;AACF;;AAED;;;;;;;wCAIoBH,Q,EAAU;;AAE5B;AACA,UAAId,WAAW,KAAKzD,yBAAL,CAA+ByD,QAA9C;;AAEA,UAAIA,YAAY,IAAhB,EAAsB;;AAEpB;AACA,YAAIY,SAAS,EAAb;AACAA,eAAOE,QAAP,GAAkBA,QAAlB;AACAF,eAAOrB,OAAP,GAAiB,EAAjB;;AAEA;AACA,YAAIA,UAAU,KAAKhD,yBAAL,CAA+BgD,OAA7C;;AAEA;AACA,aAAK,IAAI4B,IAAI,CAAb,EAAgBA,IAAI5B,QAAQW,MAA5B,EAAoCiB,GAApC,EAAyC;AACvC,cAAIrB,SAASP,QAAQ4B,CAAR,CAAb;;AAEA,cAAIrB,UAAU,IAAd,EAAoB;;AAElB,gBAAIY,WAAWZ,OAAOT,EAAtB;AACA,gBAAI2B,eAAe,EAAnB;AACA,gBAAI7D,YAAY,KAAhB;;AAEA;AACA,gBAAI8D,iBAAiB,KAAKC,oBAAL,CAA0BR,QAA1B,EAAoCM,YAApC,EAAkD7D,SAAlD,CAArB;;AAEA;AACAyD,mBAAOrB,OAAP,CAAeC,IAAf,CAAoByB,cAApB;AACD;AACF;;AAED;AACAjB,iBAASR,IAAT,CAAcoB,MAAd;AACD;AACF;;AAED;;;;;;;;;;;;;yCAUqBF,Q,EAAUV,Q,EAAU7C,S,EAAWiE,Q,EAAUC,yB,EAA2B;;AAEvF,UAAIJ,iBAAiB,EAArB;AACAA,qBAAeP,QAAf,GAA0BA,QAA1B;AACAO,qBAAejB,QAAf,GAA0BA,QAA1B;AACAiB,qBAAe9D,SAAf,GAA2BA,SAA3B;AACA8D,qBAAeG,QAAf,GAA0BA,QAA1B;AACAH,qBAAeI,yBAAf,GAA2CA,yBAA3C;;AAEA,aAAOJ,cAAP;AACD;;AAED;;;;;;;6CAIyBP,Q,EAAU;;AAEjC;AACA,UAAIV,WAAW,KAAKzD,yBAAL,CAA+ByD,QAA9C;;AAEA,UAAIA,YAAY,IAAhB,EAAsB;;AAEpB;;;;AAIA,aAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAID,SAASE,MAA7B,EAAqCD,GAArC,EAA0C;AACxC,cAAIE,iBAAiBH,SAASC,CAAT,CAArB;;AAEA,cAAIE,kBAAkB,IAAtB,EAA4B;;AAE1B,gBAAIZ,UAAUY,eAAeZ,OAA7B;;AAEA;AACA,iBAAK,IAAI4B,IAAI,CAAb,EAAgBA,IAAI5B,QAAQW,MAA5B,EAAoCiB,GAApC,EAAyC;AACvC,kBAAIrB,SAASP,QAAQ4B,CAAR,CAAb;;AAEA,kBAAIrB,UAAU,IAAd,EAAoB;AAClB,oBAAIY,aAAaZ,OAAOY,QAAxB,EAAkC;AAChC;;AAEA;AACAnB,0BAAQQ,MAAR,CAAeoB,CAAf,EAAkB,CAAlB;AACA;AACD;AACF;AACF;AACF;AACF;AACF;AACF;;AAED;;;;;;;6CAIyBL,Q,EAAU;;AAEjC;AACA,UAAId,WAAW,KAAKzD,yBAAL,CAA+ByD,QAA9C;;AAEA,UAAIA,YAAY,IAAhB,EAAsB;;AAEpB;AACA,aAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAID,SAASE,MAA7B,EAAqCD,GAArC,EAA0C;AACxC,cAAIE,iBAAiBH,SAASC,CAAT,CAArB;;AAEA,cAAIE,kBAAkB,IAAtB,EAA4B;;AAE1B,gBAAIW,aAAaX,eAAeW,QAAhC,EAA0C;AACxC;;AAEA;AACAd,uBAASD,MAAT,CAAgBE,CAAhB,EAAmB,CAAnB;AACA;AACD;AACF;AACF;AACF;AACF;;AAED;;;;;;mDAG+B;;AAE7B,UAAIqB,OAAO,IAAX;;AAEA,UAAI,KAAKC,oBAAL,EAAJ,EAAiC;AAC/B;AACAD,eAAO,IAAP;AACD,OAHD,MAGO;AACL;;;;AAIAA,eAAO,KAAP;AACD;;AAED;AACA,WAAKE,wBAAL,CAA8BF,IAA9B;;AAEA;AACA,WAAKrC,6BAAL;AACD;;AAED;;;;;;;;2CAKuB;;AAErB;AACA,UAAIe,WAAW,KAAKzD,yBAAL,CAA+ByD,QAA9C;;AAEA,UAAIA,YAAY,IAAhB,EAAsB;;AAEpB;AACA,aAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAID,SAASE,MAA7B,EAAqCD,GAArC,EAA0C;;AAExC,cAAIwB,eAAezB,SAASC,CAAT,CAAnB;;AAEA,cAAIwB,gBAAgB,IAApB,EAA0B;AACxB,gBAAIC,cAAcD,aAAalC,OAA/B;;AAEA,gBAAImC,eAAe,IAAnB,EAAyB;;AAEvB;AACA,mBAAK,IAAIP,IAAI,CAAb,EAAgBA,IAAIO,YAAYxB,MAAhC,EAAwCiB,GAAxC,EAA6C;AAC3C,oBAAId,aAAaqB,YAAYP,CAAZ,CAAjB;;AAEA,oBAAId,cAAc,IAAlB,EAAwB;;AAEtB,sBAAIA,WAAWL,QAAX,IAAuB,IAAvB,IAA+BK,WAAWL,QAAX,IAAuB,EAA1D,EAA8D;AAC5D;AACA,2BAAO,IAAP;AACD;;AAED,sBAAIK,WAAWlD,SAAf,EAA0B;AACxB;AACA,2BAAO,IAAP;AACD;AACF;AACF;AACF;AACF;AACF;AACF;;AAED,aAAO,KAAP;AACD;;AAED;;;;;;;kDAI8B6C,Q,EAAU;AACtC,UAAI,CAACA,SAAS7C,SAAd,EAAyB;AACvB;AACA,eAAO6C,SAASoB,QAAhB;AACA,eAAOpB,SAASqB,yBAAhB;AACD;AACD;AACA,WAAKpC,6BAAL;AACD;;AAED;;;;;;;;sCAKkBa,M,EAAQ;AACxB;AACA,UAAI6B,SAAS,EAAb;AACAA,aAAOC,OAAP,GAAiB,IAAjB;AACAD,aAAO/D,MAAP,GAAgB,KAAKA,MAArB;AACA+D,aAAO9D,WAAP,GAAqB,KAAKA,WAA1B;AACA8D,aAAOxD,MAAP,GAAgB,QAAhB;AACAwD,aAAO5C,YAAP,GAAsBe,MAAtB;;AAEA;AACA,WAAKtE,UAAL,CAAgBqG,UAAhB,CAA2B,kBAA3B,EAA+CF,MAA/C;AACD;;AAED;;;;;;;;sCAKkBf,M,EAAQ;AACxB;AACA,UAAIe,SAAS,EAAb;AACAA,aAAOC,OAAP,GAAiB,IAAjB;AACAD,aAAO/D,MAAP,GAAgB,KAAKA,MAArB;AACA+D,aAAO9D,WAAP,GAAqB,KAAKA,WAA1B;AACA8D,aAAOxD,MAAP,GAAgB,QAAhB;AACAwD,aAAO5C,YAAP,GAAsB6B,MAAtB;;AAEA;AACA,WAAKpF,UAAL,CAAgBqG,UAAhB,CAA2B,kBAA3B,EAA+CF,MAA/C;AACD;;;;;;AAGHxG,yBAAyB2G,OAAzB,GAAmC,CACjC,SADiC,EAEjC,WAFiC,EAGjC,UAHiC,EAIjC,IAJiC,EAKjC,YALiC,EAMjC,QANiC,EAOjC,mBAPiC,EAQjC,eARiC,EASjC,gBATiC,EAUjC,cAViC,EAWjC,aAXiC,EAYjC,iBAZiC,EAajC,gBAbiC,EAcjC,qBAdiC,EAejC,oBAfiC,EAgBjC,aAhBiC,CAAnC;;kBAmBe3G,wB","file":"matchAuthoringController.js","sourcesContent":["'use strict';\n\nimport MatchController from \"./matchController\";\n\nclass MatchAuthoringController extends MatchController {\n  constructor($filter,\n              $mdDialog,\n              $mdMedia,\n              $q,\n              $rootScope,\n              $scope,\n              AnnotationService,\n              ConfigService,\n              dragulaService,\n              MatchService,\n              NodeService,\n              NotebookService,\n              ProjectService,\n              StudentAssetService,\n              StudentDataService,\n              UtilService) {\n    super($filter,\n      $mdDialog,\n      $mdMedia,\n      $q,\n      $rootScope,\n      $scope,\n      AnnotationService,\n      ConfigService,\n      dragulaService,\n      MatchService,\n      NodeService,\n      NotebookService,\n      ProjectService,\n      StudentAssetService,\n      StudentDataService,\n      UtilService);\n\n    this.allowedConnectedComponentTypes = [\n      {\n        type: 'Match'\n      }\n    ];\n\n    $scope.$watch(function() {\n      return this.authoringComponentContent;\n    }.bind(this), function(newValue, oldValue) {\n      this.componentContent = this.ProjectService.injectAssetPaths(newValue);\n      this.isHorizontal = this.componentContent.horizontal;\n      this.isSaveButtonVisible = this.componentContent.showSaveButton;\n      this.isSubmitButtonVisible = this.componentContent.showSubmitButton;\n      this.isCorrect = null;\n      this.submitCounter = 0;\n      this.isDisabled = false;\n      this.isSubmitButtonDisabled = false;\n      this.initializeChoices();\n      this.initializeBuckets();\n    }.bind(this), true);\n\n    this.$scope.$on('assetSelected', (event, args) => {\n      if (args.nodeId == this.nodeId && args.componentId == this.componentId) {\n        const assetItem = args.assetItem;\n        const fileName = assetItem.fileName;\n        const assetsDirectoryPath = this.ConfigService.getProjectAssetsDirectoryPath();\n        const fullAssetPath = assetsDirectoryPath + '/' + fileName;\n        if (args.target == 'prompt' || args.target == 'rubric') {\n          let summernoteId = '';\n          if (args.target == 'prompt') {\n            summernoteId = 'summernotePrompt_' + this.nodeId + '_' + this.componentId;\n          } else if (args.target == 'rubric') {\n            summernoteId = 'summernoteRubric_' + this.nodeId + '_' + this.componentId;\n          }\n          if (summernoteId != '') {\n            /*\n             * move the cursor back to its position when the asset chooser\n             * popup was clicked\n             */\n            $('#' + summernoteId).summernote('editor.restoreRange');\n            $('#' + summernoteId).summernote('editor.focus');\n\n            if (this.UtilService.isImage(fileName)) {\n              $('#' + summernoteId).summernote('insertImage', fullAssetPath, fileName);\n            } else if (this.UtilService.isVideo(fileName)) {\n              const videoElement = document.createElement('video');\n              videoElement.controls = 'true';\n              videoElement.innerHTML = '<source ng-src=\"' + fullAssetPath + '\" type=\"video/mp4\">';\n              $('#' + summernoteId).summernote('insertNode', videoElement);\n            }\n          }\n        } else if (args.target == 'choice') {\n          const choiceObject = args.targetObject;\n          choiceObject.value = '<img src=\"' + fileName + '\"/>';\n          this.authoringViewComponentChanged();\n        } else if (args.target == 'bucket') {\n          const bucketObject = args.targetObject;\n          bucketObject.value = '<img src=\"' + fileName + '\"/>';\n          this.authoringViewComponentChanged();\n        }\n      }\n      this.$mdDialog.hide();\n    });\n  }\n\n  /**\n   * Add a choice\n   */\n  authoringAddChoice() {\n\n    // create a new choice\n    var newChoice = {};\n    newChoice.id = this.UtilService.generateKey(10);\n    newChoice.value = '';\n    newChoice.type = 'choice';\n\n    // add the choice to the array of choices\n    this.authoringComponentContent.choices.push(newChoice);\n\n    // add the choice to the feedback\n    this.addChoiceToFeedback(newChoice.id);\n\n    // save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Add a bucket\n   */\n  authoringAddBucket() {\n\n    // create a new bucket\n    var newBucket = {};\n    newBucket.id = this.UtilService.generateKey(10);\n    newBucket.value = '';\n    newBucket.type = 'bucket';\n\n    // add the bucket to the array of buckets\n    this.authoringComponentContent.buckets.push(newBucket);\n\n    // add the bucket to the feedback\n    this.addBucketToFeedback(newBucket.id);\n\n    // save the project\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Move a choice up\n   * @param index the index of the choice\n   */\n  authoringMoveChoiceUp(index) {\n\n    if (index != 0) {\n      // the choice is not at the top so we can move it up\n\n      // remember the choice\n      var choice = this.authoringComponentContent.choices[index];\n\n      if (choice != null) {\n\n        // remove the choice\n        this.authoringComponentContent.choices.splice(index, 1);\n\n        // insert the choice one index back\n        this.authoringComponentContent.choices.splice(index - 1, 0, choice);\n      }\n\n      /*\n       * get the feedback so we can update the order of the choices within\n       * the bucket feedback\n       */\n      var feedback = this.authoringComponentContent.feedback;\n\n      if (feedback != null) {\n\n        // loop through all the bucket feedback objects\n        for (var f = 0; f < feedback.length; f++) {\n          var bucketFeedback = feedback[f];\n\n          if (bucketFeedback != null) {\n\n            // get all the choices\n            var bucketFeedbackChoices = bucketFeedback.choices;\n\n            if (bucketFeedbackChoices != null) {\n\n              // remmeber the choice\n              var tempChoice = bucketFeedbackChoices[index];\n\n              if (tempChoice != null) {\n                // remove the choice\n                bucketFeedbackChoices.splice(index, 1);\n\n                // insert the choice one index back\n                bucketFeedbackChoices.splice(index - 1, 0, tempChoice);\n              }\n            }\n          }\n        }\n      }\n\n      // save the project\n      this.authoringViewComponentChanged();\n    }\n  }\n\n  /**\n   * Move a choice down\n   * @param index the index of the choice\n   */\n  authoringMoveChoiceDown(index) {\n\n    if (index < this.authoringComponentContent.choices.length - 1) {\n      // the choice is not at the bottom so we can move it down\n\n      // remember the choice\n      var choice = this.authoringComponentContent.choices[index];\n\n      if (choice != null) {\n\n        // remove the choice\n        this.authoringComponentContent.choices.splice(index, 1);\n\n        // insert the choice one index forward\n        this.authoringComponentContent.choices.splice(index + 1, 0, choice);\n      }\n\n      /*\n       * get the feedback so we can update the order of the choices within\n       * the bucket feedback\n       */\n      var feedback = this.authoringComponentContent.feedback;\n\n      if (feedback != null) {\n\n        // loop through all the bucket feedback objects\n        for (var f = 0; f < feedback.length; f++) {\n          var bucketFeedback = feedback[f];\n\n          if (bucketFeedback != null) {\n\n            // get all the choices\n            var bucketFeedbackChoices = bucketFeedback.choices;\n\n            if (bucketFeedbackChoices != null) {\n\n              // remmeber the choice\n              var tempChoice = bucketFeedbackChoices[index];\n\n              if (tempChoice != null) {\n                // remove the choice\n                bucketFeedbackChoices.splice(index, 1);\n\n                // insert the choice one index forward\n                bucketFeedbackChoices.splice(index + 1, 0, tempChoice);\n              }\n            }\n          }\n        }\n      }\n\n      // save the project\n      this.authoringViewComponentChanged();\n    }\n  }\n\n  /**\n   * Delete a choice\n   * @param index the index of the choice in the choice array\n   */\n  authoringDeleteChoice(index) {\n\n    // confirm with the user that they want to delete the choice\n    var answer = confirm(this.$translate('match.areYouSureYouWantToDeleteThisChoice'));\n\n    if (answer) {\n\n      // remove the choice from the array\n      var deletedChoice = this.authoringComponentContent.choices.splice(index, 1);\n\n      if (deletedChoice != null && deletedChoice.length > 0) {\n\n        // splice returns an array so we need to get the element out of it\n        deletedChoice = deletedChoice[0];\n\n        // get the choice id\n        var choiceId = deletedChoice.id;\n\n        // remove the choice from the feedback\n        this.removeChoiceFromFeedback(choiceId);\n      }\n\n      // save the project\n      this.authoringViewComponentChanged();\n    }\n  }\n\n  /**\n   * Move a bucket up\n   * @param index the index of the bucket\n   */\n  authoringMoveBucketUp(index) {\n\n    if (index > 0) {\n      // the bucket is not at the top so we can move it up\n\n      // remember the bucket\n      var bucket = this.authoringComponentContent.buckets[index];\n\n      if (bucket != null) {\n\n        // remove the bucket\n        this.authoringComponentContent.buckets.splice(index, 1);\n\n        // insert the bucket one index back\n        this.authoringComponentContent.buckets.splice(index - 1, 0, bucket);\n      }\n\n      /*\n       * Remember the bucket feedback. The first element of the feedback\n       * contains the origin bucket. The first authored bucket is located\n       * at index 1. This means we need the index of the bucket feedback\n       * that we want is located at index + 1.\n       */\n      var bucketFeedback = this.authoringComponentContent.feedback[index + 1];\n\n      if (bucketFeedback != null) {\n\n        // remove the bucket feedback\n        this.authoringComponentContent.feedback.splice(index + 1, 1);\n\n        // insert the bucket one index back\n        this.authoringComponentContent.feedback.splice(index, 0, bucketFeedback);\n      }\n\n      // save the project\n      this.authoringViewComponentChanged();\n    }\n  }\n\n  /**\n   * Move a bucket down\n   * @param index the index of the bucket\n   */\n  authoringMoveBucketDown(index) {\n\n    if (index < this.authoringComponentContent.buckets.length - 1) {\n      // the bucket is not at the bottom so we can move it down\n\n      // remember the bucket\n      var bucket = this.authoringComponentContent.buckets[index];\n\n      if (bucket != null) {\n\n        // remove the bucket\n        this.authoringComponentContent.buckets.splice(index, 1);\n\n        // insert the bucket one index forward\n        this.authoringComponentContent.buckets.splice(index + 1, 0, bucket);\n      }\n\n      /*\n       * Remember the bucket feedback. The first element of the feedback\n       * contains the origin bucket. The first authored bucket is located\n       * at index 1. This means we need the index of the bucket feedback\n       * that we want is located at index + 1.\n       */\n      var bucketFeedback = this.authoringComponentContent.feedback[index + 1];\n\n      if (bucketFeedback != null) {\n\n        // remove the bucket feedback\n        this.authoringComponentContent.feedback.splice(index + 1, 1);\n\n        // insert the bucket one index forward\n        this.authoringComponentContent.feedback.splice(index + 2, 0, bucketFeedback);\n      }\n\n      // save the project\n      this.authoringViewComponentChanged();\n    }\n  }\n\n  /**\n   * Delete a bucket\n   * @param index the index of the bucket in the bucket array\n   */\n  authoringDeleteBucket(index) {\n\n    // confirm with the user tha tthey want to delete the bucket\n    var answer = confirm(this.$translate('match.areYouSureYouWantToDeleteThisBucket'));\n\n    if (answer) {\n\n      // remove the bucket from the array\n      var deletedBucket = this.authoringComponentContent.buckets.splice(index, 1);\n\n      if (deletedBucket != null && deletedBucket.length > 0) {\n\n        // splice returns an array so we need to get the element out of it\n        deletedBucket = deletedBucket[0];\n\n        // get the bucket id\n        var bucketId = deletedBucket.id;\n\n        // remove the bucket from the feedback\n        this.removeBucketFromFeedback(bucketId);\n      }\n\n      // save the project\n      this.authoringViewComponentChanged();\n    }\n  }\n\n  /**\n   * Add a choice to the feedback\n   * @param choiceId the choice id\n   */\n  addChoiceToFeedback(choiceId) {\n\n    // get the feedback array\n    var feedback = this.authoringComponentContent.feedback;\n\n    if (feedback != null) {\n\n      /*\n       * loop through all the elements in the feedback. each element\n       * represents a bucket.\n       */\n      for (var f = 0; f < feedback.length; f++) {\n        // get a bucket\n        var bucketFeedback = feedback[f];\n\n        if (bucketFeedback != null) {\n\n          // get the choices in the bucket\n          var choices = bucketFeedback.choices;\n\n          var feedbackText = '';\n          var isCorrect = false;\n\n          // create a feedback object\n          var feedbackObject = this.createFeedbackObject(choiceId, feedbackText, isCorrect);\n\n          // add the feedback object\n          choices.push(feedbackObject);\n        }\n      }\n    }\n  }\n\n  /**\n   * Add a bucket to the feedback\n   * @param bucketId the bucket id\n   */\n  addBucketToFeedback(bucketId) {\n\n    // get the feedback array. each element in the array represents a bucket.\n    var feedback = this.authoringComponentContent.feedback;\n\n    if (feedback != null) {\n\n      // create a new bucket feedback object\n      var bucket = {};\n      bucket.bucketId = bucketId;\n      bucket.choices = [];\n\n      // get all the choices\n      var choices = this.authoringComponentContent.choices;\n\n      // loop through all the choices and add a choice feedback object to the bucket\n      for (var c = 0; c < choices.length; c++) {\n        var choice = choices[c];\n\n        if (choice != null) {\n\n          var choiceId = choice.id;\n          var feedbackText = '';\n          var isCorrect = false;\n\n          // create a feedback object\n          var feedbackObject = this.createFeedbackObject(choiceId, feedbackText, isCorrect);\n\n          // add the feedback object\n          bucket.choices.push(feedbackObject);\n        }\n      }\n\n      // add the feedback bucket\n      feedback.push(bucket);\n    }\n  }\n\n  /**\n   * Create a feedback object\n   * @param choiceId the choice id\n   * @param feedback the feedback\n   * @param isCorrect whether the choice is correct\n   * @param position (optional) the position\n   * @param incorrectPositionFeedback (optional) the feedback for when the\n   * choice is in the correct but wrong position\n   * @returns the feedback object\n   */\n  createFeedbackObject(choiceId, feedback, isCorrect, position, incorrectPositionFeedback) {\n\n    var feedbackObject = {};\n    feedbackObject.choiceId = choiceId;\n    feedbackObject.feedback = feedback;\n    feedbackObject.isCorrect = isCorrect;\n    feedbackObject.position = position;\n    feedbackObject.incorrectPositionFeedback = incorrectPositionFeedback;\n\n    return feedbackObject;\n  }\n\n  /**\n   * Remove a choice from the feedback\n   * @param choiceId the choice id to remove\n   */\n  removeChoiceFromFeedback(choiceId) {\n\n    // get the feedback array. each element in the array represents a bucket.\n    var feedback = this.authoringComponentContent.feedback;\n\n    if (feedback != null) {\n\n      /*\n       * loop through each bucket feedback and remove the choice from each\n       * bucket feedback object\n       */\n      for (var f = 0; f < feedback.length; f++) {\n        var bucketFeedback = feedback[f];\n\n        if (bucketFeedback != null) {\n\n          var choices = bucketFeedback.choices;\n\n          // loop through all the choices\n          for (var c = 0; c < choices.length; c++) {\n            var choice = choices[c];\n\n            if (choice != null) {\n              if (choiceId === choice.choiceId) {\n                // we have found the choice we want to remove\n\n                // remove the choice feedback object\n                choices.splice(c, 1);\n                break;\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Remove a bucket from the feedback\n   * @param bucketId the bucket id to remove\n   */\n  removeBucketFromFeedback(bucketId) {\n\n    // get the feedback array. each element in the array represents a bucket.\n    var feedback = this.authoringComponentContent.feedback;\n\n    if (feedback != null) {\n\n      // loop through all the bucket feedback objects\n      for (var f = 0; f < feedback.length; f++) {\n        var bucketFeedback = feedback[f];\n\n        if (bucketFeedback != null) {\n\n          if (bucketId === bucketFeedback.bucketId) {\n            // we have found the bucket feedback object we want to remove\n\n            // remove the bucket feedback object\n            feedback.splice(f, 1);\n            break;\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * The author has changed the feedback so we will enable the submit button\n   */\n  authoringViewFeedbackChanged() {\n\n    var show = true;\n\n    if (this.componentHasFeedback()) {\n      // this component has feedback so we will show the submit button\n      show = true;\n    } else {\n      /*\n       * this component does not have feedback so we will not show the\n       * submit button\n       */\n      show = false;\n    }\n\n    // show or hide the submit button\n    this.setShowSubmitButtonValue(show);\n\n    // save the component\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Check if this component has been authored to have feedback or a correct\n   * choice\n   * @return whether this component has feedback or a correct choice\n   */\n  componentHasFeedback() {\n\n    // get the feedback\n    var feedback = this.authoringComponentContent.feedback;\n\n    if (feedback != null) {\n\n      // loop through all the feedback buckets\n      for (var f = 0; f < feedback.length; f++) {\n\n        var tempFeedback = feedback[f];\n\n        if (tempFeedback != null) {\n          var tempChoices = tempFeedback.choices;\n\n          if (tempChoices != null) {\n\n            // loop through the feedback choices\n            for (var c = 0; c < tempChoices.length; c++) {\n              var tempChoice = tempChoices[c];\n\n              if (tempChoice != null) {\n\n                if (tempChoice.feedback != null && tempChoice.feedback != '') {\n                  // this choice has feedback\n                  return true;\n                }\n\n                if (tempChoice.isCorrect) {\n                  // this choice is correct\n                  return true;\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * The \"Is Correct\" checkbox for a choice feedback has been clicked.\n   * @param feedback The choice feedback.\n   */\n  authoringViewIsCorrectClicked(feedback) {\n    if (!feedback.isCorrect) {\n      // the choice has been set to not correct so we will remove the position\n      delete feedback.position;\n      delete feedback.incorrectPositionFeedback;\n    }\n    // save the component\n    this.authoringViewComponentChanged();\n  }\n\n  /**\n   * Show the asset popup to allow the author to choose an image for the\n   * choice\n   * @param choice the choice object to set the image into\n   */\n  chooseChoiceAsset(choice) {\n    // generate the parameters\n    var params = {};\n    params.isPopup = true;\n    params.nodeId = this.nodeId;\n    params.componentId = this.componentId;\n    params.target = 'choice';\n    params.targetObject = choice;\n\n    // display the asset chooser\n    this.$rootScope.$broadcast('openAssetChooser', params);\n  }\n\n  /**\n   * Show the asset popup to allow the author to choose an image for the\n   * bucket\n   * @param bucket the bucket object to set the image into\n   */\n  chooseBucketAsset(bucket) {\n    // generate the parameters\n    var params = {};\n    params.isPopup = true;\n    params.nodeId = this.nodeId;\n    params.componentId = this.componentId;\n    params.target = 'bucket';\n    params.targetObject = bucket;\n\n    // display the asset chooser\n    this.$rootScope.$broadcast('openAssetChooser', params);\n  }\n}\n\nMatchAuthoringController.$inject = [\n  '$filter',\n  '$mdDialog',\n  '$mdMedia',\n  '$q',\n  '$rootScope',\n  '$scope',\n  'AnnotationService',\n  'ConfigService',\n  'dragulaService',\n  'MatchService',\n  'NodeService',\n  'NotebookService',\n  'ProjectService',\n  'StudentAssetService',\n  'StudentDataService',\n  'UtilService'\n];\n\nexport default MatchAuthoringController;\n"]}