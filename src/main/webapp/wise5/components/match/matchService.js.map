{"version":3,"sources":["matchService.es6"],"names":[],"mappings":"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","file":"matchService.js","sourcesContent":["import NodeService from '../../services/nodeService';\n\nclass MatchService extends NodeService {\n    constructor(StudentDataService,\n                UtilService) {\n        super();\n        this.StudentDataService = StudentDataService;\n        this.UtilService = UtilService;\n    }\n\n    /**\n     * Create a Match component object\n     * @returns a new Match component object\n     */\n    createComponent() {\n\n        var component = {};\n        component.id = this.UtilService.generateKey();\n        component.type = 'Match';\n        component.prompt = 'Enter prompt here';\n        component.showSaveButton = false;\n        component.showSubmitButton = true;\n        component.choices = [];\n        component.buckets = [];\n        component.feedback = [];\n        component.ordered = false;\n\n        return component;\n    }\n\n    /**\n     * Copies an existing Match component object\n     * @returns a copied Match component object\n     */\n    copyComponent(componentToCopy) {\n        var component = this.createComponent();\n        component.prompt = componentToCopy.prompt;\n        component.showSaveButton = componentToCopy.showSaveButton;\n        component.showSubmitButton = componentToCopy.showSubmitButton;\n        component.feedback = componentToCopy.feedback;  // Copy the feedback as-is. We'll update the id's below.\n        component.choices = [];\n        // go through the original choices and create new id's\n        if (componentToCopy.choices != null && componentToCopy.choices.length > 0) {\n            for (var c = 0; c < componentToCopy.choices.length; c++) {\n                var choice = componentToCopy.choices[c];\n                var oldChoiceId = choice.id;\n                var newChoiceId = this.UtilService.generateKey();  // generate a new id for this choice.\n                choice.id = newChoiceId;  // update the choice.\n                component.choices.push(choice);\n                // Also update any matching choice in the feedback.\n                if (component.feedback != null && component.feedback.length > 0) {\n                    for (var f = 0; f < component.feedback.length; f++) {\n                        var feedback = component.feedback[f];\n                        if (feedback.choices != null && feedback.choices.length > 0) {\n                            for (var fc = 0; fc < feedback.choices.length; fc++) {\n                                var feedbackChoice = feedback.choices[fc];\n                                if (feedbackChoice.choiceId === oldChoiceId) {\n                                    feedbackChoice.choiceId = newChoiceId;\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        component.buckets = [];\n        // go through the original buckets and create new id's\n        if (componentToCopy.buckets != null && componentToCopy.buckets.length > 0) {\n            for (var b = 0; b < componentToCopy.buckets.length; b++) {\n                var bucket = componentToCopy.buckets[b];\n                var oldBucketId = bucket.id;\n                var newBucketId = this.UtilService.generateKey();  // generate a new id for this bucket.\n                bucket.id = newBucketId;  // update the bucket's id\n                component.buckets.push(bucket);\n                // Also update any matching bucket in the feedback.\n                if (component.feedback != null && component.feedback.length > 0) {\n                    for (var f = 0; f < component.feedback.length; f++) {\n                        var feedback = component.feedback[f];\n                        if (feedback.bucketId === oldBucketId) {\n                            feedback.bucketId = newBucketId;\n                        }\n                    }\n                }\n            }\n        }\n        component.ordered = false;\n        return component;\n    }\n\n    /**\n     * Populate a component state with the data from another component state\n     * @param componentStateFromOtherComponent the component state to obtain the data from\n     * @return a new component state that contains the student data from the other\n     * component state\n     */\n    populateComponentState(componentStateFromOtherComponent) {\n        var componentState = null;\n\n        if (componentStateFromOtherComponent != null) {\n\n            // create an empty component state\n            componentState = this.StudentDataService.createComponentState();\n\n            // get the component type of the other component state\n            var otherComponentType = componentStateFromOtherComponent.componentType;\n\n            if (otherComponentType === 'Match') {\n                // the other component is an Match component\n\n                // get the student data from the other component state\n                var studentData = componentStateFromOtherComponent.studentData;\n\n                // create a copy of the student data\n                var studentDataCopy = this.UtilService.makeCopyOfJSONObject(studentData);\n\n                // set the student data into the new component state\n                componentState.studentData = studentDataCopy;\n            }\n        }\n\n        return componentState;\n    };\n\n    /**\n     * Check if the component was completed\n     * @param component the component object\n     * @param componentStates the component states for the specific component\n     * @param componentEvents the events for the specific component\n     * @param nodeEvents the events for the parent node of the component\n     * @param node parent node of the component\n     * @returns whether the component was completed\n     */\n    isCompleted(component, componentStates, componentEvents, nodeEvents, node) {\n        var result = false;\n\n        if (componentStates && componentStates.length) {\n            let submitRequired = node.showSubmitButton || (component.showSubmitButton && !node.showSaveButton);\n\n            // loop through all the component states\n            for (var c = 0; c < componentStates.length; c++) {\n\n                // the component state\n                var componentState = componentStates[c];\n\n                // get the student data from the component state\n                var studentData = componentState.studentData;\n\n                if (studentData != null) {\n                    var buckets = studentData.buckets;\n\n                    if (buckets && buckets.length) {\n                        // there is a bucket, so the student has saved work\n                        if (submitRequired) {\n                            // completion requires a submission, so check for isSubmit\n                            if (componentState.isSubmit) {\n                                result = true;\n                                break;\n                            }\n                        } else {\n                            result = true;\n                            break;\n                        }\n                    }\n                }\n            }\n        }\n\n        return result;\n    };\n}\n\nMatchService.$inject = [\n    'StudentDataService',\n    'UtilService'\n];\n\nexport default MatchService;\n"]}