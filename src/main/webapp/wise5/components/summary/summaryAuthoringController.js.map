{"version":3,"sources":["summaryAuthoringController.es6"],"names":["SummaryAuthoringController","$filter","$mdDialog","$rootScope","$scope","AnnotationService","ConfigService","NodeService","NotebookService","ProjectService","StudentAssetService","StudentDataService","SummaryService","UtilService","isResponsesOptionAvailable","updateStudentDataTypeOptionsIfNecessary","authoringComponentContent","summaryComponentId","components","getComponentsByNodeId","summaryNodeId","numberOfAllowedComponents","allowedComponent","component","isComponentTypeAllowed","type","id","componentId","performUpdatesIfNecessary","authoringViewComponentChanged","componentType","updateOtherPrompt","updateStudentDataTypeIfNecessary","otherPrompt","getOtherPrompt","nodeId","isStudentDataTypeAvailableForComponent","studentDataType","summaryStudentDataType","getComponentByNodeIdAndComponentId","isScoresSummaryAvailableForComponentType","isResponsesSummaryAvailableForComponentType","SummaryController","$inject"],"mappings":"AAAA;;;;;;;AAEA;;;;;;;;;;;;;;;;;;;;;;IAEMA,0B;;;;;AACJ,sCAAYC,OAAZ,EACIC,SADJ,EAEIC,UAFJ,EAGIC,MAHJ,EAIIC,iBAJJ,EAKIC,aALJ,EAMIC,WANJ,EAOIC,eAPJ,EAQIC,cARJ,EASIC,mBATJ,EAUIC,kBAVJ,EAWIC,cAXJ,EAYIC,WAZJ,EAYiB;AAAA;;AAAA;;AACf,oGAAMZ,OAAN,EACIC,SADJ,EAEIC,UAFJ,EAGIC,MAHJ,EAIIC,iBAJJ,EAKIC,aALJ,EAMIC,WANJ,EAOIC,eAPJ,EAQIC,cARJ,EASIC,mBATJ,EAUIC,kBAVJ,EAWIC,cAXJ,EAYIC,WAZJ;AAaA,UAAKC,0BAAL,GAAkC,KAAlC;;AACA,UAAKC,uCAAL;;AAfe;AAgBhB;;;;oDAE+B;AAC9B,WAAKC,yBAAL,CAA+BC,kBAA/B,GAAoD,IAApD;AACA,UAAMC,UAAU,GAAG,KAAKC,qBAAL,CAA2B,KAAKH,yBAAL,CAA+BI,aAA1D,CAAnB;AACA,UAAIC,yBAAyB,GAAG,CAAhC;AACA,UAAIC,gBAAgB,GAAG,IAAvB;AAJ8B;AAAA;AAAA;;AAAA;AAK9B,6BAAwBJ,UAAxB,8HAAoC;AAAA,cAAzBK,SAAyB;;AAClC,cAAI,KAAKC,sBAAL,CAA4BD,SAAS,CAACE,IAAtC,KAA+CF,SAAS,CAACG,EAAV,IAAgB,KAAKC,WAAxE,EAAqF;AACnFN,YAAAA,yBAAyB,IAAI,CAA7B;AACAC,YAAAA,gBAAgB,GAAGC,SAAnB;AACD;AACF;AAV6B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAW9B,UAAIF,yBAAyB,KAAK,CAAlC,EAAqC;AACnC,aAAKL,yBAAL,CAA+BC,kBAA/B,GAAoDK,gBAAgB,CAACI,EAArE;AACD;;AACD,WAAKE,yBAAL;AACA,WAAKC,6BAAL;AACD;;;2CAEsBC,a,EAAe;AACpC,aAAO,KAAKlB,cAAL,CAAoBY,sBAApB,CAA2CM,aAA3C,CAAP;AACD;;;yDAEoC;AACnC,WAAKF,yBAAL;AACA,WAAKC,6BAAL;AACD;;;gDAE2B;AAC1B,WAAKE,iBAAL;AACA,WAAKhB,uCAAL;AACA,WAAKiB,gCAAL;AACD;;;wCAEmB;AAClB,WAAKC,WAAL,GAAmB,KAAKC,cAAL,CAAoB,KAAKlB,yBAAL,CAA+BI,aAAnD,EACjB,KAAKJ,yBAAL,CAA+BC,kBADd,CAAnB;AAED;;;8DAEyC;AACxC,UAAMkB,MAAM,GAAG,KAAKnB,yBAAL,CAA+BI,aAA9C;AACA,UAAMO,WAAW,GAAG,KAAKX,yBAAL,CAA+BC,kBAAnD;AACA,WAAKH,0BAAL,GACI,KAAKsB,sCAAL,CAA4CD,MAA5C,EAAoDR,WAApD,EAAiE,WAAjE,CADJ;AAED;;;uDAEkC;AACjC,UAAMQ,MAAM,GAAG,KAAKnB,yBAAL,CAA+BI,aAA9C;AACA,UAAMO,WAAW,GAAG,KAAKX,yBAAL,CAA+BC,kBAAnD;AACA,UAAMoB,eAAe,GAAG,KAAKrB,yBAAL,CAA+BsB,sBAAvD;;AACA,UAAI,CAAC,KAAKF,sCAAL,CAA4CD,MAA5C,EAAoDR,WAApD,EAAiEU,eAAjE,CAAL,EAAwF;AACtF,YAAI,KAAKD,sCAAL,CAA4CD,MAA5C,EAAoDR,WAApD,EAAiE,QAAjE,CAAJ,EAAgF;AAC9E,eAAKX,yBAAL,CAA+BsB,sBAA/B,GAAwD,QAAxD;AACD,SAFD,MAEO;AACL,eAAKtB,yBAAL,CAA+BsB,sBAA/B,GAAwD,IAAxD;AACD;AACF;AACF;;;2DAEsCH,M,EAAQR,W,EAAaU,e,EAAiB;AAC3E,UAAMd,SAAS,GAAG,KAAKd,cAAL,CAAoB8B,kCAApB,CAAuDJ,MAAvD,EAA+DR,WAA/D,CAAlB;;AACA,UAAIJ,SAAS,IAAI,IAAjB,EAAuB;AACrB,YAAIc,eAAe,KAAK,QAAxB,EAAkC;AAChC,iBAAO,KAAKzB,cAAL,CAAoB4B,wCAApB,CAA6DjB,SAAS,CAACE,IAAvE,CAAP;AACD,SAFD,MAEO,IAAIY,eAAe,KAAK,WAAxB,EAAqC;AAC1C,iBAAO,KAAKzB,cAAL,CAAoB6B,2CAApB,CAAgElB,SAAS,CAACE,IAA1E,CAAP;AACD;AACF;;AACD,aAAO,KAAP;AACD;;;0DAEqC;AACpC,WAAKM,iBAAL;AACA,WAAKF,6BAAL;AACD;;;;EAxGsCa,6B;;AA2GzC1C,0BAA0B,CAAC2C,OAA3B,GAAqC,CACnC,SADmC,EAEnC,WAFmC,EAGnC,YAHmC,EAInC,QAJmC,EAKnC,mBALmC,EAMnC,eANmC,EAOnC,aAPmC,EAQnC,iBARmC,EASnC,gBATmC,EAUnC,qBAVmC,EAWnC,oBAXmC,EAYnC,gBAZmC,EAanC,aAbmC,CAArC;eAgBe3C,0B","sourcesContent":["'use strict';\n\nimport SummaryController from './summaryController';\n\nclass SummaryAuthoringController extends SummaryController {\n  constructor($filter,\n      $mdDialog,\n      $rootScope,\n      $scope,\n      AnnotationService,\n      ConfigService,\n      NodeService,\n      NotebookService,\n      ProjectService,\n      StudentAssetService,\n      StudentDataService,\n      SummaryService,\n      UtilService) {\n    super($filter,\n        $mdDialog,\n        $rootScope,\n        $scope,\n        AnnotationService,\n        ConfigService,\n        NodeService,\n        NotebookService,\n        ProjectService,\n        StudentAssetService,\n        StudentDataService,\n        SummaryService,\n        UtilService);\n    this.isResponsesOptionAvailable = false;\n    this.updateStudentDataTypeOptionsIfNecessary();\n  }\n\n  authoringSummaryNodeIdChanged() {\n    this.authoringComponentContent.summaryComponentId = null;\n    const components = this.getComponentsByNodeId(this.authoringComponentContent.summaryNodeId);\n    let numberOfAllowedComponents = 0;\n    let allowedComponent = null;\n    for (const component of components) {\n      if (this.isComponentTypeAllowed(component.type) && component.id != this.componentId) {\n        numberOfAllowedComponents += 1;\n        allowedComponent = component;\n      }\n    }\n    if (numberOfAllowedComponents === 1) {\n      this.authoringComponentContent.summaryComponentId = allowedComponent.id;\n    }\n    this.performUpdatesIfNecessary();\n    this.authoringViewComponentChanged();\n  }\n\n  isComponentTypeAllowed(componentType) {\n    return this.SummaryService.isComponentTypeAllowed(componentType);\n  }\n\n  authoringSummaryComponentIdChanged() {\n    this.performUpdatesIfNecessary();\n    this.authoringViewComponentChanged();\n  }\n\n  performUpdatesIfNecessary() {\n    this.updateOtherPrompt();\n    this.updateStudentDataTypeOptionsIfNecessary();\n    this.updateStudentDataTypeIfNecessary(); \n  }\n\n  updateOtherPrompt() {\n    this.otherPrompt = this.getOtherPrompt(this.authoringComponentContent.summaryNodeId,\n      this.authoringComponentContent.summaryComponentId);\n  }\n\n  updateStudentDataTypeOptionsIfNecessary() {\n    const nodeId = this.authoringComponentContent.summaryNodeId;\n    const componentId = this.authoringComponentContent.summaryComponentId;\n    this.isResponsesOptionAvailable = \n        this.isStudentDataTypeAvailableForComponent(nodeId, componentId, 'responses');\n  }\n\n  updateStudentDataTypeIfNecessary() {\n    const nodeId = this.authoringComponentContent.summaryNodeId;\n    const componentId = this.authoringComponentContent.summaryComponentId;\n    const studentDataType = this.authoringComponentContent.summaryStudentDataType;\n    if (!this.isStudentDataTypeAvailableForComponent(nodeId, componentId, studentDataType)) {\n      if (this.isStudentDataTypeAvailableForComponent(nodeId, componentId, 'scores')) {\n        this.authoringComponentContent.summaryStudentDataType = 'scores';\n      } else {\n        this.authoringComponentContent.summaryStudentDataType = null;\n      }\n    }\n  }\n\n  isStudentDataTypeAvailableForComponent(nodeId, componentId, studentDataType) {\n    const component = this.ProjectService.getComponentByNodeIdAndComponentId(nodeId, componentId);\n    if (component != null) {\n      if (studentDataType === 'scores') {\n        return this.SummaryService.isScoresSummaryAvailableForComponentType(component.type);\n      } else if (studentDataType === 'responses') {\n        return this.SummaryService.isResponsesSummaryAvailableForComponentType(component.type);\n      }\n    }\n    return false;\n  }\n\n  showPromptFromOtherComponentChanged() {\n    this.updateOtherPrompt();\n    this.authoringViewComponentChanged();\n  }\n}\n\nSummaryAuthoringController.$inject = [\n  '$filter',\n  '$mdDialog',\n  '$rootScope',\n  '$scope',\n  'AnnotationService',\n  'ConfigService',\n  'NodeService',\n  'NotebookService',\n  'ProjectService',\n  'StudentAssetService',\n  'StudentDataService',\n  'SummaryService',\n  'UtilService'\n];\n\nexport default SummaryAuthoringController;\n"],"file":"summaryAuthoringController.js"}