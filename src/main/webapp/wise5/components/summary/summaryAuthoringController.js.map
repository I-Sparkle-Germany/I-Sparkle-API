{"version":3,"sources":["src/main/webapp/wise5/components/summary/summaryAuthoringController.es6"],"names":["SummaryAuthoringController","$filter","$injector","$mdDialog","$rootScope","$scope","AnnotationService","ConfigService","NodeService","NotebookService","ProjectService","StudentAssetService","StudentDataService","SummaryService","UtilService","isResponsesOptionAvailable","isHighlightCorrectAnswerAvailable","isPieChartAllowed","updateStudentDataTypeOptionsIfNecessary","updateHasCorrectAnswerIfNecessary","updateChartTypeOptionsIfNecessary","authoringComponentContent","summaryComponentId","components","getComponentsByNodeId","summaryNodeId","numberOfAllowedComponents","allowedComponent","component","isComponentTypeAllowed","type","id","componentId","performUpdatesIfNecessary","authoringViewComponentChanged","componentType","updateOtherPrompt","updateStudentDataTypeIfNecessary","otherPrompt","getOtherPrompt","nodeId","isStudentDataTypeAvailableForComponent","studentDataType","componentHasCorrectAnswer","highlightCorrectAnswer","componentAllowsMultipleResponses","chartType","getComponentByNodeIdAndComponentId","isScoresSummaryAvailableForComponentType","isResponsesSummaryAvailableForComponentType","componentService","get","choiceType","SummaryController","$inject"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nimport SummaryController from './summaryController';\r\n\r\nclass SummaryAuthoringController extends SummaryController {\r\n  constructor($filter,\r\n      $injector,\r\n      $mdDialog,\r\n      $rootScope,\r\n      $scope,\r\n      AnnotationService,\r\n      ConfigService,\r\n      NodeService,\r\n      NotebookService,\r\n      ProjectService,\r\n      StudentAssetService,\r\n      StudentDataService,\r\n      SummaryService,\r\n      UtilService) {\r\n    super($filter,\r\n        $mdDialog,\r\n        $rootScope,\r\n        $scope,\r\n        AnnotationService,\r\n        ConfigService,\r\n        NodeService,\r\n        NotebookService,\r\n        ProjectService,\r\n        StudentAssetService,\r\n        StudentDataService,\r\n        SummaryService,\r\n        UtilService);\r\n    this.$injector = $injector;\r\n    this.isResponsesOptionAvailable = false;\r\n    this.isHighlightCorrectAnswerAvailable = false;\r\n    this.isPieChartAllowed = true;\r\n    this.updateStudentDataTypeOptionsIfNecessary();\r\n    this.updateHasCorrectAnswerIfNecessary();\r\n    this.updateChartTypeOptionsIfNecessary();\r\n  }\r\n\r\n  authoringSummaryNodeIdChanged() {\r\n    this.authoringComponentContent.summaryComponentId = null;\r\n    const components = this.getComponentsByNodeId(this.authoringComponentContent.summaryNodeId);\r\n    let numberOfAllowedComponents = 0;\r\n    let allowedComponent = null;\r\n    for (const component of components) {\r\n      if (this.isComponentTypeAllowed(component.type) && component.id != this.componentId) {\r\n        numberOfAllowedComponents += 1;\r\n        allowedComponent = component;\r\n      }\r\n    }\r\n    if (numberOfAllowedComponents === 1) {\r\n      this.authoringComponentContent.summaryComponentId = allowedComponent.id;\r\n    }\r\n    this.performUpdatesIfNecessary();\r\n    this.authoringViewComponentChanged();\r\n  }\r\n\r\n  isComponentTypeAllowed(componentType) {\r\n    return this.SummaryService.isComponentTypeAllowed(componentType);\r\n  }\r\n\r\n  authoringSummaryComponentIdChanged() {\r\n    this.performUpdatesIfNecessary();\r\n    this.authoringViewComponentChanged();\r\n  }\r\n\r\n  studentDataTypeChanged() {\r\n    this.updateHasCorrectAnswerIfNecessary();\r\n    this.updateChartTypeOptionsIfNecessary();\r\n    this.authoringViewComponentChanged();\r\n  }\r\n\r\n  performUpdatesIfNecessary() {\r\n    this.updateOtherPrompt();\r\n    this.updateStudentDataTypeOptionsIfNecessary();\r\n    this.updateStudentDataTypeIfNecessary();\r\n    this.updateHasCorrectAnswerIfNecessary();\r\n    this.updateChartTypeOptionsIfNecessary();\r\n  }\r\n\r\n  updateOtherPrompt() {\r\n    this.otherPrompt = this.getOtherPrompt(this.authoringComponentContent.summaryNodeId,\r\n      this.authoringComponentContent.summaryComponentId);\r\n  }\r\n\r\n  updateStudentDataTypeOptionsIfNecessary() {\r\n    const nodeId = this.authoringComponentContent.summaryNodeId;\r\n    const componentId = this.authoringComponentContent.summaryComponentId;\r\n    this.isResponsesOptionAvailable = \r\n        this.isStudentDataTypeAvailableForComponent(nodeId, componentId, 'responses');\r\n  }\r\n\r\n  updateStudentDataTypeIfNecessary() {\r\n    const nodeId = this.authoringComponentContent.summaryNodeId;\r\n    const componentId = this.authoringComponentContent.summaryComponentId;\r\n    const studentDataType = this.authoringComponentContent.studentDataType;\r\n    if (!this.isStudentDataTypeAvailableForComponent(nodeId, componentId, studentDataType)) {\r\n      if (this.isStudentDataTypeAvailableForComponent(nodeId, componentId, 'scores')) {\r\n        this.authoringComponentContent.studentDataType = 'scores';\r\n      } else {\r\n        this.authoringComponentContent.studentDataType = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  updateHasCorrectAnswerIfNecessary() {\r\n    this.isHighlightCorrectAnswerAvailable = this.componentHasCorrectAnswer() &&\r\n        this.authoringComponentContent.studentDataType === 'responses';\r\n    if (!this.isHighlightCorrectAnswerAvailable) {\r\n      this.authoringComponentContent.highlightCorrectAnswer = false;\r\n    }\r\n  }\r\n\r\n  updateChartTypeOptionsIfNecessary() {\r\n    this.isPieChartAllowed = this.authoringComponentContent.studentDataType === 'scores' || \r\n        !this.componentAllowsMultipleResponses();\r\n    if (!this.isPieChartAllowed && this.authoringComponentContent.chartType === 'pie') {\r\n      this.authoringComponentContent.chartType = 'column';\r\n    }\r\n  }\r\n\r\n  isStudentDataTypeAvailableForComponent(nodeId, componentId, studentDataType) {\r\n    const component = this.ProjectService.getComponentByNodeIdAndComponentId(nodeId, componentId);\r\n    if (component != null) {\r\n      if (studentDataType === 'scores') {\r\n        return this.SummaryService.isScoresSummaryAvailableForComponentType(component.type);\r\n      } else if (studentDataType === 'responses') {\r\n        return this.SummaryService.isResponsesSummaryAvailableForComponentType(component.type);\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  showPromptFromOtherComponentChanged() {\r\n    this.updateOtherPrompt();\r\n    this.authoringViewComponentChanged();\r\n  }\r\n\r\n  componentHasCorrectAnswer() {\r\n    const nodeId = this.authoringComponentContent.summaryNodeId;\r\n    const componentId = this.authoringComponentContent.summaryComponentId;\r\n    if (nodeId != null && componentId != null) {\r\n      const component = this.ProjectService.getComponentByNodeIdAndComponentId(nodeId, componentId);\r\n      if (component != null) {\r\n        const componentService = this.$injector.get(component.type + 'Service');\r\n        return componentService.componentHasCorrectAnswer(component);\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  componentAllowsMultipleResponses() {\r\n    const nodeId = this.authoringComponentContent.summaryNodeId;\r\n    const componentId = this.authoringComponentContent.summaryComponentId;\r\n    if (nodeId != null && componentId != null) {\r\n      const component = this.ProjectService.getComponentByNodeIdAndComponentId(nodeId, componentId);\r\n      if (component != null) {\r\n        return component.choiceType === 'checkbox';\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n}\r\n\r\nSummaryAuthoringController.$inject = [\r\n  '$filter',\r\n  '$injector',\r\n  '$mdDialog',\r\n  '$rootScope',\r\n  '$scope',\r\n  'AnnotationService',\r\n  'ConfigService',\r\n  'NodeService',\r\n  'NotebookService',\r\n  'ProjectService',\r\n  'StudentAssetService',\r\n  'StudentDataService',\r\n  'SummaryService',\r\n  'UtilService'\r\n];\r\n\r\nexport default SummaryAuthoringController;\r\n"],"file":"summaryAuthoringController.js"}