{"version":3,"sources":["summaryController.es6"],"names":["SummaryController","$filter","$mdDialog","$rootScope","$scope","AnnotationService","ConfigService","NodeService","NotebookService","ProjectService","StudentAssetService","StudentDataService","SummaryService","UtilService","summaryNodeId","componentContent","summaryComponentId","studentDataType","chartType","prompt","highlightCorrectAnswer","warningMessage","showPromptFromOtherComponent","otherPrompt","getOtherPrompt","isStudent","isPreview","isStudentRun","otherStepTitle","getOtherStepTitle","isShowDisplay","calculateIsShowDisplay","getWarningMessage","setPeriodIdIfNecessary","nodeId","componentId","otherComponent","getComponentByNodeIdAndComponentId","componentStates","getComponentStatesByNodeIdAndComponentId","length","requirementToSeeSummary","studentHasSubmittedWork","studentHasSavedWork","studentHasCompletedComponent","messageTranslationKey","$translate","stepTitle","componentState","isSubmit","isCompleted","getNodePositionAndTitleByNodeId","source","periodId","getPeriodId","event","args","ComponentController","$inject"],"mappings":"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","sourcesContent":["'use strict';\n\nimport ComponentController from '../componentController';\n\nclass SummaryController extends ComponentController {\n  constructor($filter,\n      $mdDialog,\n      $rootScope,\n      $scope,\n      AnnotationService,\n      ConfigService,\n      NodeService,\n      NotebookService,\n      ProjectService,\n      StudentAssetService,\n      StudentDataService,\n      SummaryService,\n      UtilService) {\n    super($filter,\n        $mdDialog,\n        $rootScope,\n        $scope,\n        AnnotationService,\n        ConfigService,\n        NodeService,\n        NotebookService,\n        ProjectService,\n        StudentAssetService,\n        StudentDataService,\n        UtilService);\n    this.SummaryService = SummaryService;\n    this.summaryNodeId = this.componentContent.summaryNodeId;\n    this.summaryComponentId = this.componentContent.summaryComponentId;\n    this.studentDataType = this.componentContent.studentDataType;\n    this.chartType = this.componentContent.chartType;\n    this.prompt = this.componentContent.prompt;\n    this.highlightCorrectAnswer = this.componentContent.highlightCorrectAnswer;\n    this.warningMessage = '';\n    if (this.componentContent.showPromptFromOtherComponent) {\n      this.otherPrompt = this.getOtherPrompt(this.summaryNodeId, this.summaryComponentId);\n    }\n    this.isStudent = this.ConfigService.isPreview() || this.ConfigService.isStudentRun();\n    if (this.isStudent) {\n      this.otherStepTitle = this.getOtherStepTitle();\n      this.isShowDisplay = this.calculateIsShowDisplay();\n    } else {\n      this.isShowDisplay = true;\n    }\n    if (!this.isShowDisplay) {\n      this.warningMessage = this.getWarningMessage();\n    }\n    this.setPeriodIdIfNecessary();\n  }\n\n  getOtherPrompt(nodeId, componentId) {\n    const otherComponent = this.ProjectService.getComponentByNodeIdAndComponentId(\n        nodeId, componentId);\n    if (otherComponent != null) {\n      return otherComponent.prompt;\n    }\n    return null;\n  }\n\n  isStudentHasWork() {\n    const componentStates = this.StudentDataService.getComponentStatesByNodeIdAndComponentId(\n        this.summaryNodeId, this.summaryComponentId);\n    return componentStates.length > 0;\n  }\n\n  calculateIsShowDisplay() {\n    if (this.componentContent.requirementToSeeSummary === 'submitWork') {\n      return this.studentHasSubmittedWork();\n    } else if (this.componentContent.requirementToSeeSummary === 'saveWork') {\n      return this.studentHasSavedWork();\n    } else if (this.componentContent.requirementToSeeSummary === 'completeComponent') {\n      return this.studentHasCompletedComponent();\n    } else if (this.componentContent.requirementToSeeSummary === 'none') {\n      return true;\n    }\n  }\n\n  getWarningMessage() {\n    let messageTranslationKey = '';\n    if (this.componentContent.requirementToSeeSummary === 'submitWork') {\n      messageTranslationKey = 'summary.youMustSubmitWork';\n    } else if (this.componentContent.requirementToSeeSummary === 'saveWork') {\n      messageTranslationKey = 'summary.youMustSaveWork';\n    } else if (this.componentContent.requirementToSeeSummary === 'completeComponent') {\n      messageTranslationKey = 'summary.youMustComplete';\n    }\n    return this.$translate(messageTranslationKey, { stepTitle: this.otherStepTitle });\n  }\n\n  studentHasSubmittedWork() {\n    const componentStates = this.StudentDataService.getComponentStatesByNodeIdAndComponentId(\n        this.summaryNodeId, this.summaryComponentId); \n    for (const componentState of componentStates) {\n      if (componentState.isSubmit) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  studentHasSavedWork() {\n    const componentStates = this.StudentDataService.getComponentStatesByNodeIdAndComponentId(\n        this.summaryNodeId, this.summaryComponentId); \n    return componentStates.length > 0;\n  }\n\n  studentHasCompletedComponent() {\n    return this.StudentDataService.isCompleted(this.summaryNodeId, this.summaryComponentId);\n  }\n\n  getOtherStepTitle() {\n    return this.ProjectService.getNodePositionAndTitleByNodeId(this.summaryNodeId);\n  }\n\n  setPeriodIdIfNecessary() {\n    if (this.ConfigService.isStudentRun()) {\n      if (this.componentContent.source === 'period') {\n        this.periodId = this.ConfigService.getPeriodId();\n      } else if (this.componentContent.source === 'allPeriods') {\n        this.periodId = null;\n      }\n    }\n  }\n\n  handleStudentWorkSavedToServerAdditionalProcessing(event, args) {\n    if (this.isStudent) {\n      this.isShowDisplay = this.calculateIsShowDisplay();\n    }\n  }\n}\n\nSummaryController.$inject = [\n    '$filter',\n    '$mdDialog',\n    '$rootScope',\n    '$scope',\n    'AnnotationService',\n    'ConfigService',\n    'NodeService',\n    'NotebookService',\n    'ProjectService',\n    'StudentAssetService',\n    'StudentDataService',\n    'SummaryService',\n    'UtilService'\n];\n\nexport default SummaryController;"],"file":"summaryController.js"}