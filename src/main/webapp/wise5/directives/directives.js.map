{"version":3,"sources":["directives.es6"],"names":["ComponentDirective","$injector","$compile","ConfigService","NodeService","NotebookService","ProjectService","StudentDataService","restrict","$scope","element","attrs","nodeId","nodeid","componentId","componentid","componentState","componentstate","workgroupId","teacherWorkgroupId","originalNodeId","originalnodeid","originalComponentId","originalcomponentid","mode","workgroupid","parseInt","e","teacherworkgroupid","instance","getLatestComponentStateByNodeIdAndComponentId","angular","fromJson","authoringComponentContent","getComponentByNodeIdAndComponentId","componentContent","injectAssetPaths","replaceStudentNames","isNotebookEnabled","injectClickToSnipImage","componentTemplatePath","getComponentTemplatePath","type","originalComponentContent","componentHTML","html","contents","CompileDirective","scope","ele","$watch","$eval","compile","value","ConfirmNumberDecrease","priority","require","modelCtrl","message","confirmNumberDecrease","$parsers","push","newValue","oldValue","$modelValue","answer","confirm","$setViewValue","$render","DisableDeleteKeypress","$document","bind","keyCode","nodeName","target","targetType","toLowerCase","contentEditable","preventDefault","ListenForDeleteKeypress","$broadcast","DraggableDirective","attr","startX","startY","attributes","on","event","leftString","topString","left","top","length","style","replace","pageX","pageY","mousemove","mouseup","linkTypeChooserWidth","linkTypeChooserHeight","linkTypeChooserWidthString","css","linkTypeChooserHeightString","overlayWidth","overlayHeight","x","y","conceptMapController","conceptMapContainer","offset","offsetTop","off","Wiselink","bindings","linkText","tooltip","linkClass","templateUrl","controller","Annotation","annotation","fromWorkgroupId","toWorkgroupId","componentStateId","active","maxScore","ComponentAnnotations","annotations","PossibleScore","Directives","module","directiveFactory","$inject","component","directive"],"mappings":"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","file":"directives.js","sourcesContent":["'use strict';\n\nimport AnnotationController from './annotation/annotationController';\nimport ComponentAnnotationsController from './componentAnnotations/componentAnnotationsController';\nimport PossibleScoreController from './possibleScore/possibleScoreController';\nimport WiselinkController from './wiselink/wiselinkController';\n\nclass ComponentDirective {\n    constructor($injector, $compile, ConfigService, NodeService, NotebookService, ProjectService, StudentDataService) {\n        this.restrict = 'E';\n        this.$injector = $injector;\n        this.$compile = $compile;\n        this.ConfigService = ConfigService;\n        this.NodeService = NodeService;\n        this.NotebookService = NotebookService;\n        this.ProjectService = ProjectService;\n        this.StudentDataService = StudentDataService;\n    }\n\n    static directiveFactory($injector, $compile, ConfigService, NodeService, NotebookService, ProjectService, StudentDataService) {\n        ComponentDirective.instance = new ComponentDirective($injector, $compile, ConfigService, NodeService, NotebookService, ProjectService, StudentDataService);\n        return ComponentDirective.instance;\n    }\n\n    link($scope, element, attrs) {\n        var nodeId = attrs.nodeid;\n        var componentId = attrs.componentid;\n        var componentState = attrs.componentstate;\n        var workgroupId = null;\n        var teacherWorkgroupId = null;\n        var originalNodeId = attrs.originalnodeid;\n        var originalComponentId = attrs.originalcomponentid;\n\n        $scope.mode = \"student\";\n        if (attrs.mode) {\n            $scope.mode = attrs.mode;\n        }\n\n        if (attrs.workgroupid != null) {\n            try {\n                workgroupId = parseInt(attrs.workgroupid);\n            } catch(e) {\n\n            }\n        }\n\n        if (attrs.teacherworkgroupid) {\n            try {\n                teacherWorkgroupId = parseInt(attrs.teacherworkgroupid);\n            } catch(e) {\n\n            }\n        }\n\n        if (componentState == null || componentState === '') {\n            componentState = ComponentDirective.instance.StudentDataService.getLatestComponentStateByNodeIdAndComponentId(nodeId, componentId);\n        } else {\n            componentState = angular.fromJson(componentState);\n            nodeId = componentState.nodeId;\n            componentId = componentState.componentId;\n\n        }\n\n        var authoringComponentContent = ComponentDirective.instance.ProjectService.getComponentByNodeIdAndComponentId(nodeId, componentId);\n        var componentContent = ComponentDirective.instance.ProjectService.injectAssetPaths(authoringComponentContent);\n\n        // replace any student names in the component content\n        componentContent = ComponentDirective.instance.ConfigService.replaceStudentNames(componentContent);\n\n        if (this.NotebookService.isNotebookEnabled()) {\n            // inject the click attribute that will snip the image when the image is clicked\n            componentContent = ComponentDirective.instance.ProjectService.injectClickToSnipImage(componentContent);\n        }\n\n        $scope.componentContent = componentContent;\n        $scope.authoringComponentContent = authoringComponentContent;\n        $scope.componentState = componentState;\n        $scope.componentTemplatePath = ComponentDirective.instance.NodeService.getComponentTemplatePath(componentContent.type);\n        $scope.nodeId = nodeId;\n        $scope.workgroupId = workgroupId;\n        $scope.teacherWorkgroupId = teacherWorkgroupId;\n        $scope.type = componentContent.type;\n\n        if (originalNodeId != null && originalComponentId != null) {\n            /*\n             * set the original node id and component id. this is used\n             * when we are showing previous work from another component.\n             */\n            $scope.originalNodeId = originalNodeId;\n            $scope.originalComponentId = originalComponentId;\n\n            // get the original component\n            var originalComponentContent = ComponentDirective.instance.ProjectService.getComponentByNodeIdAndComponentId(originalNodeId, originalComponentId);\n            $scope.originalComponentContent = originalComponentContent;\n        }\n\n        var componentHTML = '<div id=\"{{component.id}}\" class=\"component-wrapper\">' +\n            '<div ng-include=\"componentTemplatePath\" class=\"component component--{{type}}\"></div></div>';\n\n        if (componentHTML != null) {\n            element.html(componentHTML);\n            ComponentDirective.instance.$compile(element.contents())($scope);\n        }\n    }\n}\n\nclass CompileDirective {\n    constructor($compile) {\n\n        this.$compile = $compile;\n    }\n\n    static directiveFactory($compile) {\n        CompileDirective.instance = new CompileDirective($compile);\n        return CompileDirective.instance;\n    }\n\n    link(scope, ele, attrs) {\n        scope.$watch(\n            function(scope) {\n                return scope.$eval(attrs.compile);\n            },\n            function(value) {\n                ele.html(value);\n                CompileDirective.instance.$compile(ele.contents())(scope);\n            }\n        );\n    }\n}\n\n/**\n * A directive that asks the user if they are sure they want to change a\n * number input value to a lower value. We will not ask the user if they\n * change the number to a higher value. This directive is intended to\n * be used in cases when changing to a lower value will have a destructive\n * effect such as setting the number of rows in the authoring view of the\n * table component.\n */\nclass ConfirmNumberDecrease {\n    constructor() {\n        this.priority = -1;\n        this.restrict = 'A';\n        this.require = 'ngModel';\n    }\n\n    static directiveFactory() {\n        ConfirmNumberDecrease.instance = new ConfirmNumberDecrease();\n        return ConfirmNumberDecrease.instance;\n    }\n\n    link($scope, element, attrs, modelCtrl) {\n\n        // get the message\n        var message = attrs.confirmNumberDecrease;\n\n        modelCtrl.$parsers.push(function (newValue) {\n\n            // get the old value\n            var oldValue = modelCtrl.$modelValue;\n\n            // check if the new value is less than the old value\n            if (newValue < oldValue) {\n                /*\n                 * the new value is less than the old value so we will ask them to confirm\n                 * the change since it may be destructive\n                 */\n                var answer = confirm(message);\n\n                if (answer) {\n                    // the user wants to change the value\n                    return newValue;\n                } else {\n                    // the user does not want to change the value so we will roll it back\n                    modelCtrl.$setViewValue(oldValue);\n                    modelCtrl.$render();\n                    return oldValue;\n                }\n            } else {\n                /*\n                 * the new value is equal or greater than the old value so we do\n                 * not need the user to confirm the change\n                 */\n                return newValue;\n            }\n        });\n    }\n}\n\n/**\n * Disable the backspace key so that it does not navigate the user back\n * in their browser history.\n */\nclass DisableDeleteKeypress {\n    constructor($document) {\n        this.restrict = 'A';\n        this.$document = $document;\n    }\n\n    static directiveFactory($document) {\n        DisableDeleteKeypress.instance = new DisableDeleteKeypress($document);\n        return DisableDeleteKeypress.instance;\n    }\n\n    link($document) {\n        DisableDeleteKeypress.instance.$document.bind('keydown', function(e) {\n\n            // check for the delete key press\n            if (e.keyCode === 8) {\n                // the delete key was pressed\n\n                // get the name of the node e.g. body, input, div, etc.\n                let nodeName = e.target.nodeName;\n\n                // get the type if applicable e.g. text, password, file, etc.\n                let targetType = e.target.type;\n\n                if (nodeName != null) {\n                    nodeName = nodeName.toLowerCase();\n                }\n\n                if (targetType != null) {\n                    targetType = targetType.toLowerCase();\n                }\n\n                let contentEditable = e.target.contentEditable === 'true';\n\n                if ((nodeName === 'input' && targetType === 'text') ||\n                    (nodeName === 'input' && targetType === 'password') ||\n                    (nodeName === 'input' && targetType === 'file') ||\n                    (nodeName === 'input' && targetType === 'search') ||\n                    (nodeName === 'input' && targetType === 'email') ||\n                    (nodeName === 'input' && targetType === 'number') ||\n                    (nodeName === 'input' && targetType === 'date') ||\n                    nodeName === 'textarea' || contentEditable) {\n                    /*\n                     * the user is typing in a valid input element so we will\n                     * allow the delete key press\n                     */\n                } else {\n                    /*\n                     * the user is not typing in an input element so we will\n                     * not allow the delete key press\n                     */\n                    e.preventDefault();\n                }\n            }\n        });\n    }\n}\n\n/**\n * Listen for the backspace key press so we can perform special processing\n * specific for components such as deleting a point in a graph component.\n */\nclass ListenForDeleteKeypress {\n    constructor($document) {\n        this.restrict = 'A';\n        this.$document = $document;\n    }\n\n    static directiveFactory($document) {\n        ListenForDeleteKeypress.instance = new ListenForDeleteKeypress($document);\n        return ListenForDeleteKeypress.instance;\n    }\n\n    link($scope) {\n        ListenForDeleteKeypress.instance.$document.bind('keydown', function(e) {\n\n            // check for the delete key press\n            if (e.keyCode === 8) {\n                // the delete key was pressed\n\n                // fire the deleteKeyPressed event\n                $scope.$broadcast('deleteKeyPressed');\n            }\n        })\n    }\n}\n\n/**\n * Make the element draggable\n */\nclass DraggableDirective {\n    constructor($document) {\n        this.restrict = 'A';\n        this.$document = $document;\n    }\n\n    static directiveFactory($document) {\n        DraggableDirective.instance = new DraggableDirective($document);\n        return DraggableDirective.instance;\n    }\n\n    /**\n     * Set up the element\n     */\n    link(scope, element, attr) {\n\n        var $document = this.$document;\n\n        /*\n         * used to remember the start x and y coordinate of the top left corner\n         * of the element\n         */\n        var startX = 0;\n        var startY = 0;\n\n        // set the attributes into the element so we can access them later\n        this.attributes = attr;\n\n        /*\n         * listen for the mouse down event so we can set up the variables\n         * to start dragging\n         */\n        element.on('mousedown', (event) => {\n\n            // Prevent default dragging of selected content\n            event.preventDefault();\n\n            var leftString = null;\n            var topString = null;\n            var left = null;\n            var top = null;\n\n            if (element != null && element.length > 0) {\n                /*\n                 * get the pixel location of the top left corner relative to its\n                 * parent container\n                 */\n                leftString = element[0].style.left;\n                topString = element[0].style.top;\n\n                if (leftString != null) {\n                    // get the integer value of the left\n                    left = parseInt(leftString.replace('px', ''));\n                }\n\n                if (topString != null) {\n                    // get the integer value of the top\n                    top = parseInt(topString.replace('px', ''));\n                }\n\n                /*\n                 * get the position of the mouse and subtract the distance from\n                 * the upper left corner of the parent container to the upper\n                 * left corner of the element.\n                 * this will be equal to the sum of two values.\n                 * the first value is the x and y difference between the upper\n                 * left corner of the browser screen to the upper left corner\n                 * of the parent container.\n                 * the second value is the x and y difference between the upper\n                 * left corner of the element to the mouse position.\n                 * we will use the sum of these two values later to calculate\n                 * where to place the element when it is being dragged.\n                 */\n                startX = event.pageX - left;\n                startY = event.pageY - top;\n\n                // add mouse listeners to handle moving the element\n                $document.on('mousemove', mousemove);\n                $document.on('mouseup', mouseup);\n            }\n        });\n\n        /**\n         * Called when the user is dragging the element\n         * @param event the event\n         */\n        function mousemove(event) {\n\n            var linkTypeChooserWidth = null;\n            var linkTypeChooserHeight = null;\n\n            // get the width and height of the element we are dragging\n            var linkTypeChooserWidthString = angular.element(element[0]).css('width');\n            var linkTypeChooserHeightString = angular.element(element[0]).css('height');\n\n            if (linkTypeChooserWidthString != null && linkTypeChooserHeightString != null) {\n                // get the integer values of the width and height\n                linkTypeChooserWidth = parseInt(linkTypeChooserWidthString.replace('px', ''));\n                linkTypeChooserHeight = parseInt(linkTypeChooserHeightString.replace('px', ''));\n            }\n\n            /*\n             * get the width and height of the container that we want to restrict\n             * the element within. the user will not be able to drag the element\n             * outside of these boundaries.\n             */\n            var overlayWidth = element.scope().$eval(element[0].attributes['container-width'].value);\n            var overlayHeight = element.scope().$eval(element[0].attributes['container-height'].value);\n\n            /*\n             * calculate the x and y position of where the element should be\n             * placed. we will calculate the position by taking the mouse\n             * position and subtracting the value we previously calculated\n             * in the mousedown event. performing the subtraction will give\n             * us the x and y difference between the upper left corner of the\n             * parent container and the upper left corner of the element.\n             */\n            var x = event.pageX - startX;\n            var y = event.pageY - startY;\n\n            var top = 0;\n\n            if (element.scope().conceptMapController.mode == 'authoring') {\n                /*\n                 * if we are in authoring mode we need to include the offset of\n                 * the container for some reason.\n                 * TODO: figure out why the offset is required in authoring mode\n                 * but not in student mode.\n                 */\n\n                // get the concept map container\n                var conceptMapContainer = angular.element('#conceptMapContainer');\n\n                // get the offset of the container relative to the whole page\n                var offset = conceptMapContainer.offset();\n\n                // get the top offset\n                var offsetTop = offset.top;\n\n                // set the top to the offset\n                top = offsetTop;\n            }\n\n            if (x < 0) {\n                /*\n                 * the x position that we have calculated for the left\n                 * side of the element is past the left side of the parent\n                 * container so we will set the x position to 0 so that the\n                 * element is up against the left side of the parent container\n                 */\n                x = 0;\n            } else if((x + linkTypeChooserWidth) > overlayWidth) {\n                /*\n                 * the x position that we have calculated for the right\n                 * side of the element is past the right side of the parent\n                 * container so we will set the x position so that the element\n                 * is up against the right side of the parent container\n                 */\n                x = overlayWidth - linkTypeChooserWidth;\n            }\n\n            if (y < top) {\n                /*\n                 * the y position that we have calculated for the top\n                 * side of the element is past the top side of the parent\n                 * container so we will set the y position to 0 so that the\n                 * element is up against the top side of the parent container\n                 */\n                y = top;\n            } else if ((y + linkTypeChooserHeight) > (overlayHeight + top)) {\n                /*\n                 * the y position that we have calculated for the bottom\n                 * side of the element is past the bottom side of the parent\n                 * container so we will set the y position so that the element\n                 * is up against the bottom side of the parent container\n                 */\n                y = (overlayHeight + top) - linkTypeChooserHeight;\n            }\n\n            // move the element to the new position\n            element.css({\n                top: y + 'px',\n                left:  x + 'px'\n            });\n        }\n\n        /**\n         * Called when the user has released the mouse button\n         */\n        function mouseup() {\n            // remove the mousemove listener\n            $document.off('mousemove', mousemove);\n\n            // remove the mouseup listener\n            $document.off('mouseup', mouseup);\n        }\n    };\n}\n\n/**\n * Creates a link or button that the student can click on to navigate to\n * another step or activity in the project.\n */\nconst Wiselink = {\n    bindings: {\n        nodeId: '@',\n        linkText: '@',\n        tooltip: '@',\n        linkClass: '@',\n        type: '@'\n    },\n    templateUrl: 'wise5/directives/wiselink/wiselink.html',\n    controller: 'WiselinkController as wiselinkCtrl'\n}\n\nconst Annotation = {\n    bindings: {\n        annotation: '<',\n        type: '@',\n        mode: '<',\n        nodeId: '<',\n        componentId: '<',\n        fromWorkgroupId: '<',\n        toWorkgroupId: '<',\n        componentStateId: '<',\n        active: '<',\n        maxScore: '<'\n    },\n    templateUrl: 'wise5/directives/annotation/annotation.html',\n    controller: 'AnnotationController as annotationController'\n}\n\nconst ComponentAnnotations = {\n    bindings: {\n        annotations: '<',\n        maxScore: '<'\n    },\n    templateUrl: 'wise5/directives/componentAnnotations/componentAnnotations.html',\n    controller: 'ComponentAnnotationsController as componentAnnotationsCtrl'\n}\n\nconst PossibleScore = {\n    bindings: {\n        maxScore: '<'\n    },\n    templateUrl: 'wise5/directives/possibleScore/possibleScore.html',\n    controller: 'PossibleScoreController as possibleScoreCtrl'\n}\n\nlet Directives = angular.module('directives', []);\n\nCompileDirective.directiveFactory.$inject = ['$compile'];\nComponentDirective.directiveFactory.$inject = ['$injector', '$compile', 'ConfigService', 'NodeService', 'NotebookService', 'ProjectService', 'StudentDataService'];\nConfirmNumberDecrease.directiveFactory.$inject = [];\nDisableDeleteKeypress.directiveFactory.$inject = ['$document'];\nListenForDeleteKeypress.directiveFactory.$inject = ['$document'];\nDraggableDirective.directiveFactory.$inject = ['$document'];\n\nDirectives.controller('AnnotationController', AnnotationController);\nDirectives.component('annotation', Annotation);\nDirectives.controller('ComponentAnnotationsController', ComponentAnnotationsController);\nDirectives.component('componentAnnotations', ComponentAnnotations);\nDirectives.controller('PossibleScoreController', PossibleScoreController);\nDirectives.component('wiselink', Wiselink);\nDirectives.controller('WiselinkController', WiselinkController);\nDirectives.component('possibleScore', PossibleScore);\nDirectives.directive('compile', CompileDirective.directiveFactory);\nDirectives.directive('component', ComponentDirective.directiveFactory);\nDirectives.directive('confirmNumberDecrease', ConfirmNumberDecrease.directiveFactory);\nDirectives.directive('disableDeleteKeypress', DisableDeleteKeypress.directiveFactory);\nDirectives.directive('draggable', DraggableDirective.directiveFactory);\nDirectives.directive('listenForDeleteKeypress', ListenForDeleteKeypress.directiveFactory);\n\nexport default Directives;\n"]}