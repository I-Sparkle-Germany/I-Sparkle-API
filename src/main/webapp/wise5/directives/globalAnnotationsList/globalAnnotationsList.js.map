{"version":3,"sources":["globalAnnotationsList.es6"],"names":["GlobalAnnotationsListController","$rootScope","$scope","$translate","AnnotationService","ProjectService","active","$onInit","setModel","$on","event","args","latestGlobalAnnotationGroup","getLatestGlobalAnnotationGroup","latestGlobalComment","latestGlobalScore","annotations","n","length","i","annotation","type","nodeId","nodeTitle","getNodePositionAndTitleByNodeId","maxScore","getMaxScoreForNode","getActiveGlobalAnnotationGroups","total","sort","a","b","Date","serverSaveTime","$inject","GlobalAnnotationsList","bindings","template","controller"],"mappings":"AAAA;;;;;;;;;;IAEMA,+B;AACF,6CAAYC,UAAZ,EACYC,MADZ,EAEYC,UAFZ,EAGYC,iBAHZ,EAIYC,cAJZ,EAI4B;AAAA;;AAAA;;AACxB,aAAKJ,UAAL,GAAkBA,UAAlB;AACA,aAAKC,MAAL,GAAcA,MAAd;AACA,aAAKC,UAAL,GAAkBA,UAAlB;AACA,aAAKC,iBAAL,GAAyBA,iBAAzB;AACA,aAAKC,cAAL,GAAsBA,cAAtB;;AAEA,aAAKC,MAAL,GAAc,KAAd;;AAEA,aAAKC,OAAL,GAAe,YAAM;AACjB,kBAAKC,QAAL;AACH,SAFD;;AAIA;AACA,aAAKN,MAAL,CAAYO,GAAZ,CAAgB,yBAAhB,EAA2C,UAACC,KAAD,EAAQC,IAAR,EAAiB;AACxD,kBAAKH,QAAL;AACH,SAFD;;AAIA;AACA,aAAKP,UAAL,CAAgBQ,GAAhB,CAAoB,qBAApB,EAA2C,UAACC,KAAD,EAAQC,IAAR,EAAiB;AACxD,kBAAKH,QAAL;AACH,SAFD;AAGH;;;;mCAEU;AACP,gBAAII,8BAA8B,KAAKC,8BAAL,EAAlC;AACA,iBAAKC,mBAAL,GAA2B,IAA3B;AACA,iBAAKC,iBAAL,GAAyB,IAAzB;;AAEA,gBAAIH,2BAAJ,EAAiC;AAC7B,oBAAII,cAAcJ,4BAA4BI,WAA9C;;AAEA,oBAAIC,IAAID,YAAYE,MAAZ,GAAmB,CAA3B;AACA,qBAAK,IAAIC,IAAIF,CAAb,EAAgBE,IAAI,CAAC,CAArB,EAAwBA,GAAxB,EAA6B;AACzB,wBAAIC,aAAaJ,YAAYG,CAAZ,CAAjB;AACA,wBAAIE,OAAOD,WAAWC,IAAtB;AACA,wBAAIA,SAAS,aAAb,EAA4B;AACxB,6BAAKP,mBAAL,GAA2BM,UAA3B;AACH,qBAFD,MAEO,IAAIC,SAAS,WAAb,EAA0B;AAC7B,6BAAKN,iBAAL,GAAyBK,UAAzB;AACH;;AAED,wBAAI,KAAKN,mBAAL,IAA4B,KAAKC,iBAArC,EAAwD;AACpD;AACH;AACJ;;AAED,oBAAIO,SAASV,4BAA4BU,MAAzC;AACA,qBAAKC,SAAL,GAAiB,KAAKlB,cAAL,CAAoBmB,+BAApB,CAAoDF,MAApD,CAAjB;;AAEA,oBAAIG,WAAW,KAAKpB,cAAL,CAAoBqB,kBAApB,CAAuCJ,MAAvC,CAAf;AACH;AACJ;;AAED;;;;;;yDAGiC;AAC7B,gBAAIV,8BAA8B,IAAlC;;AAEA,gBAAII,cAAc,KAAKZ,iBAAL,CAAuBuB,+BAAvB,EAAlB;AACA,gBAAIC,QAAQZ,YAAYE,MAAxB;;AAEA,gBAAIU,KAAJ,EAAW;AACPZ,4BAAYa,IAAZ,CAAiB,UAASC,CAAT,EAAWC,CAAX,EAAa;AAC1B,2BAAO,IAAIC,IAAJ,CAASD,EAAEE,cAAX,IAA6B,IAAID,IAAJ,CAASF,EAAEG,cAAX,CAApC;AACH,iBAFD;;AAIArB,8CAA8BI,YAAY,CAAZ,CAA9B;AACH;;AAED,mBAAOJ,2BAAP;AACH;;;;;;AAGLZ,gCAAgCkC,OAAhC,GAA0C,CACtC,YADsC,EAEtC,QAFsC,EAGtC,YAHsC,EAItC,mBAJsC,EAKtC,gBALsC,CAA1C;;AAQA,IAAMC,wBAAwB;AAC1BC,cAAU,EADgB;AAE1BC,0fAF0B;AAY1BC,gBAAYtC;AAZc,CAA9B;;kBAeemC,qB","file":"globalAnnotationsList.js","sourcesContent":["\"use strict\";\n\nclass GlobalAnnotationsListController {\n    constructor($rootScope,\n                $scope,\n                $translate,\n                AnnotationService,\n                ProjectService) {\n        this.$rootScope = $rootScope;\n        this.$scope = $scope;\n        this.$translate = $translate;\n        this.AnnotationService = AnnotationService;\n        this.ProjectService = ProjectService;\n\n        this.active = false;\n\n        this.$onInit = () => {\n            this.setModel();\n        }\n\n        // list for new annotations or updates\n        this.$scope.$on('annotationSavedToServer', (event, args) => {\n            this.setModel();\n        });\n\n        // listen for node status changes\n        this.$rootScope.$on('nodeStatusesChanged', (event, args) => {\n            this.setModel();\n        });\n    };\n\n    setModel() {\n        let latestGlobalAnnotationGroup = this.getLatestGlobalAnnotationGroup();\n        this.latestGlobalComment = null;\n        this.latestGlobalScore = null;\n\n        if (latestGlobalAnnotationGroup) {\n            let annotations = latestGlobalAnnotationGroup.annotations;\n\n            let n = annotations.length-1;\n            for (let i = n; i > -1; i--) {\n                let annotation = annotations[i];\n                let type = annotation.type;\n                if (type === 'autoComment') {\n                    this.latestGlobalComment = annotation;\n                } else if (type === 'autoScore') {\n                    this.latestGlobalScore = annotation;\n                }\n\n                if (this.latestGlobalComment && this.latestGlobalScore) {\n                    break;\n                }\n            }\n\n            let nodeId = latestGlobalAnnotationGroup.nodeId;\n            this.nodeTitle = this.ProjectService.getNodePositionAndTitleByNodeId(nodeId);\n\n            let maxScore = this.ProjectService.getMaxScoreForNode(nodeId);\n        }\n    }\n\n    /**\n     * Return the latest active global annotatin group\n     */\n    getLatestGlobalAnnotationGroup() {\n        let latestGlobalAnnotationGroup = null;\n\n        let annotations = this.AnnotationService.getActiveGlobalAnnotationGroups();\n        let total = annotations.length;\n\n        if (total) {\n            annotations.sort(function(a,b){\n                return new Date(b.serverSaveTime) - new Date(a.serverSaveTime);\n            });\n\n            latestGlobalAnnotationGroup = annotations[0];\n        }\n\n        return latestGlobalAnnotationGroup;\n    }\n}\n\nGlobalAnnotationsListController.$inject = [\n    '$rootScope',\n    '$scope',\n    '$translate',\n    'AnnotationService',\n    'ProjectService'\n];\n\nconst GlobalAnnotationsList = {\n    bindings: {},\n    template:\n        `<p class=\"md-body-1 text-secondary\" style=\"text-decoration: underline;\">From {{$ctrl.nodeTitle}}<br /></p>\n        <div class=\"md-body-1\">\n            <p ng-if=\"$ctrl.latestGlobalComment\">\n                <compile data=\"$ctrl.latestGlobalComment.data.value\"></compile>\n            </p>\n            <p ng-if=\"$ctrl.latestGlobalScore\">\n                Score: {{$ctrl.latestGlobalScore.data.value}}<span ng-if=\"$ctrl.maxScore\">/{{$ctrl.maxScore}}</span>\n            </p>\n        </div>`,\n    controller: GlobalAnnotationsListController\n};\n\nexport default GlobalAnnotationsList;\n"]}