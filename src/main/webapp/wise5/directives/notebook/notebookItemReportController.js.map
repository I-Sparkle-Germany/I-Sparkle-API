{"version":3,"sources":["notebookItemReportController.es6"],"names":["NotebookItemReportController","$injector","$mdBottomSheet","$rootScope","$scope","$filter","ConfigService","NotebookService","ProjectService","StudentAssetService","StudentDataService","$translate","mode","getMode","dirty","autoSaveInterval","saveMessage","text","time","reportItem","getLatestNotebookReportItemByReportId","reportId","workgroupId","serverSaveTime","clientSaveTime","convertToClientTimestamp","setSavedMessage","getTemplateReportItemByReportId","notebookConfig","getNotebookConfig","label","itemTypes","report","reportItemContent","injectAssetPaths","content","summernoteOptions","toolbar","popover","image","customButton","buttonText","tooltip","buttonClass","action","$event","addNotebookItemContent","disableDragAndDrop","toolbarContainer","callbacks","onBlur","$","summernote","$watch","newValue","oldValue","startAutoSaveInterval","item","nodeId","getNodePositionAndTitleByNodeId","templateUrl","ev","notebookItems","getNotebookByWorkgroup","items","themePath","reportTextareaCursorPosition","angular","element","prop","$reportElement","show","parent","document","body","locals","controller","NotebookItemChooserController","controllerAs","bindToController","chooseNotebookItem","notebookItem","$item","css","attachments","a","length","notebookItemAttachment","$img","iconURL","addClass","append","$caption","hide","$inject","stopAutoSaveInterval","autoSaveIntervalId","setInterval","saveNotebookReportItem","clearInterval","Date","parse","id","saveNotebookItem","localNotebookItemId","type","title","groups","then","result","distance","elem","edge","scrollBarWidth","clientWidth","querySelector","outerWidth","find","setSaveText","message","removeAbsoluteAssetPaths","windowString","w","window","open","write","close"],"mappings":"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","file":"notebookItemReportController.js","sourcesContent":["'use strict';\n\nclass NotebookItemReportController {\n  constructor($injector,\n              $mdBottomSheet,\n              $rootScope,\n              $scope,\n              $filter,\n              ConfigService,\n              NotebookService,\n              ProjectService,\n              StudentAssetService,\n              StudentDataService) {\n    this.$injector = $injector;\n    this.$mdBottomSheet = $mdBottomSheet;\n    this.$rootScope = $rootScope;\n    this.$scope = $scope;\n    this.$filter = $filter;\n    this.ConfigService = ConfigService;\n    this.NotebookService = NotebookService;\n    this.ProjectService = ProjectService;\n    this.StudentAssetService = StudentAssetService;\n    this.StudentDataService = StudentDataService;\n    this.$translate = this.$filter('translate');\n    this.mode = this.ConfigService.getMode();\n    this.dirty = false;\n    this.autoSaveInterval = 60000;  // the auto save interval in milliseconds\n    this.saveMessage = {\n      text: '',\n      time: ''\n    };\n\n    this.reportItem = this.NotebookService.getLatestNotebookReportItemByReportId(this.reportId, this.workgroupId);\n    if (this.reportItem) {\n      let serverSaveTime = this.reportItem.serverSaveTime;\n      let clientSaveTime = this.ConfigService.convertToClientTimestamp(serverSaveTime);\n      this.setSavedMessage(clientSaveTime);\n    } else {\n      // Student doesn't have work for this report yet, so we'll use the template.\n      this.reportItem = this.NotebookService.getTemplateReportItemByReportId(this.reportId);\n      if (this.reportItem == null) {\n        // if there is no template, don't allow student to work on the report.\n        return;\n      }\n    }\n\n    this.notebookConfig = this.NotebookService.getNotebookConfig();\n    this.label = this.notebookConfig.itemTypes.report.label;\n    this.reportItemContent = this.ProjectService.injectAssetPaths(this.reportItem.content.content);\n\n    this.summernoteOptions = {\n      toolbar: [\n        ['edit', ['undo', 'redo']],\n        ['style', ['bold', 'italic', 'underline'/*, 'superscript', 'subscript', 'strikethrough', 'clear'*/]],\n        //['style', ['style']],\n        //['fontface', ['fontname']],\n        //['textsize', ['fontsize']],\n        //['fontclr', ['color']],\n        ['para', ['ul', 'ol', 'paragraph'/*, 'lineheight'*/]],\n        //['height', ['height']],\n        //['table', ['table']],\n        //['insert', ['link','picture','video','hr']],\n        //['view', ['fullscreen', 'codeview']],\n        //['help', ['help']]\n        ['customButton', ['customButton']]\n        //['print', ['print']]\n      ],\n      popover: {\n        image: [\n          ['imagesize', ['imageSize100', 'imageSize50', 'imageSize25']],\n          //['float', ['floatLeft', 'floatRight', 'floatNone']],\n          ['remove', ['removeMedia']]\n        ]\n      },\n      customButton: {\n        buttonText: 'Add ' + this.notebookConfig.label + ' Item +',\n        tooltip: 'Insert from ' + this.notebookConfig.label,\n        buttonClass: 'accent-1 notebook-item--report__add-note',\n        action: ($event) => {\n          this.addNotebookItemContent($event);\n        }\n      },\n      disableDragAndDrop: true,\n      toolbarContainer: '#' + this.reportId + '-toolbar',\n      callbacks: {\n        onBlur: function () {\n          $(this).summernote('saveRange');\n        }\n      }\n    };\n\n    this.$scope.$watch(() => {\n      return this.reportItem.content.content;\n    }, (newValue, oldValue) => {\n      if (newValue !== oldValue) {\n        this.dirty = true;\n      }\n    });\n\n    if (this.mode != \"classroomMonitor\") {\n      this.startAutoSaveInterval();\n    }\n  }\n\n  getItemNodeId() {\n    if (this.item == null) {\n      return null;\n    } else {\n      return this.item.nodeId;\n    }\n  }\n\n  getItemNodePositionAndTitle() {\n    if (this.item == null) {\n      return \"\";\n    } else {\n      return this.ProjectService.getNodePositionAndTitleByNodeId(this.item.nodeId);\n    }\n  }\n\n  getTemplateUrl() {\n    return this.templateUrl;\n  }\n\n  addNotebookItemContent(ev) {\n    let notebookItems = this.NotebookService.getNotebookByWorkgroup(this.workgroupId).items;\n    let templateUrl = this.themePath + '/notebook/notebookItemChooser.html';\n    let reportTextareaCursorPosition = angular.element('textarea.report').prop(\"selectionStart\"); // insert the notebook item at the cursor position later\n    let $reportElement = $('#' + this.reportId);\n\n    this.$mdBottomSheet.show({\n      parent: angular.element(document.body),\n      templateUrl: templateUrl,\n      locals: {\n        notebookItems: notebookItems,\n        reportItem: this.reportItem,\n        reportTextareaCursorPosition: reportTextareaCursorPosition,\n        themePath: this.themePath,\n        notebookConfig: this.notebookConfig\n      },\n      controller: NotebookItemChooserController,\n      controllerAs: 'notebookItemChooserController',\n      bindToController: true\n    });\n\n    function NotebookItemChooserController($mdBottomSheet, $scope, notebookItems, reportItem, reportTextareaCursorPosition, themePath) {\n      $scope.notebookItems = notebookItems;\n      $scope.reportItem = reportItem;\n      $scope.reportTextareaCursorPosition = reportTextareaCursorPosition;\n      $scope.themePath = themePath;\n      $scope.chooseNotebookItem = (notebookItem) => {\n        let $item = $('<div></div>').css('text-align', 'center');\n        if (notebookItem.content && notebookItem.content.attachments) {\n          for (let a = 0; a < notebookItem.content.attachments.length; a++) {\n            let notebookItemAttachment = notebookItem.content.attachments[a];\n            let $img = $('<img src=\"' + notebookItemAttachment.iconURL + '\" alt=\"notebook image\" style=\"width: 75%; max-width: 100%; height: auto; border: 1px solid #aaaaaa; padding: 8px; margin-bottom: 4px;\" />');\n            $img.addClass('notebook-item--report__note-img');\n            $item.append($img);\n          }\n        }\n        if (notebookItem.content && notebookItem.content.text) {\n          let $caption = $('<div><b>' + notebookItem.content.text + '</b></div>').css({'text-align': 'center'});\n          $item.append($caption);\n        }\n\n        $reportElement.summernote('focus');\n        $reportElement.summernote('restoreRange');\n        $reportElement.summernote('insertNode', $item[0]);\n        $mdBottomSheet.hide();\n      };\n    }\n\n    NotebookItemChooserController.$inject = [\"$mdBottomSheet\", \"$scope\", \"notebookItems\", \"reportItem\", \"reportTextareaCursorPosition\", \"themePath\"];\n  }\n\n  startAutoSaveInterval() {\n    this.stopAutoSaveInterval();\n    this.autoSaveIntervalId = setInterval(() => {\n      if (this.dirty) {\n        this.saveNotebookReportItem();\n      }\n    }, this.autoSaveInterval);\n  };\n\n  stopAutoSaveInterval() {\n    clearInterval(this.autoSaveIntervalId);\n  };\n\n  saveNotebookReportItem() {\n    // save new report notebook item\n    this.reportItem.content.clientSaveTime = Date.parse(new Date());  // set save timestamp\n    this.reportItem.id = null;  // set the id to null so it can be inserted as initial version, as opposed to updated. this is true for both new and just-loaded reports.\n\n    this.NotebookService.saveNotebookItem(this.reportItem.id, this.reportItem.nodeId, this.reportItem.localNotebookItemId,\n      this.reportItem.type, this.reportItem.title, this.reportItem.content, this.reportItem.groups, this.reportItem.content.clientSaveTime)\n      .then((result) => {\n        if (result) {\n          this.dirty = false;\n          this.reportItem.id = result.id; // set the reportNotebookItemId to the newly-incremented id so that future saves during this visit will be an update instead of an insert.\n          let serverSaveTime = result.serverSaveTime;\n          let clientSaveTime = this.ConfigService.convertToClientTimestamp(serverSaveTime);\n          this.setSavedMessage(clientSaveTime);\n        }\n      });\n  }\n\n  /**\n   * Account for potential vertical scrollbar on Notebook content and set\n   * fixed rich text toolbar location accordingly\n   */\n  setEditorPosition(distance, elem, edge) {\n    let scrollBarWidth = document.body.clientWidth - angular.element(document.querySelector('#notebook')).outerWidth(true);\n    elem.find('.notebook-item--report__toolbar').css('right', scrollBarWidth);\n  }\n\n  setSavedMessage(time) {\n    this.setSaveText(this.$translate('SAVED'), time);\n  }\n\n  /**\n   * Set the message next to the save button\n   * @param message the message to display\n   * @param time the time to display\n   */\n  setSaveText(message, time) {\n    this.saveMessage.text = message;\n    this.saveMessage.time = time;\n  }\n\n  reportItemContentChanged() {\n    /*\n     * remove the absolute asset paths\n     * e.g.\n     * <img src='https://wise.berkeley.edu/curriculum/3/assets/sun.png'/>\n     * will be changed to\n     * <img src='sun.png'/>\n     */\n    this.reportItem.content.content = this.ConfigService.removeAbsoluteAssetPaths(this.reportItemContent);\n  }\n\n  print() {\n    let content = this.reportItem.content.content;\n    let windowString =\n      \"<html>\" +\n      \"<head>\" +\n      \"<link rel='stylesheet' href='../wise5/lib/bootstrap/css/bootstrap.min.css'>\" +\n      \"<link rel='stylesheet' href='../wise5/themes/default/style/monitor.css'>\" +\n      \"<link rel='stylesheet' href='../wise5/themes/default/style/angular-material.css'>\" +\n      \"<link rel='stylesheet' href='../wise5/lib/summernote/dist/summernote.css'>\" +\n      \"<script>window.addEventListener('load', function() { window.print(); window.close(); });</script>\" +\n      \"</html>\" +\n      \"<body style='background-color: #ffffff;'>\" +\n      \"<div class='md-padding'>\" + content + \"</div>\" +\n      \"</body>\" +\n      \"</html>\";\n\n    let w = window.open('', '');\n    w.document.write(windowString);\n    w.document.close();\n  }\n}\n\nNotebookItemReportController.$inject = [\n  \"$injector\",\n  '$mdBottomSheet',\n  \"$rootScope\",\n  \"$scope\",\n  \"$filter\",\n  \"ConfigService\",\n  \"NotebookService\",\n  \"ProjectService\",\n  \"StudentAssetService\",\n  \"StudentDataService\"\n];\n\nexport default NotebookItemReportController;\n"]}