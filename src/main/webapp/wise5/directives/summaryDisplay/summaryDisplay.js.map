{"version":3,"sources":["summaryDisplay.es6"],"names":["SummaryDisplayController","$filter","$injector","$q","ConfigService","ProjectService","$translate","dataService","chartType","mode","getMode","isPreview","get","renderDisplay","$onChanges","changes","summaryComponent","getComponentByNodeIdAndComponentId","nodeId","componentId","getComponentStates","periodId","then","componentStates","processComponentStates","clearChartConfig","chartConfig","options","legend","enabled","exporting","credits","isVLEPreview","getDummyStudentWorkForVLEPreview","isAuthoringPreview","getDummyStudentWorkForAuthoringPreview","isStudentRun","getClassmateStudentWork","isClassroomMonitor","retrieveStudentDataByNodeIdAndComponentIdAndPeriodId","createDummyClassmateStudentWork","componentState","getLatestComponentStateByNodeIdAndComponentId","push","resolveComponentStates","deferred","defer","setTimeout","resolve","promise","component","choices","dummyComponentStates","dummyCounter","createDummyComponentState","studentData","studentChoices","id","getRandomChoice","Math","floor","random","length","summaryData","createSummaryData","createSeriesData","data","total","series","createSeries","title","xAxisType","createChartConfig","numResponses","totalWorkgroups","getTotalWorkgroups","percentResponded","getPercentResponded","numComponentStates","numWorkgroups","getNumberOfWorkgroupsInPeriod","max","choice","createChoiceSummaryData","text","isCorrect","addComponentStateDataToSummaryData","count","incrementSummaryData","chart","type","tooltip","formatter","s","point","key","round","y","xAxis","yAxis","plotOptions","pie","dataLabels","format","hasCorrectness","hasCorrectAnswer","getSummaryDataCount","color","getDataPointColor","dataPoint","createDataPoint","name","$inject","SummaryDisplay","bindings","templateUrl","controller","controllerAs"],"mappings":"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","sourcesContent":["'use strict';\n\nclass SummaryDisplayController {\n  constructor($filter, $injector, $q, ConfigService, ProjectService) {\n    this.$filter = $filter;\n    this.$injector = $injector;\n    this.$q = $q;\n    this.ConfigService = ConfigService;\n    this.ProjectService = ProjectService;\n    this.$translate = this.$filter('translate');\n    this.dataService = null;\n    if (this.chartType == null) {\n      this.chartType = 'column';\n    }\n    const mode = this.ConfigService.getMode();\n    if (this.ConfigService.isPreview() || mode === 'studentRun') {\n      this.dataService = this.$injector.get('StudentDataService');\n    } else if (mode === 'classroomMonitor' || mode === 'author') {\n      this.dataService = this.$injector.get('TeacherDataService'); \n    }\n    this.renderDisplay();\n    if (mode === 'author') {\n      this.$onChanges = (changes) => {\n        this.renderDisplay();\n      }\n    }\n  }\n\n  renderDisplay() {\n    const summaryComponent = \n        this.ProjectService.getComponentByNodeIdAndComponentId(this.nodeId, this.componentId);\n    if (summaryComponent != null) {\n      this.getComponentStates(this.nodeId, this.componentId, this.periodId)\n          .then((componentStates = []) => {\n        this.processComponentStates(componentStates);\n      });\n    } else {\n      this.clearChartConfig();\n    }\n  }\n\n  clearChartConfig() {\n    this.chartConfig = {\n      options: {\n        legend: {\n          enabled: false\n        },\n        exporting: {\n          enabled: false\n        },\n        credits: {\n          enabled: false\n        }\n      }\n    };\n  }\n\n  getComponentStates(nodeId, componentId, periodId) {\n    if (this.isVLEPreview()) {\n      return this.getDummyStudentWorkForVLEPreview(nodeId, componentId);\n    } else if (this.isAuthoringPreview()) {\n      return this.getDummyStudentWorkForAuthoringPreview(nodeId, componentId);\n    } else if (this.isStudentRun()) {\n      return this.dataService.getClassmateStudentWork(nodeId, componentId, periodId);\n    } else if (this.isClassroomMonitor()) {\n      return this.dataService.retrieveStudentDataByNodeIdAndComponentIdAndPeriodId(\n          nodeId, componentId, periodId);\n    }\n  }\n\n  isVLEPreview() {\n    return this.ConfigService.isPreview();\n  }\n\n  isAuthoringPreview() {\n    return this.ConfigService.getMode() === 'author';\n  }\n\n  isStudentRun() {\n    return this.ConfigService.getMode() === 'studentRun';\n  }\n\n  isClassroomMonitor() {\n    return this.ConfigService.getMode() === 'classroomMonitor';\n  }\n\n  getDummyStudentWorkForVLEPreview(nodeId, componentId) {\n    const componentStates = this.createDummyClassmateStudentWork();\n    const componentState = this.dataService\n        .getLatestComponentStateByNodeIdAndComponentId(nodeId, componentId);\n    if (componentState != null) {\n      componentStates.push(componentState);\n    }\n    return this.resolveComponentStates(componentStates);\n  }\n\n  getDummyStudentWorkForAuthoringPreview() {\n    const componentStates = this.createDummyClassmateStudentWork();\n    return this.resolveComponentStates(componentStates);\n  }\n\n  resolveComponentStates(componentStates) {\n    const deferred = this.$q.defer();\n    // We need to set a delay otherwise the graph won't render properly\n    setTimeout(() => {\n      deferred.resolve(componentStates);\n    }, 1);\n    return deferred.promise\n  }\n\n  createDummyClassmateStudentWork() {\n    const component = this.ProjectService.getComponentByNodeIdAndComponentId(\n        this.nodeId, this.componentId);\n    const choices = component.choices;\n    const dummyComponentStates = [];\n    for (let dummyCounter = 0; dummyCounter < 20; dummyCounter++) {\n      dummyComponentStates.push(this.createDummyComponentState(choices));\n    }\n    return dummyComponentStates;\n  }\n\n  createDummyComponentState(choices) {\n    return {\n      studentData: {\n        studentChoices: [\n          { id: this.getRandomChoice(choices).id }\n        ]\n      }\n    }; \n  }\n  \n  getRandomChoice(choices) {\n    return choices[Math.floor(Math.random() * choices.length)];\n  }\n\n  processComponentStates(componentStates) {\n    const component = this.ProjectService.getComponentByNodeIdAndComponentId(\n        this.nodeId, this.componentId);\n    const summaryData = this.createSummaryData(component, componentStates);\n    const { data, total } = this.createSeriesData(component, summaryData);\n    const series = this.createSeries(data);\n    const chartType = this.chartType;\n    const title = this.$translate('CLASS_RESULTS');\n    const xAxisType = 'category';\n    this.chartConfig =  this.createChartConfig(chartType, title, xAxisType, total, series);\n    this.numResponses = componentStates.length;\n    this.totalWorkgroups = this.getTotalWorkgroups(componentStates);\n    this.percentResponded = this.getPercentResponded(this.numResponses, this.totalWorkgroups);\n  }\n\n  getTotalWorkgroups(componentStates) {\n    const numComponentStates = componentStates.length;\n    if (this.ConfigService.isPreview() || this.ConfigService.getMode() === 'author') {\n      return numComponentStates;\n    } else {\n      const numWorkgroups = this.ConfigService.getNumberOfWorkgroupsInPeriod(this.periodId);\n      return Math.max(numWorkgroups, numComponentStates);\n    }\n  }\n\n  getPercentResponded(numResponses, totalWorkgroups) {\n    return Math.floor(100 * numResponses / totalWorkgroups);\n  }\n\n  createSummaryData(component, componentStates) {\n    const summaryData = {};\n    for (const choice of component.choices) {\n      summaryData[choice.id] = this.createChoiceSummaryData(\n          choice.id, choice.text, choice.isCorrect);\n    }\n    for (const componentState of componentStates) {\n      this.addComponentStateDataToSummaryData(summaryData, componentState);\n    }\n    return summaryData;\n  }\n\n  createChoiceSummaryData(id, text, isCorrect) {\n    return {\n      id: id,\n      text: text,\n      isCorrect: isCorrect,\n      count: 0\n    };\n  }\n\n  addComponentStateDataToSummaryData(summaryData, componentState) {\n    for (const choice of componentState.studentData.studentChoices) {\n      this.incrementSummaryData(summaryData, choice.id);\n    }\n  }\n\n  incrementSummaryData(summaryData, id) {\n    summaryData[id].count += 1;\n  }\n\n  getSummaryDataCount(summaryData, id) {\n    return summaryData[id].count;\n  }\n\n  createChartConfig(chartType, title, xAxisType, total, series) {\n    const chartConfig = {\n      options: {\n        chart: {\n          type: chartType\n        },\n        legend: {\n          enabled: false\n        },\n        tooltip: {\n          formatter: function(s, point) {\n            return this.key + ': ' + Math.round(100 * this.y / total) + '%';\n          }\n        },\n        exporting: {\n          enabled: false\n        },\n        credits: {\n          enabled: false\n        }\n      },\n      title: {\n        text: title\n      },\n      xAxis: {\n        type: xAxisType\n      },\n      yAxis: {\n        title: {\n          text: this.$translate('COUNT')\n        }\n      },\n      series: series\n    };\n    if (chartType === 'pie') {\n      chartConfig.options.plotOptions = {\n        pie: {\n          dataLabels: {\n            enabled: true,\n            format: '<br>{point.name}</b>: {point.y}'\n          }\n        }\n      };\n    }\n    return chartConfig;\n  }\n\n  hasCorrectAnswer(component) {\n    for (const choice of component.choices) {\n      if (choice.isCorrect) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  createSeriesData(component, summaryData) {\n    const data = [];\n    let total = 0;\n    const hasCorrectness = this.hasCorrectAnswer(component);\n    for (const choice of component.choices) {\n      const count = this.getSummaryDataCount(summaryData, choice.id);\n      total += count;\n      const color = this.getDataPointColor(choice, hasCorrectness);\n      const dataPoint = this.createDataPoint(choice.text, count, color);\n      data.push(dataPoint);\n    }\n    return { data: data, total: total };\n  }\n\n  getDataPointColor(choice, hasCorrectness) {\n    let color = null;\n    if (hasCorrectness) {\n      if (choice.isCorrect) {\n        color = 'green';\n      } else {\n        color = 'red';\n      }\n    }\n    return color;\n  }\n  \n  createDataPoint(name, y, color) {\n    return {\n      name: name,\n      y: y,\n      color: color\n    };\n  }\n\n  createSeries(data) {\n    return [{\n      data: data,\n      dataLabels: {\n        enabled: true\n      }\n    }];\n  }\n}\n\nSummaryDisplayController.$inject = [\n  '$filter',\n  '$injector',\n  '$q',\n  'ConfigService',\n  'ProjectService',\n  'StudentDataService'\n];\n\nconst SummaryDisplay = {\n  bindings: {\n    nodeId: '<',\n    componentId: '<',\n    periodId: '<',\n    chartType: '<'\n  },\n  templateUrl: 'wise5/directives/summaryDisplay/summaryDisplay.html',\n  controller: SummaryDisplayController,\n  controllerAs: 'summaryDisplayCtrl'\n}\n\nexport default SummaryDisplay;"],"file":"summaryDisplay.js"}