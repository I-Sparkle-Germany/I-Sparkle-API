{"version":3,"sources":["nodeController.es6"],"names":[],"mappings":"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","file":"nodeController.js","sourcesContent":["class NodeController {\n    constructor($rootScope,\n                $scope,\n                ConfigService,\n                NodeService,\n                NotebookService,\n                ProjectService,\n                StudentDataService) {\n\n        this.$rootScope = $rootScope;\n        this.$scope = $scope;\n        this.ConfigService = ConfigService;\n        this.NodeService = NodeService;\n        this.NotebookService = NotebookService;\n        this.ProjectService = ProjectService;\n        this.StudentDataService = StudentDataService;\n\n        // the auto save interval in milliseconds\n        this.autoSaveInterval = 60000;\n\n        // the node id of the current node\n        this.nodeId = null;\n\n        // field that will hold the node content\n        this.nodeContent = null;\n\n        // field that will hold the node status\n        this.nodeStatus = null;\n\n        // field that will hold the node title\n        this.nodeTitle = null;\n\n        // whether the student work is dirty and needs saving\n        this.isDirty = false;\n\n        this.workgroupId = this.ConfigService.getWorkgroupId();\n\n        this.teacherWorkgroupId = this.ConfigService.getTeacherWorkgroupId();\n\n        /*\n         * an object that holds the mappings with the key being the component\n         * and the value being the scope object from the child controller\n         */\n        this.$scope.componentToScope = {};\n        this.notebookOpen = false;\n\n        this.saveMessage = {\n            text: '',\n            time: ''\n        };\n\n        // perform setup of this node only if the current node is not a group.\n        if (this.StudentDataService.getCurrentNode() && this.ProjectService.isApplicationNode(this.StudentDataService.getCurrentNodeId())) {\n            // get the current node and node id\n            var currentNode = this.StudentDataService.getCurrentNode();\n            if (currentNode != null) {\n                this.nodeId = currentNode.id;\n            }\n\n            // get the node content\n            this.nodeContent = this.ProjectService.getNodeById(this.nodeId);\n\n            this.nodeTitle = this.ProjectService.getNodeTitleByNodeId(this.nodeId);\n\n            this.nodeStatus = this.StudentDataService.nodeStatuses[this.nodeId];\n\n            // populate the student work into this node\n            //this.setStudentWork();\n\n            // check if we need to lock this node\n            this.calculateDisabled();\n\n            //this.importWork();\n\n            // tell the parent controller that this node has loaded\n            //this.nodeLoaded(this.nodeId);\n\n            // start the auto save interval\n            this.startAutoSaveInterval();\n\n            // register this controller to listen for the exit event\n            this.registerExitListener();\n\n            if (this.NodeService.hasTransitionLogic() && this.NodeService.evaluateTransitionLogicOn('enterNode')) {\n                this.NodeService.evaluateTransitionLogic();\n            }\n\n            // save nodeEntered event\n            var nodeId = this.nodeId;\n            var componentId = null;\n            var componentType = null;\n            var category = \"Navigation\";\n            var event = \"nodeEntered\";\n            var eventData = {};\n            eventData.nodeId = nodeId;\n            this.StudentDataService.saveVLEEvent(nodeId, componentId, componentType, category, event, eventData);\n        }\n\n        /**\n         * The function that child component controllers will call to register\n         * themselves with this node\n         * @param childScope the child scope object\n         * @param component the component content for the component\n         */\n        this.$scope.registerComponentController = function(childScope, component) {\n\n            if (this.$scope != null && component != null) {\n                // get the component id\n                var componentId = component.id;\n\n                // add the component id to child scope mapping\n                this.$scope.componentToScope[componentId] = childScope;\n            }\n        }.bind(this);\n\n        /**\n         * Listen for the componentSaveTriggered event which occurs when a\n         * component is requesting student data to be saved\n         */\n        this.$scope.$on('componentSaveTriggered', angular.bind(this, function(event, args) {\n            var isAutoSave = false;\n\n            if (args != null) {\n                var nodeId = args.nodeId;\n                var componentId = args.componentId;\n\n                if (nodeId != null && componentId != null) {\n                    if (this.nodeId == nodeId && this.nodeContainsComponent(componentId)) {\n                        /*\n                         * obtain the component states from the children and save them\n                         * to the server\n                         */\n                        this.createAndSaveComponentData(isAutoSave, componentId);\n                    }\n                }\n            }\n        }));\n\n        /**\n         * Listen for the componentSubmitTriggered event which occurs when a\n         * component is requesting student data to be submitted\n         */\n        this.$scope.$on('componentSubmitTriggered', angular.bind(this, function(event, args) {\n            var isAutoSave = false;\n\n            if (args != null) {\n                var nodeId = args.nodeId;\n                var componentId = args.componentId;\n\n                if (nodeId != null && componentId != null) {\n                    if (this.nodeId == nodeId && this.nodeContainsComponent(componentId)) {\n                        /*\n                         * obtain the component states from the children and save them\n                         * to the server\n                         */\n                        this.createAndSaveComponentData(isAutoSave, componentId);\n                    }\n                }\n            }\n        }));\n\n        /**\n         * Listen for the componentStudentDataChanged event that will come from\n         * child component scopes\n         * @param event\n         * @param args the arguments provided when the event is fired\n         */\n        this.$scope.$on('componentStudentDataChanged', angular.bind(this, function(event, args) {\n            /*\n             * the student data in one of our child scopes has changed so\n             * we will need to save\n             */\n            this.isDirty = true;\n            this.setSaveMessage('');\n\n            if (args != null) {\n\n                // get the part id\n                var componentId = args.componentId;\n\n                // get the new component state\n                var componentState = args.componentState;\n\n                if (componentId != null && componentState != null) {\n\n                    /*\n                     * notify the parts that are connected that the student\n                     * data has changed\n                     */\n                    this.notifyConnectedParts(componentId, componentState);\n                }\n            }\n        }));\n\n        /**\n         * Listen for the 'exitNode' event which is fired when the student\n         * exits the node. This will perform saving when the student exits\n         * the node.\n         */\n        this.$scope.$on('exitNode', angular.bind(this, function(event, args) {\n\n            // get the node that is exiting\n            var nodeToExit = args.nodeToExit;\n\n            /*\n             * make sure the node id of the node that is exiting is\n             * this node\n             */\n            if (nodeToExit.id === this.nodeId) {\n                var saveTriggeredBy = 'exitNode';\n\n                // stop the auto save interval for this node\n                this.stopAutoSaveInterval();\n\n                /*\n                 * tell the parent that this node is done performing\n                 * everything it needs to do before exiting\n                 */\n                this.nodeUnloaded(this.nodeId);\n\n                // check if this node has transition logic that should be run when the student exits the node\n                if (this.NodeService.hasTransitionLogic() && this.NodeService.evaluateTransitionLogicOn('exitNode')) {\n                    // this node has transition logic\n                    this.NodeService.evaluateTransitionLogic();\n                }\n            }\n        }));\n    }\n\n    /**\n     * Populate the student work into the node\n     */\n    setStudentWork() {\n\n    };\n\n    /**\n     * Import work from another node\n     */\n    importWork() {\n\n    };\n\n    /**\n     * Returns all the revisions made by this user for the specified component\n     */\n    getRevisions(componentId) {\n        var revisions = [];\n        // get the component states for this component\n        var componentStates = this.StudentDataService.getComponentStatesByNodeIdAndComponentId(this.nodeId, componentId);\n        return componentStates;\n    };\n\n    showRevisions($event, componentId, isComponentDisabled) {\n        var revisions = this.getRevisions(componentId);\n        var allowRevert = !isComponentDisabled;\n\n        // get the scope for the component\n        var childScope = this.$scope.componentToScope[componentId];\n\n        // TODO: generalize for other controllers\n        var componentController = null;\n\n        if (childScope.openResponseController) {\n            componentController = childScope.openResponseController;\n        } else if (childScope.drawController) {\n            componentController = childScope.drawController;\n        }\n\n        // broadcast showRevisions event\n        this.$rootScope.$broadcast('showRevisions', {revisions: revisions, componentController: componentController, allowRevert: allowRevert, $event: $event});\n    };\n\n    showNotebook($event, componentId) {\n\n        // get the scope for the component\n        var childScope = this.$scope.componentToScope[componentId];\n\n        // TODO: generalize for other controllers\n        var componentController = null;\n\n        if (childScope.openResponseController) {\n            componentController = childScope.openResponseController;\n        } else if (childScope.drawController) {\n            componentController = childScope.drawController;\n        } else if (childScope.discussionController) {\n            componentController = childScope.discussionController;\n        } else if (childScope.tableController) {\n            componentController = childScope.tableController;\n        } else if (childScope.graphController) {\n            componentController = childScope.graphController;\n        }\n\n        // TODO: support filtering by notebook item type/filetype\n        var notebookFilters = [{'name': 'files', 'label': 'Files'}];\n\n        this.$rootScope.$broadcast('showNotebook', {componentController: componentController, notebookFilters: notebookFilters, $event: $event});\n    };\n\n    /**\n     * Called when the student clicks the save button\n     */\n    saveButtonClicked() {\n\n        // notify the child components that the save button was clicked\n        this.$rootScope.$broadcast('nodeSaveClicked', {nodeId: this.nodeId});\n\n        var isAutoSave = false;\n\n        /*\n         * obtain the component states from the children and save them\n         * to the server\n         */\n        this.createAndSaveComponentData(isAutoSave);\n    };\n\n    /**\n     * Called when the student clicks the submit button\n     */\n    submitButtonClicked() {\n\n        // notify the child components that the submit button was clicked\n        this.$rootScope.$broadcast('nodeSubmitClicked', {nodeId: this.nodeId});\n\n        var isAutoSave = false;\n\n        /*\n         * obtain the component states from the children and save them\n         * to the server\n         */\n        this.createAndSaveComponentData(isAutoSave);\n    };\n\n    /**\n     * Check if we need to lock the node\n     */\n    calculateDisabled() {\n\n        var nodeId = this.nodeId;\n\n        // get the node content\n        var nodeContent = this.nodeContent;\n\n        if (nodeContent) {\n            var lockAfterSubmit = nodeContent.lockAfterSubmit;\n\n            if (lockAfterSubmit) {\n                // we need to lock the step after the student has submitted\n\n                // get the component states for the node\n                var componentStates = this.StudentDataService.getComponentStatesByNodeId(nodeId);\n\n                // check if any of the component states were submitted\n                var isSubmitted = this.NodeService.isWorkSubmitted(componentStates);\n\n                if (isSubmitted) {\n                    // the student has submitted work for this node\n                    this.isDisabled = true;\n                }\n            }\n        }\n    };\n\n    /**\n     * Get the components for this node.\n     * @return an array that contains the content for the components\n     */\n    getComponents() {\n        var components = null;\n\n        if (this.nodeContent != null) {\n            components = this.nodeContent.components;\n        }\n\n        if (components != null && this.isDisabled) {\n            for (var c = 0; c < components.length; c++) {\n                var component = components[c];\n\n                component.isDisabled = true;\n            }\n        }\n\n        if (components != null && this.nodeContent.lockAfterSubmit) {\n            for (c = 0; c < components.length; c++) {\n                component = components[c];\n\n                component.lockAfterSubmit = true;\n            }\n        }\n\n        return components;\n    };\n\n    /**\n     * Get the component given the component id\n     * @param componentId the component id we want\n     * @return the component object with the given component id\n     */\n    getComponentById(componentId) {\n\n        var component = null;\n\n        if (componentId != null) {\n\n            // get all the components\n            var components = this.getComponents();\n\n            // loop through all the components\n            for (var c = 0; c < components.length; c++) {\n\n                // get a component\n                var tempComponent = components[c];\n\n                if (tempComponent != null) {\n                    var tempComponentId = tempComponent.id;\n\n                    // check if the component id matches the one we want\n                    if (tempComponentId === componentId) {\n                        // the component id matches\n                        component = tempComponent;\n                        break;\n                    }\n                }\n            }\n        }\n\n        return component;\n    };\n\n    /**\n     * Check if this node contains a given component id\n     * @param componentId the component id\n     * @returns whether this node contains the component\n     */\n    nodeContainsComponent(componentId) {\n        var result = false;\n\n        if (componentId != null) {\n\n            // get all the components\n            var components = this.getComponents();\n\n            // loop through all the components\n            for (var c = 0; c < components.length; c++) {\n\n                // get a component\n                var tempComponent = components[c];\n\n                if (tempComponent != null) {\n                    var tempComponentId = tempComponent.id;\n\n                    // check if the component id matches the one we want\n                    if (tempComponentId === componentId) {\n                        // the component id matches\n                        result = true;\n                        break;\n                    }\n                }\n            }\n        }\n\n        return result;\n    };\n\n    /**\n     * Get the html template for the component\n     * @param componentType the component type\n     * @return the path to the html template for the component\n     */\n    getComponentTemplatePath(componentType) {\n        return this.NodeService.getComponentTemplatePath(componentType);\n    };\n\n    /**\n     * Check whether we need to show the save button\n     * @return whether to show the save button\n     */\n    showSaveButton() {\n        var result = false;\n\n        if (this.nodeContent != null && this.nodeContent.showSaveButton) {\n            result = true;\n        }\n\n        return result;\n    };\n\n    /**\n     * Check whether we need to show the submit button\n     * @return whether to show the submit button\n     */\n    showSubmitButton() {\n        var result = false;\n\n        if (this.nodeContent != null && this.nodeContent.showSubmitButton) {\n            result = true;\n        }\n\n        return result;\n    };\n\n    /**\n     * Check whether we need to lock the component after the student\n     * submits an answer.\n     */\n    isLockAfterSubmit() {\n        var result = false;\n\n        if (this.componentContent != null) {\n\n            // check the lockAfterSubmit field in the component content\n            if (this.componentContent.lockAfterSubmit) {\n                result = true;\n            }\n        }\n\n        return result;\n    };\n\n    /**\n     * Set the message next to the save button\n     * @param message the message to display\n     */\n    setSaveMessage(message) {\n        this.saveMessage.text = message;\n        this.saveMessage.time = new Date();\n    };\n\n    /**\n     * Start the auto save interval for this node\n     */\n    startAutoSaveInterval() {\n        this.autoSaveIntervalId = setInterval(angular.bind(this, function() {\n            // check if the student work is dirty\n            if (this.isDirty) {\n                // the student work is dirty so we will save\n\n                var isAutoSave = true;\n\n                /*\n                 * obtain the component states from the children and save them\n                 * to the server\n                 */\n                this.createAndSaveComponentData(isAutoSave);\n                //this.setSaveMessage('Auto-Saved');\n            }\n        }), this.autoSaveInterval);\n    };\n\n    /**\n     * Stop the auto save interval for this node\n     */\n    stopAutoSaveInterval() {\n        clearInterval(this.autoSaveIntervalId);\n    };\n\n    /**\n     * Obtain the componentStates and annotations from the children and save them\n     * to the server\n     * @param isAutoSave whether the component states were auto saved\n     * @param componentId (optional) the component id of the component\n     * that triggered the save\n     */\n    createAndSaveComponentData(isAutoSave, componentId) {\n\n        // obtain the component states from the children\n        var componentStates = this.createComponentStates(isAutoSave, componentId);\n        var componentAnnotations = this.getComponentAnnotations();\n        var componentEvents = null;\n        var nodeStates = null;\n\n        if (this.ConfigService.getConfigParam('mode') === 'preview') {\n            // we are in preview mode so we will pretend that the data was saved to the server\n\n            this.isDirty = false;\n\n            if (isAutoSave) {\n                this.setSaveMessage('Auto-Saved');\n            } else {\n                this.setSaveMessage('Saved');\n            }\n        }\n\n        if ((componentStates != null && componentStates.length > 0) ||\n            (componentAnnotations != null && componentAnnotations.length > 0) ||\n            (componentEvents != null && componentEvents.length > 0)) {\n            // save the component states to the server\n            return this.StudentDataService.saveToServer(componentStates, nodeStates, componentEvents, componentAnnotations).then(angular.bind(this, function(savedStudentDataResponse) {\n                // check if this node has transition logic that should be run when the student data changes\n                if (this.NodeService.hasTransitionLogic() && this.NodeService.evaluateTransitionLogicOn('studentDataChanged')) {\n                    // this node has transition logic\n                    this.NodeService.evaluateTransitionLogic();\n                }\n\n                // TODO: handle error response from server if POST fails\n                this.isDirty = false;\n\n                if (isAutoSave) {\n                    this.setSaveMessage('Auto-Saved');\n                } else {\n                    this.setSaveMessage('Saved');\n                }\n\n                return savedStudentDataResponse;\n            }));\n        }\n    };\n\n    /**\n     * Loop through this node's components and get/create component states\n     * @param isAutoSave whether the component states were auto saved\n     * @param componentId (optional) the component id of the component\n     * that triggered the save\n     * @returns an array of component states\n     */\n    createComponentStates(isAutoSave, componentId) {\n        var componentStates = [];\n\n        // get the components for this node\n        var components = this.getComponents();\n\n        if (components != null) {\n\n            var runId = this.ConfigService.getRunId();\n            var periodId = this.ConfigService.getPeriodId();\n            var workgroupId = this.ConfigService.getWorkgroupId();\n\n            // loop through all the components\n            for (var c = 0; c < components.length; c++) {\n\n                // get a component\n                var component = components[c];\n\n                if (component != null) {\n                    // get the component id\n                    var tempComponentId = component.id;\n\n                    // get the scope for the component\n                    var childScope = this.$scope.componentToScope[tempComponentId];\n\n                    if (childScope != null) {\n                        var componentState = null;\n\n                        if (childScope.getComponentState != null) {\n                            // get the student work object from the child scope\n                            componentState = childScope.getComponentState();\n                        }\n\n                        if (componentState != null) {\n\n                            componentState.runId = runId;\n                            componentState.periodId = periodId;\n                            componentState.workgroupId = workgroupId;\n                            componentState.nodeId = this.nodeId;\n\n                            // set the component id into the student work object\n                            componentState.componentId = tempComponentId;\n\n                            // set the component type\n                            componentState.componentType = component.type;\n\n                            if (componentId == null) {\n                                /*\n                                 * the node has triggered the save so all the components will\n                                 * either have isAutoSave set to true or false\n                                 */\n                                componentState.isAutoSave = isAutoSave;\n                            } else {\n                                /*\n                                 * a component has triggered the save so that component will\n                                 * have isAutoSave set to false but all other components will\n                                 * have isAutoSave set to true\n                                 */\n\n                                if (componentId === tempComponentId) {\n                                    // this component triggered the save\n                                    componentState.isAutoSave = false;\n                                } else {\n                                    // this component did not trigger the save\n                                    componentState.isAutoSave = true;\n                                }\n                            }\n\n                            // add the student work object to our components array\n                            componentStates.push(componentState);\n                        }\n                    }\n                }\n            }\n        }\n\n        return componentStates;\n    };\n\n    /**\n     * Loop through this node's components and get annotations\n     * @param isAutoSave whether the component states were auto saved\n     * @param componentId (optional) the component id of the component\n     * that triggered the save\n     * @returns an array of component states\n     */\n    getComponentAnnotations() {\n        var componentAnnotations = [];\n\n        // get the components for this node\n        var components = this.getComponents();\n\n        if (components != null) {\n\n            // loop through all the components\n            for (var c = 0; c < components.length; c++) {\n\n                // get a component\n                var component = components[c];\n\n                if (component != null) {\n                    // get the component id\n                    var tempComponentId = component.id;\n\n                    // get the scope for the component\n                    var childScope = this.$scope.componentToScope[tempComponentId];\n\n                    if (childScope != null) {\n\n                        var componentState = null;\n\n                        if (childScope.getUnSavedAnnotation != null) {\n                            // get the student work object from the child scope\n                            componentAnnotation = childScope.getUnSavedAnnotation();\n\n                            if (componentAnnotation != null) {\n                                // add the student work object to our components array\n                                componentAnnotations.push(componentAnnotation);\n\n                                childScope.setUnSavedAnnotation(null);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n\n        return componentAnnotations;\n    };\n\n    /**\n     * Notify any connected components that the student data has changed\n     * @param componentId the component id that has changed\n     * @param componentState the new component state\n     */\n    notifyConnectedParts(changedComponentId, componentState) {\n\n        if (changedComponentId != null && componentState != null) {\n\n            // get all the components\n            var components = this.getComponents();\n\n            if (components != null) {\n\n                /*\n                 * loop through all the components and look for components\n                 * that are listening for the given component id to change.\n                 * only notify components that are listening for changes\n                 * from the specific component id.\n                 */\n                for (var c = 0; c < components.length; c++) {\n\n                    // get a component\n                    var tempComponent = components[c];\n\n                    if (tempComponent != null) {\n\n                        // get this component id\n                        var tempComponentId = tempComponent.id;\n\n                        /*\n                         * get the connected components that this component is\n                         * listening for\n                         */\n                        var connectedComponents = tempComponent.connectedComponents;\n\n                        if (connectedComponents != null) {\n\n                            // loop through all the connected components\n                            for (var cc = 0; cc < connectedComponents.length; cc++) {\n\n                                // get a connected component\n                                var connectedComponentParams = connectedComponents[cc];\n\n                                if (connectedComponentParams != null) {\n\n                                    // get the connected component id\n                                    var connectedComponentId = connectedComponentParams.id;\n\n                                    // check if the component id matches the one that has changed\n                                    if (connectedComponentId === changedComponentId) {\n\n                                        var connectedComponent = this.getComponentById(connectedComponentId);\n\n                                        // get the scope for the listening component\n                                        var componentScope = this.$scope.componentToScope[tempComponentId];\n\n                                        // check if the listening component has a handler function\n                                        if (componentScope.handleConnectedComponentStudentDataChanged != null) {\n\n                                            // tell the listening part to handle the student data changing\n                                            componentScope.handleConnectedComponentStudentDataChanged(connectedComponent, connectedComponentParams, componentState);\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    };\n\n    /**\n     * Get the student data for a specific part\n     * @param the componentId\n     * @return the student data for the given component\n     */\n    getComponentStateByComponentId(componentId) {\n        var componentState = null;\n\n        if (componentId != null) {\n\n            // get the latest component state for the component\n            componentState = this.StudentDataService.getLatestComponentStateByNodeIdAndComponentId(this.nodeId, componentId);\n        }\n\n        return componentState;\n    };\n\n    /**\n     * Get the student data for a specific part\n     * @param the nodeId\n     * @param the componentId\n     * @return the student data for the given component\n     */\n    getComponentStateByNodeIdAndComponentId(nodeId, componentId) {\n        var componentState = null;\n\n        if (nodeId != null && componentId != null) {\n\n            // get the latest component state for the component\n            componentState = this.StudentDataService.getLatestComponentStateByNodeIdAndComponentId(nodeId, componentId);\n        }\n\n        return componentState;\n    };\n\n    nodeLoaded(nodeId) {\n        //var newNodeVisit = this.StudentDataService.createNodeVisit(nodeId);\n    };\n\n    nodeUnloaded(nodeId) {\n        var isAutoSave = true;\n\n        this.createAndSaveComponentData(isAutoSave);\n\n        // save nodeExited event\n        var componentId = null;\n        var componentType = null;\n        var category = \"Navigation\";\n        var event = \"nodeExited\";\n        var eventData = {};\n        eventData.nodeId = nodeId;\n        this.StudentDataService.saveVLEEvent(nodeId, componentId, componentType, category, event, eventData);\n    };\n\n    // saves current work and adds to notebook as needed\n    addStudentWorkItemToNotebook(componentId) {\n        var currentNode = this.StudentDataService.getCurrentNode();\n        if (currentNode != null) {\n            var currentNodeId = currentNode.id;\n\n            // get the scope for the component\n            var childScope = this.$scope.componentToScope[componentId];\n\n            if (childScope != null && childScope.isDirty()) {\n                // we need to save this component first before adding to notebook\n                var isAutoSave = false;\n\n                this.createAndSaveComponentData(isAutoSave, componentId).then(angular.bind(this, function(saveResult) {\n                    var currentComponentState = this.StudentDataService.getLatestComponentStateByNodeIdAndComponentId(currentNodeId, componentId);\n                    if (currentComponentState != null) {\n                        this.NotebookService.addStudentWorkNotebookItem(currentComponentState);\n                    }\n                }));\n            } else {\n                // no new data to save. Get the latest componentstate and add to notebook\n                var currentComponentState = this.StudentDataService.getLatestComponentStateByNodeIdAndComponentId(currentNodeId, componentId);\n                if (currentComponentState != null) {\n                    this.NotebookService.addStudentWorkNotebookItem(currentComponentState);\n                }\n            }\n        }\n    };\n\n    /**\n     * Register the the listener that will listen for the exit event\n     * so that we can perform saving before exiting.\n     */\n    registerExitListener() {\n        /**\n         * Listen for the 'exit' event which is fired when the student exits\n         * the VLE. This will perform saving before exiting.\n         */\n        this.logOutListener = this.$scope.$on('exit', angular.bind(this, function(event, args) {\n\n            // stop the auto save interval for this node\n            this.stopAutoSaveInterval();\n\n            /*\n             * tell the parent that this node is done performing\n             * everything it needs to do before exiting\n             */\n            this.nodeUnloaded(this.nodeId);\n\n            // call this function to remove the listener\n            this.logOutListener();\n\n            /*\n             * tell the session service that this listener is done\n             * performing everything it needs to do before exiting\n             */\n            this.$rootScope.$broadcast('doneExiting');\n        }));\n    };\n}\n\nNodeController.$inject = [\n    '$rootScope',\n    '$scope',\n    'ConfigService',\n    'NodeService',\n    'NotebookService',\n    'ProjectService',\n    'StudentDataService'\n];\n\nexport default NodeController;\n"]}