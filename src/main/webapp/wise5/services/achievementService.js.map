{"version":3,"sources":["achievementService.es6"],"names":["AchievementService","$http","$q","$rootScope","ConfigService","ProjectService","StudentDataService","UtilService","achievementsByWorkgroupId","debug","loadAchievements","str","console","log","workgroupId","type","isPreview","getWorkgroupId","Promise","resolve","achievementsURL","getAchievementsURL","config","method","url","params","getMode","periodId","getPeriodId","then","response","achievements","data","i","length","achievement","addOrUpdateAchievement","projectAchievement","getAchievementByAchievementId","achievementId","completed","deregisterFunction","debugOutput","id","projectAchievements","getAchievementItems","p","isAchievementCompleted","checkAchievement","studentCompletedAchievement","achievementWorkgroupId","Array","found","w","a","push","deferred","defer","promise","headers","angular","toJson","$","param","result","fromJson","getAchievements","isEnabled","projectAchievementItems","items","createNodeCompletedListener","createAggregateAchievementListener","getAchievementsByWorkgroupId","isVisible","alert","name","makeCopyOfJSONObject","newAchievement","createNewAchievement","saveAchievementToServer","$broadcast","thisAchievementService","thisAchievement","$on","event","args","nodeId","checkNodeCompletedAchievement","checkAggregateAchievement","nodeIds","n","isCompleted","achievementIds","tempAchievementId","achievementsByAchievementId","workgroupIds","getClassmateWorkgroupIds","achievementsForWorkgroup","achievementIdToAchievements","studentAchievements","getAchievementsByAchievementId","generateKey","$inject"],"mappings":"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","file":"achievementService.js","sourcesContent":["class AchievementService {\n  constructor($http, $q, $rootScope, ConfigService, ProjectService, StudentDataService, UtilService) {\n\n    this.$http = $http;\n    this.$q = $q;\n    this.$rootScope = $rootScope;\n    this.ConfigService = ConfigService;\n    this.ProjectService = ProjectService;\n    this.StudentDataService = StudentDataService;\n    this.UtilService = UtilService;\n    this.achievementsByWorkgroupId = {};  // an object of achievements, where key is workgroupId and value is the array of achievements for the workgroup.\n\n    // whether to print debug output to the console\n    this.debug = false;\n\n    // load the achievements in the project\n    this.loadAchievements();\n  }\n\n  /**\n   * Output the string to the console if debug=true\n   * @param str the string to output to the console\n   */\n  debugOutput(str) {\n    if (this.debug) {\n      console.log(str);\n    }\n  }\n\n  /**\n   * Retrieves achievements from the server\n   */\n  retrieveAchievements(workgroupId = null, type = null) {\n\n    if (this.ConfigService.isPreview()) {\n\n      // get the signed in workgroup id\n      var workgroupId = this.ConfigService.getWorkgroupId();\n\n      // initialize the achievements for the workgroup to an empty array\n      this.achievementsByWorkgroupId[workgroupId] = [];\n\n      return Promise.resolve(this.achievementsByWorkgroupId);\n    } else {\n      let achievementsURL = this.ConfigService.getAchievementsURL();\n\n      let config = {\n        method: \"GET\",\n        url: achievementsURL,\n        params: {}\n      };\n      if (workgroupId != null) {\n        config.params.workgroupId = workgroupId;\n      } else if (this.ConfigService.getMode() !== 'classroomMonitor') {\n        // get the achievements for the logged-in workgroup\n        config.params.workgroupId = this.ConfigService.getWorkgroupId();\n        config.params.periodId = this.ConfigService.getPeriodId();\n      }\n      if (type != null) {\n        config.params.type = type;\n      }\n\n      return this.$http(config).then((response) => {\n        let achievements = response.data;\n\n        if (achievements != null) {\n\n          // loop through all the student achievements\n          for (let i = 0; i < achievements.length; i++) {\n\n            // get a student achievement\n            let achievement = achievements[i];\n\n            // add the student achievement to our local data structure\n            this.addOrUpdateAchievement(achievement);\n\n            if (this.ConfigService.getMode() == 'studentRun') {\n\n              // get the project achievement object\n              var projectAchievement = this.ProjectService.getAchievementByAchievementId(achievement.achievementId);\n\n              if (projectAchievement != null) {\n\n                /*\n                 * set the completed field to true in case we ever\n                 * need to easily see which achievements the student\n                 * has completed\n                 */\n                projectAchievement.completed = true;\n\n                if (projectAchievement.deregisterFunction != null) {\n                  /*\n                   * the student has completed this achievement\n                   * so we no longer need to listen for it\n                   */\n                  projectAchievement.deregisterFunction();\n                  this.debugOutput('deregistering ' + projectAchievement.id);\n                }\n              }\n            }\n          }\n\n          if (this.ConfigService.getMode() == 'studentRun') {\n\n            /*\n             * Loop through all the project achievements and\n             * re-evaluate whether the student has completed each.\n             * This is to make sure students never get stuck in a\n             * state where they did everything required to complete\n             * a certain achievement but some error or bug occurred\n             * which prevented their student achievement from being\n             * saved and then they end up never being able to\n             * complete that achievement. We will avoid this\n             * situation by re-evaluating all the project\n             * achievements each time the student loads the VLE.\n             */\n\n            // get all the project achievements\n            var projectAchievements = this.ProjectService.getAchievementItems();\n\n            if (projectAchievements != null) {\n\n              // loop through all the project achievements\n              for (var p = 0; p < projectAchievements.length; p++) {\n                var projectAchievement = projectAchievements[p];\n\n                if (projectAchievement != null) {\n\n                  if (!this.isAchievementCompleted(projectAchievement.id)) {\n                    /*\n                     * the student has not completed this project achievement\n                     * yet\n                     */\n\n                    if (this.checkAchievement(projectAchievement)) {\n                      /*\n                       * the student has satisfied everything that is\n                       * required of the achievement\n                       */\n                      this.studentCompletedAchievement(projectAchievement);\n                    }\n                  }\n                }\n              }\n            }\n          }\n        } else {\n          this.achievementsByWorkgroupId = {};\n        }\n\n        return this.achievementsByWorkgroupId;\n      });\n    }\n  }\n\n  /**\n   * Add Achievement to local bookkeeping\n   * @param achievement the Achievement to add or update\n   */\n  addOrUpdateAchievement(achievement) {\n\n    if (achievement != null) {\n\n      // get the workgroup id\n      let achievementWorkgroupId = achievement.workgroupId;\n\n      /*\n       * initialize the workgroup's array of achievements if it does\n       * not exist yet\n       */\n      if (this.achievementsByWorkgroupId[achievementWorkgroupId] == null) {\n        this.achievementsByWorkgroupId[achievementWorkgroupId] = new Array();\n      }\n\n      // get the achievements the workgroup has completed\n      let achievements = this.achievementsByWorkgroupId[achievementWorkgroupId];\n\n      let found = false;\n\n      // loop through all the achievements this workgroup has completed\n      for (let w = 0; w < achievements.length; w++) {\n\n        // get an achievement the workgroup has compeleted\n        let a = achievements[w];\n\n        if (a.achievementId != null && a.achievementId === achievement.achievementId &&\n          a.workgroupId != null && a.workgroupId === achievement.workgroupId) {\n          /*\n           * the achievement 10 character alphanumeric id matches and\n           * the workgroup id matches so we will update it\n           */\n          achievements[w] = achievement;\n          found = true;  // remember this so we don't insert later.\n          break;\n        }\n      }\n\n      if (!found) {\n        // we did not find the achievement so we will add it to the array\n        achievements.push(achievement);\n      }\n    }\n  }\n\n  /**\n   * Saves the achievement for the logged-in user\n   * @param achievement\n   */\n  saveAchievementToServer(achievement) {\n\n    if (this.ConfigService.isPreview()) {\n      // if we're in preview, don't make any request to the server but pretend that we did\n      let deferred = this.$q.defer();\n      deferred.resolve(achievement);\n      return deferred.promise;\n\n    } else {\n\n      let config = {\n        method: \"POST\",\n        url: this.ConfigService.getAchievementsURL(),\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        }\n      };\n\n      let params = {\n        achievementId: achievement.achievementId,\n        workgroupId: achievement.workgroupId,\n        type: achievement.type\n      };\n      if (achievement.id != null) {\n        params.id = achievement.id;\n      }\n      if (achievement.data != null) {\n        params.data = angular.toJson(achievement.data);\n      }\n\n      config.data = $.param(params);\n\n      return this.$http(config).then((result) => {\n        let achievement = result.data;\n        if (achievement.data != null) {\n          // parse the data string into a JSON object\n          achievement.data = angular.fromJson(achievement.data);\n        }\n        this.addOrUpdateAchievement(achievement);\n        return achievement;\n      })\n    }\n  }\n\n  /**\n   * Creates a new achievement object\n   * @param type type of achievement [\"completion\", \"milestone\", etc]\n   * @param achievementId id of achievement in project content\n   * @param data other extra information about this achievement\n   * @param workgroupId id of workgroup whom this achievement is for\n   * @returns newly created achievement object\n   */\n  createNewAchievement(type, achievementId, data = null, workgroupId = null) {\n    if (workgroupId == null) {\n      workgroupId = this.ConfigService.getWorkgroupId();\n    }\n    return {\n      id: null,\n      type: type,\n      achievementId: achievementId,\n      workgroupId: workgroupId,\n      data: data\n    };\n  }\n\n  /**\n   * Load the achievements by creating listeners for the appropriate events\n   */\n  loadAchievements() {\n\n    var projectAchievements = this.ProjectService.getAchievements();\n\n    if (projectAchievements != null) {\n      if (projectAchievements.isEnabled) {\n\n        // get all the achievements in the project\n        var projectAchievementItems = projectAchievements.items;\n\n        if (projectAchievementItems != null) {\n\n          // loop through all the achievements in the project\n          for (var a = 0; a < projectAchievementItems.length; a++) {\n\n            var projectAchievement = projectAchievementItems[a];\n\n            if (projectAchievement != null) {\n\n              var deregisterFunction = null;\n\n              // create a listener for the achievement\n              if (projectAchievement.type == 'milestone' || projectAchievement.type == 'completion') {\n                deregisterFunction = this.createNodeCompletedListener(projectAchievement);\n              } else if (projectAchievement.type == 'aggregate') {\n                deregisterFunction = this.createAggregateAchievementListener(projectAchievement);\n              }\n\n              /*\n               * set the deregisterFunction into the project\n               * achievement so that we can deregister the\n               * listener after the student has completed the\n               * achievement\n               */\n              projectAchievement.deregisterFunction = deregisterFunction;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Check if the student has completed the achievement\n   * @param achievementId\n   * @return whether the student has completed the achievement\n   */\n  isAchievementCompleted(achievementId) {\n\n    if (achievementId != null) {\n\n      // get the student workgroup id\n      var workgroupId = this.ConfigService.getWorkgroupId();\n\n      // get all the achievements the student has completed\n      var achievements = this.getAchievementsByWorkgroupId(workgroupId);\n\n      if (achievements != null) {\n\n        // loop through all the achievements the student has completed\n        for (var a = 0; a < achievements.length; a++) {\n          var achievement = achievements[a];\n\n          if (achievement != null) {\n            if (achievement.achievementId == achievementId) {\n              /*\n               * we have found the achievement with the matching\n               * achievement id which means the student has\n               * completed the achievement\n               */\n              return true;\n            }\n          }\n        }\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * The student has just completed an achievement\n   * @param achievement the achievement the student completed\n   */\n  studentCompletedAchievement(achievement) {\n\n    if (achievement != null) {\n\n      if (achievement.isVisible == true) {\n        /*\n         * this is a visible achievement so we will display a message\n         * to the student\n         */\n        alert(\"Congratulations you completed: \" + achievement.name);\n        console.log(\"Congratulations you completed: \" + achievement.name);\n      }\n\n      // get the project achievement object\n      var projectAchievement = this.ProjectService.getAchievementByAchievementId(achievement.id);\n\n      if (projectAchievement != null && projectAchievement.deregisterFunction != null) {\n        /*\n         * deregister the achievement listener now that the student has\n         * completed the achievement\n         */\n        projectAchievement.deregisterFunction();\n        this.debugOutput('deregistering ' + projectAchievement.id);\n      }\n\n      /*\n       * create a copy of the achievement to make sure we don't cause\n       * any referencing problems in the future\n       */\n      var achievement = this.UtilService.makeCopyOfJSONObject(achievement);\n\n      // get the student workgroup id\n      var workgroupId = this.ConfigService.getWorkgroupId();\n\n      // get the parameters for creating an achievement\n      var type = achievement.type;\n      var id = achievement.id;\n      var data = achievement;\n\n      // create the student achievement\n      var newAchievement = this.createNewAchievement(type, id, data, workgroupId);\n\n      // get all the achievements the student has completed\n      var achievements = this.getAchievementsByWorkgroupId(workgroupId);\n\n      // add the achievement to the array of student completed achievements\n      achievements.push(newAchievement);\n\n      // save the new achievement to the server\n      this.saveAchievementToServer(newAchievement);\n\n      // fire an achievementCompleted event\n      this.$rootScope.$broadcast('achievementCompleted', { achievementId: achievement.id });\n    }\n  }\n\n  /**\n   * Create a listener for the node completed achievement\n   * @param achievement the achievement to listen for\n   * @return the deregister function for the listener\n   */\n  createNodeCompletedListener(achievement) {\n\n    // save this to a variable so that we can access it in the callback\n    var thisAchievementService = this;\n\n    // save the achievement to a variable so that we can access it in the callback\n    var thisAchievement = achievement;\n\n    this.debugOutput('registering ' + achievement.id);\n\n    // listen for the nodeCompleted event\n    var deregisterFunction = this.$rootScope.$on('nodeCompleted', (event, args) => {\n      /*\n       * the nodeCompleted event was fired so we will check if this\n       * achievement has been completed\n       */\n\n      var achievement = thisAchievement;\n\n      if (achievement != null) {\n        this.debugOutput('createNodeCompletedListener checking ' + achievement.id + ' completed ' + args.nodeId);\n\n        // get the id of the achievement we need to check\n        var id = achievement.id;\n\n        if (!this.isAchievementCompleted(id)) {\n          /*\n           * the student has not completed this achievement before\n           * so we will now check if they have completed it\n           */\n\n          // check if the student has completed this node completed achievement\n          var completed = this.checkNodeCompletedAchievement(achievement);\n\n          if (completed) {\n            // the student has just completed the achievement\n            thisAchievementService.studentCompletedAchievement(achievement);\n          }\n        }\n      }\n    });\n\n    return deregisterFunction;\n  }\n\n  /**\n   * Check if the student completed a specific achievement\n   * @param achievement an achievement\n   * @return whether the student completed the achievement\n   */\n  checkAchievement(achievement) {\n\n    var completed = false;\n\n    if (achievement != null) {\n      if (achievement.type == 'milestone' || achievement.type == 'completion') {\n        // this is a milestone or completion achievement\n        completed = this.checkNodeCompletedAchievement(achievement);\n      } else if (achievement.type == 'aggregate') {\n        // this is an aggregate achievement\n        completed = this.checkAggregateAchievement(achievement);\n      }\n    }\n\n    return completed;\n  }\n\n  /**\n   * Check if the student completed a node completed achievement\n   * @param achievement a node completed achievement\n   * @return whether the student completed the node completed achievement\n   */\n  checkNodeCompletedAchievement(achievement) {\n\n    var completed = false;\n\n    if (achievement != null) {\n\n      // get the achievement params\n      var params = achievement.params;\n\n      if (params != null) {\n\n        // get the node ids that need to be completed\n        var nodeIds = params.nodeIds;\n\n        /*\n         * loop through all the node ids that need to be completed\n         * for the achievement\n         */\n        for (var n = 0; n < nodeIds.length; n++) {\n          var nodeId = nodeIds[n];\n\n          if (n == 0) {\n            // this is the first node id\n            completed = this.StudentDataService.isCompleted(nodeId);\n          } else {\n            /*\n             * this is a node id after the first node id so\n             * we will use an and conditional\n             */\n            completed = completed && this.StudentDataService.isCompleted(nodeId);\n          }\n        }\n      }\n    }\n\n    return completed;\n  }\n\n  /**\n   * Create a listener for an aggregate achievement\n   * @param achievement the project achievement\n   * @return the deregister function for the listener\n   */\n  createAggregateAchievementListener(achievement) {\n\n    var thisAchievementService = this;\n    var thisAchievement = achievement;\n\n    this.debugOutput('registering ' + achievement.id);\n\n    // listen for the achievementCompleted event\n    var deregisterFunction = this.$rootScope.$on('achievementCompleted', (event, args) => {\n      /*\n       * the achievementCompleted event was fired so we will check if this\n       * achievement has been completed\n       */\n\n      var achievement = thisAchievement;\n\n      if (achievement != null) {\n        this.debugOutput('createAggregateAchievementListener checking ' + achievement.id + ' completed ' + args.achievementId);\n\n        // get the id of the achievement we need to check\n        var id = achievement.id;\n\n        // the achievement that was just completed\n        var achievementId = args.achievementId;\n\n        if (!this.isAchievementCompleted(id)) {\n          /*\n           * the student has not completed this achievement before\n           * so we will now check if they have completed it\n           */\n\n          // check if the student has completed this aggregate achievement\n          var completed = this.checkAggregateAchievement(achievement);\n\n          if (completed) {\n            // the student has just completed the achievement\n            thisAchievementService.studentCompletedAchievement(achievement);\n          }\n        }\n      }\n    });\n\n    return deregisterFunction;\n  }\n\n  /**\n   * Check if the student completed a aggregate achievement\n   * @param achievement an aggregate achievement\n   * @return whether the student completed the aggregate achievement\n   */\n  checkAggregateAchievement(achievement) {\n\n    var completed = false;\n\n    if (achievement != null) {\n\n      // get the achievement params\n      var params = achievement.params;\n\n      if (params != null) {\n\n        // get the achievement ids that need to be completed\n        var achievementIds = params.achievementIds;\n\n        var completed = false;\n\n        /*\n         * loop through all the achievement ids that need to be\n         * completed\n         */\n        for (var a = 0; a < achievementIds.length; a++) {\n          var tempAchievementId = achievementIds[a];\n\n          if (a == 0) {\n            // this is the first node id\n            completed = this.isAchievementCompleted(tempAchievementId);\n          } else {\n            /*\n             * this is a node id after the first node id so\n             * we will use an and conditional\n             */\n            completed = completed && this.isAchievementCompleted(tempAchievementId);\n          }\n        }\n      }\n    }\n\n    return completed;\n  }\n\n  /**\n   * Get achievements for a workgroup id\n   * @param workgroupId the workgroup id\n   * @return an array of achievements completed by the workgroup\n   */\n  getAchievementsByWorkgroupId(workgroupId = null) {\n\n    var achievements = [];\n\n    if (workgroupId == null) {\n      // get the signed in workgroup id\n      workgroupId = this.ConfigService.getWorkgroupId();\n    }\n\n    if (this.achievementsByWorkgroupId[workgroupId] == null) {\n      /*\n       * this workgroup does not have an array of achievements yet so we\n       * will make it\n       */\n      this.achievementsByWorkgroupId[workgroupId] = [];\n      achievements = this.achievementsByWorkgroupId[workgroupId];\n    } else if (this.achievementsByWorkgroupId[workgroupId] != null) {\n      // this workgroup has an array of achievements\n      achievements = this.achievementsByWorkgroupId[workgroupId];\n    }\n\n    return achievements;\n  }\n\n  /**\n   * Get an array of student achievements for a given achievement id\n   * @param achievementId a 10 character achievement id\n   * @return an array of student achievements. student achievements are\n   * created when a workgroup completes an achievement.\n   */\n  getAchievementsByAchievementId(achievementId) {\n\n    var achievementsByAchievementId = [];\n\n    if (achievementId != null) {\n\n      // get all the workgroup ids\n      var workgroupIds = this.ConfigService.getClassmateWorkgroupIds();\n\n      if (workgroupIds != null) {\n\n        // loop through all the workgroup ids\n        for (var w = 0; w < workgroupIds.length; w++) {\n\n          var workgroupId = workgroupIds[w];\n\n          if (workgroupId != null) {\n\n            // get all the achievements this workgroup has completed\n            var achievementsForWorkgroup = this.achievementsByWorkgroupId[workgroupId];\n\n            if (achievementsForWorkgroup != null) {\n\n              // loop through all the achievements this workgroup has completed\n              for (var a = achievementsForWorkgroup.length - 1; a >= 0; a--) {\n                var achievement = achievementsForWorkgroup[a];\n\n                if (achievement != null && achievement.data != null) {\n                  if (achievementId == achievement.data.id) {\n                    /*\n                     * the workgroup has completed the achievement we are\n                     * looking for\n                     */\n                    achievementsByAchievementId.push(achievement);\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return achievementsByAchievementId;\n  }\n\n  /**\n   * Get a mapping from achievement id to array of student achievements\n   * @param achievementId the achievement id\n   * @return a mapping from achievement id to array of student achievements\n   * student achievements are created when a workgroup completes an achievement.\n   */\n  getAchievementIdToAchievementsMappings(achievementId) {\n    var achievementIdToAchievements = {};\n\n    // get all the project achievements\n    var projectAchievements = this.ProjectService.getAchievementItems();\n\n    // get the workgroup ids\n    var workgroupIds = this.ConfigService.getClassmateWorkgroupIds();\n\n    if (projectAchievements != null) {\n\n      // loop through all the project achievements\n      for (var a = 0; a < projectAchievements.length; a++) {\n        var projectAchievement = projectAchievements[a];\n\n        if (projectAchievement != null) {\n\n          // get an array of student achievements for the given achievement id\n          var studentAchievements = this.getAchievementsByAchievementId(projectAchievement.id);\n\n          // add the array to the mapping\n          achievementIdToAchievements[projectAchievement.id] = studentAchievements;\n        }\n      }\n    }\n\n    return achievementIdToAchievements;\n  }\n\n  /**\n   * Get an available achievement id\n   * @return an achievement id that isn't being used\n   */\n  getAvailableAchievementId() {\n\n    var id = null;\n\n    while (id == null) {\n\n      // generate a 10 character id\n      var id = this.UtilService.generateKey(10);\n\n      // check to make sure the id isn't already being used\n\n      var achievements = this.ProjectService.getAchievementItems();\n\n      // loop through all the achievements\n      for (var a = 0; a < achievements.length; a++) {\n        var achievement = achievements[a];\n\n        if (achievement != null) {\n          if (id == achievement.id) {\n            /*\n             * the id is already being used so we need to find\n             * a different one\n             */\n            id = null;\n            break;\n          }\n        }\n      }\n    }\n\n    return id;\n  }\n}\n\nAchievementService.$inject = [\n  '$http',\n  '$q',\n  '$rootScope',\n  'ConfigService',\n  'ProjectService',\n  'StudentDataService',\n  'UtilService'\n];\n\nexport default AchievementService;\n"]}