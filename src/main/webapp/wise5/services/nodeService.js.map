{"version":3,"sources":["nodeService.es6"],"names":["NodeService","$filter","$http","$injector","$mdDialog","$q","ConfigService","ProjectService","StudentDataService","$translate","getMode","TeacherDataService","get","transitionResults","chooseTransitionPromises","componentState","clientSaveTime","Date","parse","nodeState","runId","getRunId","periodId","getPeriodId","workgroupId","getWorkgroupId","nodeType","nodeTypeCamelCased","length","firstChar","charAt","firstCharLowerCase","toLowerCase","substr","str","result","toUpperCase","componentType","isStringUpperCase","toCamelCase","wiseBaseURL","getWISEBaseURL","nodeContent","componentId","componentContent","components","tempComponent","tempComponentId","id","componentStates","isSubmit","functionParams","nodeId","isCompleted","getNextNodeId","then","nextNodeId","mode","endCurrentNodeAndSetCurrentNodeByNodeId","currentId","deferred","defer","promise","currentNodeId","currentNode","getCurrentNode","currentNodeOrder","getNodeOrderById","nextNodeOrder","nextId","getNodeIdByOrder","isApplicationNode","isGroupNode","resolve","transitionLogic","getTransitionLogicByFromNodeId","branchPathTakenEvents","getBranchPathTakenEventsByNodeId","canChangePath","b","branchPathTakenEvent","data","toNodeId","transitions","parentGroupId","getParentGroupId","parentHasTransitionLogic","parentTransitionLogic","chooseTransition","transition","transitionToNodeId","to","startId","getGroupStartId","getNextNodeIdWithWork","hasWork","nodeHasWork","prevNodeId","getPrevNodeId","prevNodeOrder","prevId","nodeIdsByToNodeId","getNodeIdsByToNodeId","stackHistory","getStackHistory","s","stackHistoryNodeId","indexOf","getPrevNodeIdWithWork","parentNode","getParentGroup","parentNodeId","getChooseTransitionPromise","resolvePromiseNow","transitionResult","getTransitionResultByNodeId","availableTransitions","criteria","criteriaResult","firstResult","tempResult","tempCriteria","evaluateCriteria","push","isPreview","ChooseBranchPathController","$scope","chooseBranchPath","setTransitionResult","setChooseTransitionPromise","hide","getNodePositionAndTitleByNodeId","close","chooseBranchPathTemplateUrl","getThemePath","dialogOptions","templateUrl","controller","locals","$inject","show","howToChooseAmongAvailablePaths","randomIndex","Math","floor","random","index","alreadyBranched","events","fromNodeId","createBranchPathTakenEvent","category","event","eventData","saveVLEEvent","whenToChoosePath","$event","stepNumberAndTitle","rubricTitle","dialogHeader","dialogActions","dialogContent","dialogString","template","fullscreen","DialogController","openInNewWindow","w","window","open","windowHeader","rubricContent","document","getElementById","innerHTML","windowString","write","targetEvent","clickOutsideToClose","escapeToClose"],"mappings":"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","file":"nodeService.js","sourcesContent":["class NodeService {\n\n  constructor($filter,\n              $http,\n              $injector,\n              $mdDialog,\n              $q,\n              ConfigService,\n              ProjectService,\n              StudentDataService) {\n    this.$filter = $filter;\n    this.$http = $http;\n    this.$injector = $injector;\n    this.$mdDialog = $mdDialog;\n    this.$q = $q;\n    this.ConfigService = ConfigService;\n    this.ProjectService = ProjectService;\n    this.StudentDataService = StudentDataService;\n    if (this.$filter) {\n      this.$translate = this.$filter('translate');\n    }\n\n    if (this.ConfigService != null &&\n        (this.ConfigService.getMode() == \"classroomMonitor\" ||\n        this.ConfigService.getMode() == \"author\")) {\n      // in the classroom monitor, we need access to the TeacherDataService\n      this.TeacherDataService = this.$injector.get('TeacherDataService');\n    }\n\n    this.transitionResults = {};\n    this.chooseTransitionPromises = {};\n  }\n\n  /**\n   * Create a new empty node state\n   * @return a new empty node state\n   */\n  createNewComponentState() {\n    var componentState = {};\n\n    // set the timestamp\n    componentState.clientSaveTime = Date.parse(new Date());\n\n    return componentState;\n  };\n\n  /**\n   * Create a new empty node state\n   * @return a new empty node state\n   */\n  createNewNodeState() {\n    var nodeState = {};\n    nodeState.runId = this.ConfigService.getRunId();\n    nodeState.periodId = this.ConfigService.getPeriodId();\n    nodeState.workgroupId = this.ConfigService.getWorkgroupId();\n\n    // set the timestamp\n    nodeState.clientSaveTime = Date.parse(new Date());\n\n    return nodeState;\n  };\n\n  /**\n   * Get the node type in camel case\n   * @param nodeType the node type e.g. OpenResponse\n   * @return the node type in camel case\n   * e.g.\n   * openResponse\n   */\n  toCamelCase(nodeType) {\n    var nodeTypeCamelCased = null;\n\n    if (nodeType != null && nodeType.length > 0) {\n\n      // get the first character\n      var firstChar = nodeType.charAt(0);\n\n      if(firstChar != null) {\n\n        // make the first character lower case\n        var firstCharLowerCase = firstChar.toLowerCase();\n\n        if (firstCharLowerCase != null) {\n\n          /*\n           * replace the first character with the lower case\n           * character\n           */\n          nodeTypeCamelCased = firstCharLowerCase + nodeType.substr(1);\n        }\n      }\n    }\n\n    return nodeTypeCamelCased;\n  };\n\n  /**\n   * Check if the string is in all uppercase\n   * @param str the string to check\n   * @return whether the string is in all uppercase\n   */\n  isStringUpperCase(str) {\n    var result = false;\n\n    if (str != null) {\n      if (str === str.toUpperCase()) {\n        // the string is in all uppercase\n        result = true;\n      }\n    }\n\n    return result;\n  };\n\n  /**\n   * Get the html template for the component\n   * @param componentType the component type\n   * @return the path to the html template for the component\n   */\n  getComponentTemplatePath(componentType) {\n\n    if (componentType == null) {\n      // error\n    } else if (this.isStringUpperCase(componentType)) {\n      /*\n       * the component type is all uppercase so we will convert it to all\n       * lowercase\n       */\n      componentType = componentType.toLowerCase();\n    } else {\n      // get the component type in camel case\n      componentType = this.toCamelCase(componentType);\n    }\n    var wiseBaseURL = this.ConfigService.getWISEBaseURL();\n    return wiseBaseURL + '/wise5/components/' + componentType + '/index.html';\n  };\n\n  /**\n   * Get the component content\n   * @param componentContent the component content\n   * @param componentId the component id\n   * @return the component content\n   */\n  getComponentContentById(nodeContent, componentId) {\n    var componentContent = null;\n\n    if (nodeContent != null && componentId != null) {\n\n      // get the components\n      var components = nodeContent.components;\n\n      if (components != null) {\n\n        // loop through the components\n        for (var tempComponent of components) {\n          if (tempComponent != null) {\n            var tempComponentId = tempComponent.id;\n\n            if (tempComponentId === componentId) {\n              // we have found the component with the component id we want\n              componentContent = tempComponent;\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    return componentContent;\n  };\n\n  /**\n   * Check if any of the component states were submitted\n   * @param componentStates an array of component states\n   * @return whether any of the component states were submitted\n   */\n  isWorkSubmitted(componentStates) {\n    var result = false;\n\n    if (componentStates != null) {\n\n      // loop through all the component states\n      for (var componentState of componentStates) {\n        if (componentState != null) {\n\n          if (componentState.isSubmit) {\n            result = true;\n            break;\n          }\n        }\n      }\n    }\n\n    return result;\n  };\n\n  /**\n   * Check if the node or component is completed\n   * @param functionParams the params that will specify which node or component\n   * to check for completion\n   * @returns whether the specified node or component is completed\n   */\n  isCompleted(functionParams) {\n\n    var result = false;\n\n    if (functionParams != null) {\n      var nodeId = functionParams.nodeId;\n      var componentId = functionParams.componentId;\n\n      result = this.StudentDataService.isCompleted(nodeId, componentId);\n    }\n\n    return result;\n  };\n\n  /**\n   * Go to the next node\n   * @return a promise that will return the next node id\n   */\n  goToNextNode() {\n\n    // get the next node id\n    return this.getNextNodeId().then((nextNodeId) => {\n      if (nextNodeId != null) {\n        var mode = this.ConfigService.getMode();\n        if (mode === 'classroomMonitor' || mode === 'author') {\n          this.TeacherDataService.endCurrentNodeAndSetCurrentNodeByNodeId(nextNodeId);\n        } else {\n          this.StudentDataService.endCurrentNodeAndSetCurrentNodeByNodeId(nextNodeId);\n        }\n      }\n\n      return nextNodeId;\n    });\n  };\n\n  /**\n   * Get the next node in the project sequence. We return a promise because\n   * in preview mode we allow the user to specify which branch path they want\n   * to go to. In all other cases we will resolve the promise immediately.\n   * @param currentId (optional)\n   * @returns a promise that returns the next node id\n   */\n  getNextNodeId(currentId) {\n    // create a promise that will return the next node id\n    let deferred = this.$q.defer();\n    let promise = deferred.promise;\n\n    let nextNodeId = null;\n    let currentNodeId = null;\n    let mode = this.ConfigService.getMode();\n\n    if (currentId) {\n      // a current node id was passed in\n      currentNodeId = currentId;\n    } else {\n      // no current id was passed in, so get current node\n      let currentNode = null;\n\n      if (mode === 'classroomMonitor' || mode === 'author') {\n        currentNode = this.TeacherDataService.getCurrentNode();\n      } else {\n        currentNode = this.StudentDataService.getCurrentNode();\n      }\n      if (currentNode) {\n        currentNodeId = currentNode.id;\n      }\n    }\n\n    if (currentNodeId) {\n      if (mode === 'classroomMonitor' || mode === 'author') {\n        let currentNodeOrder = this.ProjectService.getNodeOrderById(currentNodeId);\n\n        if (currentNodeOrder) {\n          let nextNodeOrder = currentNodeOrder + 1;\n          let nextId = this.ProjectService.getNodeIdByOrder(nextNodeOrder);\n\n          if (nextId) {\n            if (this.ProjectService.isApplicationNode(nextId)) {\n              // node is a step, so set it as the next node\n              nextNodeId = nextId;\n            } else if (this.ProjectService.isGroupNode(nextId)){\n              // node is an activity, so get next nodeId\n              nextNodeId = this.getNextNodeId(nextId);\n            }\n          }\n        }\n\n        // resolve the promise with the next node id\n        deferred.resolve(nextNodeId);\n      } else {\n        // get the transition logic from the current node\n        var transitionLogic = this.ProjectService.getTransitionLogicByFromNodeId(currentNodeId);\n\n        // get all the branchPathTaken events for the current node\n        var branchPathTakenEvents = this.StudentDataService.getBranchPathTakenEventsByNodeId(currentNodeId);\n\n        if (branchPathTakenEvents != null && branchPathTakenEvents.length > 0 &&\n          (transitionLogic != null && transitionLogic.canChangePath != true)) {\n          // the student has branched on this node before and they are not allowed to change paths\n\n          // loop through all the branchPathTaken events from newest to oldest\n          for (var b = branchPathTakenEvents.length - 1; b >= 0; b--) {\n            var branchPathTakenEvent = branchPathTakenEvents[b];\n\n            if (branchPathTakenEvent != null) {\n\n              // get the data from the event\n              var data = branchPathTakenEvent.data;\n\n              if (data != null) {\n                // get the to node id\n                var toNodeId = data.toNodeId;\n                nextNodeId = toNodeId;\n                deferred.resolve(nextNodeId);\n                break;\n              }\n            }\n          }\n        } else {\n          // the student has not branched on this node before\n\n          if (transitionLogic != null) {\n            var transitions = transitionLogic.transitions;\n\n            if (transitions == null || transitions.length == 0) {\n              /*\n               * this node does not have any transitions so we will\n               * check if the parent group has transitions\n               */\n\n              // get the parent group id\n              var parentGroupId = this.ProjectService.getParentGroupId(currentNodeId);\n              var parentHasTransitionLogic = false;\n\n              if (parentGroupId != null) {\n\n                // get the transition logic from the parent\n                var parentTransitionLogic = this.ProjectService.getTransitionLogicByFromNodeId(parentGroupId);\n\n                if (parentTransitionLogic != null) {\n\n                  parentHasTransitionLogic = true;\n\n                  // choose a transition\n                  this.chooseTransition(parentGroupId, parentTransitionLogic).then((transition) => {\n\n                    if (transition != null) {\n                      // get the to node id\n                      var transitionToNodeId = transition.to;\n\n                      if (this.ProjectService.isGroupNode(transitionToNodeId)) {\n                        // the to node is a group\n\n                        // get the start id of the group\n                        var startId = this.ProjectService.getGroupStartId(transitionToNodeId);\n\n                        if (startId == null || startId == '') {\n                          // the group does not have a start id so we will just use the group\n                          nextNodeId = transitionToNodeId;\n                        } else {\n                          // the group has a start id so we will use the start id\n                          nextNodeId = startId;\n                        }\n                      } else {\n                        // the to node is a step\n                        nextNodeId = transitionToNodeId;\n                      }\n                    }\n\n                    // resolve the promise with the next node id\n                    deferred.resolve(nextNodeId);\n                  });\n                }\n              }\n\n              if (!parentHasTransitionLogic) {\n                /*\n                 * the parent does not have any transition logic so\n                 * there is no next node from the parent\n                 */\n                deferred.resolve(null);\n              }\n            } else {\n              // choose a transition\n              this.chooseTransition(currentNodeId, transitionLogic).then((transition) => {\n\n                if (transition != null) {\n                  // move the student to the toNodeId\n                  nextNodeId = transition.to;\n\n                  // resolve the promise with the next node id\n                  deferred.resolve(nextNodeId);\n                }\n              });\n            }\n          }\n        }\n      }\n    } else {\n      deferred.resolve(null);\n    }\n\n    return promise;\n  };\n\n  /**\n   * Go to the next node that captures work\n   * @return a promise that will return the next node id\n   */\n  goToNextNodeWithWork() {\n    this.getNextNodeIdWithWork().then((nextNodeId) => {\n      if (nextNodeId) {\n        const mode = this.ConfigService.getMode();\n        if (mode === 'classroomMonitor' || mode === 'author') {\n          this.TeacherDataService.endCurrentNodeAndSetCurrentNodeByNodeId(nextNodeId);\n        } else {\n          this.StudentDataService.endCurrentNodeAndSetCurrentNodeByNodeId(nextNodeId);\n        }\n      }\n      return nextNodeId;\n    });\n  };\n\n  /**\n   * Get the next node id in the project sequence that captures student work\n   * @param currentId (optional)\n   * @returns next node id\n   */\n  getNextNodeIdWithWork(currentId) {\n    return this.getNextNodeId(currentId).then((nextNodeId) => {\n      if (nextNodeId) {\n        const hasWork = this.ProjectService.nodeHasWork(nextNodeId);\n        if (hasWork) {\n          return nextNodeId;\n        } else {\n          return this.getNextNodeIdWithWork(nextNodeId);\n        }\n      } else {\n        return null;\n      }\n    });\n  };\n\n  /**\n   * Go to the previous node\n   */\n  goToPrevNode() {\n\n    var prevNodeId = this.getPrevNodeId();\n    var mode = this.ConfigService.getMode();\n    if (mode === 'classroomMonitor' || mode === 'author') {\n      this.TeacherDataService.endCurrentNodeAndSetCurrentNodeByNodeId(prevNodeId);\n    } else {\n      this.StudentDataService.endCurrentNodeAndSetCurrentNodeByNodeId(prevNodeId);\n    }\n  };\n\n  /**\n   * Get the previous node in the project sequence\n   * @param currentId (optional)\n   */\n  getPrevNodeId(currentId) {\n    let prevNodeId = null;\n    let currentNodeId = null;\n    let mode = this.ConfigService.getMode();\n\n    if (currentId) {\n      // a current node id was passed in\n      currentNodeId = currentId;\n    } else {\n      // no current id was passed in, so get current node\n      let currentNode = null;\n\n      if (mode === 'classroomMonitor' || mode === 'author') {\n        currentNode = this.TeacherDataService.getCurrentNode();\n      } else {\n        currentNode = this.StudentDataService.getCurrentNode();\n      }\n      if (currentNode) {\n        currentNodeId = currentNode.id;\n      }\n    }\n\n    if (currentNodeId) {\n      if (mode === 'classroomMonitor' || mode === 'author') {\n        let currentNodeOrder = this.ProjectService.getNodeOrderById(currentNodeId);\n\n        if (currentNodeOrder) {\n          let prevNodeOrder = currentNodeOrder - 1;\n          let prevId = this.ProjectService.getNodeIdByOrder(prevNodeOrder);\n\n          if (prevId) {\n            if (this.ProjectService.isApplicationNode(prevId)) {\n              // node is a step, so set it as the next node\n              prevNodeId = prevId;\n            } else if (this.ProjectService.isGroupNode(prevId)){\n              // node is an activity, so get next nodeId\n              prevNodeId = this.getPrevNodeId(prevId);\n            }\n          }\n        }\n      } else {\n        // get all the nodes that transition to the current node\n        var nodeIdsByToNodeId = this.ProjectService.getNodeIdsByToNodeId(currentNodeId);\n\n        if (nodeIdsByToNodeId == null) {\n\n        } else if (nodeIdsByToNodeId.length === 1) {\n          // there is only one node that transitions to the current node\n          prevNodeId = nodeIdsByToNodeId[0];\n        } else if (nodeIdsByToNodeId.length > 1) {\n          // there are multiple nodes that transition to the current node\n\n          // get the stack history\n          var stackHistory = this.StudentDataService.getStackHistory();\n\n          // loop through the stack history node ids from newest to oldest\n          for (var s = stackHistory.length - 1; s >= 0; s--) {\n            var stackHistoryNodeId = stackHistory[s];\n\n            if (nodeIdsByToNodeId.indexOf(stackHistoryNodeId) != -1) {\n              // we have found a node that we previously visited that transitions to the current node\n              prevNodeId = stackHistoryNodeId;\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    return prevNodeId;\n  };\n\n  /**\n   * Go to the previous node that captures work\n   */\n  goToPrevNodeWithWork() {\n    const prevNodeId = this.getPrevNodeIdWithWork();\n    const mode = this.ConfigService.getMode();\n    if (mode === 'classroomMonitor' || mode === 'author') {\n      this.TeacherDataService.endCurrentNodeAndSetCurrentNodeByNodeId(prevNodeId);\n    } else {\n      this.StudentDataService.endCurrentNodeAndSetCurrentNodeByNodeId(prevNodeId);\n    }\n  };\n\n  /**\n   * Get the previous node id in the project sequence that captures student work\n   * @param currentId (optional)\n   * @returns next node id\n   */\n  getPrevNodeIdWithWork(currentId) {\n    const prevNodeId = this.getPrevNodeId(currentId);\n    if (prevNodeId) {\n      const hasWork = this.ProjectService.nodeHasWork(prevNodeId);\n      if (hasWork) {\n        return prevNodeId;\n      } else {\n        return this.getPrevNodeIdWithWork(prevNodeId);\n      }\n    } else {\n      return null;\n    }\n  };\n\n  /**\n   * Close the current node (and open the current node's parent group)\n   */\n  closeNode() {\n    let mode = this.ConfigService.getMode();\n    let currentNode = null;\n\n    if (mode === 'classroomMonitor') {\n      currentNode = this.TeacherDataService.getCurrentNode();\n    } else {\n      currentNode = this.StudentDataService.getCurrentNode();\n    }\n\n    if (currentNode) {\n\n      let currentNodeId = currentNode.id;\n\n      // get the parent node of the current node\n      let parentNode = this.ProjectService.getParentGroup(currentNodeId);\n\n      let parentNodeId = parentNode.id;\n\n      // set the current node to the parent node\n      if (mode === 'classroomMonitor') {\n        this.TeacherDataService.endCurrentNodeAndSetCurrentNodeByNodeId(parentNodeId);\n      } else {\n        this.StudentDataService.endCurrentNodeAndSetCurrentNodeByNodeId(parentNodeId);\n      }\n    }\n  };\n\n  /**\n   * Choose the transition the student will take\n   * @param nodeId the current node id\n   * @param transitionLogic an object containing transitions and parameters\n   * for how to choose a transition\n   * @returns a promise that will return a transition\n   */\n  chooseTransition(nodeId, transitionLogic) {\n\n    var deferred = this.$q.defer();\n\n    // see if there is already a promise for this step\n    var promise = this.getChooseTransitionPromise(nodeId);\n\n    if (promise == null) {\n      // there is no existing promise for this step so we will create one\n      promise = deferred.promise;\n    } else {\n      // there is an existing promise for this step so we will use it\n      return promise;\n    }\n\n    var resolvePromiseNow = true;\n\n    // check if the transition was already previously calculated\n    var transitionResult = this.getTransitionResultByNodeId(nodeId);\n\n    if (transitionResult == null || (transitionLogic != null && transitionLogic.canChangePath == true)) {\n      /*\n       * we have not previously calculated the transition or the\n       * transition logic allows the student to change branch paths\n       * so we will calculate the transition again\n       */\n\n      // get the transitions\n      var transitions = transitionLogic.transitions;\n\n      if (transitions != null) {\n\n        let availableTransitions = [];\n\n        // loop through all the transitions\n        for (var transition of transitions) {\n\n          // get the to node id\n          var toNodeId = transition.to;\n\n          // get the criteria for which this transition can be used\n          var criteria = transition.criteria;\n\n          // set the default result to true in case there is no criteria\n          var criteriaResult = true;\n\n          if (criteria != null) {\n\n            var firstResult = true;\n            var tempResult = true;\n\n            // loop through all of the criteria\n            for (var tempCriteria of criteria) {\n\n              // check if the criteria is satisfied\n              tempResult = this.StudentDataService.evaluateCriteria(tempCriteria);\n\n              if (firstResult) {\n                // this is the first criteria in this for loop\n                criteriaResult = tempResult;\n                firstResult = false;\n              } else {\n                // this is not the first criteria in this for loop so we will && the result\n                criteriaResult = criteriaResult && tempResult;\n              }\n            }\n          }\n\n          if (toNodeId != null) {\n\n            // check if the criteria was satisfied and the to node is visitable\n            if (criteriaResult) {\n\n              // the student is allowed to use the transition\n              availableTransitions.push(transition);\n            }\n          }\n        }\n\n        if (availableTransitions.length == 0) {\n          // there are no available transitions for the student\n          transitionResult = null;\n        } else if (availableTransitions.length == 1) {\n          // there is one available transition for the student\n          transitionResult = availableTransitions[0];\n        } else if (availableTransitions.length > 1) {\n          // there are multiple available transitions for the student\n\n          if (this.ConfigService.isPreview()) {\n            /*\n             * we are in preview mode so we will let the user choose\n             * the branch path to go to\n             */\n\n            if (transitionResult != null) {\n              /*\n               * the user has previously chosen the branch path\n               * so we will use the transition they chose and\n               * not ask them again\n               */\n            } else {\n              // ask the user which branch path to go to\n\n              resolvePromiseNow = false;\n\n              let chooseBranchPathTemplateUrl = this.ProjectService.getThemePath() + '/templates/branchPathChooser.html';\n\n              var dialogOptions = {\n                templateUrl: chooseBranchPathTemplateUrl,\n                controller: ChooseBranchPathController,\n                locals: {\n                  availableTransitions: availableTransitions,\n                  deferred: deferred,\n                  nodeId: nodeId\n                }\n              };\n\n              /**\n               * Controller that handles the dialog popup that lets the user\n               * which branch path to go to.\n               * @param $scope the scope\n               * @param $mdDialog the dialog popup object\n               * @param availableTransitions the branch paths\n               * @param deferred used to resolve the promise once the user\n               * has chosen a branch path\n               * @param nodeId the current node\n               */\n              function ChooseBranchPathController($scope, $mdDialog, NodeService, ProjectService, availableTransitions, deferred, nodeId) {\n\n                $scope.availableTransitions = availableTransitions;\n                $scope.NodeService = NodeService;\n                $scope.ProjectService = ProjectService;\n\n                // called when the user clicks on a branch path\n                $scope.chooseBranchPath = (transitionResult) => {\n                  // remember the transition that was chosen\n                  $scope.NodeService.setTransitionResult(nodeId, transitionResult);\n\n                  // resolve the promise\n                  deferred.resolve(transitionResult);\n\n                  /*\n                   * don't remember the promise for this step anymore\n                   * since we have resolved it\n                   */\n                  $scope.NodeService.setChooseTransitionPromise(nodeId, null);\n\n                  // close the dialog\n                  $mdDialog.hide();\n                }\n\n                // obtains the step number and title\n                $scope.getNodePositionAndTitleByNodeId = (nodeId) => {\n                  return $scope.ProjectService.getNodePositionAndTitleByNodeId(nodeId);\n                }\n\n                // called when the dialog is closed\n                $scope.close = () => {\n                  $mdDialog.hide();\n                }\n              }\n\n              ChooseBranchPathController.$inject = ['$scope', '$mdDialog', 'NodeService', 'ProjectService', 'availableTransitions', 'deferred', 'nodeId'];\n\n              /*\n               * show the popup dialog that lets the user choose the\n               * branch path\n               */\n              this.$mdDialog.show(dialogOptions);\n            }\n          } else {\n            /*\n             * we are in regular student run mode so we will choose\n             * the branch according to how the step was authored\n             */\n\n            var howToChooseAmongAvailablePaths = transitionLogic.howToChooseAmongAvailablePaths;\n\n            if (howToChooseAmongAvailablePaths == null ||\n              howToChooseAmongAvailablePaths === '' ||\n              howToChooseAmongAvailablePaths === 'random') {\n              // choose a random transition\n\n              var randomIndex = Math.floor(Math.random() * availableTransitions.length);\n              transitionResult = availableTransitions[randomIndex];\n            } else if (howToChooseAmongAvailablePaths === 'workgroupId') {\n              // use the workgroup id to choose the transition\n\n              // get the workgroup id\n              var workgroupId = this.ConfigService.getWorkgroupId();\n\n              // choose the transition index\n              var index = workgroupId % availableTransitions.length;\n\n              transitionResult = availableTransitions[index];\n            } else if (howToChooseAmongAvailablePaths === 'firstAvailable') {\n              // choose the first available transition\n\n              transitionResult = availableTransitions[0];\n            } else if (howToChooseAmongAvailablePaths === 'lastAvailable') {\n              // choose the last available transition\n\n              transitionResult = availableTransitions[availableTransitions.length - 1];\n            }\n          }\n        }\n      }\n    }\n\n    if (resolvePromiseNow) {\n      // remember the transition that was chosen for this step\n      this.setTransitionResult(nodeId, transitionResult);\n\n      // resolve the promise immediately\n      deferred.resolve(transitionResult);\n    } else {\n      /*\n       * remember the promise in case someone else calls chooseTransition()\n       * so we can chain off of this promise instead of creating another\n       * promise\n       */\n      this.setChooseTransitionPromise(nodeId, promise);\n    }\n\n    return promise;\n  };\n\n  hasTransitionLogic() {\n    var result = false;\n\n    var currentNode = this.StudentDataService.getCurrentNode();\n\n    if (currentNode != null) {\n      var transitionLogic = currentNode.transitionLogic;\n\n      if (transitionLogic != null) {\n        result = true;\n      }\n    }\n\n    return result;\n  };\n\n  /**\n   * Evaluate the transition logic for the current node and create branch\n   * path taken events if necessary.\n   */\n  evaluateTransitionLogic() {\n\n    // get the current node\n    var currentNode = this.StudentDataService.getCurrentNode();\n\n    if (currentNode != null) {\n\n      var nodeId = currentNode.id;\n      var transitionLogic = currentNode.transitionLogic;\n\n      if (transitionLogic != null) {\n\n        // get all the transitions from the current node\n        var transitions = transitionLogic.transitions;\n        var canChangePath = transitionLogic.canChangePath;\n        var alreadyBranched = false;\n\n        // get all the branchPathTaken events for the current node\n        var events = this.StudentDataService.getBranchPathTakenEventsByNodeId(currentNode.id);\n\n        if (events.length > 0) {\n          // the student has branched from this node before\n          alreadyBranched = true;\n        }\n\n        var transition, fromNodeId, toNodeId;\n\n        if (alreadyBranched) {\n          // student has previously branched\n\n          if (canChangePath) {\n            // student can change path\n\n            // choose a transition\n            this.chooseTransition(nodeId, transitionLogic).then((transition) => {\n\n              if (transition != null) {\n                fromNodeId = currentNode.id;\n                toNodeId = transition.to;\n\n                // create a branchPathTaken event to signify taking the branch path\n                this.createBranchPathTakenEvent(fromNodeId, toNodeId);\n              }\n            });\n          } else {\n            // student can't change path\n\n          }\n        } else {\n          // student has not branched yet\n\n          // choose a transition\n          this.chooseTransition(nodeId, transitionLogic).then((transition) => {\n\n            if (transition != null) {\n              fromNodeId = currentNode.id;\n              toNodeId = transition.to;\n\n              // create a branchPathTaken event to signify taking the branch path\n              this.createBranchPathTakenEvent(fromNodeId, toNodeId);\n            }\n          });\n        }\n      }\n    }\n  };\n\n  /**\n   * Create a branchPathTaken event\n   * @param fromNodeId the from node id\n   * @param toNodeid the to node id\n   */\n  createBranchPathTakenEvent(fromNodeId, toNodeId) {\n    var nodeId = fromNodeId;\n    var componentId = null;\n    var componentType = null;\n    var category = \"Navigation\";\n    var event = \"branchPathTaken\";\n    var eventData = {};\n    eventData.fromNodeId = fromNodeId;\n    eventData.toNodeId = toNodeId;\n    this.StudentDataService.saveVLEEvent(nodeId, componentId, componentType, category, event, eventData);\n  }\n\n  evaluateTransitionLogicOn(event) {\n    var result = false;\n\n    // get the current node\n    var currentNode = this.StudentDataService.getCurrentNode();\n\n    if (currentNode != null) {\n      var transitionLogic = currentNode.transitionLogic;\n\n      var whenToChoosePath = transitionLogic.whenToChoosePath;\n\n      if (event === whenToChoosePath) {\n        result = true;\n      }\n    }\n\n    return result;\n  };\n\n  /**\n   * Get the transition result for a node\n   * @param nodeId the the node id\n   * @returns the transition object that was chosen for the node\n   */\n  getTransitionResultByNodeId(nodeId) {\n    return this.transitionResults[nodeId];\n  }\n\n  /**\n   * Set the transition result for a node\n   * @param nodeId the node id\n   * @param transitionResult the transition object that was chosen for the node\n   */\n  setTransitionResult(nodeId, transitionResult) {\n    if (nodeId != null) {\n      this.transitionResults[nodeId] = transitionResult;\n    }\n  }\n\n  /**\n   * Get the promise that was created for a specific node when the\n   * chooseTransition() function was called. This promise has not been\n   * resolved yet.\n   * @param nodeId the node id\n   * @returns the promise that was created when chooseTransition() was called\n   * or null if there is no unresolved promise.\n   */\n  getChooseTransitionPromise(nodeId) {\n    return this.chooseTransitionPromises[nodeId];\n  }\n\n  /**\n   * Set the promise that was created for a specific node when the\n   * chooseTransition() function was called. This promise has not been\n   * resolved yet.\n   * @param nodeId the node id\n   * @param promise the promise\n   */\n  setChooseTransitionPromise(nodeId, promise) {\n    if (nodeId != null) {\n      this.chooseTransitionPromises[nodeId] = promise;\n    }\n  }\n\n  /**\n   * Show the node content in a dialog. We will show the step content\n   * plus the node rubric and all component rubrics.\n   */\n  showNodeInfo(nodeId, $event) {\n\n    // get the step number and title\n    let stepNumberAndTitle = this.ProjectService.getNodePositionAndTitleByNodeId(nodeId);\n    let rubricTitle = this.$translate('STEP_INFO');\n\n    /*\n     * create the dialog header, actions, and content elements\n     */\n    let dialogHeader =\n      `<md-toolbar>\n                <div class=\"md-toolbar-tools\">\n                    <h2>${ stepNumberAndTitle }</h2>\n                </div>\n            </md-toolbar>`;\n\n    let dialogActions =\n      `<md-dialog-actions layout=\"row\" layout-align=\"end center\">\n                <md-button class=\"md-primary\" ng-click=\"openInNewWindow()\" aria-label=\"{{ 'openInNewWindow' | translate }}\">{{ 'openInNewWindow' | translate }}</md-button>\n                <md-button class=\"md-primary\" ng-click=\"close()\" aria-label=\"{{ 'close' | translate }}\">{{ 'close' | translate }}</md-button>\n            </md-dialog-actions>`;\n\n    let dialogContent =\n      `<md-dialog-content class=\"gray-lighter-bg\">\n                <div class=\"md-dialog-content\" id=\"nodeInfo_${ nodeId }\">\n                    <node-info node-id=\"${ nodeId }\"></node-info>\n                </div>\n            </md-dialog-content>`;\n\n    // create the dialog string\n    let dialogString = `<md-dialog class=\"dialog--wider\" aria-label=\"${ stepNumberAndTitle } - ${ rubricTitle }\">${ dialogHeader }${  dialogContent }${ dialogActions }</md-dialog>`;\n\n    // display the rubric in a popup\n    this.$mdDialog.show({\n      template : dialogString,\n      fullscreen: true,\n      controller: ['$scope', '$mdDialog',\n        function DialogController($scope, $mdDialog) {\n\n          // display the rubric in a new tab\n          $scope.openInNewWindow = function() {\n\n            // open a new tab\n            let w = window.open('', '_blank');\n\n            /*\n             * create the header for the new window that contains the project title\n             */\n            let windowHeader =\n              `<md-toolbar class=\"layout-row\">\n                                <div class=\"md-toolbar-tools primary-bg\" style=\"color: #ffffff;\">\n                                    <h2>${ stepNumberAndTitle }</h2>\n                                </div>\n                            </md-toolbar>`;\n\n            let rubricContent = document.getElementById('nodeInfo_' + nodeId).innerHTML;\n\n            // create the window string\n            let windowString =\n              `<link rel='stylesheet' href='../wise5/lib/bootstrap/css/bootstrap.min.css' />\n                            <link rel='stylesheet' href='../wise5/themes/default/style/monitor.css'>\n                            <link rel='stylesheet' href='../wise5/themes/default/style/angular-material.css'>\n                            <link rel='stylesheet' href='../wise5/lib/summernote/dist/summernote.css' />\n                            <link rel=\"stylesheet\" href=\"http://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic%7CMaterial+Icons\" media=\"all\">\n                            <body class=\"layout-column\">\n                                <div class=\"layout-column\">${ windowHeader }<md-content class=\"md-padding\">${ rubricContent }</div></md-content></div>\n                            </body>`;\n\n            // write the rubric content to the new tab\n            w.document.write(windowString);\n\n            // close the popup\n            $mdDialog.hide();\n          }\n\n          // close the popup\n          $scope.close = () => {\n            $mdDialog.hide();\n          }\n        }\n      ],\n      targetEvent: $event,\n      clickOutsideToClose: true,\n      escapeToClose: true\n    });\n  }\n}\n\nNodeService.$inject = [\n  '$filter',\n  '$http',\n  '$injector',\n  '$mdDialog',\n  '$q',\n  'ConfigService',\n  'ProjectService',\n  'StudentDataService'\n];\n\nexport default NodeService;\n"]}