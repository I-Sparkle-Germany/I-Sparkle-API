{"version":3,"sources":["notebookService.es6"],"names":["NotebookService","$http","$q","$rootScope","ConfigService","ProjectService","StudentAssetService","StudentDataService","config","enabled","label","enableAddNew","itemTypes","note","enableLink","enableClipping","enableStudentUploads","type","singular","plural","link","icon","color","question","report","notes","reports","notebookConfig","project","notebook","angular","merge","ev","itemId","$broadcast","file","itemToDelete","items","getNotebookByWorkgroup","deletedItems","i","length","item","splice","push","workgroupId","hasOwnProperty","last","reportId","getLatestNotebookItemByLocalNotebookItemId","templateReportItem","reportNotes","reportNote","id","localNotebookItemId","content","periodId","isPreview","getWorkgroupId","notebooksByWorkgroup","allItems","groupNotebookItems","deferred","defer","resolve","promise","method","url","getStudentNotebookURL","params","then","response","allNotebookItems","data","n","notebookItem","studentAssetId","studentAsset","getAssetById","studentWorkId","studentWork","getStudentWorkByStudentWorkId","fromJson","calculateTotalUsage","notebookByWorkgroup","ni","notebookItemLocalNotebookItemId","notebookItemLocalNotebookItemIdKey","allRevisionsForThisLocalNotebookItemId","lastRevision","serverDeleteTime","notebookItemId","nodeId","title","clientSaveTime","clientDeleteTime","reject","headers","getPeriodId","toJson","Date","parse","$","param","result","isOpen","currentNode","componentId","componentType","category","eventData","curentNodeId","event","saveVLEEvent","$inject"],"mappings":"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","file":"notebookService.js","sourcesContent":["class NotebookService {\n    constructor($http,\n                $q,\n                $rootScope,\n                ConfigService,\n                ProjectService,\n                StudentAssetService,\n                StudentDataService) {\n\n        this.$http = $http;\n        this.$q = $q;\n        this.$rootScope = $rootScope;\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n        this.StudentAssetService = StudentAssetService;\n        this.StudentDataService = StudentDataService;\n\n        // default notebook configuration\n        // TODO: i18n\n        // TODO: decide on desired defaults\n        // TODO: allow wise instance to set default enabled/disabled for each type in wise config?\n        this.config = {\n            enabled: false,\n            label: \"Notebook\",\n            enableAddNew: true,\n            itemTypes: {\n                note: {\n                    enabled: true,\n                    enableLink: true,\n                    enableClipping: true,\n                    enableStudentUploads: true,\n                    type: \"note\",\n                    label: {\n                        singular: \"note\",\n                        plural: \"notes\",\n                        link: \"Notes\",\n                        icon: \"note\",\n                        color: \"#1565C0\"\n                    }\n                },\n                question: {\n                    enabled: false,\n                    enableLink: true,\n                    enableClipping: true,\n                    enableStudentUploads: true,\n                    type: \"question\",\n                    label: {\n                        singular: \"question\",\n                        plural: \"questions\",\n                        link: \"Questions\",\n                        icon: \"live_help\",\n                        color: \"#F57C00\"\n                    }\n                },\n                report: {\n                    enabled: false,\n                    label: {\n                        singular: \"report\",\n                        plural: \"reports\",\n                        link: \"Report\",\n                        icon: \"assignment\",\n                        color: \"#AD1457\"\n                    },\n                    notes: []\n                }\n            }\n        };\n\n        this.reports = [];\n\n        this.notebookConfig = {};\n        if (this.ProjectService.project) {\n            // get notebook config from project\n            this.notebookConfig = this.ProjectService.project.notebook;\n            // update local notebook config, preserving any defaults that aren't overriden\n            if (this.notebookConfig !== null && typeof this.notebookConfig === 'object') {\n                this.config = angular.merge(this.config, this.notebookConfig);\n            }\n        }\n    }\n\n    editItem(ev, itemId) {\n        // broadcast edit notebook item event\n        this.$rootScope.$broadcast('editNote', {itemId: itemId, ev: ev});\n    };\n\n    addNewItem(ev, file) {\n        // broadcast create new notebook item event\n        this.$rootScope.$broadcast('addNewNote', {ev: ev, file: file});\n    };\n\n    deleteItem(itemToDelete) {\n        let items = this.getNotebookByWorkgroup().items;\n        let deletedItems = this.getNotebookByWorkgroup().deletedItems;\n        for (let i = 0; i < items.length; i++) {\n            let item = items[i];\n            if (item === itemToDelete) {\n                items.splice(i, 1);\n                deletedItems.push(itemToDelete);\n            }\n        }\n    };\n\n    // looks up notebook item by local notebook item id, including deleted notes\n    getLatestNotebookItemByLocalNotebookItemId(itemId, workgroupId = null) {\n        if (this.getNotebookByWorkgroup(workgroupId).items.hasOwnProperty(itemId)) {\n            let items = this.getNotebookByWorkgroup(workgroupId).items[itemId];\n            return items.last();\n        } else if (this.getNotebookByWorkgroup(workgroupId).deletedItems.hasOwnProperty(itemId)) {\n            let items = this.getNotebookByWorkgroup(workgroupId).deletedItems[itemId];\n            return items.last();\n        } else {\n            return null;\n        }\n    }\n\n    // returns student's report item if they've done work, or the template if they haven't.\n    getLatestNotebookReportItemByReportId(reportId, workgroupId = null) {\n        return this.getLatestNotebookItemByLocalNotebookItemId(reportId, workgroupId);\n    }\n\n    // returns the authored report item\n    getTemplateReportItemByReportId(reportId) {\n        let templateReportItem = null;\n        let reportNotes = this.notebookConfig.itemTypes.report.notes;\n        for (let i = 0; i < reportNotes.length; i++) {\n            let reportNote = reportNotes[i];\n            if (reportNote.reportId == reportId) {\n                templateReportItem = {\n                    id: null,\n                    type: \"report\",\n                    localNotebookItemId: reportId,\n                    content: reportNote\n                };\n                break;\n            }\n        }\n        return templateReportItem;\n    }\n\n    calculateTotalUsage() {\n        // get the total size\n        /*\n        let totalSizeSoFar = 0;\n        for (let i = 0; i < this.getNotebookByWorkgroup().items.length; i++) {\n            let notebookItem = this.getNotebookByWorkgroup().items[i];\n            if (notebookItem.studentAsset != null) {\n                let notebookItemSize = notebookItem.studentAsset.fileSize;\n                totalSizeSoFar += notebookItemSize;\n            }\n        }\n        this.getNotebookByWorkgroup().totalSize = totalSizeSoFar;\n        this.getNotebookByWorkgroup().totalSizeMax = this.ConfigService.getStudentMaxTotalAssetsSize();\n        this.getNotebookByWorkgroup().usagePercentage = this.notebook.totalSize / this.notebook.totalSizeMax * 100;\n        */\n    };\n\n    getNotebookConfig() {\n        return this.config;\n    };\n\n    isNotebookEnabled() {\n        return this.config.enabled;\n    };\n\n    retrieveNotebookItems(workgroupId = null, periodId = null) {\n        if (this.ConfigService.isPreview()) {\n            // we are previewing the project, initialize dummy student data\n            let workgroupId = this.ConfigService.getWorkgroupId();\n            this.notebooksByWorkgroup = {};\n            this.notebooksByWorkgroup[workgroupId] = {};\n            this.notebooksByWorkgroup[workgroupId].allItems = [];\n            this.notebooksByWorkgroup[workgroupId].items = [];\n            this.notebooksByWorkgroup[workgroupId].deletedItems = [];\n            this.groupNotebookItems();\n            // if we're in preview, don't make any request to the server but pretend we did\n            let deferred = this.$q.defer();\n            deferred.resolve(this.notebooksByWorkgroup[workgroupId]);\n            return deferred.promise;\n        } else {\n            let config = {\n                method : 'GET',\n                url : this.ConfigService.getStudentNotebookURL(),\n                params : {}\n            };\n            if (workgroupId != null) {\n                config.params.workgroupId = workgroupId;\n            }\n            if (periodId != null) {\n                config.params.periodId = periodId;\n            }\n            return this.$http(config).then((response) => {\n                // loop through the assets and make them into JSON object with more details\n                this.notebooksByWorkgroup = {};\n                let allNotebookItems = response.data;\n                for (let n = 0; n < allNotebookItems.length; n++) {\n                    let notebookItem = allNotebookItems[n];\n                    if (notebookItem.studentAssetId != null) {\n                        // if this notebook item is a StudentAsset item, add the association here\n                        notebookItem.studentAsset = this.StudentAssetService.getAssetById(notebookItem.studentAssetId);\n                    } else if (notebookItem.studentWorkId != null) {\n                        // if this notebook item is a StudentWork item, add the association here\n                        notebookItem.studentWork = this.StudentDataService.getStudentWorkByStudentWorkId(notebookItem.studentWorkId);\n                    } else if (notebookItem.type === \"note\" || notebookItem.type === \"report\") {\n                        notebookItem.content = angular.fromJson(notebookItem.content);\n                    }\n                    let workgroupId = notebookItem.workgroupId;\n                    if (this.notebooksByWorkgroup.hasOwnProperty(workgroupId)) {\n                        // we already have create a notebook for this workgroup before, so we'll append this notebook item to the array\n                        this.notebooksByWorkgroup[workgroupId].allItems.push(notebookItem);\n                    } else {\n                        // otherwise, we'll create a new notebook field and add the item to the array\n                        this.notebooksByWorkgroup[workgroupId] = { allItems: [notebookItem] };\n                    }\n                }\n                this.groupNotebookItems(); // group notebook items based on item.localNotebookItemId\n                this.calculateTotalUsage();\n\n                return this.notebooksByWorkgroup;\n            });\n        }\n    };\n\n    /**\n     * Groups the notebook items together in to a map-like structure inside this.notebook.items.\n     * {\n     *    \"abc123\": [{localNotebookItemId:\"abc123\", \"text\":\"first revision\"}, {localNotebookItemId:\"abc123\", \"text\":\"second revision\"}],\n     *    \"def456\": [{localNotebookItemId:\"def456\", \"text\":\"hello\"}, {localNotebookItemId:\"def456\", \"text\":\"hello my friend\"}]\n     * }\n     */\n    groupNotebookItems() {\n        for (let workgroupId in this.notebooksByWorkgroup) {\n            if (this.notebooksByWorkgroup.hasOwnProperty(workgroupId)) {\n                let notebookByWorkgroup = this.notebooksByWorkgroup[workgroupId];\n                notebookByWorkgroup.items = {};\n                notebookByWorkgroup.deletedItems = {};  // reset deleted items\n                for (let ni = 0; ni < notebookByWorkgroup.allItems.length; ni++) {\n                    let notebookItem = notebookByWorkgroup.allItems[ni];\n                    let notebookItemLocalNotebookItemId = notebookItem.localNotebookItemId;\n                    if (notebookByWorkgroup.items.hasOwnProperty(notebookItemLocalNotebookItemId)) {\n                        // if this was already added before, we'll append this notebook item to the array\n                        notebookByWorkgroup.items[notebookItemLocalNotebookItemId].push(notebookItem);\n                    } else {\n                        // otherwise, we'll create a new field and add the item to the array\n                        notebookByWorkgroup.items[notebookItemLocalNotebookItemId] = [notebookItem];\n                    }\n                }\n                // now go through the items and look at the last revision of each item. If it's deleted, then move the entire item array to deletedItems\n                for (let notebookItemLocalNotebookItemIdKey in notebookByWorkgroup.items) {\n                    if (notebookByWorkgroup.items.hasOwnProperty(notebookItemLocalNotebookItemIdKey)) {\n                        // get the last note revision\n                        let allRevisionsForThisLocalNotebookItemId = notebookByWorkgroup.items[notebookItemLocalNotebookItemIdKey];\n                        if (allRevisionsForThisLocalNotebookItemId != null) {\n                            let lastRevision = allRevisionsForThisLocalNotebookItemId[allRevisionsForThisLocalNotebookItemId.length - 1];\n                            if (lastRevision != null && lastRevision.serverDeleteTime != null) {\n                                // the last revision for this not deleted, so move the entire note (with all its revisions) to deletedItems\n                                notebookByWorkgroup.deletedItems[notebookItemLocalNotebookItemIdKey] = allRevisionsForThisLocalNotebookItemId;\n                                delete notebookByWorkgroup.items[notebookItemLocalNotebookItemIdKey];  // then remove it from the items array\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    getNotebookByWorkgroup(workgroupId = null) {\n        if (workgroupId == null) {\n            workgroupId = this.ConfigService.getWorkgroupId();\n        }\n        let notebookByWorkgroup = this.notebooksByWorkgroup[workgroupId];\n        if (notebookByWorkgroup == null) {\n            notebookByWorkgroup = {\n                allItems: [],\n                items: {},\n                deletedItems: {}\n            }\n        }\n        return notebookByWorkgroup;\n    }\n\n    hasStudentWorkNotebookItem(studentWork) {\n        for (let i = 0; i < this.notebook.items.length; i++) {\n            let notebookItem = this.notebook.items[i];\n            if (notebookItem.studentWorkId === studentWork.id) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    saveNotebookItem(notebookItemId, nodeId, localNotebookItemId, type, title, content, clientSaveTime = null, clientDeleteTime = null) {\n        if (this.ConfigService.isPreview()) {\n            return this.$q((resolve, reject) => {\n                let notebookItem = {\n                    content: content,\n                    localNotebookItemId: localNotebookItemId,\n                    nodeId: nodeId,\n                    notebookItemId: notebookItemId,\n                    title: title,\n                    type: type,\n                    workgroupId: this.ConfigService.getWorkgroupId(),\n                    clientSaveTime: clientSaveTime,\n                    clientDeleteTime: clientDeleteTime\n                };\n                if (clientDeleteTime != null) {\n                    // preview user wants to delete this note, so mock the server deletion by setting the server delete time\n                    notebookItem.serverDeleteTime = clientDeleteTime;\n                } else {\n                    notebookItem.serverDeleteTime = null;\n                }\n                // add/update notebook\n                let workgroupId = notebookItem.workgroupId;\n                if (this.notebooksByWorkgroup.hasOwnProperty(workgroupId)) {\n                    // we already have create a notebook for this workgroup before, so we'll append this notebook item to the array\n                    this.notebooksByWorkgroup[workgroupId].allItems.push(notebookItem);\n                } else {\n                    // otherwise, we'll create a new notebook field and add the item to the array\n                    this.notebooksByWorkgroup[workgroupId] = { allItems: [notebookItem] };\n                }\n\n                this.groupNotebookItems();\n                this.groupNotebookItems();\n                this.$rootScope.$broadcast('notebookUpdated', {notebook: this.notebooksByWorkgroup[workgroupId]});\n                resolve();\n            });\n        } else {\n            let config = {\n                method: \"POST\",\n                url: this.ConfigService.getStudentNotebookURL(),\n                headers: {'Content-Type': 'application/x-www-form-urlencoded'}\n            };\n            let params = {\n                workgroupId: this.ConfigService.getWorkgroupId(),\n                periodId: this.ConfigService.getPeriodId(),\n                notebookItemId: notebookItemId,\n                localNotebookItemId: localNotebookItemId,\n                nodeId: nodeId,\n                type: type,\n                title: title,\n                content: angular.toJson(content),\n                clientSaveTime: Date.parse(new Date()),\n                clientDeleteTime: clientDeleteTime\n            };\n            if (params.clientSaveTime == null) {\n                params.clientSaveTime = Date.parse(new Date());\n            }\n            config.data = $.param(params);\n\n            return this.$http(config).then((result) => {\n                let notebookItem = result.data;\n                if (notebookItem != null) {\n                    if (notebookItem.type === \"note\" || notebookItem.type === \"report\") {\n                        notebookItem.content = angular.fromJson(notebookItem.content);\n                    }\n                    // add/update notebook\n                    let workgroupId = notebookItem.workgroupId;\n                    if (this.notebooksByWorkgroup.hasOwnProperty(workgroupId)) {\n                        // we already have create a notebook for this workgroup before, so we'll append this notebook item to the array\n                        this.notebooksByWorkgroup[workgroupId].allItems.push(notebookItem);\n                    } else {\n                        // otherwise, we'll create a new notebook field and add the item to the array\n                        this.notebooksByWorkgroup[workgroupId] = { allItems: [notebookItem] };\n                    }\n\n                    this.groupNotebookItems();\n\n                    this.$rootScope.$broadcast('notebookUpdated', {notebook: this.notebooksByWorkgroup[workgroupId]});\n                }\n                return result.data;\n            });\n        }\n    };\n\n    saveNotebookToggleEvent(isOpen, currentNode) {\n        let nodeId = null, componentId = null, componentType = null, category = \"Notebook\";\n        let eventData = {\n            curentNodeId: currentNode == null ? null : currentNode.id\n        };\n        let event = isOpen ? \"notebookOpened\" : \"notebookClosed\";\n\n        // save notebook open/close event\n        this.StudentDataService.saveVLEEvent(nodeId, componentId, componentType, category, event, eventData);\n    };\n}\n\nNotebookService.$inject = [\n    '$http',\n    '$q',\n    '$rootScope',\n    'ConfigService',\n    'ProjectService',\n    'StudentAssetService',\n    'StudentDataService'\n];\n\nexport default NotebookService;\n"]}