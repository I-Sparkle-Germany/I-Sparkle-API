{"version":3,"sources":["notebookService.es6"],"names":["NotebookService","$http","$q","$rootScope","ConfigService","ProjectService","StudentAssetService","StudentDataService","config","enabled","label","enableAddNew","itemTypes","note","enableLink","enableClipping","enableStudentUploads","type","singular","plural","link","icon","color","question","report","notes","reports","notebook","allItems","items","deletedItems","notebookConfig","project","angular","merge","notebookItem","push","groupNotebookItems","$broadcast","ev","itemId","file","itemToDelete","i","length","item","splice","hasOwnProperty","last","reportId","getLatestNotebookItemByLocalNotebookItemId","templateReportItem","reportNotes","reportNote","id","localNotebookItemId","content","totalSizeSoFar","studentAsset","notebookItemSize","fileSize","totalSize","totalSizeMax","getStudentMaxTotalAssetsSize","usagePercentage","workgroupId","periodId","method","url","getStudentNotebookURL","params","then","response","allNotebookItems","data","n","studentAssetId","getAssetById","studentWorkId","studentWork","getStudentWorkByStudentWorkId","fromJson","calculateTotalUsage","ni","notebookItemLocalNotebookItemId","notebookItemLocalNotebookItemIdKey","allRevisionsForThisLocalNotebookItemId","lastRevision","serverDeleteTime","notebookItemId","nodeId","title","clientSaveTime","clientDeleteTime","isPreview","resolve","reject","headers","getWorkgroupId","getPeriodId","toJson","Date","parse","$","param","result","uploadAsset","isOpen","currentNode","componentId","componentType","category","eventData","curentNodeId","event","saveVLEEvent","$inject"],"mappings":"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","file":"notebookService.js","sourcesContent":["class NotebookService {\n    constructor($http,\n                $q,\n                $rootScope,\n                ConfigService,\n                ProjectService,\n                StudentAssetService,\n                StudentDataService) {\n\n        this.$http = $http;\n        this.$q = $q;\n        this.$rootScope = $rootScope;\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n        this.StudentAssetService = StudentAssetService;\n        this.StudentDataService = StudentDataService;\n\n        // default notebook configuration\n        // TODO: i18n\n        // TODO: decide on desired defaults\n        // TODO: allow wise instance to set default enabled/disabled for each type in wise config?\n        this.config = {\n            enabled: false,\n            label: \"Notebook\",\n            enableAddNew: true,\n            itemTypes: {\n                note: {\n                    enabled: true,\n                    enableLink: true,\n                    enableClipping: true,\n                    enableStudentUploads: true,\n                    type: \"note\",\n                    label: {\n                        singular: \"note\",\n                        plural: \"notes\",\n                        link: \"Notes\",\n                        icon: \"note\",\n                        color: \"#1565C0\"\n                    }\n                },\n                question: {\n                    enabled: false,\n                    enableLink: true,\n                    enableClipping: true,\n                    enableStudentUploads: true,\n                    type: \"question\",\n                    label: {\n                        singular: \"question\",\n                        plural: \"questions\",\n                        link: \"Questions\",\n                        icon: \"live_help\",\n                        color: \"#F57C00\"\n                    }\n                },\n                report: {\n                    enabled: false,\n                    label: {\n                        singular: \"report\",\n                        plural: \"reports\",\n                        link: \"Report\",\n                        icon: \"assignment\",\n                        color: \"#AD1457\"\n                    },\n                    notes: []\n                }\n            }\n        };\n\n        this.reports = [];\n        this.notebook = {};\n        this.notebook.allItems = [];\n        this.notebook.items = {};\n        this.notebook.deletedItems = {};\n\n        this.notebookConfig = {};\n        if (this.ProjectService.project) {\n            // get notebook config from project\n            this.notebookConfig = this.ProjectService.project.notebook;\n            // update local notebook config, preserving any defaults that aren't overriden\n            if (this.notebookConfig !== null && typeof this.notebookConfig === 'object') {\n                this.config = angular.merge(this.config, this.notebookConfig);\n            }\n        }\n    }\n\n    addItem(notebookItem) {\n        this.notebook.allItems.push(notebookItem);\n        this.groupNotebookItems();\n\n        // the current node is about to change\n        this.$rootScope.$broadcast('notebookUpdated', {notebook: this.notebook});\n    };\n\n    editItem(ev, itemId) {\n        // broadcast edit notebook item event\n        this.$rootScope.$broadcast('editNote', {itemId: itemId, ev: ev});\n    };\n\n    addNewItem(ev, file) {\n        // broadcast create new notebook item event\n        this.$rootScope.$broadcast('addNewNote', {ev: ev, file: file});\n    };\n\n    deleteItem(itemToDelete) {\n        let items = this.notebook.items;\n        let deletedItems = this.notebook.deletedItems;\n        for (let i = 0; i < items.length; i++) {\n            let item = items[i];\n            if (item === itemToDelete) {\n                items.splice(i, 1);\n                deletedItems.push(itemToDelete);\n            }\n        }\n    };\n\n    getLatestNotebookItemByLocalNotebookItemId(itemId) {\n        if (this.notebook.items.hasOwnProperty(itemId)) {\n            let items = this.notebook.items[itemId];\n            return items.last();\n        } else {\n            return null;\n        }\n    }\n\n    // returns student's report item if they've done work, or the template if they haven't.\n    getLatestNotebookReportItemByReportId(reportId) {\n        return this.getLatestNotebookItemByLocalNotebookItemId(reportId);\n    }\n\n    // returns the authored report item\n    getTemplateReportItemByReportId(reportId) {\n        let templateReportItem = null;\n        let reportNotes = this.notebookConfig.itemTypes.report.notes;\n        for (let i = 0; i < reportNotes.length; i++) {\n            let reportNote = reportNotes[i];\n            if (reportNote.reportId == reportId) {\n                templateReportItem = {\n                    id: null,\n                    type: \"report\",\n                    localNotebookItemId: reportId,\n                    content: reportNote\n                };\n                break;\n            }\n        }\n        return templateReportItem;\n    }\n\n    calculateTotalUsage() {\n        // get the total size\n        let totalSizeSoFar = 0;\n        for (let i = 0; i < this.notebook.items.length; i++) {\n            let notebookItem = this.notebook.items[i];\n            if (notebookItem.studentAsset != null) {\n                let notebookItemSize = notebookItem.studentAsset.fileSize;\n                totalSizeSoFar += notebookItemSize;\n            }\n        }\n        this.notebook.totalSize = totalSizeSoFar;\n        this.notebook.totalSizeMax = this.ConfigService.getStudentMaxTotalAssetsSize();\n        this.notebook.usagePercentage = this.notebook.totalSize / this.notebook.totalSizeMax * 100;\n    };\n\n    getNotebookConfig() {\n        return this.config;\n    };\n\n    isNotebookEnabled() {\n        return this.config.enabled;\n    };\n\n    retrieveNotebookItems(workgroupId = null, periodId = null) {\n        let config = {\n            method : 'GET',\n            url : this.ConfigService.getStudentNotebookURL(),\n            params : {}\n        };\n        if (workgroupId != null) {\n            config.params.workgroupId = workgroupId;\n        }\n        if (periodId != null) {\n            config.params.periodId = periodId;\n        }\n        return this.$http(config).then((response) => {\n            // loop through the assets and make them into JSON object with more details\n            this.notebook.allItems = [];  // clear local notebook items array\n            let allNotebookItems = response.data;\n            for (let n = 0; n < allNotebookItems.length; n++) {\n                let notebookItem = allNotebookItems[n];\n                if (notebookItem.studentAssetId != null) {\n                    // if this notebook item is a StudentAsset item, add the association here\n                    notebookItem.studentAsset = this.StudentAssetService.getAssetById(notebookItem.studentAssetId);\n                } else if (notebookItem.studentWorkId != null) {\n                    // if this notebook item is a StudentWork item, add the association here\n                    notebookItem.studentWork = this.StudentDataService.getStudentWorkByStudentWorkId(notebookItem.studentWorkId);\n                } else if (notebookItem.type === \"note\" || notebookItem.type === \"report\") {\n                    notebookItem.content = angular.fromJson(notebookItem.content);\n                }\n                this.notebook.allItems.push(notebookItem);\n            }\n            this.calculateTotalUsage();\n            this.groupNotebookItems(); // group notebook items based on item.localNotebookItemId\n\n            return this.notebook;\n        });\n    };\n\n    /**\n     * Groups the notebook items together in to a map-like structure inside this.notebook.items.\n     * {\n     *    \"abc123\": [{localNotebookItemId:\"abc123\", \"text\":\"first revision\"}, {localNotebookItemId:\"abc123\", \"text\":\"second revision\"}],\n     *    \"def456\": [{localNotebookItemId:\"def456\", \"text\":\"hello\"}, {localNotebookItemId:\"def456\", \"text\":\"hello my friend\"}]\n     * }\n     */\n    groupNotebookItems() {\n        this.notebook.items = {}; // reset items\n        this.notebook.deletedItems = {};  // reset deleted items\n        for (let ni = 0; ni < this.notebook.allItems.length; ni++) {\n            let notebookItem = this.notebook.allItems[ni];\n            let notebookItemLocalNotebookItemId = notebookItem.localNotebookItemId;\n            if (this.notebook.items.hasOwnProperty(notebookItemLocalNotebookItemId)) {\n                // if this was already added before, we'll append this notebook item to the array\n                this.notebook.items[notebookItemLocalNotebookItemId].push(notebookItem);\n            } else {\n                // otherwise, we'll create a new field and add the item to the array\n                this.notebook.items[notebookItemLocalNotebookItemId] = [notebookItem];\n            }\n        }\n        // now go through the items and look at the last revision of each item. If it's deleted, then move the entire item array to deletedItems\n        for (let notebookItemLocalNotebookItemIdKey in this.notebook.items) {\n            if (this.notebook.items.hasOwnProperty(notebookItemLocalNotebookItemIdKey)) {\n                // get the last note revision\n                let allRevisionsForThisLocalNotebookItemId = this.notebook.items[notebookItemLocalNotebookItemIdKey];\n                if (allRevisionsForThisLocalNotebookItemId != null) {\n                    let lastRevision = allRevisionsForThisLocalNotebookItemId[allRevisionsForThisLocalNotebookItemId.length - 1];\n                    if (lastRevision != null && lastRevision.serverDeleteTime != null) {\n                        // the last revision for this not deleted, so move the entire note (with all its revisions) to deletedItems\n                        this.notebook.deletedItems[notebookItemLocalNotebookItemIdKey] = allRevisionsForThisLocalNotebookItemId;\n                        delete this.notebook.items[notebookItemLocalNotebookItemIdKey];  // then remove it from the items array\n                    }\n                }\n            }\n        }\n    }\n\n    hasStudentWorkNotebookItem(studentWork) {\n        for (let i = 0; i < this.notebook.items.length; i++) {\n            let notebookItem = this.notebook.items[i];\n            if (notebookItem.studentWorkId === studentWork.id) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    saveNotebookItem(notebookItemId, nodeId, localNotebookItemId, type, title, content, clientSaveTime = null, clientDeleteTime = null) {\n        if (this.ConfigService.isPreview()) {\n            return this.$q((resolve, reject) => {\n                let notebookItem = {\n                    content: content,\n                    localNotebookItemId: localNotebookItemId,\n                    nodeId: nodeId,\n                    notebookItemId: notebookItemId,\n                    title: title,\n                    type: type,\n                    clientSaveTime: clientSaveTime,\n                    clientDeleteTime: clientDeleteTime\n                };\n                this.notebook.allItems.push(notebookItem);\n                this.groupNotebookItems();\n                this.$rootScope.$broadcast('notebookUpdated', {notebook: this.notebook});\n                resolve();\n            });\n        } else {\n            let config = {\n                method: \"POST\",\n                url: this.ConfigService.getStudentNotebookURL(),\n                headers: {'Content-Type': 'application/x-www-form-urlencoded'}\n            };\n            let params = {\n                workgroupId: this.ConfigService.getWorkgroupId(),\n                periodId: this.ConfigService.getPeriodId(),\n                notebookItemId: notebookItemId,\n                localNotebookItemId: localNotebookItemId,\n                nodeId: nodeId,\n                type: type,\n                title: title,\n                content: angular.toJson(content),\n                clientSaveTime: Date.parse(new Date()),\n                clientDeleteTime: clientDeleteTime\n            };\n            if (params.clientSaveTime == null) {\n                params.clientSaveTime = Date.parse(new Date());\n            }\n            config.data = $.param(params);\n\n            return this.$http(config).then((result) => {\n                let notebookItem = result.data;\n                if (notebookItem != null) {\n                    if (notebookItem.type === \"note\" || notebookItem.type === \"report\") {\n                        notebookItem.content = angular.fromJson(notebookItem.content);\n                    }\n                    // add/update notebook\n                    this.notebook.allItems.push(notebookItem);\n                    this.groupNotebookItems();\n\n                    this.$rootScope.$broadcast('notebookUpdated', {notebook: this.notebook});\n                }\n                return result.data;\n            });\n        }\n    };\n\n    uploadStudentAssetNotebookItem(file) {\n        this.StudentAssetService.uploadAsset(file).then((studentAsset) => {\n\n            let config = {\n                method: 'POST',\n                url: this.ConfigService.getStudentNotebookURL(),\n                headers: {'Content-Type': 'application/x-www-form-urlencoded'}\n            };\n            let params = {\n                workgroupId: this.ConfigService.getWorkgroupId(),\n                periodId: this.ConfigService.getPeriodId(),\n                studentAssetId: studentAsset.id,\n                clientSaveTime: Date.parse(new Date())\n            };\n            config.data = $.param(params);\n\n            return this.$http(config).then((result) => {\n                let notebookItem = result.data;\n                if (notebookItem != null) {\n                    notebookItem.studentAsset = this.StudentAssetService.getAssetById(notebookItem.studentAssetId);\n                    this.notebook.allItems.push(notebookItem);\n                    this.groupNotebookItems();\n                }\n                this.calculateTotalUsage();\n                return notebookItem;\n            });\n        });\n    }\n\n    saveNotebookToggleEvent(isOpen, currentNode) {\n        let nodeId = null, componentId = null, componentType = null, category = \"Notebook\";\n        let eventData = {\n            curentNodeId: currentNode == null ? null : currentNode.id\n        };\n        let event = isOpen ? \"notebookOpened\" : \"notebookClosed\";\n\n        // save notebook open/close event\n        this.StudentDataService.saveVLEEvent(nodeId, componentId, componentType, category, event, eventData);\n    };\n}\n\nNotebookService.$inject = [\n    '$http',\n    '$q',\n    '$rootScope',\n    'ConfigService',\n    'ProjectService',\n    'StudentAssetService',\n    'StudentDataService'\n];\n\nexport default NotebookService;\n"]}