{"version":3,"sources":["notebookService.es6"],"names":[],"mappings":"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","file":"notebookService.js","sourcesContent":["class NotebookService {\n    constructor($http,\n                $q,\n                $rootScope,\n                ConfigService,\n                ProjectService,\n                StudentAssetService,\n                StudentDataService) {\n\n        this.$http = $http;\n        this.$q = $q;\n        this.$rootScope = $rootScope;\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n        this.StudentAssetService = StudentAssetService;\n        this.StudentDataService = StudentDataService;\n\n        // default notebook configuration\n        // TODO: i18n\n        // TODO: decide on desired defaults\n        // TODO: allow wise instance to set default enabled/disabled for each type in wise config?\n        this.config = {\n            enabled: true,\n            label: \"Notebook\",\n            enableAddNew: true,\n            itemTypes: {\n                note: {\n                    enabled: true,\n                    enableLink: true,\n                    enableClipping: true,\n                    enableStudentUploads: true,\n                    type: \"note\",\n                    label: {\n                        singular: \"note\",\n                        plural: \"notes\",\n                        link: \"Notes\",\n                        icon: \"note\",\n                        color: \"#1565C0\"\n                    }\n                },\n                question: {\n                    enabled: false,\n                    enableLink: true,\n                    enableClipping: true,\n                    enableStudentUploads: true,\n                    type: \"question\",\n                    label: {\n                        singular: \"question\",\n                        plural: \"questions\",\n                        link: \"Questions\",\n                        icon: \"live_help\",\n                        color: \"#F57C00\"\n                    }\n                },\n                report: {\n                    enabled: false,\n                    label: {\n                        singular: \"report\",\n                        plural: \"reports\",\n                        link: \"Report\",\n                        icon: \"assignment\",\n                        color: \"#AD1457\"\n                    },\n                    notes: []\n                }\n            }\n        };\n\n        this.reports = [];\n        this.notebook = {};\n        this.notebook.allItems = [];\n        this.notebook.items = {};\n        this.notebook.deletedItems = [];\n\n        this.notebookConfig = {};\n        if (this.ProjectService.project) {\n            // get notebook config from project\n            this.notebookConfig = this.ProjectService.project.notebook;\n            // update local notebook config, preserving any defaults that aren't overriden\n            if (this.notebookConfig !== null && typeof this.notebookConfig === 'object') {\n                this.config = angular.merge(this.config, this.notebookConfig);\n            }\n        }\n\n    }\n\n    addItem(notebookItem) {\n        this.notebook.allItems.push(notebookItem);\n\n        this.groupNotebookItems();\n\n        // the current node is about to change\n        this.$rootScope.$broadcast('notebookUpdated', {notebook: this.notebook});\n    };\n\n    editItem(ev, itemId) {\n        // broadcast edit notebook item event\n        this.$rootScope.$broadcast('editNote', {itemId: itemId, ev: ev});\n    };\n\n    addNewItem(ev, file) {\n        // broadcast create new notebook item event\n        this.$rootScope.$broadcast('addNewNote', {ev: ev, file: file});\n    };\n\n    deleteItem(itemToDelete) {\n        var items = this.notebook.items;\n        var deletedItems = this.notebook.deletedItems;\n        for (var i = 0; i < items.length; i++) {\n            var item = items[i];\n            if (item === itemToDelete) {\n                items.splice(i, 1);\n                deletedItems.push(itemToDelete);\n            }\n        }\n    };\n\n    getLatestNotebookItemByLocalNotebookItemId(itemId) {\n        if (this.notebook.items.hasOwnProperty(itemId)) {\n            let items = this.notebook.items[itemId];\n            return items.last();\n        } else {\n            return null;\n        }\n    }\n\n    // returns student's report item if they've done work, or the template if they haven't.\n    getLatestNotebookReportItemByReportId(reportId) {\n        return this.getLatestNotebookItemByLocalNotebookItemId(reportId);\n    }\n\n    // returns the authored report item\n    getTemplateReportItemByReportId(reportId) {\n        let templateReportItem = null;\n        let reportNotes = this.notebookConfig.itemTypes.report.notes;\n        for (let i = 0; i < reportNotes.length; i++) {\n            let reportNote = reportNotes[i];\n            if (reportNote.reportId == reportId) {\n                templateReportItem = {};\n                templateReportItem.id = null;\n                templateReportItem.type = \"report\";\n                templateReportItem.localNotebookItemId = reportId;\n                templateReportItem.content = reportNote;\n                break;\n            }\n        }\n        return templateReportItem;\n    }\n\n    calculateTotalUsage() {\n        // get the total size\n        var totalSizeSoFar = 0;\n        for (var i = 0; i < this.notebook.items.length; i++) {\n            var notebookItem = this.notebook.items[i];\n            if (notebookItem.studentAsset != null) {\n                var notebookItemSize = notebookItem.studentAsset.fileSize;\n                totalSizeSoFar += notebookItemSize;\n            }\n        }\n        this.notebook.totalSize = totalSizeSoFar;\n        this.notebook.totalSizeMax = this.ConfigService.getStudentMaxTotalAssetsSize();\n        this.notebook.usagePercentage = this.notebook.totalSize / this.notebook.totalSizeMax * 100;\n    };\n\n    getNotebookConfig() {\n        return this.config;\n    };\n\n    isNotebookEnabled() {\n        return this.config.enabled;\n    };\n\n    retrieveNotebookItems(workgroupId = null) {\n        var config = {};\n        config.method = 'GET';\n        config.url = this.ConfigService.getStudentNotebookURL();\n        config.params = {};\n        if (workgroupId != null) {\n            config.params.workgroupId = workgroupId;\n        } else {\n            config.params.workgroupId = this.ConfigService.getWorkgroupId();\n            config.params.periodId = this.ConfigService.getPeriodId();\n        }\n        return this.$http(config).then((response) => {\n            // loop through the assets and make them into JSON object with more details\n            this.notebook.allItems = [];  // clear local notebook items array\n            var allNotebookItems = response.data;\n            for (var n = 0; n < allNotebookItems.length; n++) {\n                var notebookItem = allNotebookItems[n];\n                if (notebookItem.studentAssetId != null) {\n                    // if this notebook item is a StudentAsset item, add the association here\n                    notebookItem.studentAsset = this.StudentAssetService.getAssetById(notebookItem.studentAssetId);\n                } else if (notebookItem.studentWorkId != null) {\n                    // if this notebook item is a StudentWork item, add the association here\n                    notebookItem.studentWork = this.StudentDataService.getStudentWorkByStudentWorkId(notebookItem.studentWorkId);\n                } else if (notebookItem.type === \"note\" || notebookItem.type === \"report\") {\n                    notebookItem.content = angular.fromJson(notebookItem.content);\n                }\n                if (notebookItem.serverDeleteTime == null) {\n                    this.notebook.allItems.push(notebookItem);\n                } else {\n                    this.notebook.deletedItems.push(notebookItem)\n                }\n            }\n            this.calculateTotalUsage();\n\n            // now group notebook items based on item.localNotebookItemId\n            this.groupNotebookItems();\n\n            return this.notebook;\n        });\n    };\n\n    /**\n     * Groups the notebook items together in to a map-like structure inside this.notebook.items.\n     * {\n     *    \"abc123\": [{localNotebookItemId:\"abc123\", \"text\":\"first revision\"}, {localNotebookItemId:\"abc123\", \"text\":\"second revision\"}],\n     *    \"def456\": [{localNotebookItemId:\"def456\", \"text\":\"hello\"}, {localNotebookItemId:\"def456\", \"text\":\"hello my friend\"}]\n     * }\n     */\n    groupNotebookItems() {\n        this.notebook.items = {};\n        for (let ni = 0; ni < this.notebook.allItems.length; ni++) {\n            let notebookItem = this.notebook.allItems[ni];\n            let notebookItemLocalNotebookItemId = notebookItem.localNotebookItemId;\n            if (this.notebook.items.hasOwnProperty(notebookItemLocalNotebookItemId)) {\n                // if this was already added before, we'll append this notebook item to the array\n                this.notebook.items[notebookItemLocalNotebookItemId].push(notebookItem);\n            } else {\n                // otherwise, we'll create a new field and add the item to the array\n                this.notebook.items[notebookItemLocalNotebookItemId] = [notebookItem];\n            }\n        }\n    }\n\n    hasStudentWorkNotebookItem(studentWork) {\n        for (var i = 0; i < this.notebook.items.length; i++) {\n            var notebookItem = this.notebook.items[i];\n            if (notebookItem.studentWorkId === studentWork.id) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    saveNotebookItem(notebookItemId, nodeId, localNotebookItemId, type, title, content) {\n        if (this.ConfigService.isPreview()) {\n            return this.$q((resolve, reject) => {\n                let notebookItem = {\n                    type: type,\n                    content: content\n                };\n                this.notebook.items.push(notebookItem);\n                this.$rootScope.$broadcast('notebookUpdated', {notebook: this.notebook});\n                resolve();\n            });\n        } else {\n            var config = {};\n            config.method = 'POST';\n            config.url = this.ConfigService.getStudentNotebookURL();\n            config.headers = {'Content-Type': 'application/x-www-form-urlencoded'};\n            var params = {};\n            params.workgroupId = this.ConfigService.getWorkgroupId();\n            params.periodId = this.ConfigService.getPeriodId();\n            params.notebookItemId = notebookItemId;\n            params.localNotebookItemId = localNotebookItemId;\n            params.nodeId = nodeId;\n            params.type = type;\n            params.title = title;\n            params.content = angular.toJson(content);\n            params.clientSaveTime = Date.parse(new Date());\n            config.data = $.param(params);\n\n            return this.$http(config).then((result) => {\n                var notebookItem = result.data;\n                if (notebookItem != null) {\n                    if (notebookItem.type === \"note\" || notebookItem.type === \"report\") {\n                        notebookItem.content = angular.fromJson(notebookItem.content);\n                    }\n                    // add/update notebook\n                    this.notebook.allItems.push(notebookItem);\n                    this.groupNotebookItems();\n\n                    this.$rootScope.$broadcast('notebookUpdated', {notebook: this.notebook});\n                }\n                return result.data;\n            });\n        }\n    };\n\n    uploadStudentAssetNotebookItem(file) {\n        this.StudentAssetService.uploadAsset(file).then((studentAsset) => {\n\n            var config = {};\n            config.method = 'POST';\n            config.url = this.ConfigService.getStudentNotebookURL();\n            config.headers = {'Content-Type': 'application/x-www-form-urlencoded'};\n            var params = {};\n            params.workgroupId = this.ConfigService.getWorkgroupId();\n            params.periodId = this.ConfigService.getPeriodId();\n            params.studentAssetId = studentAsset.id;\n            params.clientSaveTime = Date.parse(new Date());\n\n            config.data = $.param(params);\n\n            return this.$http(config).then((result) => {\n                var notebookItem = result.data;\n                if (notebookItem != null) {\n                    notebookItem.studentAsset = this.StudentAssetService.getAssetById(notebookItem.studentAssetId);\n                    this.notebook.allItems.push(notebookItem);\n                    this.groupNotebookItems();\n                }\n                this.calculateTotalUsage();\n                return notebookItem;\n            });\n        });\n    }\n\n    saveNotebookToggleEvent(isOpen, currentNode) {\n        var nodeId = null;\n        var componentId = null;\n        var componentType = null;\n        var category = \"Notebook\";\n        var eventData = {};\n        eventData.curentNodeId = currentNode == null ? null : currentNode.id;\n\n        var event = isOpen ? \"notebookOpened\" : \"notebookClosed\";\n\n        // save notebook open/close event\n        this.StudentDataService.saveVLEEvent(nodeId, componentId, componentType, category, event, eventData);\n    };\n}\n\nNotebookService.$inject = [\n    '$http',\n    '$q',\n    '$rootScope',\n    'ConfigService',\n    'ProjectService',\n    'StudentAssetService',\n    'StudentDataService'\n];\n\nexport default NotebookService;\n"]}