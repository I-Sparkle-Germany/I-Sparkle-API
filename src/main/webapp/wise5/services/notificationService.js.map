{"version":3,"sources":["notificationService.es6"],"names":[],"mappings":"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","file":"notificationService.js","sourcesContent":["class NotificationService {\n    constructor($http, $rootScope, ConfigService, ProjectService) {\n\n        this.$http = $http;\n        this.$rootScope = $rootScope;\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n        this.notifications = [];  // an array of notifications that students haven't seen yet.\n\n        /**\n         * We received a new notification.\n         */\n        this.$rootScope.$on('newNotification', (event, notification) => {\n            if (notification != null) {\n                if (this.ConfigService.getWorkgroupId() === notification.toWorkgroupId) {\n                    notification.nodePosition = this.ProjectService.getNodePositionById(notification.nodeId);\n                    notification.nodePositionAndTitle = this.ProjectService.getNodePositionAndTitleByNodeId(notification.nodeId);\n                    this.notifications.push(notification);\n                }\n            }\n        });\n    }\n\n    /**\n     * Creates a new notification object\n     * @param notificationType type of notification [component, node, annotation, etc]\n     * @param nodeId id of node\n     * @param componentId id of component\n     * @param fromWorkgroupId id of workgroup that created this notification\n     * @param toWorkgroupId id of workgroup this notification is for\n     * @param message notification message\n     * @param data other extra information about this notification\n     * @returns newly created notification object\n     */\n    createNewNotification(notificationType, nodeId, componentId, fromWorkgroupId, toWorkgroupId, message, data=null) {\n        let nodePosition = this.ProjectService.getNodePositionById(nodeId);\n        let nodePositionAndTitle = this.ProjectService.getNodePositionAndTitleByNodeId(nodeId);\n        let component = this.ProjectService.getComponentByNodeIdAndComponentId(nodeId, componentId);\n        let componentType = null;\n        if (component != null) {\n            componentType = component.type;\n        }\n        return {\n            id: null,\n            type: notificationType,\n            nodeId: nodeId,\n            componentId: componentId,\n            componentType: componentType,\n            nodePosition: nodePosition,\n            nodePositionAndTitle: nodePositionAndTitle,\n            fromWorkgroupId: fromWorkgroupId,\n            toWorkgroupId: toWorkgroupId,\n            message: message,\n            data: data,\n            timeGenerated: Date.parse(new Date()),\n            timeDismissed: null\n        };\n    }\n\n    /**\n     * Retrieves notifications from the server\n     */\n    retrieveNotifications(toWorkgroupId = null) {\n        \n        var notificationURL = this.ConfigService.getNotificationURL();\n        \n        if (notificationURL == null) {\n            // the notification url is null most likely because we are in preview mode\n            return Promise.resolve(this.notifications);\n        } else {\n            // the notification url is not null so we will retrieve the notifications\n            let config = {};\n            config.method = 'GET';\n            config.url = this.ConfigService.getNotificationURL();\n            config.params = {};\n            if (toWorkgroupId != null) {\n                config.params.toWorkgroupId = toWorkgroupId;\n            } else {\n                config.params.toWorkgroupId = this.ConfigService.getWorkgroupId();\n                config.params.periodId = this.ConfigService.getPeriodId();\n            }\n            \n            return this.$http(config).then((response) => {\n                this.notifications = response.data;\n                // populate nodePosition and nodePositionAndTitle, where applicable\n                if (this.notifications != null) {\n                    this.notifications.map((notification) => {\n                        if (notification.nodeId != null) {\n                            notification.nodePosition = this.ProjectService.getNodePositionById(notification.nodeId);\n                            notification.nodePositionAndTitle = this.ProjectService.getNodePositionAndTitleByNodeId(notification.nodeId);\n                        }\n                    });\n                } else {\n                    this.notifications = [];\n                }\n\n                return this.notifications;\n            });\n        }\n    }\n\n    /**\n     * Saves the notification for the logged-in user\n     * @param notification\n     */\n    saveNotificationToServer(notification) {\n\n        let config = {};\n        config.method = 'POST';\n        config.url = this.ConfigService.getNotificationURL();\n        config.headers = {'Content-Type': 'application/x-www-form-urlencoded'};\n\n        let params = {};\n        if (notification.id != null) {\n            params.notificationId = notification.id;\n        }\n        params.periodId = this.ConfigService.getPeriodId();\n        params.fromWorkgroupId = notification.fromWorkgroupId;\n        params.toWorkgroupId = notification.toWorkgroupId;\n        params.nodeId = notification.nodeId;\n        params.componentId = notification.componentId;\n        params.componentType = notification.componentType;\n        params.type = notification.type;\n        params.message = notification.message;\n        if (notification.data != null) {\n            params.data = angular.toJson(notification.data);\n        }\n        params.timeGenerated = notification.timeGenerated;\n        if (notification.timeDismissed != null) {\n            params.timeDismissed = notification.timeDismissed;\n        }\n        config.data = $.param(params);\n\n        return this.$http(config).then((result) => {\n            let notification = result.data;\n            return notification;\n        })\n    }\n}\n\nNotificationService.$inject = [\n    '$http',\n    '$rootScope',\n    'ConfigService',\n    'ProjectService'\n];\n\nexport default NotificationService;\n"]}