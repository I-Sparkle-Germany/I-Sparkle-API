{"version":3,"sources":["projectAssetService.es6"],"names":["ProjectAssetService","$q","$http","$rootScope","ConfigService","Upload","projectAssets","projectAssetTotalSizeMax","getConfigParam","projectAssetUsagePercentage","assetItem","params","assetFileName","fileName","httpParams","method","url","headers","data","$","param","then","result","projectAssetsJSON","window","location","projectAssetURL","get","files","promises","map","file","upload","fields","progress","evt","progressPercentage","parseInt","loaded","total","success","status","config","uploadedFilename","name","alert","all","$inject"],"mappings":"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","file":"projectAssetService.js","sourcesContent":["class ProjectAssetService {\n    constructor($q, $http, $rootScope, ConfigService, Upload) {\n        this.$q = $q;\n        this.$http = $http;\n        this.$rootScope = $rootScope;\n        this.ConfigService = ConfigService;\n        this.Upload = Upload;\n        this.projectAssets = {};\n        this.projectAssetTotalSizeMax = this.ConfigService.getConfigParam('projectAssetTotalSizeMax');\n        this.projectAssetUsagePercentage = 0;\n    }\n\n    deleteAssetItem(assetItem) {\n\n        let params = {\n            assetFileName: assetItem.fileName\n        };\n\n        let httpParams = {\n            method: 'POST',\n            url: this.ConfigService.getConfigParam('projectAssetURL'),\n            headers: {'Content-Type': 'application/x-www-form-urlencoded'},\n            data: $.param(params)\n        };\n\n        return this.$http(httpParams).then((result) => {\n            let projectAssetsJSON = result.data;\n            this.projectAssets = projectAssetsJSON;\n            return projectAssetsJSON;\n        });\n    }\n\n    downloadAssetItem(assetItem) {\n      let assetFileName = assetItem.fileName;\n\n      // ask the browser to download this asset by setting the location\n      window.location = this.ConfigService.getConfigParam('projectAssetURL') + \"/download?assetFileName=\" + assetFileName;\n    }\n\n    getFullAssetItemURL(assetItem) {\n        return this.ConfigService.getConfigParam('projectBaseURL') + \"assets/\" + assetItem.fileName;\n    }\n\n    retrieveProjectAssets() {\n        var projectAssetURL = this.ConfigService.getConfigParam('projectAssetURL');\n\n        return this.$http.get(projectAssetURL).then((result) => {\n            var projectAssetsJSON = result.data;\n            this.projectAssets = projectAssetsJSON;\n            return projectAssetsJSON;\n        });\n    }\n\n    uploadAssets(files) {\n        var projectAssetURL = this.ConfigService.getConfigParam('projectAssetURL');\n\n        var promises = files.map((file) => {\n            return this.Upload.upload({\n                url: projectAssetURL,\n                fields: {\n                },\n                file: file\n            }).progress((evt) => {\n                var progressPercentage = parseInt(100.0 * evt.loaded / evt.total);\n                //console.log('progress: ' + progressPercentage + '% ' + evt.config.file.name);\n            }).success((result, status, headers, config) => {\n                // Only set the projectAssets if the result is an object.\n                // Sometimes it's an error message string.\n                if (typeof result === 'object') {\n                    // upload was successful.\n                    this.projectAssets = result;\n                    let uploadedFilename = config.file.name;\n                    return uploadedFilename;\n                } else if (typeof result === 'string') {\n                    // This is an error and should be displayed to the user.\n                    alert(result);\n                }\n\n                return result;\n            });\n        });\n        return this.$q.all(promises);\n    }\n}\n\nProjectAssetService.$inject = ['$q', '$http', '$rootScope', 'ConfigService', 'Upload'];\n\nexport default ProjectAssetService;\n"]}