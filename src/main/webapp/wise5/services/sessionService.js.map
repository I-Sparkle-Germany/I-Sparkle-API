{"version":3,"sources":["sessionService.es6"],"names":["SessionService","$http","$rootScope","ConfigService","warningVisible","checkMouseEventInMinutesInterval","showWarningInMinutesInterval","forceLogoutAfterWarningInMinutesInterval","lastActivityTimestamp","Date","initializeListeners","initializeSession","$on","goHome","logOut","wiseBaseURL","getWISEBaseURL","userType","getConfigParam","href","getMainHomePageURL","window","location","$broadcast","getSessionLogOutURL","isPreview","startCheckMouseEvent","setInterval","checkMouseEvent","convertMinutesToMilliseconds","minutes","isInactiveLongEnoughToForceLogout","forceLogOut","isInactiveLongEnoughToWarn","isShowingWarning","showWarning","getInactiveTimeInMinutes","Math","floor","getInactiveTimeInMilliseconds","$inject"],"mappings":"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","file":"sessionService.js","sourcesContent":["class SessionService {\n  constructor($http, $rootScope, ConfigService) {\n    this.$http = $http;\n    this.$rootScope = $rootScope;\n    this.ConfigService = ConfigService;\n    this.warningVisible = false;\n    this.checkMouseEventInMinutesInterval = 1;\n    this.showWarningInMinutesInterval = 25;\n    this.forceLogoutAfterWarningInMinutesInterval = 5;\n    this.lastActivityTimestamp = new Date();\n    this.initializeListeners();\n    this.initializeSession();\n  }\n\n  initializeListeners() {\n    this.$rootScope.$on('goHome', () => {\n      this.goHome();\n    });\n\n    this.$rootScope.$on('logOut', () => {\n      this.logOut();\n    });\n  }\n\n  goHome() {\n    const wiseBaseURL = this.ConfigService.getWISEBaseURL();\n    const userType = this.ConfigService.getConfigParam('userType');\n    let href = this.ConfigService.getMainHomePageURL();\n    if (userType === 'student') {\n      href = wiseBaseURL + '/student';\n    } else if (userType === 'teacher') {\n      href = wiseBaseURL + '/teacher';\n    }\n    window.location.href = href;\n  }\n\n  logOut() {\n    this.$rootScope.$broadcast('exit');\n    window.location.href = this.ConfigService.getSessionLogOutURL();\n  }\n\n  initializeSession() {\n    if (!this.ConfigService.isPreview()) {\n      this.startCheckMouseEvent();\n    }\n  }\n\n  startCheckMouseEvent() {\n    setInterval(() => { this.checkMouseEvent(); },\n        this.convertMinutesToMilliseconds(this.checkMouseEventInMinutesInterval));\n  }\n\n  convertMinutesToMilliseconds(minutes) {\n    return minutes * 60 * 1000;\n  }\n\n  /**\n   * Note: This does not get called when the warning popup is being shown.\n   */\n  mouseMoved() {\n    this.lastActivityTimestamp = new Date();\n  }\n\n  checkMouseEvent() {\n    if (this.isInactiveLongEnoughToForceLogout()) {\n      this.forceLogOut();\n    } else if (this.isInactiveLongEnoughToWarn() && !this.isShowingWarning()) {\n      this.showWarning();\n    }\n  }\n\n  isInactiveLongEnoughToForceLogout() {\n    return this.getInactiveTimeInMinutes() >=\n        (this.showWarningInMinutesInterval + this.forceLogoutAfterWarningInMinutesInterval);\n  }\n\n  isInactiveLongEnoughToWarn() {\n    return this.getInactiveTimeInMinutes() >= this.showWarningInMinutesInterval;\n  }\n\n  isShowingWarning() {\n    return this.warningVisible;\n  }\n\n  getInactiveTimeInMinutes() {\n    return Math.floor(this.getInactiveTimeInMilliseconds() / 1000 / 60);\n  }\n\n  getInactiveTimeInMilliseconds() {\n    return new Date() - this.lastActivityTimestamp;\n  }\n\n  forceLogOut() {\n    this.$rootScope.$broadcast('logOut');\n  }\n\n  showWarning() {\n    this.warningVisible = true;\n    this.$rootScope.$broadcast('showSessionWarning');\n  }\n\n  renewSession() {\n    this.lastActivityTimestamp = new Date();\n    this.warningVisible = false;\n  }\n}\n\nSessionService.$inject = [\n  '$http',\n  '$rootScope',\n  'ConfigService'\n];\n\nexport default SessionService;\n"]}