{"version":3,"sources":["studentAssetService.es6"],"names":["StudentAssetService","$filter","$http","$q","Upload","$rootScope","ConfigService","$translate","allAssets","assetId","a","length","asset","id","isPreview","deferred","defer","resolve","promise","config","method","url","getStudentAssetsURL","params","workgroupId","getWorkgroupId","then","response","result","assets","data","studentUploadsBaseURL","getStudentUploadsBaseURL","isReferenced","serverDeleteTime","fileName","filePath","isImage","type","iconURL","isAudio","push","assetContentURL","imageFileExtensions","assetURL","lastIndexOf","assetExtension","substring","indexOf","toLowerCase","file","reject","reader","FileReader","onload","theFile","e","fileSrc","target","name","$broadcast","readAsDataURL","studentAssetsURL","upload","fields","getRunId","getPeriodId","Date","parse","success","status","headers","alert","error","files","promises","map","progress","evt","progressPercentage","parseInt","loaded","total","all","studentAsset","studentAssetId","periodId","clientSaveTime","$","param","copiedAsset","clientDeleteTime","splice","$inject"],"mappings":"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","file":"studentAssetService.js","sourcesContent":["'use strict';\n\nclass StudentAssetService {\n  constructor($filter,\n              $http,\n              $q,\n              Upload,\n              $rootScope,\n              ConfigService) {\n\n    this.$filter = $filter;\n    this.$http = $http;\n    this.$q = $q;\n    this.Upload = Upload;\n    this.$rootScope = $rootScope;\n    this.ConfigService = ConfigService;\n\n    this.$translate = this.$filter('translate');\n\n    this.allAssets = [];  // keep track of student's assets\n  }\n\n  getAssetById(assetId) {\n    for (var a = 0; a < this.allAssets.length; a++) {\n      var asset = this.allAssets[a];\n      if (asset.id === assetId) {\n        return asset;\n      }\n    }\n    return null;\n  };\n\n  retrieveAssets() {\n    if (this.ConfigService.isPreview()) {\n      // if we're in preview, don't make any request to the server but pretend we did\n      this.allAssets = [];\n      let deferred = this.$q.defer();\n      deferred.resolve(this.allAssets);\n      return deferred.promise;\n    } else {\n      let config = {\n        method: \"GET\",\n        url: this.ConfigService.getStudentAssetsURL(),\n        params: {\n          workgroupId: this.ConfigService.getWorkgroupId()\n        }\n      };\n      return this.$http(config).then((response) => {\n        // loop through the assets and make them into JSON object with more details\n        let result = [];\n        let assets = response.data;\n        let studentUploadsBaseURL = this.ConfigService.getStudentUploadsBaseURL();\n        for (let a = 0; a < assets.length; a++) {\n          let asset = assets[a];\n          if (!asset.isReferenced && asset.serverDeleteTime == null && asset.fileName !== '.DS_Store') {\n            asset.url = studentUploadsBaseURL + asset.filePath;\n            if (this.isImage(asset)) {\n              asset.type = 'image';\n              asset.iconURL = asset.url;\n            } else if (this.isAudio(asset)) {\n              asset.type = 'audio';\n              asset.iconURL = 'wise5/vle/notebook/audio.png';\n            } else {\n              asset.type = 'file';\n              asset.iconURL = 'wise5/vle/notebook/file.png';\n            }\n            result.push(asset);\n          }\n        }\n        this.allAssets = result;\n        return result;\n      });\n    }\n  };\n\n  getAssetContent(asset) {\n    var assetContentURL = asset.url;\n\n    // retrieve the csv file and parse it\n    var config = {};\n    config.method = 'GET';\n    config.url = assetContentURL;\n    return this.$http(config).then((response) => {\n      return response.data;\n    });\n  };\n\n  isImage(asset) {\n    var isImage = false;\n    var imageFileExtensions = ['png', 'jpg', 'jpeg', 'gif'];\n    if (asset != null) {\n      var assetURL = asset.url;\n      if (assetURL != null && assetURL.lastIndexOf('.') !== -1) {\n        var assetExtension = assetURL.substring(assetURL.lastIndexOf('.') + 1);\n        if (imageFileExtensions.indexOf(assetExtension.toLowerCase()) != -1) {\n          isImage = true;\n        }\n      }\n    }\n    return isImage;\n  };\n\n  isAudio(asset) {\n    var isAudio = false;\n    var imageFileExtensions = ['wav', 'mp3', 'ogg', 'm4a', 'm4p', 'raw', 'aiff'];\n    if (asset != null) {\n      var assetURL = asset.url;\n      if (assetURL != null && assetURL.lastIndexOf('.') != -1) {\n        var assetExtension = assetURL.substring(assetURL.lastIndexOf('.') + 1);\n        if (imageFileExtensions.indexOf(assetExtension.toLowerCase()) != -1) {\n          isAudio = true;\n        }\n      }\n    }\n    return isAudio;\n  };\n\n  uploadAsset(file) {\n    if (this.ConfigService.isPreview()) {\n      return this.$q((resolve, reject) => {\n        var reader = new FileReader();\n\n        // Closure to capture the file information.\n        reader.onload = ( (theFile) => {\n          return (e) => {\n            let fileSrc = e.target.result;\n            let fileName = theFile.name;\n\n            let asset = {};\n            asset.file = file;\n            asset.url = fileSrc;\n            // assume this is an image for now. in the future, support audio and other file formats.\n            asset.type = 'image';\n            asset.iconURL = asset.url;\n\n            this.allAssets.push(asset);\n            this.$rootScope.$broadcast('studentAssetsUpdated');\n            return resolve(asset);\n          };\n        })(file);\n\n        // Read in the image file as a data URL.\n        reader.readAsDataURL(file);\n      });\n    } else {\n      var studentAssetsURL = this.ConfigService.getStudentAssetsURL();\n      var deferred = this.$q.defer();\n\n      this.Upload.upload({\n        url: studentAssetsURL,\n        fields: {\n          'runId': this.ConfigService.getRunId(),\n          'workgroupId': this.ConfigService.getWorkgroupId(),\n          'periodId': this.ConfigService.getPeriodId(),\n          'clientSaveTime': Date.parse(new Date())\n        },\n        file: file\n      }).success((asset, status, headers, config) => {\n        if (asset === \"error\") {\n          alert(this.$translate('THERE_WAS_AN_ERROR_UPLOADING'));\n        } else {\n          var studentUploadsBaseURL = this.ConfigService.getStudentUploadsBaseURL();\n          asset.url = studentUploadsBaseURL + asset.filePath;\n          if (this.isImage(asset)) {\n            asset.type = 'image';\n            asset.iconURL = asset.url;\n          } else if (this.isAudio(asset)) {\n            asset.type = 'audio';\n            asset.iconURL = 'wise5/vle/notebook/audio.png';\n          } else {\n            asset.type = 'file';\n            asset.iconURL = 'wise5/vle/notebook/file.png';\n          }\n          this.allAssets.push(asset);\n          this.$rootScope.$broadcast('studentAssetsUpdated');\n          deferred.resolve(asset);\n        }\n      }).error((asset, status, headers, config) => {\n        alert(this.$translate('THERE_WAS_AN_ERROR_UPLOADING_YOU_MIGHT_HAVE_REACHED_LIMIT'));\n      });\n\n      return deferred.promise;\n    }\n  };\n\n  uploadAssets(files) {\n    var studentAssetsURL = this.ConfigService.getStudentAssetsURL();\n    var promises = files.map((file) => {\n      return this.Upload.upload({\n        url: studentAssetsURL,\n        fields: {\n          'runId': this.ConfigService.getRunId(),\n          'workgroupId': this.ConfigService.getWorkgroupId(),\n          'periodId': this.ConfigService.getPeriodId(),\n          'clientSaveTime': Date.parse(new Date())\n        },\n        file: file\n      }).progress((evt) => {\n        var progressPercentage = parseInt(100.0 * evt.loaded / evt.total);\n        //console.log('progress: ' + progressPercentage + '% ' + evt.config.file.name);\n      }).success((data, status, headers, config) => {\n        //console.log('file ' + config.file.name + 'uploaded. Response: ' + JSON.stringify(data));\n      });\n    });\n    return this.$q.all(promises);\n  };\n\n  // given asset, makes a copy of it so steps can use for reference. Returns newly-copied asset.\n  copyAssetForReference(studentAsset) {\n    if (this.ConfigService.isPreview()) {\n      return this.$q((resolve, reject) => {\n        return resolve(studentAsset);\n      });\n    } else {\n      var config = {};\n      config.method = 'POST';\n      config.url = this.ConfigService.getStudentAssetsURL() + '/copy';\n      config.headers = {'Content-Type': 'application/x-www-form-urlencoded'};\n      var params = {};\n      params.studentAssetId = studentAsset.id;\n      params.workgroupId = this.ConfigService.getWorkgroupId();\n      params.periodId = this.ConfigService.getPeriodId();\n      params.clientSaveTime = Date.parse(new Date());\n\n      config.data = $.param(params);\n\n      return this.$http(config).then((result) => {\n        var copiedAsset = result.data;\n        if (copiedAsset != null) {\n          var studentUploadsBaseURL = this.ConfigService.getStudentUploadsBaseURL();\n          if (copiedAsset.isReferenced && copiedAsset.fileName !== '.DS_Store') {\n            copiedAsset.url = studentUploadsBaseURL + copiedAsset.filePath;\n            if (this.isImage(copiedAsset)) {\n              copiedAsset.type = 'image';\n              copiedAsset.iconURL = copiedAsset.url;\n            } else if (this.isAudio(copiedAsset)) {\n              copiedAsset.type = 'audio';\n              copiedAsset.iconURL = 'wise5/vle/notebook/audio.png';\n            } else {\n              copiedAsset.type = 'file';\n              copiedAsset.iconURL = 'wise5/vle/notebook/file.png';\n            }\n            //this.$rootScope.$broadcast('studentAssetsUpdated');\n            return copiedAsset;\n          }\n        }\n        return null;\n      });\n    }\n  };\n\n  deleteAsset(studentAsset) {\n    var config = {};\n    config.method = 'POST';\n    config.url = this.ConfigService.getStudentAssetsURL() + '/remove';\n    config.headers = {'Content-Type': 'application/x-www-form-urlencoded'};\n    var params = {};\n    params.studentAssetId = studentAsset.id;\n    params.workgroupId = this.ConfigService.getWorkgroupId();\n    params.periodId = this.ConfigService.getPeriodId();\n    params.clientDeleteTime = Date.parse(new Date());\n    config.data = $.param(params);\n\n    return this.$http(config).then((result) => {\n      //var deletedAsset = result.data;\n      // also remove from local copy of all assets\n      this.allAssets = this.allAssets.splice(this.allAssets.indexOf(studentAsset), 1);\n      this.$rootScope.$broadcast('studentAssetsUpdated');\n      return studentAsset;\n    });\n  };\n}\n\nStudentAssetService.$inject = [\n  '$filter',\n  '$http',\n  '$q',\n  'Upload',\n  '$rootScope',\n  'ConfigService'];\n\nexport default StudentAssetService;\n"]}