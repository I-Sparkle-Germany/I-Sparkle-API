{"version":3,"sources":["studentAssetService.es6"],"names":["StudentAssetService","$filter","$http","$q","Upload","$rootScope","ConfigService","$translate","allAssets","assetId","asset","id","isPreview","deferred","defer","resolve","promise","config","method","url","getStudentAssetsURL","params","workgroupId","getWorkgroupId","then","response","result","assets","data","studentUploadsBaseURL","getStudentUploadsBaseURL","isReferenced","serverDeleteTime","fileName","filePath","isImage","type","iconURL","isAudio","push","assetContentURL","imageFileExtensions","assetURL","lastIndexOf","assetExtension","substring","indexOf","toLowerCase","file","reject","reader","FileReader","onload","theFile","e","fileSrc","target","name","$broadcast","readAsDataURL","studentAssetsURL","upload","fields","getRunId","getPeriodId","Date","parse","success","status","headers","alert","error","files","promises","map","progress","evt","progressPercentage","parseInt","loaded","total","all","studentAsset","studentAssetId","periodId","clientSaveTime","$","param","copiedAsset","clientDeleteTime","splice","$inject"],"mappings":"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","file":"studentAssetService.js","sourcesContent":["'use strict';\n\nclass StudentAssetService {\n  constructor(\n      $filter,\n      $http,\n      $q,\n      Upload,\n      $rootScope,\n      ConfigService) {\n    this.$filter = $filter;\n    this.$http = $http;\n    this.$q = $q;\n    this.Upload = Upload;\n    this.$rootScope = $rootScope;\n    this.ConfigService = ConfigService;\n    this.$translate = this.$filter('translate');\n    this.allAssets = [];  // keep track of student's assets\n  }\n\n  getAssetById(assetId) {\n    for (let asset of this.allAssets) {\n      if (asset.id === assetId) {\n        return asset;\n      }\n    }\n    return null;\n  };\n\n  retrieveAssets() {\n    if (this.ConfigService.isPreview()) {\n      // if we're in preview, don't make any request to the server but pretend we did\n      this.allAssets = [];\n      let deferred = this.$q.defer();\n      deferred.resolve(this.allAssets);\n      return deferred.promise;\n    } else {\n      let config = {\n        method: \"GET\",\n        url: this.ConfigService.getStudentAssetsURL(),\n        params: {\n          workgroupId: this.ConfigService.getWorkgroupId()\n        }\n      };\n      return this.$http(config).then((response) => {\n        // loop through the assets and make them into JSON object with more details\n        let result = [];\n        let assets = response.data;\n        let studentUploadsBaseURL = this.ConfigService.getStudentUploadsBaseURL();\n        for (let asset of assets) {\n          if (!asset.isReferenced && asset.serverDeleteTime == null && asset.fileName !== '.DS_Store') {\n            asset.url = studentUploadsBaseURL + asset.filePath;\n            if (this.isImage(asset)) {\n              asset.type = 'image';\n              asset.iconURL = asset.url;\n            } else if (this.isAudio(asset)) {\n              asset.type = 'audio';\n              asset.iconURL = 'wise5/vle/notebook/audio.png';\n            } else {\n              asset.type = 'file';\n              asset.iconURL = 'wise5/vle/notebook/file.png';\n            }\n            result.push(asset);\n          }\n        }\n        this.allAssets = result;\n        return result;\n      });\n    }\n  };\n\n  getAssetContent(asset) {\n    const assetContentURL = asset.url;\n\n    // retrieve the csv file and parse it\n    const config = {};\n    config.method = 'GET';\n    config.url = assetContentURL;\n    return this.$http(config).then((response) => {\n      return response.data;\n    });\n  };\n\n  isImage(asset) {\n    let isImage = false;\n    const imageFileExtensions = ['png', 'jpg', 'jpeg', 'gif'];\n    if (asset != null) {\n      const assetURL = asset.url;\n      if (assetURL != null && assetURL.lastIndexOf('.') !== -1) {\n        const assetExtension = assetURL.substring(assetURL.lastIndexOf('.') + 1);\n        if (imageFileExtensions.indexOf(assetExtension.toLowerCase()) != -1) {\n          isImage = true;\n        }\n      }\n    }\n    return isImage;\n  };\n\n  isAudio(asset) {\n    let isAudio = false;\n    const imageFileExtensions = ['wav', 'mp3', 'ogg', 'm4a', 'm4p', 'raw', 'aiff'];\n    if (asset != null) {\n      const assetURL = asset.url;\n      if (assetURL != null && assetURL.lastIndexOf('.') != -1) {\n        const assetExtension = assetURL.substring(assetURL.lastIndexOf('.') + 1);\n        if (imageFileExtensions.indexOf(assetExtension.toLowerCase()) != -1) {\n          isAudio = true;\n        }\n      }\n    }\n    return isAudio;\n  };\n\n  uploadAsset(file) {\n    if (this.ConfigService.isPreview()) {\n      return this.$q((resolve, reject) => {\n        const reader = new FileReader();\n\n        // Closure to capture the file information.\n        reader.onload = ( (theFile) => {\n          return (e) => {\n            let fileSrc = e.target.result;\n            let fileName = theFile.name;\n\n            let asset = {};\n            asset.file = file;\n            asset.url = fileSrc;\n            // assume this is an image for now. in the future, support audio and other file formats.\n            asset.type = 'image';\n            asset.iconURL = asset.url;\n\n            this.allAssets.push(asset);\n            this.$rootScope.$broadcast('studentAssetsUpdated');\n            return resolve(asset);\n          };\n        })(file);\n\n        // Read in the image file as a data URL.\n        reader.readAsDataURL(file);\n      });\n    } else {\n      const studentAssetsURL = this.ConfigService.getStudentAssetsURL();\n      const deferred = this.$q.defer();\n\n      this.Upload.upload({\n        url: studentAssetsURL,\n        fields: {\n          'runId': this.ConfigService.getRunId(),\n          'workgroupId': this.ConfigService.getWorkgroupId(),\n          'periodId': this.ConfigService.getPeriodId(),\n          'clientSaveTime': Date.parse(new Date())\n        },\n        file: file\n      }).success((asset, status, headers, config) => {\n        if (asset === \"error\") {\n          alert(this.$translate('THERE_WAS_AN_ERROR_UPLOADING'));\n        } else {\n          const studentUploadsBaseURL = this.ConfigService.getStudentUploadsBaseURL();\n          asset.url = studentUploadsBaseURL + asset.filePath;\n          if (this.isImage(asset)) {\n            asset.type = 'image';\n            asset.iconURL = asset.url;\n          } else if (this.isAudio(asset)) {\n            asset.type = 'audio';\n            asset.iconURL = 'wise5/vle/notebook/audio.png';\n          } else {\n            asset.type = 'file';\n            asset.iconURL = 'wise5/vle/notebook/file.png';\n          }\n          this.allAssets.push(asset);\n          this.$rootScope.$broadcast('studentAssetsUpdated');\n          deferred.resolve(asset);\n        }\n      }).error((asset, status, headers, config) => {\n        alert(this.$translate('THERE_WAS_AN_ERROR_UPLOADING_YOU_MIGHT_HAVE_REACHED_LIMIT'));\n      });\n\n      return deferred.promise;\n    }\n  };\n\n  uploadAssets(files) {\n    const studentAssetsURL = this.ConfigService.getStudentAssetsURL();\n    const promises = files.map((file) => {\n      return this.Upload.upload({\n        url: studentAssetsURL,\n        fields: {\n          'runId': this.ConfigService.getRunId(),\n          'workgroupId': this.ConfigService.getWorkgroupId(),\n          'periodId': this.ConfigService.getPeriodId(),\n          'clientSaveTime': Date.parse(new Date())\n        },\n        file: file\n      }).progress((evt) => {\n        const progressPercentage = parseInt(100.0 * evt.loaded / evt.total);\n        //console.log('progress: ' + progressPercentage + '% ' + evt.config.file.name);\n      }).success((data, status, headers, config) => {\n        //console.log('file ' + config.file.name + 'uploaded. Response: ' + JSON.stringify(data));\n      });\n    });\n    return this.$q.all(promises);\n  };\n\n  // given asset, makes a copy of it so steps can use for reference. Returns newly-copied asset.\n  copyAssetForReference(studentAsset) {\n    if (this.ConfigService.isPreview()) {\n      return this.$q((resolve, reject) => {\n        return resolve(studentAsset);\n      });\n    } else {\n      const config = {};\n      config.method = 'POST';\n      config.url = this.ConfigService.getStudentAssetsURL() + '/copy';\n      config.headers = {'Content-Type': 'application/x-www-form-urlencoded'};\n      const params = {};\n      params.studentAssetId = studentAsset.id;\n      params.workgroupId = this.ConfigService.getWorkgroupId();\n      params.periodId = this.ConfigService.getPeriodId();\n      params.clientSaveTime = Date.parse(new Date());\n\n      config.data = $.param(params);\n\n      return this.$http(config).then((result) => {\n        const copiedAsset = result.data;\n        if (copiedAsset != null) {\n          const studentUploadsBaseURL = this.ConfigService.getStudentUploadsBaseURL();\n          if (copiedAsset.isReferenced && copiedAsset.fileName !== '.DS_Store') {\n            copiedAsset.url = studentUploadsBaseURL + copiedAsset.filePath;\n            if (this.isImage(copiedAsset)) {\n              copiedAsset.type = 'image';\n              copiedAsset.iconURL = copiedAsset.url;\n            } else if (this.isAudio(copiedAsset)) {\n              copiedAsset.type = 'audio';\n              copiedAsset.iconURL = 'wise5/vle/notebook/audio.png';\n            } else {\n              copiedAsset.type = 'file';\n              copiedAsset.iconURL = 'wise5/vle/notebook/file.png';\n            }\n            //this.$rootScope.$broadcast('studentAssetsUpdated');\n            return copiedAsset;\n          }\n        }\n        return null;\n      });\n    }\n  };\n\n  deleteAsset(studentAsset) {\n    const config = {};\n    config.method = 'POST';\n    config.url = this.ConfigService.getStudentAssetsURL() + '/remove';\n    config.headers = {'Content-Type': 'application/x-www-form-urlencoded'};\n    const params = {};\n    params.studentAssetId = studentAsset.id;\n    params.workgroupId = this.ConfigService.getWorkgroupId();\n    params.periodId = this.ConfigService.getPeriodId();\n    params.clientDeleteTime = Date.parse(new Date());\n    config.data = $.param(params);\n\n    return this.$http(config).then((result) => {\n      //const deletedAsset = result.data;\n      // also remove from local copy of all assets\n      this.allAssets = this.allAssets.splice(this.allAssets.indexOf(studentAsset), 1);\n      this.$rootScope.$broadcast('studentAssetsUpdated');\n      return studentAsset;\n    });\n  };\n}\n\nStudentAssetService.$inject = [\n  '$filter',\n  '$http',\n  '$q',\n  'Upload',\n  '$rootScope',\n  'ConfigService'];\n\nexport default StudentAssetService;\n"]}