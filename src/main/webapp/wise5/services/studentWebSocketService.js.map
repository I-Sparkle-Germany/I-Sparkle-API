{"version":3,"sources":["studentWebSocketService.es6"],"names":["StudentWebSocketService","$rootScope","AnnotationService","ConfigService","runId","getRunId","periodId","getPeriodId","workgroupId","getWorkgroupId","$stomp","subscribe","message","headers","res","type","$broadcast","data","content","studentWork","JSON","parse","notification","annotationData","addOrUpdateAnnotation","annotation","$inject"],"mappings":"AAAA;;;;;;;;;;;;;IAEMA,uB;;;AACJ,mCACIC,UADJ,EAEI;AACAC,EAAAA,iBAHJ,EAIIC,aAJJ,EAImB;AAAA;;AACjB,SAAKF,UAAL,GAAkBA,UAAlB,CADiB,CAEjB;;AACA,SAAKC,iBAAL,GAAyBA,iBAAzB;AACA,SAAKC,aAAL,GAAqBA,aAArB;AACD;;;;iCAEY;AACX,WAAKC,KAAL,GAAa,KAAKD,aAAL,CAAmBE,QAAnB,EAAb;AACA,WAAKC,QAAL,GAAgB,KAAKH,aAAL,CAAmBI,WAAnB,EAAhB;AACA,WAAKC,WAAL,GAAmB,KAAKL,aAAL,CAAmBM,cAAnB,EAAnB;AACA;;;;;;;;;;AAUD;;;gDAE2B;AAAA;;AAC1B,WAAKC,MAAL,CAAYC,SAAZ,4BAA0C,KAAKP,KAA/C,cAAwD,KAAKE,QAA7D,GAAyE,UAACM,OAAD,EAAUC,OAAV,EAAmBC,GAAnB,EAA2B;AAClG,YAAIF,OAAO,CAACG,IAAR,KAAiB,OAArB,EAA8B;AAC5B,UAAA,KAAI,CAACd,UAAL,CAAgBe,UAAhB,CAA2B,aAA3B,EAA0C;AAACC,YAAAA,IAAI,EAAEL,OAAO,CAACM;AAAf,WAA1C;AACD,SAFD,MAEO,IAAIN,OAAO,CAACG,IAAR,KAAiB,SAArB,EAAgC;AACrC,UAAA,KAAI,CAACd,UAAL,CAAgBe,UAAhB,CAA2B,eAA3B,EAA4C;AAACC,YAAAA,IAAI,EAAEL,OAAO,CAACM;AAAf,WAA5C;AACD,SAFM,MAEA,IAAIN,OAAO,CAACG,IAAR,KAAiB,aAArB,EAAoC;AACzC,cAAMI,WAAW,GAAGC,IAAI,CAACC,KAAL,CAAWT,OAAO,CAACM,OAAnB,CAApB;;AACA,UAAA,KAAI,CAACjB,UAAL,CAAgBe,UAAhB,CAA2B,qBAA3B,EAAkDG,WAAlD;AACD;AACF,OATD;AAUD;;;gDAE2B;AAAA;;AAC1B,WAAKT,MAAL,CAAYC,SAAZ,4BAA0C,KAAKH,WAA/C,GAA8D,UAACI,OAAD,EAAUC,OAAV,EAAmBC,GAAnB,EAA2B;AACvF,YAAIF,OAAO,CAACG,IAAR,KAAiB,cAArB,EAAqC;AACnC,cAAMO,YAAY,GAAGF,IAAI,CAACC,KAAL,CAAWT,OAAO,CAACM,OAAnB,CAArB;;AACA,UAAA,MAAI,CAACjB,UAAL,CAAgBe,UAAhB,CAA2B,yBAA3B,EAAsDM,YAAtD;AACD,SAHD,MAGO,IAAIV,OAAO,CAACG,IAAR,KAAiB,YAArB,EAAmC;AACxC,cAAMQ,cAAc,GAAGH,IAAI,CAACC,KAAL,CAAWT,OAAO,CAACM,OAAnB,CAAvB;;AACA,UAAA,MAAI,CAAChB,iBAAL,CAAuBsB,qBAAvB,CAA6CD,cAA7C;;AACA,UAAA,MAAI,CAACtB,UAAL,CAAgBe,UAAhB,CAA2B,uBAA3B,EAAoD;AAACS,YAAAA,UAAU,EAAEF;AAAb,WAApD;AACD;AACF,OATD;AAUD;;;;;;AAGHvB,uBAAuB,CAAC0B,OAAxB,GAAkC,CAChC,YADgC,EAEhC;AACA,mBAHgC,EAIhC,eAJgC,CAAlC;eAOe1B,uB","sourcesContent":["'use strict';\n\nclass StudentWebSocketService {\n  constructor(\n      $rootScope,\n      //$stomp,\n      AnnotationService,\n      ConfigService) {\n    this.$rootScope = $rootScope;\n    //this.$stomp = $stomp;\n    this.AnnotationService = AnnotationService;\n    this.ConfigService = ConfigService;\n  }\n\n  initialize() {\n    this.runId = this.ConfigService.getRunId();\n    this.periodId = this.ConfigService.getPeriodId();\n    this.workgroupId = this.ConfigService.getWorkgroupId();\n    /*\n    try {\n      this.$stomp.connect(this.ConfigService.getWebSocketURL()).then((frame) => {\n        this.subscribeToClassroomTopic();\n        this.subscribeToWorkgroupTopic();\n      });\n    } catch(e) {\n      console.log(e);\n    }\n    */\n  }\n\n  subscribeToClassroomTopic() {\n    this.$stomp.subscribe(`/topic/classroom/${this.runId}/${this.periodId}`, (message, headers, res) => {\n      if (message.type === 'pause') {\n        this.$rootScope.$broadcast('pauseScreen', {data: message.content});\n      } else if (message.type === 'unpause') {\n        this.$rootScope.$broadcast('unPauseScreen', {data: message.content});\n      } else if (message.type === 'studentWork') {\n        const studentWork = JSON.parse(message.content);\n        this.$rootScope.$broadcast('studentWorkReceived', studentWork);\n      }\n    });\n  }\n\n  subscribeToWorkgroupTopic() {\n    this.$stomp.subscribe(`/topic/workgroup/${this.workgroupId}`, (message, headers, res) => {\n      if (message.type === 'notification') {\n        const notification = JSON.parse(message.content);\n        this.$rootScope.$broadcast('newNotificationReceived', notification);\n      } else if (message.type === 'annotation') {\n        const annotationData = JSON.parse(message.content);\n        this.AnnotationService.addOrUpdateAnnotation(annotationData);\n        this.$rootScope.$broadcast('newAnnotationReceived', {annotation: annotationData});\n      }\n    });\n  }\n}\n\nStudentWebSocketService.$inject = [\n  '$rootScope',\n  //'$stomp',\n  'AnnotationService',\n  'ConfigService'\n];\n\nexport default StudentWebSocketService;\n"],"file":"studentWebSocketService.js"}