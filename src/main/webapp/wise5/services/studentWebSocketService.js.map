{"version":3,"sources":["studentWebSocketService.es6"],"names":[],"mappings":"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","file":"studentWebSocketService.js","sourcesContent":["class StudentWebSocketService {\n    constructor($rootScope,\n                $websocket,\n                ConfigService,\n                StudentDataService) {\n\n        this.$rootScope = $rootScope;\n        this.$websocket = $websocket;\n        this.ConfigService = ConfigService;\n        this.StudentDataService = StudentDataService;\n\n        this.dataStream = null;\n    }\n\n    /**\n     * Initialize the websocket connection\n     */\n    initialize() {\n\n        // get the mode\n        var mode = this.ConfigService.getConfigParam('mode');\n\n        if (mode === 'preview') {\n            // we are previewing the project\n        } else {\n            // we are in a run\n\n            // get the parameters for initializing the websocket connection\n            var runId = this.ConfigService.getRunId();\n            var periodId = this.ConfigService.getPeriodId();\n            var workgroupId = this.ConfigService.getWorkgroupId();\n            var webSocketURL = this.ConfigService.getWebSocketURL();\n            webSocketURL += \"?runId=\" + runId + \"&periodId=\" + periodId + \"&workgroupId=\" + workgroupId;\n\n            // start the websocket connection\n            this.dataStream = this.$websocket(webSocketURL);\n\n            // this is the function that handles messages we receive from web sockets\n            this.dataStream.onMessage(angular.bind(this, function(message) {\n\n                if (message != null && message.data != null) {\n\n                    var data = message.data;\n\n                    try {\n                        data = angular.fromJson(data);\n\n                        this.handleWebSocketMessageReceived(data);\n                    } catch(e) {\n\n                    }\n                }\n            }));\n        }\n    };\n\n    /**\n     * Handle the message we have received\n     * @param data the data from the message\n     */\n    handleWebSocketMessageReceived(data) {\n\n        // broadcast the data to all listeners\n        this.$rootScope.$broadcast('webSocketMessageRecieved', {data: data});\n    };\n\n    /**\n     * Send the student status to the server through websockets\n     */\n    sendStudentStatus() {\n\n        var mode = this.ConfigService.getConfigParam('mode');\n\n        if (mode !== 'preview') {\n            // we are in a run\n\n            // get the current node id\n            var currentNodeId = this.StudentDataService.getCurrentNodeId();\n\n            // get the node statuses\n            var nodeStatuses = this.StudentDataService.getNodeStatuses();\n\n            // get the latest node visit\n            //var latestCompletedNodeVisit = this.StudentDataService.getLatestCompletedNodeVisit();\n            var latestComponentState = this.StudentDataService.getLatestComponentState();\n\n            // make the websocket message\n            var messageJSON = {};\n            messageJSON.messageType = 'studentStatus';\n            messageJSON.messageParticipants = 'studentToTeachers';\n            messageJSON.currentNodeId = currentNodeId;\n            //messageJSON.previousNodeVisit = latestCompletedNodeVisit;\n            messageJSON.previousComponentState = latestComponentState;\n            messageJSON.nodeStatuses = nodeStatuses;\n\n            // send the websocket message\n            this.dataStream.send(messageJSON);\n        }\n    };\n\n    /**\n     * Send a message to classmates in the period\n     * @param data the data to send to the classmates\n     */\n    sendStudentToClassmatesInPeriodMessage(data) {\n        var mode = this.ConfigService.getConfigParam('mode');\n\n        if (mode !== 'preview') {\n            // we are in a run\n\n            // get the current node id\n            var currentNodeId = this.StudentDataService.getCurrentNodeId();\n\n            // make the websocket message\n            var messageJSON = {};\n            messageJSON.messageType = 'studentData';\n            messageJSON.messageParticipants = 'studentToClassmatesInPeriod';\n            messageJSON.currentNodeId = currentNodeId;\n            messageJSON.data = data;\n\n            // send the websocket message\n            this.dataStream.send(messageJSON);\n        }\n    };\n}\n\nStudentWebSocketService.$inject = [\n    '$rootScope',\n    '$websocket',\n    'ConfigService',\n    'StudentDataService'\n];\n\nexport default StudentWebSocketService;"]}