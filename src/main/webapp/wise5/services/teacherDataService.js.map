{"version":3,"sources":["teacherDataService.es6"],"names":["TeacherDataService","$http","$rootScope","AnnotationService","ConfigService","ProjectService","studentData","currentPeriod","runStatus","exportType","exportURL","getConfigParam","runId","getRunId","params","getStudentWork","getEvents","getAnnotations","httpParams","method","url","then","result","data","nodeId","periodId","periodName","nodeIdsAndComponentIds","getNodeIdsAndComponentIds","showPreviousWorkNodeIdsAndComponentIds","getShowPreviousWorkNodeIdsAndComponentIds","components","concat","workgroupId","retrieveStudentData","toWorkgroupId","studentDataURL","resultData","studentWorkList","componentStates","componentStatesByWorkgroupId","componentStatesByNodeId","componentStatesByComponentId","i","length","componentState","componentStateWorkgroupId","Array","push","componentStateNodeId","componentId","events","allEvents","eventsByWorkgroupId","eventsByNodeId","event","eventWorkgroupId","eventNodeId","annotations","annotationsToWorkgroupId","annotationsByNodeId","annotation","annotationWorkgroupId","annotationNodeId","setAnnotations","runStatusURL","headers","latestComponentState","getComponentStatesByWorkgroupIdAndNodeId","c","componentStateComponentId","getComponentStatesByWorkgroupId","getComponentStatesByNodeId","filter","n","indexOf","getComponentStatesByComponentId","getEventsByWorkgroupId","getEventsByNodeId","getAnnotationsToWorkgroupId","getAnnotationsByNodeId","period","totalScore","getTotalScore","isPaused","allPeriodsPaused","periods","p","paused","getPeriods","x","value","createRunStatus","tempPeriod","tempPeriodId","customPauseMessage","pauseMessage","angular","toJson","runStatusParams","status","$","param","$inject"],"mappings":"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","file":"teacherDataService.js","sourcesContent":["'use strict';\n\nclass TeacherDataService {\n\n    constructor($http,\n                $rootScope,\n                AnnotationService,\n                ConfigService,\n                ProjectService) {\n        this.$http = $http;\n        this.$rootScope = $rootScope;\n        this.AnnotationService = AnnotationService;\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n\n        this.studentData = {};\n        this.currentPeriod = null;\n        this.runStatus == null;\n    }\n\n    /**\n     * Retrieves the export given the export Type\n     * @param exportType\n     */\n    getExport(exportType) {\n        var exportURL = this.ConfigService.getConfigParam('runDataExportURL');\n        var runId = this.ConfigService.getRunId();\n        exportURL += \"/\" + runId + \"/\" + exportType;\n\n        var params = {};\n        params.getStudentWork = true;\n        params.getEvents = false;\n        params.getAnnotations = true;\n\n        var httpParams = {};\n        httpParams.method = 'GET';\n        httpParams.url = exportURL;\n        httpParams.params = params;\n\n        return this.$http(httpParams).then((result) => {\n            return result.data;\n        });\n    };\n\n    /**\n     * Retrieve the student data for a node id\n     * @param nodeId the node id\n     * @returns the student data for the node id\n     */\n    retrieveStudentDataByNodeId(nodeId) {\n\n        var periodId = null;\n\n        if (this.currentPeriod != null && this.currentPeriod.periodName != 'All') {\n            periodId = this.currentPeriod.periodId;\n        }\n        \n        // get the node ids and component ids in the node\n        var nodeIdsAndComponentIds = this.ProjectService.getNodeIdsAndComponentIds(nodeId);\n        \n        // get the show previous work node ids and component ids in the node\n        var showPreviousWorkNodeIdsAndComponentIds = this.ProjectService.getShowPreviousWorkNodeIdsAndComponentIds(nodeId);\n\n        var components = [];\n        components = components.concat(nodeIdsAndComponentIds);\n        components = components.concat(showPreviousWorkNodeIdsAndComponentIds);\n\n        var params = {};\n        params.runId = this.ConfigService.getRunId();\n        params.periodId = periodId;\n        params.workgroupId = null;\n        params.components = components;\n\n        return this.retrieveStudentData(params);\n    };\n\n    /**\n     * Retrieve the student data for the workgroup id\n     * @param workgroupId the workgroup id\n     * @returns the student data for the workgroup id\n     */\n    retrieveStudentDataByWorkgroupId(workgroupId) {\n\n        var params = {};\n        params.runId = this.ConfigService.getRunId();\n        params.periodId = null;\n        params.nodeId = null;\n        params.workgroupId = workgroupId;\n        params.toWorkgroupId = workgroupId;\n\n        return this.retrieveStudentData(params);\n    };\n\n    /**\n     * Retrieve the annotations for the run\n     * @returns the annotations for the run\n     */\n    retrieveAnnotations() {\n        var params = {};\n        params.runId = this.ConfigService.getRunId();\n        params.periodId = null;\n        params.nodeId = null;\n        params.workgroupId = null;\n        params.toWorkgroupId = null;\n        params.getStudentWork = false;\n        params.getEvents = false;\n        params.getAnnotations = true;\n\n        return this.retrieveStudentData(params);\n    };\n\n    /**\n     * Retrieve the student data\n     * @param params the params that specify what student data we want\n     * @returns a promise\n     */\n    retrieveStudentData(params) {\n        var studentDataURL = this.ConfigService.getConfigParam('teacherDataURL');\n\n        if (params.getStudentWork == null) {\n            params.getStudentWork = true;\n        }\n\n        if (params.getEvents == null) {\n            params.getEvents = false;\n        }\n\n        if (params.getAnnotations == null) {\n            params.getAnnotations = true;\n        }\n\n        var httpParams = {};\n        httpParams.method = 'GET';\n        httpParams.url = studentDataURL;\n        httpParams.params = params;\n\n        return this.$http(httpParams).then((result) => {\n            var resultData = result.data;\n            if (resultData != null) {\n\n                if (this.studentData == null) {\n                    this.studentData = {};\n                }\n\n                if (resultData.studentWorkList != null) {\n                    var componentStates = resultData.studentWorkList;\n\n                    // populate allComponentStates, componentStatesByWorkgroupId and componentStatesByNodeId arrays\n                    this.studentData.componentStates = componentStates;\n                    this.studentData.componentStatesByWorkgroupId = {};\n                    this.studentData.componentStatesByNodeId = {};\n                    this.studentData.componentStatesByComponentId = {};\n\n                    for (var i = 0; i < componentStates.length; i++) {\n                        var componentState = componentStates[i];\n\n                        var componentStateWorkgroupId = componentState.workgroupId;\n                        if (this.studentData.componentStatesByWorkgroupId[componentStateWorkgroupId] == null) {\n                            this.studentData.componentStatesByWorkgroupId[componentStateWorkgroupId] = new Array();\n                        }\n                        this.studentData.componentStatesByWorkgroupId[componentStateWorkgroupId].push(componentState);\n\n                        var componentStateNodeId = componentState.nodeId;\n                        if (this.studentData.componentStatesByNodeId[componentStateNodeId] == null) {\n                            this.studentData.componentStatesByNodeId[componentStateNodeId] = new Array();\n                        }\n                        this.studentData.componentStatesByNodeId[componentStateNodeId].push(componentState);\n\n                        var componentId = componentState.componentId;\n                        if (this.studentData.componentStatesByComponentId[componentId] == null) {\n                            this.studentData.componentStatesByComponentId[componentId] = new Array();\n                        }\n                        this.studentData.componentStatesByComponentId[componentId].push(componentState);\n                    }\n                }\n\n                if (resultData.events != null) {\n                    // populate allEvents, eventsByWorkgroupId, and eventsByNodeId arrays\n                    this.studentData.allEvents = resultData.events;\n                    this.studentData.eventsByWorkgroupId = {};\n                    this.studentData.eventsByNodeId = {};\n                    for (var i = 0; i < resultData.events.length; i++) {\n                        var event = resultData.events[i];\n                        var eventWorkgroupId = event.workgroupId;\n                        if (this.studentData.eventsByWorkgroupId[eventWorkgroupId] == null) {\n                            this.studentData.eventsByWorkgroupId[eventWorkgroupId] = new Array();\n                        }\n                        this.studentData.eventsByWorkgroupId[eventWorkgroupId].push(event);\n\n                        var eventNodeId = event.nodeId;\n                        if (this.studentData.eventsByNodeId[eventNodeId] == null) {\n                            this.studentData.eventsByNodeId[eventNodeId] = new Array();\n                        }\n                        this.studentData.eventsByNodeId[eventNodeId].push(event);\n                    }\n                }\n\n                if (resultData.annotations != null) {\n                    // populate annotations, annotationsByWorkgroupId, and annotationsByNodeId arrays\n                    this.studentData.annotations = resultData.annotations;\n                    this.studentData.annotationsToWorkgroupId = {};\n                    this.studentData.annotationsByNodeId = {};\n                    for (var i = 0; i < resultData.annotations.length; i++) {\n                        var annotation = resultData.annotations[i];\n                        var annotationWorkgroupId = annotation.toWorkgroupId;\n                        if (this.studentData.annotationsToWorkgroupId[annotationWorkgroupId] == null) {\n                            this.studentData.annotationsToWorkgroupId[annotationWorkgroupId] = new Array();\n                        }\n                        this.studentData.annotationsToWorkgroupId[annotationWorkgroupId].push(annotation);\n\n                        var annotationNodeId = annotation.nodeId;\n                        if (this.studentData.annotationsByNodeId[annotationNodeId] == null) {\n                            this.studentData.annotationsByNodeId[annotationNodeId] = new Array();\n                        }\n                        this.studentData.annotationsByNodeId[annotationNodeId].push(annotation);\n                    }\n                }\n\n                this.AnnotationService.setAnnotations(this.studentData.annotations);\n            }\n        });\n    };\n\n    /**\n     * Retrieve the run status from the server\n     */\n    retrieveRunStatus() {\n        var runStatusURL = this.ConfigService.getConfigParam('runStatusURL');\n        var runId = this.ConfigService.getConfigParam('runId');\n\n        //create the params for the request\n        var params = {\n            runId:runId\n        }\n\n        var httpParams = {};\n        httpParams.method = 'GET';\n        httpParams.url = runStatusURL;\n        httpParams.headers = {'Content-Type': 'application/x-www-form-urlencoded'};\n        httpParams.params = params;\n\n        // make the request\n        return this.$http(httpParams).then((result) => {\n            if (result != null) {\n                var data = result.data;\n                if (data != null) {\n                    // save the run status\n                    this.runStatus = data;\n                }\n            }\n        });\n    }\n\n    getComponentStatesByWorkgroupId(workgroupId) {\n        if (this.studentData.componentStatesByWorkgroupId == null) {\n            //debugger;\n        }\n        var componentStatesByWorkgroupId = this.studentData.componentStatesByWorkgroupId[workgroupId];\n        if (componentStatesByWorkgroupId != null) {\n            return componentStatesByWorkgroupId;\n        } else {\n            return [];\n        }\n    };\n\n    getComponentStatesByNodeId(nodeId) {\n        var componentStatesByNodeId = this.studentData.componentStatesByNodeId[nodeId];\n        if (componentStatesByNodeId != null) {\n            return componentStatesByNodeId;\n        } else {\n            return [];\n        }\n    };\n\n    /**\n     * Get the component stats for a component id\n     * @param componentId the component id\n     * @returns an array containing component states for a component id\n     */\n    getComponentStatesByComponentId(componentId) {\n        var componentStates = [];\n\n        var componentStatesByComponentId = this.studentData.componentStatesByComponentId[componentId];\n\n        if (componentStatesByComponentId != null) {\n            componentStates = componentStatesByComponentId;\n        }\n\n        return componentStates;\n    };\n\n    getLatestComponentStateByWorkgroupIdNodeIdAndComponentId(workgroupId, nodeId, componentId) {\n        var latestComponentState = null;\n\n        var componentStates = this.getComponentStatesByWorkgroupIdAndNodeId(workgroupId, nodeId);\n\n        if (componentStates != null) {\n\n            // loop through all the component states from newest to oldest\n            for (var c = componentStates.length - 1; c >= 0; c--) {\n                var componentState = componentStates[c];\n\n                if (componentState != null) {\n                    var componentStateNodeId = componentState.nodeId;\n                    var componentStateComponentId = componentState.componentId;\n\n                    // compare the node id and component id\n                    if (nodeId == componentStateNodeId &&\n                        componentId == componentStateComponentId) {\n                        latestComponentState = componentState;\n                        break;\n                    }\n                }\n            }\n        }\n\n        return latestComponentState;\n    };\n\n    getComponentStatesByWorkgroupIdAndNodeId(workgroupId, nodeId) {\n\n        var componentStatesByWorkgroupId = this.getComponentStatesByWorkgroupId(workgroupId);\n        var componentStatesByNodeId = this.getComponentStatesByNodeId(nodeId);\n\n        // find the intersect and return it\n        return componentStatesByWorkgroupId.filter((n) => {\n            return componentStatesByNodeId.indexOf(n) != -1;\n        });\n    };\n\n    /**\n     * Get component states for a workgroup id and component id\n     * @param workgroupId the workgroup id\n     * @param componentId the component id\n     * @returns an array of component states\n     */\n    getComponentStatesByWorkgroupIdAndComponentId(workgroupId, componentId) {\n        var componentStatesByWorkgroupId = this.getComponentStatesByWorkgroupId(workgroupId);\n        var componentStatesByComponentId = this.getComponentStatesByComponentId(componentId);\n\n        // find the intersect and return it\n        return componentStatesByWorkgroupId.filter((n) => {\n            return componentStatesByComponentId.indexOf(n) != -1;\n        });\n    }\n\n    getEventsByWorkgroupId(workgroupId) {\n        var eventsByWorkgroupId = this.studentData.eventsByWorkgroupId[workgroupId];\n        if (eventsByWorkgroupId != null) {\n            return eventsByWorkgroupId;\n        } else {\n            return [];\n        }\n    };\n\n    getEventsByNodeId(nodeId) {\n        var eventsByNodeId = this.studentData.eventsByNodeId[nodeId];\n        if (eventsByNodeId != null) {\n            return eventsByNodeId;\n        } else {\n            return [];\n        }\n    };\n\n    getEventsByWorkgroupIdAndNodeId(workgroupId, nodeId) {\n        var eventsByWorkgroupId = this.getEventsByWorkgroupId(workgroupId);\n        var eventsByNodeId = this.getEventsByNodeId(nodeId);\n\n        // find the intersect and return it\n        return eventsByWorkgroupId.filter((n) => {\n            return eventsByNodeId.indexOf(n) != -1;\n        });\n    };\n\n    getAnnotationsToWorkgroupId(workgroupId) {\n        var annotationsToWorkgroupId = this.studentData.annotationsToWorkgroupId[workgroupId];\n        if (annotationsToWorkgroupId != null) {\n            return annotationsToWorkgroupId;\n        } else {\n            return [];\n        }\n    };\n\n    getAnnotationsByNodeId(nodeId) {\n        var annotationsByNodeId = this.studentData.annotationsByNodeId[nodeId];\n        if (annotationsByNodeId != null) {\n            return annotationsByNodeId;\n        } else {\n            return [];\n        }\n    };\n\n    getAnnotationsToWorkgroupIdAndNodeId(workgroupId, nodeId) {\n        var annotationsToWorkgroupId = this.getAnnotationsToWorkgroupId(workgroupId);\n        var annotationsByNodeId = this.getAnnotationsByNodeId(nodeId);\n\n        // find the intersect and return it\n        return annotationsToWorkgroupId.filter((n) => {\n            return annotationsByNodeId.indexOf(n) != -1;\n        });\n    };\n\n    setCurrentPeriod(period) {\n        this.currentPeriod = period;\n    };\n\n    getCurrentPeriod() {\n        return this.currentPeriod;\n    };\n\n    /**\n     * Get the total score for a workgroup\n     * @param workgroupId the workgroup id\n     * @returns the total score for the workgroup\n     */\n    getTotalScoreByWorkgroupId(workgroupId) {\n\n        var totalScore = null;\n\n        if (this.studentData.annotationsToWorkgroupId != null) {\n\n            // get all the annotations for a workgroup\n            var annotations = this.studentData.annotationsToWorkgroupId[workgroupId];\n\n            // get the total score for the workgroup\n            totalScore = this.AnnotationService.getTotalScore(annotations, workgroupId);\n        }\n\n        return totalScore;\n    }\n\n    /**\n     * Get the run status\n     * @returns the run status object\n     */\n    getRunStatus() {\n        return this.runStatus;\n    }\n\n    /**\n     * Check if a period is paused\n     * @returns whether the period is paused or not\n     */\n    isPeriodPaused(periodId) {\n\n        var isPaused = false;\n\n        // get the run status\n        var runStatus = this.runStatus;\n\n        if (runStatus != null) {\n            if (periodId == -1) {\n                // -1 represents all periods\n                isPaused = runStatus.allPeriodsPaused;\n            } else {\n                var periods = runStatus.periods;\n\n                // loop through all the periods\n                for (var p = 0; p < periods.length; p++) {\n                    var period = periods[p];\n\n                    if (period != null) {\n                        if (periodId == period.periodId) {\n                            // we have found the period we are looking for\n                            isPaused = period.paused;\n                        }\n                    }\n                }\n            }\n        }\n\n        return isPaused;\n    }\n\n    /**\n     * Create a local run status object to keep track of the run status\n     * @returns the run status object\n     */\n    createRunStatus() {\n        var runStatus = {};\n\n        //get the run id\n        runStatus.runId = this.ConfigService.getConfigParam('runId');\n\n        //set this to default to not paused\n        runStatus.allPeriodsPaused = false;\n\n        //get all the periods objects\n        var periods = this.ConfigService.getPeriods();\n\n        //loop through all the periods\n        for(var x = 0; x < periods.length; x++) {\n            //get a period\n            var period = periods[x];\n\n            //set this to default to not paused\n            period.paused = false;\n        }\n\n        //set the periods into the run status\n        runStatus.periods = periods;\n\n        //set the run status into the view so we can access it later\n        this.runStatus = runStatus;\n\n        return this.runStatus;\n    }\n\n    /**\n     * Update the paused value for a period in our run status\n     * @param periodId the period id\n     * @param value whether the period is paused or not\n     */\n    updatePausedRunStatusValue(periodId, value) {\n        //create the local run status object if necessary\n        if(this.runStatus == null) {\n            this.createRunStatus();\n        }\n\n        //get the local run status object\n        var runStatus = this.runStatus;\n\n        if(periodId == null || periodId == -1) {\n            //we are updating the all periods value\n            runStatus.allPeriodsPaused = value;\n\n            //set all the periods to the value as well\n            //this.setAllPeriodsPaused(value);\n        } else {\n            //we are updating a specific period\n\n            //get all the periods\n            var periods = runStatus.periods;\n\n            if(periods != null) {\n                //loop through all the periods\n                for(var x = 0; x < periods.length; x++) {\n                    //get a period\n                    var tempPeriod = periods[x];\n\n                    //get the period id\n                    var tempPeriodId = tempPeriod.periodId;\n\n                    //check if the period id matches the one we need to update\n                    if(periodId == tempPeriodId) {\n                        //we have found the period we want to update\n                        tempPeriod.paused = value;\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Send the run status back to the server to be saved in the db\n     * @param customPauseMessage the custom pause message text to send to the students\n     */\n    sendRunStatus(customPauseMessage) {\n        //get the run status url we will use to make the request\n        var runStatusURL = this.ConfigService.getConfigParam('runStatusURL');\n\n        if(runStatusURL != null) {\n            //make the request to the server for the student statuses\n\n            //get the run id\n            var runId = this.ConfigService.getConfigParam('runId');\n\n            if(customPauseMessage != null) {\n                //set the pause message if one was provided\n                this.runStatus.pauseMessage = customPauseMessage;\n            }\n\n            //get the run status as a string\n            var runStatus = angular.toJson(this.runStatus);\n\n            //create the params for the request\n            var runStatusParams = {\n                runId:runId,\n                status:runStatus\n            }\n\n            var httpParams = {};\n            httpParams.method = 'POST';\n            httpParams.url = runStatusURL;\n            httpParams.headers = {'Content-Type': 'application/x-www-form-urlencoded'};\n            httpParams.data = $.param(runStatusParams);\n\n            // make the request\n            this.$http(httpParams);\n        }\n    };\n}\n\nTeacherDataService.$inject = ['$http',\n    '$rootScope',\n    'AnnotationService',\n    'ConfigService',\n    'ProjectService'\n];\n\nexport default TeacherDataService;\n"]}