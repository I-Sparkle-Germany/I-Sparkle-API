{"version":3,"sources":["teacherDataService.es6"],"names":["TeacherDataService","$http","$filter","$q","$rootScope","AnnotationService","ConfigService","NotificationService","ProjectService","TeacherWebSocketService","UtilService","$translate","studentData","componentStatesByWorkgroupId","componentStatesByNodeId","componentStatesByComponentId","currentPeriod","currentWorkgroup","currentNode","previousStep","runStatus","periods","nodeGradingSort","$on","event","args","annotation","handleAnnotationReceived","studentWork","addOrUpdateComponentState","$broadcast","annotations","push","toWorkgroupId","annotationsToWorkgroupId","Array","nodeId","annotationsByNodeId","setAnnotations","exportType","selectedNodes","exportURL","getConfigParam","runId","getRunId","params","getStudentWork","getAnnotations","getEvents","components","retrieveStudentData","httpParams","method","url","then","result","data","window","location","href","deferred","defer","promise","resolve","context","componentId","componentType","category","newEvent","workgroupId","getWorkgroupId","clientSaveTime","Date","parse","type","events","angular","toJson","headers","$","param","savedEvents","nodeIdsAndComponentIds","getNodeIdsAndComponentIds","showPreviousWorkNodeIdsAndComponentIds","getShowPreviousWorkNodeIdsAndComponentIds","concat","periodId","studentDataURL","resultData","studentWorkList","componentStates","i","length","componentState","sort","sortByServerSaveTime","allEvents","eventsByWorkgroupId","eventsByNodeId","eventWorkgroupId","eventNodeId","annotationWorkgroupId","annotationNodeId","componentStateWorkgroupId","found","w","cs","id","componentStateNodeId","n","c","runStatusURL","initializePeriods","latestComponentState","getComponentStatesByWorkgroupIdAndNodeId","componentStateComponentId","componentStatesForWorkgroup","getComponentStatesByWorkgroupId","componentRevisionCounter","componentsFound","csf","key","revisionCounter","csb","reverse","getComponentStatesByNodeId","filter","indexOf","getComponentStatesByComponentId","getEventsByWorkgroupId","getEventsByNodeId","eventType","e","getAnnotationsToWorkgroupId","getAnnotationsByNodeId","getPeriods","allPeriodsOption","periodName","unshift","setCurrentPeriod","period","previousPeriod","setCurrentWorkgroup","workgroup","currentNodeId","node","getNodeById","setCurrentNode","previousCurrentNode","isGroupNode","previousNode","nodeToExit","endCurrentNode","setCurrentNodeByNodeId","totalScore","getTotalScore","isPaused","nPeriods","nPeriodsPaused","p","paused","updatePausedRunStatusValue","pauseScreens","unPauseScreens","sendRunStatus","saveEvent","x","value","createRunStatus","allPeriodsPaused","l","tempPeriod","tempPeriodId","customPauseMessage","pauseMessage","runStatusParams","status","$inject"],"mappings":"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","file":"teacherDataService.js","sourcesContent":["'use strict';\r\n\r\nclass TeacherDataService {\r\n\r\n    constructor($http,\r\n                $filter,\r\n                $q,\r\n                $rootScope,\r\n                AnnotationService,\r\n                ConfigService,\r\n                NotificationService,\r\n                ProjectService,\r\n                TeacherWebSocketService,\r\n                UtilService) {\r\n        this.$http = $http;\r\n        this.$filter = $filter;\r\n        this.$q = $q;\r\n        this.$rootScope = $rootScope;\r\n        this.AnnotationService = AnnotationService;\r\n        this.ConfigService = ConfigService;\r\n        this.NotificationService = NotificationService;\r\n        this.ProjectService = ProjectService;\r\n        this.TeacherWebSocketService = TeacherWebSocketService;\r\n        this.UtilService = UtilService;\r\n\r\n        this.$translate = this.$filter('translate');\r\n\r\n        this.studentData = {\r\n            componentStatesByWorkgroupId: {},\r\n            componentStatesByNodeId: {},\r\n            componentStatesByComponentId: {}\r\n        };\r\n\r\n        this.currentPeriod = null;\r\n        this.currentWorkgroup = null;\r\n        this.currentNode = null;\r\n        this.previousStep = null;\r\n        this.runStatus = null;\r\n        this.periods = [];\r\n        this.nodeGradingSort = 'team';\r\n\r\n        /**\r\n         * Listen for the 'annotationSavedToServer' event which is fired when\r\n         * we receive the response from saving an annotation to the server\r\n         */\r\n        this.$rootScope.$on('annotationSavedToServer', (event, args) => {\r\n\r\n            if (args) {\r\n                // get the annotation that was saved to the server\r\n                let annotation = args.annotation;\r\n                this.handleAnnotationReceived(annotation);\r\n            }\r\n        });\r\n\r\n        /**\r\n         * Listen for the 'newAnnotationReceived' event which is fired when\r\n         * teacher receives a new annotation (usually on a student work) from the server\r\n         */\r\n        this.$rootScope.$on('newAnnotationReceived', (event, args) => {\r\n\r\n            if (args) {\r\n                // get the annotation that was saved to the server\r\n                let annotation = args.annotation;\r\n                this.handleAnnotationReceived(annotation);\r\n            }\r\n        });\r\n\r\n        /**\r\n         * Listen for the 'newStudentWorkReceived' event which is fired when\r\n         * teacher receives a new student work from the server\r\n         */\r\n        this.$rootScope.$on('newStudentWorkReceived', (event, args) => {\r\n\r\n            if (args) {\r\n                // get the student work (component state) that was saved to the server\r\n                let studentWork = args.studentWork;\r\n                this.addOrUpdateComponentState(studentWork);\r\n                // broadcast the event that a new work has been received\r\n                this.$rootScope.$broadcast('studentWorkReceived', {studentWork: studentWork});\r\n            }\r\n        });\r\n    }\r\n\r\n    handleAnnotationReceived(annotation) {\r\n        // add the annotation to the local annotations array\r\n        this.studentData.annotations.push(annotation);\r\n\r\n        let toWorkgroupId = annotation.toWorkgroupId;\r\n        if (this.studentData.annotationsToWorkgroupId[toWorkgroupId] == null) {\r\n            this.studentData.annotationsToWorkgroupId[toWorkgroupId] = new Array();\r\n        }\r\n        this.studentData.annotationsToWorkgroupId[toWorkgroupId].push(annotation);\r\n\r\n        let nodeId = annotation.nodeId;\r\n        if (this.studentData.annotationsByNodeId[nodeId] == null) {\r\n            this.studentData.annotationsByNodeId[nodeId] = new Array();\r\n        }\r\n        this.studentData.annotationsByNodeId[nodeId].push(annotation);\r\n\r\n        this.AnnotationService.setAnnotations(this.studentData.annotations);\r\n\r\n        // broadcast the event that a new annotation has been received\r\n        this.$rootScope.$broadcast('annotationReceived', {annotation: annotation});\r\n    }\r\n\r\n    /**\r\n     * Get the data for the export and generate the csv file that will be downloaded\r\n     * @param exportType the type of export\r\n     */\r\n    getExport(exportType, selectedNodes) {\r\n        let exportURL = this.ConfigService.getConfigParam('runDataExportURL');\r\n        let runId = this.ConfigService.getRunId();\r\n        exportURL += \"/\" + runId + \"/\" + exportType;\r\n\r\n        if (exportType === \"allStudentWork\" || exportType === \"latestStudentWork\") {\r\n            let params = {};\r\n            params.runId = this.ConfigService.getRunId();\r\n            params.getStudentWork = true;\r\n            params.getAnnotations = true;\r\n            params.getEvents = false;\r\n            params.components = selectedNodes;\r\n\r\n            return this.retrieveStudentData(params);\r\n        } else if (exportType === \"events\") {\r\n            let params = {};\r\n            params.runId = this.ConfigService.getRunId();\r\n            params.getStudentWork = false;\r\n            params.getAnnotations = false;\r\n            params.getEvents = true;\r\n            params.components = selectedNodes;\r\n\r\n            return this.retrieveStudentData(params);\r\n        } else if (exportType === \"latestNotebookItems\" || exportType === \"allNotebookItems\") {\r\n            let httpParams = {\r\n                method : 'GET',\r\n                url : exportURL,\r\n                params : {}\r\n            };\r\n\r\n            return this.$http(httpParams).then((result) => {\r\n                return result.data;\r\n            });\r\n        } else if (exportType === \"notifications\") {\r\n            let httpParams = {\r\n                method : 'GET',\r\n                url : exportURL,\r\n                params : {}\r\n            };\r\n\r\n            return this.$http(httpParams).then((result) => {\r\n                return result.data;\r\n            });\r\n        } else if (exportType === \"studentAssets\") {\r\n            window.location.href = exportURL;\r\n            let deferred = this.$q.defer();\r\n            let promise = deferred.promise;\r\n            deferred.resolve([]);\r\n            return promise;\r\n        } else if (exportType === \"oneWorkgroupPerRow\") {\r\n            let params = {};\r\n            params.runId = this.ConfigService.getRunId();\r\n            params.getStudentWork = true;\r\n            params.getAnnotations = true;\r\n            params.getEvents = true;\r\n            params.components = selectedNodes;\r\n\r\n            return this.retrieveStudentData(params);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Retrieves the export given the export Type\r\n     * @param exportType\r\n     */\r\n    getExport0(exportType) {\r\n        let exportURL = this.ConfigService.getConfigParam('runDataExportURL');\r\n        let runId = this.ConfigService.getRunId();\r\n        exportURL += \"/\" + runId + \"/\" + exportType;\r\n\r\n        if (exportType === \"studentAssets\") {\r\n            window.location.href = exportURL;\r\n            let deferred = this.$q.defer();\r\n            let promise = deferred.promise;\r\n            deferred.resolve([]);\r\n            return promise;\r\n        } else {\r\n            let httpParams = {\r\n                method : 'GET',\r\n                url : exportURL,\r\n                params : {}\r\n            };\r\n\r\n            return this.$http(httpParams).then((result) => {\r\n                return result.data;\r\n            });\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Save events that occur in the Classroom Monitor to the server\r\n     * @param event the event object\r\n     * @returns a promise\r\n     */\r\n    saveEvent(context, nodeId, componentId, componentType, category, event, data) {\r\n        let newEvent = {\r\n            runId : this.ConfigService.getRunId(),\r\n            workgroupId : this.ConfigService.getWorkgroupId(),\r\n            clientSaveTime : Date.parse(new Date()),\r\n            context : context,\r\n            nodeId : nodeId,\r\n            componentId : componentId,\r\n            type : componentType,\r\n            category : category,\r\n            event : event,\r\n            data : data\r\n        };\r\n\r\n        let events = [newEvent];\r\n\r\n        let params = {\r\n             runId : this.ConfigService.getRunId(),\r\n             workgroupId : this.ConfigService.getWorkgroupId(),\r\n             events : angular.toJson(events)\r\n        };\r\n\r\n        let httpParams = {};\r\n        httpParams.method = 'POST';\r\n        httpParams.url = this.ConfigService.getConfigParam('teacherDataURL');\r\n        httpParams.headers = {'Content-Type': 'application/x-www-form-urlencoded'};\r\n        httpParams.data = $.param(params);\r\n\r\n        return this.$http(httpParams).then((result) => {\r\n\r\n            let savedEvents = null;\r\n\r\n            if (result != null && result.data != null) {\r\n                let data = result.data;\r\n\r\n                if (data != null) {\r\n\r\n                    // get the saved events\r\n                    savedEvents = data.events;\r\n                }\r\n            }\r\n\r\n            return savedEvents;\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Retrieve the student data for a node id\r\n     * @param nodeId the node id\r\n     * @returns the student data for the node id\r\n     */\r\n    retrieveStudentDataByNodeId(nodeId) {\r\n\r\n        //var periodId = null;\r\n\r\n        //if (this.currentPeriod != null && this.currentPeriod.periodName != 'All') {\r\n            //periodId = this.currentPeriod.periodId;\r\n        //}\r\n\r\n        // get the node ids and component ids in the node\r\n        var nodeIdsAndComponentIds = this.ProjectService.getNodeIdsAndComponentIds(nodeId);\r\n\r\n        // get the show previous work node ids and component ids in the node\r\n        var showPreviousWorkNodeIdsAndComponentIds = this.ProjectService.getShowPreviousWorkNodeIdsAndComponentIds(nodeId);\r\n\r\n        var components = [];\r\n        components = components.concat(nodeIdsAndComponentIds);\r\n        components = components.concat(showPreviousWorkNodeIdsAndComponentIds);\r\n\r\n        var params = {};\r\n        params.runId = this.ConfigService.getRunId();\r\n        //params.periodId = periodId;\r\n        params.periodId = null;\r\n        params.workgroupId = null;\r\n        params.components = components;\r\n\r\n        return this.retrieveStudentData(params);\r\n    };\r\n\r\n    /**\r\n     * Retrieve the student data for the workgroup id\r\n     * @param workgroupId the workgroup id\r\n     * @returns the student data for the workgroup id\r\n     */\r\n    retrieveStudentDataByWorkgroupId(workgroupId) {\r\n\r\n        var params = {};\r\n        params.runId = this.ConfigService.getRunId();\r\n        params.periodId = null;\r\n        params.nodeId = null;\r\n        params.workgroupId = workgroupId;\r\n        params.toWorkgroupId = workgroupId;\r\n\r\n        return this.retrieveStudentData(params);\r\n    };\r\n\r\n    /**\r\n     * Retrieve the annotations for the run\r\n     * @returns the annotations for the run\r\n     */\r\n    retrieveAnnotations() {\r\n        var params = {};\r\n        params.runId = this.ConfigService.getRunId();\r\n        params.periodId = null;\r\n        params.nodeId = null;\r\n        params.workgroupId = null;\r\n        params.toWorkgroupId = null;\r\n        params.getStudentWork = false;\r\n        params.getEvents = false;\r\n        params.getAnnotations = true;\r\n\r\n        return this.retrieveStudentData(params);\r\n    };\r\n\r\n    /**\r\n     * Retrieve the student data\r\n     * @param params the params that specify what student data we want\r\n     * @returns a promise\r\n     */\r\n    retrieveStudentData(params) {\r\n        let studentDataURL = this.ConfigService.getConfigParam('teacherDataURL');\r\n\r\n        if (params.getStudentWork == null) {\r\n            params.getStudentWork = true;\r\n        }\r\n\r\n        if (params.getEvents == null) {\r\n            params.getEvents = false;\r\n        }\r\n\r\n        if (params.getAnnotations == null) {\r\n            params.getAnnotations = true;\r\n        }\r\n\r\n        let httpParams = {\r\n            \"method\": \"GET\",\r\n            \"url\": studentDataURL,\r\n            \"params\": params\r\n        };\r\n\r\n        return this.$http(httpParams).then((result) => {\r\n            var resultData = result.data;\r\n            if (resultData != null) {\r\n\r\n                if (resultData.studentWorkList != null) {\r\n                    var componentStates = resultData.studentWorkList;\r\n\r\n                    // populate allComponentStates, componentStatesByWorkgroupId and componentStatesByNodeId objects\r\n                    for (var i = 0; i < componentStates.length; i++) {\r\n                        var componentState = componentStates[i];\r\n                        this.addOrUpdateComponentState(componentState);\r\n                    }\r\n                }\r\n\r\n                if (resultData.events != null) {\r\n                    // populate allEvents, eventsByWorkgroupId, and eventsByNodeId arrays\r\n\r\n                    // sort the events by server save time\r\n                    resultData.events.sort(this.UtilService.sortByServerSaveTime);\r\n\r\n                    this.studentData.allEvents = resultData.events;\r\n                    this.studentData.eventsByWorkgroupId = {};\r\n                    this.studentData.eventsByNodeId = {};\r\n                    for (var i = 0; i < resultData.events.length; i++) {\r\n                        var event = resultData.events[i];\r\n                        var eventWorkgroupId = event.workgroupId;\r\n                        if (this.studentData.eventsByWorkgroupId[eventWorkgroupId] == null) {\r\n                            this.studentData.eventsByWorkgroupId[eventWorkgroupId] = new Array();\r\n                        }\r\n                        this.studentData.eventsByWorkgroupId[eventWorkgroupId].push(event);\r\n\r\n                        var eventNodeId = event.nodeId;\r\n                        if (this.studentData.eventsByNodeId[eventNodeId] == null) {\r\n                            this.studentData.eventsByNodeId[eventNodeId] = new Array();\r\n                        }\r\n                        this.studentData.eventsByNodeId[eventNodeId].push(event);\r\n                    }\r\n                }\r\n\r\n                if (resultData.annotations != null) {\r\n                    // populate annotations, annotationsByWorkgroupId, and annotationsByNodeId arrays\r\n                    this.studentData.annotations = resultData.annotations;\r\n                    this.studentData.annotationsToWorkgroupId = {};\r\n                    this.studentData.annotationsByNodeId = {};\r\n                    for (var i = 0; i < resultData.annotations.length; i++) {\r\n                        var annotation = resultData.annotations[i];\r\n                        var annotationWorkgroupId = annotation.toWorkgroupId;\r\n                        if (!this.studentData.annotationsToWorkgroupId[annotationWorkgroupId]) {\r\n                            this.studentData.annotationsToWorkgroupId[annotationWorkgroupId] = new Array();\r\n                        }\r\n                        this.studentData.annotationsToWorkgroupId[annotationWorkgroupId].push(annotation);\r\n\r\n                        var annotationNodeId = annotation.nodeId;\r\n                        if (!this.studentData.annotationsByNodeId[annotationNodeId]) {\r\n                            this.studentData.annotationsByNodeId[annotationNodeId] = new Array();\r\n                        }\r\n                        this.studentData.annotationsByNodeId[annotationNodeId].push(annotation);\r\n                    }\r\n                }\r\n\r\n                this.AnnotationService.setAnnotations(this.studentData.annotations);\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Add ComponentState to local bookkeeping\r\n     * @param componentState the ComponentState to add\r\n     */\r\n    addOrUpdateComponentState(componentState) {\r\n        var componentStateWorkgroupId = componentState.workgroupId;\r\n        if (this.studentData.componentStatesByWorkgroupId[componentStateWorkgroupId] == null) {\r\n            this.studentData.componentStatesByWorkgroupId[componentStateWorkgroupId] = new Array();\r\n        }\r\n        let found = false;\r\n        for (let w = 0; w < this.studentData.componentStatesByWorkgroupId[componentStateWorkgroupId].length; w++) {\r\n            let cs = this.studentData.componentStatesByWorkgroupId[componentStateWorkgroupId][w];\r\n            if (cs.id != null && cs.id === componentState.id) {\r\n                // found the same component id, so just update it in place.\r\n                this.studentData.componentStatesByWorkgroupId[componentStateWorkgroupId][w] = componentState;\r\n                found = true;  // remember this so we don't insert later.\r\n                break;\r\n            }\r\n        }\r\n        if (!found) {\r\n            this.studentData.componentStatesByWorkgroupId[componentStateWorkgroupId].push(componentState);\r\n        }\r\n\r\n        var componentStateNodeId = componentState.nodeId;\r\n        if (this.studentData.componentStatesByNodeId[componentStateNodeId] == null) {\r\n            this.studentData.componentStatesByNodeId[componentStateNodeId] = new Array();\r\n        }\r\n        found = false;  // reset\r\n        for (let n = 0; n < this.studentData.componentStatesByNodeId[componentStateNodeId].length; n++) {\r\n            let cs = this.studentData.componentStatesByNodeId[componentStateNodeId][n];\r\n            if (cs.id != null && cs.id === componentState.id) {\r\n                // found the same component id, so just update it in place.\r\n                this.studentData.componentStatesByNodeId[componentStateNodeId][n] = componentState;\r\n                found = true; // remember this so we don't insert later.\r\n                break;\r\n            }\r\n        }\r\n        if (!found) {\r\n            this.studentData.componentStatesByNodeId[componentStateNodeId].push(componentState);\r\n        }\r\n\r\n        var componentId = componentState.componentId;\r\n        if (this.studentData.componentStatesByComponentId[componentId] == null) {\r\n            this.studentData.componentStatesByComponentId[componentId] = new Array();\r\n        }\r\n        found = false;  // reset\r\n        for (let c = 0; c < this.studentData.componentStatesByComponentId[componentId].length; c++) {\r\n            let cs = this.studentData.componentStatesByComponentId[componentId][c];\r\n            if (cs.id != null && cs.id === componentState.id) {\r\n                // found the same component id, so just update it in place.\r\n                this.studentData.componentStatesByComponentId[componentId][c] = componentState\r\n                found = true; // remember this so we don't insert later.\r\n                break;\r\n            }\r\n        }\r\n        if (!found) {\r\n            this.studentData.componentStatesByComponentId[componentId].push(componentState);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Retrieve the run status from the server\r\n     */\r\n    retrieveRunStatus() {\r\n        var runStatusURL = this.ConfigService.getConfigParam('runStatusURL');\r\n        var runId = this.ConfigService.getConfigParam('runId');\r\n\r\n        //create the params for the request\r\n        var params = {\r\n            runId:runId\r\n        };\r\n\r\n        var httpParams = {};\r\n        httpParams.method = 'GET';\r\n        httpParams.url = runStatusURL;\r\n        httpParams.headers = {'Content-Type': 'application/x-www-form-urlencoded'};\r\n        httpParams.params = params;\r\n\r\n        // make the request\r\n        return this.$http(httpParams).then((result) => {\r\n            if (result != null) {\r\n                var data = result.data;\r\n                if (data != null) {\r\n                    // save the run status\r\n                    this.runStatus = data;\r\n                    this.initializePeriods();\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    getComponentStatesByWorkgroupId(workgroupId) {\r\n        if (this.studentData.componentStatesByWorkgroupId == null) {\r\n            //debugger;\r\n        }\r\n        var componentStatesByWorkgroupId = this.studentData.componentStatesByWorkgroupId[workgroupId];\r\n        if (componentStatesByWorkgroupId != null) {\r\n            return componentStatesByWorkgroupId;\r\n        } else {\r\n            return [];\r\n        }\r\n    }\r\n\r\n    getComponentStatesByNodeId(nodeId) {\r\n        var componentStatesByNodeId = this.studentData.componentStatesByNodeId[nodeId];\r\n        if (componentStatesByNodeId != null) {\r\n            return componentStatesByNodeId;\r\n        } else {\r\n            return [];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the component stats for a component id\r\n     * @param componentId the component id\r\n     * @returns an array containing component states for a component id\r\n     */\r\n    getComponentStatesByComponentId(componentId) {\r\n        var componentStates = [];\r\n\r\n        var componentStatesByComponentId = this.studentData.componentStatesByComponentId[componentId];\r\n\r\n        if (componentStatesByComponentId != null) {\r\n            componentStates = componentStatesByComponentId;\r\n        }\r\n\r\n        return componentStates;\r\n    }\r\n\r\n    getLatestComponentStateByWorkgroupIdNodeIdAndComponentId(workgroupId, nodeId, componentId) {\r\n        var latestComponentState = null;\r\n\r\n        var componentStates = this.getComponentStatesByWorkgroupIdAndNodeId(workgroupId, nodeId);\r\n\r\n        if (componentStates != null) {\r\n\r\n            // loop through all the component states from newest to oldest\r\n            for (var c = componentStates.length - 1; c >= 0; c--) {\r\n                var componentState = componentStates[c];\r\n\r\n                if (componentState != null) {\r\n                    var componentStateNodeId = componentState.nodeId;\r\n                    var componentStateComponentId = componentState.componentId;\r\n\r\n                    // compare the node id and component id\r\n                    if (nodeId == componentStateNodeId &&\r\n                        componentId == componentStateComponentId) {\r\n                        latestComponentState = componentState;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return latestComponentState;\r\n    }\r\n\r\n    getLatestComponentStateByWorkgroupIdNodeId(workgroupId, nodeId) {\r\n        var latestComponentState = null;\r\n\r\n        var componentStates = this.getComponentStatesByWorkgroupIdAndNodeId(workgroupId, nodeId);\r\n\r\n        if (componentStates != null) {\r\n\r\n            // loop through all the component states from newest to oldest\r\n            for (var c = componentStates.length - 1; c >= 0; c--) {\r\n                var componentState = componentStates[c];\r\n\r\n                if (componentState != null) {\r\n                    var componentStateNodeId = componentState.nodeId;\r\n\r\n                    // compare the node id and component id\r\n                    if (nodeId == componentStateNodeId) {\r\n                        latestComponentState = componentState;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return latestComponentState;\r\n    }\r\n\r\n    /**\r\n     * Get the latest component states for a workgroup. Each component state\r\n     * will be the latest component state for a component.\r\n     * @param workgroupId the workgroup id\r\n     * @return an array of latest component states\r\n     */\r\n    getLatestComponentStatesByWorkgroupId(workgroupId) {\r\n        var componentStates = [];\r\n\r\n        if (workgroupId != null) {\r\n\r\n            // get all the component states for a workgroup\r\n            var componentStatesForWorkgroup = this.getComponentStatesByWorkgroupId(workgroupId);\r\n\r\n            if (componentStatesForWorkgroup != null) {\r\n\r\n                // mapping of component to revision counter\r\n                var componentRevisionCounter = {};\r\n\r\n                /*\r\n                 * used to keep track of the components we have found component\r\n                 * states for already\r\n                 */\r\n                var componentsFound = {};\r\n\r\n                // loop through the component states forwards\r\n                for (var csf = 0; csf < componentStatesForWorkgroup.length; csf++) {\r\n\r\n                    // get a component state\r\n                    var componentState = componentStatesForWorkgroup[csf];\r\n\r\n                    if (componentState != null) {\r\n\r\n                        // get the node id and component id of the component state\r\n                        var nodeId = componentState.nodeId;\r\n                        var componentId = componentState.componentId;\r\n\r\n                        // generate the component key e.g. \"node2_bb83hs0sd8\"\r\n                        var key = nodeId + \"-\" + componentId;\r\n\r\n                        if (componentRevisionCounter[key] == null) {\r\n                            // initialize the component revision counter for this component to 1 if there is no entry\r\n                            componentRevisionCounter[key] = 1;\r\n                        }\r\n\r\n                        // get the revision counter\r\n                        var revisionCounter = componentRevisionCounter[key];\r\n\r\n                        // set the revision counter into the component state\r\n                        componentState.revisionCounter = revisionCounter;\r\n\r\n                        // increment the revision counter for the component\r\n                        componentRevisionCounter[key] = revisionCounter + 1;\r\n                    }\r\n                }\r\n\r\n                // loop through the component states backwards\r\n                for(var csb = componentStatesForWorkgroup.length - 1; csb >= 0; csb--) {\r\n\r\n                    // get a component state\r\n                    var componentState = componentStatesForWorkgroup[csb];\r\n\r\n                    if (componentState != null) {\r\n\r\n                        // get the node id and component id of the component state\r\n                        var nodeId = componentState.nodeId;\r\n                        var componentId = componentState.componentId;\r\n\r\n                        // generate the component key e.g. \"node2_bb83hs0sd8\"\r\n                        var key = nodeId + \"-\" + componentId;\r\n\r\n                        if (componentsFound[key] == null) {\r\n                            /*\r\n                             * we have not found a component state for this\r\n                             * component yet so we will add it to the array\r\n                             * of component states\r\n                             */\r\n                            componentStates.push(componentState);\r\n\r\n                            /*\r\n                             * add an entry into the components found so that\r\n                             * don't add any more component states from this\r\n                             * component\r\n                             */\r\n                            componentsFound[key] = true;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                /*\r\n                 * reverse the component states array since we have been adding\r\n                 * component states from newest to oldest order but we want them\r\n                 * in oldest to newest order\r\n                 */\r\n                componentStates.reverse();\r\n            }\r\n        }\r\n\r\n        return componentStates;\r\n    }\r\n\r\n    getComponentStatesByWorkgroupIdAndNodeId(workgroupId, nodeId) {\r\n\r\n        var componentStatesByWorkgroupId = this.getComponentStatesByWorkgroupId(workgroupId);\r\n        var componentStatesByNodeId = this.getComponentStatesByNodeId(nodeId);\r\n\r\n        // find the intersect and return it\r\n        return componentStatesByWorkgroupId.filter((n) => {\r\n            return componentStatesByNodeId.indexOf(n) != -1;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Get component states for a workgroup id and component id\r\n     * @param workgroupId the workgroup id\r\n     * @param componentId the component id\r\n     * @returns an array of component states\r\n     */\r\n    getComponentStatesByWorkgroupIdAndComponentId(workgroupId, componentId) {\r\n        var componentStatesByWorkgroupId = this.getComponentStatesByWorkgroupId(workgroupId);\r\n        var componentStatesByComponentId = this.getComponentStatesByComponentId(componentId);\r\n\r\n        // find the intersect and return it\r\n        return componentStatesByWorkgroupId.filter((n) => {\r\n            return componentStatesByComponentId.indexOf(n) != -1;\r\n        });\r\n    }\r\n\r\n    getEventsByWorkgroupId(workgroupId) {\r\n        var eventsByWorkgroupId = this.studentData.eventsByWorkgroupId[workgroupId];\r\n        if (eventsByWorkgroupId != null) {\r\n            return eventsByWorkgroupId;\r\n        } else {\r\n            return [];\r\n        }\r\n    };\r\n\r\n    getEventsByNodeId(nodeId) {\r\n        var eventsByNodeId = this.studentData.eventsByNodeId[nodeId];\r\n        if (eventsByNodeId != null) {\r\n            return eventsByNodeId;\r\n        } else {\r\n            return [];\r\n        }\r\n    };\r\n\r\n    getEventsByWorkgroupIdAndNodeId(workgroupId, nodeId) {\r\n        var eventsByWorkgroupId = this.getEventsByWorkgroupId(workgroupId);\r\n        var eventsByNodeId = this.getEventsByNodeId(nodeId);\r\n\r\n        // find the intersect and return it\r\n        return eventsByWorkgroupId.filter((n) => {\r\n            return eventsByNodeId.indexOf(n) != -1;\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Get the latest event by workgroup id, node id, and event type\r\n     * @param workgroupId the workgroup id\r\n     * @param nodeId the node id\r\n     * @param eventType the event type\r\n     * @return the latest event with the matching parameters or null if\r\n     * no event is found with the matching parameters\r\n     */\r\n    getLatestEventByWorkgroupIdAndNodeIdAndType(workgroupId, nodeId, eventType) {\r\n\r\n        // get all the events for a workgroup id\r\n        var eventsByWorkgroupId = this.getEventsByWorkgroupId(workgroupId);\r\n\r\n        if (eventsByWorkgroupId != null) {\r\n\r\n            /*\r\n             * loop through all the events for the workgroup from newest to\r\n             * oldest\r\n             */\r\n            for (var e = eventsByWorkgroupId.length - 1; e >= 0; e--) {\r\n\r\n                // get an event\r\n                var event = eventsByWorkgroupId[e];\r\n\r\n                if (event != null) {\r\n                    if (event.nodeId == nodeId && event.event == eventType) {\r\n                        /*\r\n                         * the event parameters match the ones we are looking\r\n                         * for\r\n                         */\r\n                        return event;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    getAnnotationsToWorkgroupId(workgroupId) {\r\n        var annotationsToWorkgroupId = this.studentData.annotationsToWorkgroupId[workgroupId];\r\n        if (annotationsToWorkgroupId != null) {\r\n            return annotationsToWorkgroupId;\r\n        } else {\r\n            return [];\r\n        }\r\n    }\r\n\r\n    getAnnotationsByNodeId(nodeId) {\r\n        var annotationsByNodeId = this.studentData.annotationsByNodeId[nodeId];\r\n        if (annotationsByNodeId != null) {\r\n            return annotationsByNodeId;\r\n        } else {\r\n            return [];\r\n        }\r\n    }\r\n\r\n    getAnnotationsToWorkgroupIdAndNodeId(workgroupId, nodeId) {\r\n        var annotationsToWorkgroupId = this.getAnnotationsToWorkgroupId(workgroupId);\r\n        var annotationsByNodeId = this.getAnnotationsByNodeId(nodeId);\r\n\r\n        // find the intersect and return it\r\n        return annotationsToWorkgroupId.filter((n) => {\r\n            return annotationsByNodeId.indexOf(n) != -1;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Initialize the periods\r\n     */\r\n    initializePeriods() {\r\n        let periods = this.ConfigService.getPeriods();\r\n        let currentPeriod = null;\r\n\r\n        if (periods.length > 1) {\r\n            // create an option for all periods\r\n            let allPeriodsOption = {\r\n                periodId: -1,\r\n                periodName: this.$translate('allPeriods')\r\n            };\r\n\r\n            periods.unshift(allPeriodsOption);\r\n            currentPeriod = periods[0];\r\n        } else if (periods.length == 1) {\r\n            currentPeriod = periods[0];\r\n        }\r\n\r\n        this.periods = periods;\r\n        if (!this.runStatus.periods) {\r\n            this.runStatus.periods = this.periods;\r\n        }\r\n\r\n        // set the current period\r\n        if (currentPeriod) {\r\n            this.setCurrentPeriod(currentPeriod);\r\n        }\r\n    }\r\n\r\n    setCurrentPeriod(period) {\r\n        let previousPeriod = this.currentPeriod;\r\n        this.currentPeriod = period;\r\n\r\n        // whenever the current period is set, clear the currently selected workgroup\r\n        this.setCurrentWorkgroup(null);\r\n\r\n        // broadcast the event that the current period has changed\r\n        this.$rootScope.$broadcast('currentPeriodChanged', {previousPeriod: previousPeriod, currentPeriod: this.currentPeriod});\r\n    }\r\n\r\n    getCurrentPeriod() {\r\n        return this.currentPeriod;\r\n    }\r\n\r\n    getPeriods() {\r\n        return this.periods;\r\n    }\r\n\r\n    getRunStatus() {\r\n        return this.runStatus;\r\n    }\r\n\r\n    setCurrentWorkgroup(workgroup) {\r\n        this.currentWorkgroup = workgroup;\r\n\r\n        // broadcast the event that the current workgroup has changed\r\n        this.$rootScope.$broadcast('currentWorkgroupChanged', {currentWorkgroup: this.currentWorkgroup});\r\n    }\r\n\r\n    getCurrentWorkgroup() {\r\n        return this.currentWorkgroup;\r\n    }\r\n\r\n    /**\r\n     * Get the current node\r\n     * @returns the current node object\r\n     */\r\n    getCurrentNode() {\r\n        return this.currentNode;\r\n    }\r\n\r\n    /**\r\n     * Get the current node id\r\n     * @returns the current node id\r\n     */\r\n    getCurrentNodeId() {\r\n        var currentNodeId = null;\r\n\r\n        if (this.currentNode != null) {\r\n            currentNodeId = this.currentNode.id;\r\n        }\r\n\r\n        return currentNodeId;\r\n    }\r\n\r\n    /**\r\n     * Set the current node\r\n     * @param nodeId the node id\r\n     */\r\n    setCurrentNodeByNodeId(nodeId) {\r\n        if (nodeId != null) {\r\n            let node = this.ProjectService.getNodeById(nodeId);\r\n\r\n            this.setCurrentNode(node);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set the current node\r\n     * @param node the node object\r\n     */\r\n    setCurrentNode(node) {\r\n        let previousCurrentNode = this.currentNode;\r\n\r\n        if (previousCurrentNode !== node) {\r\n            // the current node is about to change\r\n\r\n            if (previousCurrentNode && !this.ProjectService.isGroupNode(previousCurrentNode.id)){\r\n                // set the previous node to the current node\r\n                this.previousStep = previousCurrentNode;\r\n            }\r\n\r\n            // set the current node to the new node\r\n            this.currentNode = node;\r\n\r\n            // broadcast the event that the current node has changed\r\n            this.$rootScope.$broadcast('currentNodeChanged', {previousNode: previousCurrentNode, currentNode: this.currentNode});\r\n        }\r\n    }\r\n\r\n    /**\r\n     * End the current node\r\n     */\r\n    endCurrentNode() {\r\n\r\n        // get the current node\r\n        var previousCurrentNode = this.currentNode;\r\n\r\n        if (previousCurrentNode != null) {\r\n\r\n            // tell the node to exit\r\n            this.$rootScope.$broadcast('exitNode', {nodeToExit: previousCurrentNode});\r\n        }\r\n    }\r\n\r\n    /**\r\n     * End the current node and set the current node\r\n     * @param nodeId the node id of the new current node\r\n     */\r\n    endCurrentNodeAndSetCurrentNodeByNodeId(nodeId) {\r\n        // end the current node\r\n        this.endCurrentNode();\r\n\r\n        // set the current node\r\n        this.setCurrentNodeByNodeId(nodeId);\r\n    }\r\n\r\n    /**\r\n     * Get the total score for a workgroup\r\n     * @param workgroupId the workgroup id\r\n     * @returns the total score for the workgroup\r\n     */\r\n    getTotalScoreByWorkgroupId(workgroupId) {\r\n\r\n        var totalScore = null;\r\n\r\n        if (this.studentData.annotationsToWorkgroupId != null) {\r\n\r\n            // get all the annotations for a workgroup\r\n            var annotations = this.studentData.annotationsToWorkgroupId[workgroupId];\r\n\r\n            // get the total score for the workgroup\r\n            totalScore = this.AnnotationService.getTotalScore(annotations, workgroupId);\r\n        }\r\n\r\n        return totalScore;\r\n    }\r\n\r\n    /**\r\n     * Get the run status\r\n     * @returns the run status object\r\n     */\r\n    getRunStatus() {\r\n        return this.runStatus;\r\n    }\r\n\r\n    /**\r\n     * Check if any period in the run is paused\r\n     * @returns Boolean whether any periods are paused\r\n     */\r\n    isAnyPeriodPaused(periodId) {\r\n        let isPaused = false;\r\n\r\n        // get the run status\r\n        let runStatus = this.runStatus;\r\n\r\n        if (runStatus && runStatus.periods) {\r\n            let periods = runStatus.periods;\r\n            let nPeriods = periods.length;\r\n            let nPeriodsPaused = 0;\r\n\r\n            // loop through all the periods\r\n            for (let p = 0; p < periods.length; p++) {\r\n                let period = periods[p];\r\n\r\n                if (period != null) {\r\n                    if (period.paused) {\r\n                        isPaused = true;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return isPaused;\r\n    }\r\n\r\n    /**\r\n     * Check if the given period is paused\r\n     * @param periodId the id for a period\r\n     * @returns Boolean whether the period is paused or not\r\n     */\r\n    isPeriodPaused(periodId) {\r\n\r\n        let isPaused = false;\r\n\r\n        // get the run status\r\n        let runStatus = this.runStatus;\r\n\r\n        if (runStatus && runStatus.periods) {\r\n            let periods = runStatus.periods;\r\n            let nPeriods = periods.length;\r\n            let nPeriodsPaused = 0;\r\n\r\n            // loop through all the periods\r\n            for (let p = 0; p < periods.length; p++) {\r\n                let period = periods[p];\r\n\r\n                if (period != null) {\r\n                    isPaused = period.paused;\r\n                    if (periodId == period.periodId) {\r\n                        // we have found the period we are looking for\r\n                        break;\r\n                    } else {\r\n                        if (isPaused) {\r\n                            nPeriodsPaused++;\r\n                        } else {\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (periodId === -1 && nPeriods === nPeriodsPaused) {\r\n                isPaused = true;\r\n            }\r\n        }\r\n\r\n        return isPaused;\r\n    }\r\n\r\n    /**\r\n     * The pause screen status was changed for the given periodId. Update period accordingly.\r\n     * @param periodId the id of the period to toggle\r\n     * @param isPaused Boolean whether the period should be paused or not\r\n     */\r\n    pauseScreensChanged(periodId, isPaused) {\r\n        if (periodId) {\r\n            // update the run status\r\n            this.updatePausedRunStatusValue(periodId, isPaused);\r\n\r\n            if (isPaused) {\r\n                // pause the student screens\r\n                this.TeacherWebSocketService.pauseScreens(periodId);\r\n            } else {\r\n                // unpause the student screens\r\n                this.TeacherWebSocketService.unPauseScreens(periodId);\r\n            }\r\n\r\n            // save the run status to the server\r\n            this.sendRunStatus();\r\n\r\n            // save pause/unpause screen event\r\n            let context = \"ClassroomMonitor\", nodeId = null, componentId = null, componentType = null,\r\n                category = \"TeacherAction\", data = { periodId: periodId };\r\n            let event = \"pauseScreen\";\r\n            if (!isPaused) {\r\n                event = \"unPauseScreen\";\r\n            }\r\n            this.saveEvent(context, nodeId, componentId, componentType, category, event, data);\r\n\r\n            this.$rootScope.$broadcast('pauseScreensChanged', {periods: this.runStatus.periods});\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create a local run status object to keep track of the run status\r\n     * @returns the run status object\r\n     */\r\n    createRunStatus() {\r\n        var runStatus = {};\r\n\r\n        // get the run id\r\n        runStatus.runId = this.ConfigService.getConfigParam('runId');\r\n\r\n        // get all the periods objects\r\n        var periods = this.ConfigService.getPeriods();\r\n\r\n        //loop through all the periods\r\n        for (var x = 0; x < periods.length; x++) {\r\n            //get a period\r\n            var period = periods[x];\r\n\r\n            //set this to default to not paused\r\n            period.paused = false;\r\n        }\r\n\r\n        // set the periods into the run status\r\n        runStatus.periods = periods;\r\n\r\n        // set the run status into the view so we can access it later\r\n        this.runStatus = runStatus;\r\n\r\n        return this.runStatus;\r\n    }\r\n\r\n    /**\r\n     * Update the paused value for a period in our run status\r\n     * @param periodId the period id\r\n     * @param value whether the period is paused or not\r\n     */\r\n    updatePausedRunStatusValue(periodId, value) {\r\n        //create the local run status object if necessary\r\n        if (this.runStatus == null) {\r\n            this.createRunStatus();\r\n        }\r\n\r\n        //get the local run status object\r\n        let runStatus = this.runStatus;\r\n        let periods = runStatus.periods;\r\n\r\n        let allPeriodsPaused = true;\r\n\r\n        if (periods) {\r\n            let l = periods.length, x = l - 1;\r\n            //loop through all the periods\r\n            for (; x > -1; x--) {\r\n                //get a period\r\n                let tempPeriod = periods[x];\r\n\r\n                //get the period id\r\n                let tempPeriodId = tempPeriod.periodId;\r\n\r\n                //check if the period id matches the one we need to update or if all periods has been selected\r\n                if (periodId === tempPeriodId || periodId === -1) {\r\n                    //we have found the period we want to update\r\n                    tempPeriod.paused = value;\r\n                }\r\n\r\n                if (tempPeriodId !== -1 && !tempPeriod.paused) {\r\n                    allPeriodsPaused = false;\r\n                }\r\n\r\n                if (tempPeriodId === -1) {\r\n                    // set the paused status for the all periods option\r\n                    tempPeriod.paused = allPeriodsPaused;\r\n                }\r\n             }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Send the run status back to the server to be saved in the db\r\n     * @param customPauseMessage the custom pause message text to send to the students\r\n     */\r\n    sendRunStatus(customPauseMessage) {\r\n        //get the run status url we will use to make the request\r\n        var runStatusURL = this.ConfigService.getConfigParam('runStatusURL');\r\n\r\n        if (runStatusURL != null) {\r\n            //make the request to the server for the student statuses\r\n\r\n            //get the run id\r\n            var runId = this.ConfigService.getConfigParam('runId');\r\n\r\n            if (customPauseMessage != null) {\r\n                //set the pause message if one was provided\r\n                this.runStatus.pauseMessage = customPauseMessage;\r\n            }\r\n\r\n            //get the run status as a string\r\n            var runStatus = angular.toJson(this.runStatus);\r\n\r\n            //create the params for the request\r\n            var runStatusParams = {\r\n                runId:runId,\r\n                status:runStatus\r\n            };\r\n\r\n            var httpParams = {};\r\n            httpParams.method = 'POST';\r\n            httpParams.url = runStatusURL;\r\n            httpParams.headers = {'Content-Type': 'application/x-www-form-urlencoded'};\r\n            httpParams.data = $.param(runStatusParams);\r\n\r\n            // make the request\r\n            this.$http(httpParams);\r\n        }\r\n    };\r\n}\r\n\r\nTeacherDataService.$inject = [\r\n    '$http',\r\n    '$filter',\r\n    '$q',\r\n    '$rootScope',\r\n    'AnnotationService',\r\n    'ConfigService',\r\n    'NotificationService',\r\n    'ProjectService',\r\n    'TeacherWebSocketService',\r\n    'UtilService'\r\n];\r\n\r\nexport default TeacherDataService;\r\n"]}