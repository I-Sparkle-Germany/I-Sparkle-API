{"version":3,"sources":["teacherWebSocketService.es6"],"names":["TeacherWebSocketService","$rootScope","$stomp","$websocket","ConfigService","StudentStatusService","dataStream","studentsOnlineArray","runId","getRunId","webSocketURL","getWebSocketURL","connect","then","frame","subscribeToTeacherTopic","subscribeToTeacherWorkgroupTopic","e","console","log","subscribe","message","headers","res","type","studentWork","content","studentData","JSON","parse","$broadcast","studentStatus","status","handleStudentStatusReceived","achievement","data","studentAchievement","annotationData","annotation","getWorkgroupId","notification","studentsOnlineMessage","studentsOnlineList","studentsOnline","workgroupId","indexOf","setStudentStatusForWorkgroupId","$emit","studentDisconnectedMessage","periodId","send","stringify","$inject"],"mappings":"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","file":"teacherWebSocketService.js","sourcesContent":["class TeacherWebSocketService {\n  constructor(\n      $rootScope,\n      $stomp,\n      $websocket,\n      ConfigService,\n      StudentStatusService) {\n    this.$rootScope = $rootScope;\n    this.$stomp = $stomp;\n    this.$websocket = $websocket;\n    this.ConfigService = ConfigService;\n    this.StudentStatusService = StudentStatusService;\n    this.dataStream = null;\n    this.studentsOnlineArray = [];\n  }\n\n  initialize() {\n    this.runId = this.ConfigService.getRunId();\n    const webSocketURL = this.ConfigService.getWebSocketURL();\n    try {\n      this.$stomp.connect(webSocketURL).then((frame) => {\n        this.subscribeToTeacherTopic();\n        this.subscribeToTeacherWorkgroupTopic();\n      });\n    } catch(e) {\n      console.log(e);\n    }\n  }\n\n  subscribeToTeacherTopic() {\n    this.$stomp.subscribe(`/topic/teacher/${this.runId}`, (message, headers, res) => {\n      if (message.type === 'studentWork') {\n        const studentWork = message.content;\n        studentWork.studentData = JSON.parse(studentWork.studentData);\n        this.$rootScope.$broadcast('newStudentWorkReceived', {studentWork: studentWork});\n      } else if (message.type === 'studentStatus') {\n        const studentStatus = message.content;\n        const status = JSON.parse(studentStatus.status);\n        this.handleStudentStatusReceived(status);\n      } else if (message.type === 'newStudentAchievement') {\n        const achievement = message.content;\n        achievement.data = JSON.parse(achievement.data);\n        this.$rootScope.$broadcast('newStudentAchievement', {studentAchievement: achievement});\n      } else if (message.type === 'annotation') {\n        const annotationData = message.content;\n        annotationData.data = JSON.parse(annotationData.data);\n        this.$rootScope.$broadcast('newAnnotationReceived', {annotation: annotationData});\n      }\n    });\n  }\n\n  subscribeToTeacherWorkgroupTopic() {\n    this.$stomp.subscribe(`/topic/workgroup/${this.ConfigService.getWorkgroupId()}`, (message, headers, res) => {\n      if (message.type === 'notification') {\n        const notification = message.content;\n        notification.data = JSON.parse(notification.data);\n        this.$rootScope.$broadcast('newNotificationReceived', notification);\n      }\n    });\n  }\n\n  handleStudentsOnlineReceived(studentsOnlineMessage) {\n    this.studentsOnlineArray = studentsOnlineMessage.studentsOnlineList;\n    this.$rootScope.$broadcast('studentsOnlineReceived', {studentsOnline: this.studentsOnlineArray});\n  }\n\n  getStudentsOnline() {\n    return this.studentsOnlineArray;\n  }\n\n  isStudentOnline(workgroupId) {\n    return this.studentsOnlineArray.indexOf(workgroupId) > -1;\n  }\n\n  handleStudentStatusReceived(studentStatus) {\n    const workgroupId = studentStatus.workgroupId;\n    this.StudentStatusService\n        .setStudentStatusForWorkgroupId(workgroupId, studentStatus);\n    this.$rootScope\n        .$emit('studentStatusReceived', {studentStatus: studentStatus});\n  }\n\n  handleStudentDisconnected(studentDisconnectedMessage) {\n    this.$rootScope.$broadcast('studentDisconnected', {data: studentDisconnectedMessage});\n  }\n\n  pauseScreens(periodId) {\n    this.$stomp.send(`/app/pause/${this.runId}/${periodId}`, JSON.stringify({'name': 'teacher'}), {});\n  }\n\n  unPauseScreens(periodId) {\n    this.$stomp.send(`/app/unpause/${this.runId}/${periodId}`, JSON.stringify({'name': 'teacher'}), {});\n  }\n}\n\nTeacherWebSocketService.$inject = [\n  '$rootScope',\n  '$stomp',\n  '$websocket',\n  'ConfigService',\n  'StudentStatusService'\n];\n\nexport default TeacherWebSocketService;\n"]}