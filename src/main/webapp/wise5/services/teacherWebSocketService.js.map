{"version":3,"sources":["teacherWebSocketService.es6"],"names":[],"mappings":"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","file":"teacherWebSocketService.js","sourcesContent":["class TeacherWebSocketService {\n    constructor($rootScope, $websocket, ConfigService, StudentStatusService) {\n        this.$rootScope = $rootScope;\n        this.$websocket = $websocket;\n        this.ConfigService = ConfigService;\n        this.StudentStatusService = StudentStatusService;\n        this.dataStream = null;\n    }\n\n    initialize() {\n        var runId = this.ConfigService.getRunId();\n        var periodId = this.ConfigService.getPeriodId();\n        var workgroupId = this.ConfigService.getWorkgroupId();\n        var webSocketURL = this.ConfigService.getWebSocketURL();\n        webSocketURL += \"?runId=\" + runId + \"&periodId=\" + periodId + \"&workgroupId=\" + workgroupId;\n        this.dataStream = this.$websocket(webSocketURL);\n\n        this.dataStream.onMessage(angular.bind(this, function(message) {\n            this.handleMessage(message);\n        }));\n    };\n\n    handleMessage(message) {\n        var data = JSON.parse(message.data);\n        var messageType = data.messageType;\n        if (messageType === 'studentStatus') {\n            this.handleStudentStatusReceived(data);\n        } else if (messageType === 'studentsOnlineList') {\n            this.handleStudentsOnlineReceived(data);\n        }\n    };\n\n    handleStudentsOnlineReceived(studentsOnlineMessage) {\n        this.studentsOnlineArray = studentsOnlineMessage.studentsOnlineList;\n\n        this.$rootScope.$broadcast('studentsOnlineReceived', {studentsOnline: this.studentsOnlineArray});\n    };\n\n    getStudentsOnline() {\n        var studentsOnline = [];\n        if (this.studentsOnlineArray != null) {\n            studentsOnline = this.studentsOnlineArray;\n        }\n        return studentsOnline;\n    };\n\n    /**\n     * This function is called when the teacher receives a websocket message\n     * with messageType 'studentStatus'.\n     */\n    handleStudentStatusReceived(studentStatus) {\n        var workgroupId = studentStatus.workgroupId;\n\n        this.StudentStatusService.setStudentStatusForWorkgroupId(workgroupId, studentStatus);\n\n        var latestCompletedNodeVisit = studentStatus.previousNodeVisit;\n        if (latestCompletedNodeVisit != null) {\n            var nodeStates = latestCompletedNodeVisit.nodeStates;\n            if (nodeStates != null && nodeStates.length > 0) {\n                // there's new work. notify the teacher\n                this.StudentStatusService.addNewNodeVisit(latestCompletedNodeVisit);\n            }\n        }\n        /*\n         var runId = data.runId;\n         var periodId = data.periodId;\n         var workgroupId = data.workgroupId;\n         var currentNodeId = data.currentNodeId;\n         var previousNodeVisit = data.previousNodeVisit;\n         var nodeStatuses = data.nodeStatuses;\n\n         //we will reset the time spent value to 0 since the student has just moved to a new step\n         var timeSpent = '0:00';\n\n         //update our local copy of the student status object for the workgroup id\n         var studentStatusObject = this.updateStudentStatusObject(data);\n         */\n\n        //get the annotation if any\n        //var annotation = data.annotation;\n\n        //update the student progress row for the workgroup id\n        //this.updateStudentProgress(runId, periodId, workgroupId, currentNodeId, previousNodeVisit, nodeStatuses, timeSpent);\n\n        //update the step progress for all steps and periods\n        //this.updateStepProgress();\n\n        //check if we need to notify the teacher that there's new work for the screen they are viewing\n        //this.checkIfNeedToDisplayNewWorkNotification(data);\n\n        //if (annotation != null) {\n        //analyze the annotation to see if we need to do anything special\n        //this.analyzeAnnotation(annotation, previousNodeVisit, workgroupId);\n        //}\n    };\n}\n\nTeacherWebSocketService.$inject = ['$rootScope', '$websocket', 'ConfigService', 'StudentStatusService'];\n\nexport default TeacherWebSocketService;"]}