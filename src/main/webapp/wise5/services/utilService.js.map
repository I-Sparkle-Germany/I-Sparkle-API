{"version":3,"sources":["utilService.es6"],"names":["UtilService","$filter","$rootScope","$translate","length","CHARS","key","a","Math","floor","random","str","result","isNaN","Number","jsonObject","copyOfJSONObject","jsonObjectString","angular","toJson","fromJson","img_b64","blob","dataURItoBlob","now","Date","getTime","filename","encodeURIComponent","pngFile","File","lastModified","type","dataURI","byteString","split","indexOf","atob","unescape","mimeString","ia","Uint8Array","i","charCodeAt","Blob","imageElement","imageObject","canvas","document","createElement","width","naturalWidth","height","naturalHeight","ctx","getContext","drawImage","dataURL","toDataURL","getImageObjectFromBase64String","iframes","element","iframe","style","display","fileName","lowerCaseFileName","toLowerCase","imageExtensionsRegEx","RegExp","matchResult","match","videoExtensionsRegEx","html","insertWISELinkAnchors","insertWISELinkButtons","wiseLinkRegEx","wiseLinkRegExMatchResult","exec","anchorHTML","anchorText","nodeId","getWISELinkNodeId","componentIdAttr","componentId","getWISELinkComponentId","wiselinkHtml","replace","buttonHTML","buttonText","nodeIdRegEx","nodeIdRegExResult","componentIdRegEx","componentIdRegExResult","typeRegEx","typeRegExResult","linkText","linkTextRegEx","linkTextRegExResult","replaceWISELinksHelper","regex","wiseLinkHTML","componentHTML","getWISELinkType","getWISELinkLinkText","newElement","controller","projectId","target","tooltip","thisRootScope","InsertAssetButton","context","ui","$","summernote","button","contents","click","invoke","params","popup","$broadcast","render","InsertWISELinkButton","text","subjectString","searchString","position","isFinite","lastIndex","lastIndexOf","object1","object2","serverSaveTime","milliseconds","dateTimeString","date","toDateString","toLocaleTimeString","componentType","label","Array","prototype","last","$inject"],"mappings":"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","file":"utilService.js","sourcesContent":["'use strict';\r\n\r\nclass UtilService {\r\n\r\n    constructor($filter,\r\n                $rootScope) {\r\n        this.$filter = $filter;\r\n        this.$rootScope = $rootScope;\r\n\r\n        this.$translate = this.$filter('translate');\r\n    }\r\n\r\n    /**\r\n     * Generates and returns a random key of the given length if\r\n     * specified. If length is not specified, returns a key 10\r\n     * characters in length.\r\n     */\r\n    generateKey(length) {\r\n        this.CHARS = [\"a\",\"b\",\"c\",\"d\",\"e\",\"f\",\"g\",\"h\",\"i\",\"j\",\"k\",\"l\",\"m\",\"n\",\"o\",\"p\",\"q\",\"r\", \"s\",\"t\",\r\n            \"u\",\"v\",\"w\",\"x\",\"y\",\"z\",\"0\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\"];\r\n\r\n        /* set default length if not specified */\r\n        if (!length) {\r\n            length = 10;\r\n        }\r\n\r\n        /* generate the key */\r\n        var key = '';\r\n        for (var a = 0; a < length; a++) {\r\n            key += this.CHARS[Math.floor(Math.random() * (this.CHARS.length - 1))];\r\n        }\r\n\r\n        /* return the generated key */\r\n        // TODO: check that the new key is unique\r\n        return key;\r\n    };\r\n\r\n    /**\r\n     * Try to convert a string to a number\r\n     * @param str the string to convert\r\n     * @returns a number if we were able to convert the string to a number.\r\n     * if we couldn't convert the string to a number we will just return the string.\r\n     */\r\n    convertStringToNumber(str) {\r\n        var result = str;\r\n\r\n        if (str != null && str != '' && !isNaN(Number(str))) {\r\n            result = Number(str);\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * Create a copy of a JSON object\r\n     * @param jsonObject the JSON object to get a copy of\r\n     * @return a copy of the JSON object that was passed in\r\n     */\r\n    makeCopyOfJSONObject(jsonObject) {\r\n        var copyOfJSONObject = null;\r\n\r\n        if (jsonObject != null) {\r\n            // create a JSON string from the JSON object\r\n            var jsonObjectString = angular.toJson(jsonObject);\r\n\r\n            // create a JSON object from the JSON string\r\n            copyOfJSONObject = angular.fromJson(jsonObjectString);\r\n        }\r\n\r\n        return copyOfJSONObject;\r\n    };\r\n\r\n    /**\r\n     * Get the image object\r\n     * @params img_b64 the base64 image string\r\n     * @returns an image object\r\n     */\r\n    getImageObjectFromBase64String(img_b64) {\r\n\r\n        // create a blob from the base64 image string\r\n        var blob = this.dataURItoBlob(img_b64);\r\n\r\n        var now = new Date().getTime();\r\n        var filename = encodeURIComponent('picture_' + now + '.png');\r\n        var pngFile = new File([blob], filename, {\r\n            lastModified: now, // optional - default = now\r\n            type: 'image/png' // optional - default = ''\r\n        });\r\n\r\n        return pngFile;\r\n    }\r\n\r\n    /**\r\n     * Convert base64/URLEncoded data component to raw binary data held in a string\r\n     * @param dataURI base64/URLEncoded data\r\n     * @returns a Blob object\r\n     */\r\n    dataURItoBlob(dataURI) {\r\n\r\n        var byteString;\r\n        if (dataURI.split(',')[0].indexOf('base64') >= 0)\r\n            byteString = atob(dataURI.split(',')[1]);\r\n        else\r\n            byteString = unescape(dataURI.split(',')[1]);\r\n\r\n        // separate out the mime component\r\n        var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];\r\n\r\n        // write the bytes of the string to a typed array\r\n        var ia = new Uint8Array(byteString.length);\r\n        for (var i = 0; i < byteString.length; i++) {\r\n            ia[i] = byteString.charCodeAt(i);\r\n        }\r\n\r\n        return new Blob([ia], {type:mimeString});\r\n    };\r\n\r\n    /**\r\n     * Get an image object from an image element\r\n     * @param imageElement an image element (<img src='abc.jpg'/>)\r\n     * @returns an image object\r\n     */\r\n    getImageObjectFromImageElement(imageElement) {\r\n\r\n        var imageObject = null;\r\n\r\n        if (imageElement != null) {\r\n            // create a canvas element that we will use to generate a base64 string\r\n            var canvas = document.createElement(\"canvas\");\r\n\r\n            // set the width and height of the canvas to match the image dimensions\r\n            canvas.width = imageElement.naturalWidth;\r\n            canvas.height = imageElement.naturalHeight;\r\n\r\n            // draw the image onto the canvas\r\n            var ctx = canvas.getContext(\"2d\");\r\n            ctx.drawImage(imageElement, 0, 0);\r\n\r\n            // create the base64 string representation of the image\r\n            var dataURL = canvas.toDataURL(\"image/png\");\r\n\r\n            // get the image object\r\n            imageObject = this.getImageObjectFromBase64String(dataURL);\r\n        }\r\n\r\n        return imageObject;\r\n    }\r\n\r\n    /**\r\n     * Hide all the iframes. This is used before a student snips something\r\n     * to put into their notebook. Iframes shift the position of elements\r\n     * below it which causes issues when html2canvas tries to capture\r\n     * certain elements.\r\n     */\r\n    hideIFrames() {\r\n\r\n        // get all the iframes\r\n        var iframes = angular.element('iframe');\r\n\r\n        // loop through all the iframes\r\n        for (var i = 0; i < iframes.length; i++) {\r\n            var iframe = iframes[i];\r\n\r\n            if (iframe != null) {\r\n                // hide the iframe\r\n                iframe.style.display = 'none';\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Show all the iframes. This is used after the student snips something\r\n     * to put into their notebook. Iframes shift the position of elements\r\n     * below it which causes issues when html2canvas tries to capture\r\n     * certain elements.\r\n     */\r\n    showIFrames() {\r\n\r\n        // get all the iframes\r\n        var iframes = angular.element('iframe');\r\n\r\n        // loop through all the iframes\r\n        for (var i = 0; i < iframes.length; i++) {\r\n            var iframe = iframes[i];\r\n\r\n            if (iframe != null) {\r\n                // show the iframe\r\n                iframe.style.display = '';\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if the asset is an image\r\n     * @param fileName the file name of the asset\r\n     * @return whether the asset is an image or not\r\n     */\r\n    isImage(fileName) {\r\n        var result = false;\r\n\r\n        if (fileName != null) {\r\n            var lowerCaseFileName = fileName.toLowerCase();\r\n\r\n            // regex to match image extensions\r\n            var imageExtensionsRegEx = new RegExp('.*\\.(png|jpg|jpeg|bmp|gif|tiff|svg)');\r\n\r\n            var matchResult = lowerCaseFileName.match(imageExtensionsRegEx);\r\n\r\n            if (matchResult != null) {\r\n                // we have found a match so the asset is an image\r\n                result = true;\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Check if the asset is a video\r\n     * @param fileName the file name of the asset\r\n     * @return whether the asset is a video or not\r\n     */\r\n    isVideo(fileName) {\r\n        var result = false;\r\n\r\n        if (fileName != null) {\r\n            var lowerCaseFileName = fileName.toLowerCase();\r\n\r\n            // regex to match video extensions\r\n            var videoExtensionsRegEx = new RegExp('.*\\.(mp4|mpg|mpeg|m4v|m2v|avi|gifv|mov|qt)');\r\n\r\n            var matchResult = lowerCaseFileName.match(videoExtensionsRegEx);\r\n\r\n            if (matchResult != null) {\r\n                // we have found a match so the asset is a video\r\n                result = true;\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Replace <a> and <button> elements with <wiselink> elements where\r\n     * applicable\r\n     * @param html the html\r\n     * @return the modified html with <wiselink> elements\r\n     */\r\n    insertWISELinks(html) {\r\n\r\n        // replace <a> elements with <wiselink> elements\r\n        html = this.insertWISELinkAnchors(html);\r\n\r\n        // replace <button> elements with <wiselink> elements\r\n        html = this.insertWISELinkButtons(html);\r\n\r\n        return html;\r\n    }\r\n\r\n    /**\r\n     * Replace <a> elements that have the parameter wiselink=true with\r\n     * <wiselink> elements\r\n     * @param html the html\r\n     * @return the modified html with certain <a> elements replaced with\r\n     * <wiselink> elements\r\n     */\r\n    insertWISELinkAnchors(html) {\r\n\r\n        // find <a> elements with the parameter wiselink=true\r\n        let wiseLinkRegEx = new RegExp(/<a.*?wiselink=\"true\".*?>(.*?)<\\/a>/);\r\n\r\n        // find the first match\r\n        let wiseLinkRegExMatchResult = wiseLinkRegEx.exec(html);\r\n\r\n        // loop until we have replaced all the matches\r\n        while(wiseLinkRegExMatchResult != null) {\r\n\r\n            // get the whole <a> element\r\n            let anchorHTML = wiseLinkRegExMatchResult[0];\r\n\r\n            // get the inner html of the <a> element\r\n            let anchorText = wiseLinkRegExMatchResult[1];\r\n\r\n            // get the node id parameter of the <a> element\r\n            let nodeId = this.getWISELinkNodeId(anchorHTML);\r\n\r\n            if (nodeId == null) {\r\n                nodeId = '';\r\n            }\r\n\r\n            let componentIdAttr = \"\";\r\n            let componentId = this.getWISELinkComponentId(anchorHTML);\r\n            if (componentId != null) {\r\n                componentIdAttr = \"component-id='\" + componentId + \"'\";\r\n            }\r\n\r\n            // create the <wiselink> element\r\n            let wiselinkHtml = \"<wiselink type='link' link-text='\" + anchorText + \"' node-id='\" + nodeId + \"' \" + componentIdAttr + \"/>\";\r\n\r\n            // replace the <a> element with the <wiselink> element\r\n            html = html.replace(wiseLinkRegExMatchResult[0], wiselinkHtml);\r\n\r\n            // search for the next <a> element with the parameter wiselink=true\r\n            wiseLinkRegExMatchResult = wiseLinkRegEx.exec(html);\r\n        }\r\n\r\n        return html;\r\n    }\r\n\r\n    /**\r\n     * Replace <button> elements that have the parameter wiselink=true\r\n     * with <wiselink> elements\r\n     * @param html the html\r\n     * @return the modified html with certain <button> elements replaced with\r\n     * <wiselink> elements\r\n     */\r\n    insertWISELinkButtons(html) {\r\n\r\n        // find <button> elements with the parameter wiselink=true\r\n        var wiseLinkRegEx = new RegExp(/<button.*?wiselink=\"true\".*?>(.*?)<\\/button>/);\r\n\r\n        // find the first match\r\n        var wiseLinkRegExMatchResult = wiseLinkRegEx.exec(html);\r\n\r\n        // loop until we have replaced all the matches\r\n        while(wiseLinkRegExMatchResult != null) {\r\n\r\n            // get the whole <button> element\r\n            var buttonHTML = wiseLinkRegExMatchResult[0];\r\n\r\n            // get the inner html of the <button> element\r\n            var buttonText = wiseLinkRegExMatchResult[1];\r\n\r\n            // get the node id parameter of the <button> element\r\n            var nodeId = this.getWISELinkNodeId(buttonHTML);\r\n\r\n            if (nodeId == null) {\r\n                nodeId = '';\r\n            }\r\n\r\n            let componentIdAttr = \"\";\r\n            let componentId = this.getWISELinkComponentId(buttonHTML);\r\n            if (componentId != null) {\r\n                componentIdAttr = \"component-id='\" + componentId + \"'\";\r\n            }\r\n\r\n\r\n            // create the <wiselink> element\r\n            var wiselinkHtml = \"<wiselink type='button' link-text='\" + buttonText + \"' node-id='\" + nodeId + \"' \" + componentIdAttr + \"/>\";\r\n\r\n            // replace the <button> element with the <wiselink> element\r\n            html = html.replace(wiseLinkRegExMatchResult[0], wiselinkHtml);\r\n\r\n            // search for the next <button> element with the parameter wiselink=true\r\n            wiseLinkRegExMatchResult = wiseLinkRegEx.exec(html);\r\n        }\r\n\r\n        return html;\r\n    }\r\n\r\n    /**\r\n     * Get the node id from the wiselink element\r\n     * e.g.\r\n     * <wiselink node-id='node5'/>\r\n     * the node id in this case is 'node5'\r\n     * @param html the html for the element\r\n     * @return the node id from the node id parameter in the element\r\n     */\r\n    getWISELinkNodeId(html) {\r\n\r\n        let nodeId = null;\r\n\r\n        if (html != null) {\r\n            // create the regex to find the node id parameter\r\n            let nodeIdRegEx = new RegExp(/node-id=[\"'b](.*?)[\"']/, 'g');\r\n\r\n            // try to find a match\r\n            let nodeIdRegExResult = nodeIdRegEx.exec(html);\r\n\r\n            if (nodeIdRegExResult != null) {\r\n                // we have found a node id\r\n                nodeId = nodeIdRegExResult[1];\r\n            }\r\n        }\r\n\r\n        return nodeId;\r\n    }\r\n\r\n    /**\r\n     * Get the component id from the wiselink element\r\n     * e.g.\r\n     * <wiselink node-id='node5' component-id='xyzabc' />\r\n     * the component id in this case is 'xyzabc'\r\n     * @param html the html for the element\r\n     * @return the component id from the component id parameter in the element\r\n     */\r\n    getWISELinkComponentId(html) {\r\n\r\n        let componentId = null;\r\n\r\n        if (html != null) {\r\n            // create the regex to find the component id parameter\r\n            let componentIdRegEx = new RegExp(/component-id=[\"'b](.*?)[\"']/, 'g');\r\n\r\n            // try to find a match\r\n            let componentIdRegExResult = componentIdRegEx.exec(html);\r\n\r\n            if (componentIdRegExResult != null) {\r\n                // we have found a node id\r\n                componentId = componentIdRegExResult[1];\r\n            }\r\n        }\r\n\r\n        return componentId;\r\n    }\r\n\r\n    /**\r\n     * Get the link type from the wiselink element\r\n     * e.g.\r\n     * <wiselink type='button'/>\r\n     * the type in this case is 'button'\r\n     * @param html the html for the element\r\n     * @return the link type from the type parameter in the element\r\n     */\r\n    getWISELinkType(html) {\r\n        let type = null;\r\n\r\n        if (html != null) {\r\n            // create the regex to find the type\r\n            let typeRegEx = new RegExp(/type=[\"'b](.*?)[\"']/, 'g');\r\n\r\n            // try to find a match\r\n            let typeRegExResult = typeRegEx.exec(html);\r\n\r\n            if (typeRegExResult != null) {\r\n                // we have found a type\r\n                type = typeRegExResult[1];\r\n            }\r\n        }\r\n\r\n        return type;\r\n    }\r\n\r\n    /**\r\n     * Get the link text from the wiselink element\r\n     * <wiselink link-text='Go to here'/>\r\n     * the link text in this case is 'Go to here'\r\n     * @param html the html for the element\r\n     * @return the link text from the link text parameter in the element\r\n     */\r\n    getWISELinkLinkText(html) {\r\n        let linkText = null;\r\n\r\n        if (html != null) {\r\n            // create the regex to find the link text\r\n            let linkTextRegEx = new RegExp(/link-text=[\"'b](.*?)[\"']/, 'g');\r\n\r\n            // try to find a match\r\n            let linkTextRegExResult = linkTextRegEx.exec(html);\r\n\r\n            if (linkTextRegExResult != null) {\r\n                // we have found a link text\r\n                linkText = linkTextRegExResult[1];\r\n            }\r\n        }\r\n\r\n        return linkText;\r\n    }\r\n\r\n    /**\r\n     * Replace <wiselink> elements with <a> and <button> elements\r\n     * @param html the html\r\n     * @return the modified html without <wiselink> elements\r\n     */\r\n    replaceWISELinks(html) {\r\n\r\n        // replace wiselinks that look like <wiselink/>\r\n        html = this.replaceWISELinksHelper(html, '<wiselink.*?\\/>');\r\n\r\n        // replace wiselinks that look like <wiselink></wiselink>\r\n        html = this.replaceWISELinksHelper(html, '<wiselink.*?>.*?<\\/wiselink>');\r\n\r\n        return html;\r\n    }\r\n\r\n    /**\r\n     * Helper function for replacing <wiselink> elements with <a> and <button>\r\n     * elements\r\n     * @param html the html\r\n     * @param regex the regex string to search for\r\n     * @return the html without <wiselink> elements\r\n     */\r\n    replaceWISELinksHelper(html, regex) {\r\n\r\n        // create the regex\r\n        let wiseLinkRegEx = new RegExp(regex);\r\n\r\n        // find the first match\r\n        let wiseLinkRegExMatchResult = wiseLinkRegEx.exec(html);\r\n\r\n        // loop until we have replaced all the matches\r\n        while (wiseLinkRegExMatchResult != null) {\r\n\r\n            /*\r\n             * get the whole match\r\n             * e.g. <wiselink type='link' node-id='node5' link-text='Go to here'/>\r\n             */\r\n            let wiseLinkHTML = wiseLinkRegExMatchResult[0];\r\n\r\n            // get the node id, component id (if exists), type and link text from the match\r\n            let nodeId = this.getWISELinkNodeId(wiseLinkHTML);\r\n            let componentId = this.getWISELinkComponentId(wiseLinkHTML);\r\n            let componentHTML = '';\r\n            if (componentId != null && componentId != '') {\r\n                componentHTML = \"component-id='\" + componentId + \"'\";\r\n            }\r\n            let type = this.getWISELinkType(wiseLinkHTML);\r\n            let linkText = this.getWISELinkLinkText(wiseLinkHTML);\r\n\r\n            let newElement = null;\r\n\r\n            if (type == 'link') {\r\n                // create a link that represents the wiselink\r\n                newElement = \"<a wiselink='true' node-id='\" + nodeId + \"' \" + componentHTML + \">\" + linkText + \"</a>\";\r\n            } else if (type == 'button') {\r\n                // create a button that represents the wiselink\r\n                newElement = \"<button wiselink='true' node-id='\" + nodeId + \"' \" + componentHTML + \">\" + linkText + \"</button>\";\r\n            } else {\r\n                // default to creating a link that represents the wiselink\r\n                newElement = \"<a wiselink='true' node-id='\" + nodeId + \"' \" + componentHTML + \">\" + linkText + \"</a>\";\r\n            }\r\n\r\n            if (newElement != null) {\r\n                // replace the wiselink with the new element\r\n                html = html.replace(wiseLinkHTML, newElement);\r\n            }\r\n\r\n            // find the next match\r\n            wiseLinkRegExMatchResult = wiseLinkRegEx.exec(html);\r\n        }\r\n\r\n        return html;\r\n    }\r\n\r\n    /**\r\n     * Create a custom summernote button that inserts a WISE asset into\r\n     * summernote\r\n     * @param controller the controller that is creating the button\r\n     * e.g. openResponseController\r\n     * @param nodeId the node id of the component that is creating the button\r\n     * @param componentId the component id of the component that is creating the button\r\n     * @param target the target element in the component to insert the asset into\r\n     * e.g. 'prompt' or 'rubricSummernoteId'\r\n     * @param tooltip the tooltip text for the custom button\r\n     * @return custom summernote button\r\n     */\r\n    createInsertAssetButton(controller, projectId, nodeId, componentId, target, tooltip) {\r\n\r\n        var thisRootScope = this.$rootScope;\r\n\r\n        // a custom button that opens the asset chooser\r\n        var InsertAssetButton = function(context) {\r\n            var ui = $.summernote.ui;\r\n\r\n            // create button\r\n            var button = ui.button({\r\n                contents: '<i class=\"note-icon-picture\"></i>',\r\n                tooltip: tooltip,\r\n                click: function () {\r\n                    // remember the position of the cursor\r\n                    context.invoke('editor.saveRange');\r\n\r\n                    // create the params for opening the asset chooser\r\n                    var params = {};\r\n                    params.popup = true;\r\n\r\n                    if (projectId != null) {\r\n                        params.projectId = projectId;\r\n                    }\r\n\r\n                    if (nodeId != null) {\r\n                        params.nodeId = nodeId;\r\n                    }\r\n\r\n                    if (componentId != null) {\r\n                        params.componentId = componentId;\r\n                    }\r\n\r\n                    params.target = target;\r\n\r\n                    // display the asset chooser\r\n                    thisRootScope.$broadcast('openAssetChooser', params);\r\n                }\r\n            });\r\n\r\n            return button.render();   // return button as jquery object\r\n        };\r\n\r\n        return InsertAssetButton;\r\n    }\r\n\r\n    /**\r\n     * Create a custom summernote button that inserts a WISE link into\r\n     * summernote\r\n     * @param controller the controller that is creating the WISE link\r\n     * e.g. openResponseController\r\n     * @param nodeId the node id of the component that is creating the WISE link\r\n     * @param componentId the component id of the component that is creating the WISE link\r\n     * @param target the target element in the component to insert the WISE link into\r\n     * e.g. 'prompt' or 'rubricSummernoteId'\r\n     * @param tooltip the tooltip text for the custom button\r\n     * @return custom summernote button\r\n     */\r\n    createInsertWISELinkButton(controller, projectId, nodeId, componentId, target, tooltip) {\r\n\r\n        var thisRootScope = this.$rootScope;\r\n\r\n        // a custom button that opens the WISE Link authoring popup\r\n        var InsertWISELinkButton = function(context) {\r\n            var ui = $.summernote.ui;\r\n\r\n            // create button\r\n            var button = ui.button({\r\n                contents: '<i class=\"note-icon-link\"></i>',\r\n                tooltip: tooltip,\r\n                click: function () {\r\n                    // remember the position of the cursor\r\n                    context.invoke('editor.saveRange');\r\n\r\n                    // create the params for opening the WISE Link chooser\r\n                    var params = {};\r\n\r\n                    if (projectId != null) {\r\n                        params.projectId = projectId;\r\n                    }\r\n\r\n                    if (nodeId != null) {\r\n                        params.nodeId = nodeId;\r\n                    }\r\n\r\n                    if (componentId != null) {\r\n                        params.componentId = componentId;\r\n                    }\r\n\r\n                    params.target = target;\r\n\r\n                    // display the WISE Link authoring popup\r\n                    thisRootScope.$broadcast('openWISELinkChooser', params);\r\n                }\r\n            });\r\n\r\n            return button.render();   // return button as jquery object\r\n        }\r\n\r\n        return InsertWISELinkButton;\r\n    }\r\n\r\n    /**\r\n     * Remove html tags from the string. Also remove new lines.\r\n     * @param html an html string\r\n     * @return text without html tags\r\n     */\r\n    removeHTMLTags(html) {\r\n\r\n        var text = '';\r\n\r\n        if (html != null) {\r\n            // remove tags\r\n            text = html.replace(/<\\/?[^>]+(>|$)/g, \" \");\r\n\r\n            // remove new lines\r\n            text = text.replace(/\\n/g, \" \");\r\n\r\n            // remove line returns\r\n            text = text.replace(/\\r/g, \" \");\r\n        }\r\n\r\n        return text;\r\n    }\r\n\r\n    /**\r\n     * Check if a string ends with a specific string\r\n     * @param subjectString the main string\r\n     * @param searchString the potential end of the string\r\n     * @param position (optional) the position to start searching\r\n     * @return whether the subjectString ends with the searchString\r\n     */\r\n    endsWith(subjectString, searchString, position) {\r\n        if (typeof position !== 'number' || !isFinite(position) || Math.floor(position) !== position || position > subjectString.length) {\r\n            position = subjectString.length;\r\n        }\r\n        position -= searchString.length;\r\n        var lastIndex = subjectString.lastIndexOf(searchString, position);\r\n        return lastIndex !== -1 && lastIndex === position;\r\n    }\r\n\r\n    /**\r\n     * Sort the objects by server save time\r\n     * @param object1 an object\r\n     * @param object2 an object\r\n     * @return -1 if object1 server save time comes before object2 server save time\r\n     * 1 if object1 server save time comes after object2 server save time\r\n     * 0 if object1 server save time is equal to object2 server save time\r\n     */\r\n    sortByServerSaveTime(object1, object2) {\r\n\r\n        if (object1.serverSaveTime < object2.serverSaveTime) {\r\n            return -1;\r\n        } else if (object1.serverSaveTime > object2.serverSaveTime) {\r\n            return 1;\r\n        } else {\r\n            return 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Convert milliseconds since the epoch to a pretty printed date time\r\n     * @param milliseconds the milliseconds since the epoch\r\n     * @return a string containing the pretty printed date time\r\n     * example\r\n     * Wed Apr 06 2016 9:05:38 AM\r\n     */\r\n    convertMillisecondsToFormattedDateTime(milliseconds) {\r\n\r\n        var dateTimeString = \"\";\r\n\r\n        // create a Date object with the milliseconds\r\n        var date = new Date(milliseconds);\r\n\r\n        if (date != null) {\r\n            // get the date time string e.g. Wed Apr 06 2016 9:05:38 AM\r\n            dateTimeString = date.toDateString() + \" \" + date.toLocaleTimeString();\r\n        }\r\n\r\n        return dateTimeString;\r\n    }\r\n\r\n    /**\r\n     * Get the label for the given component type\r\n     * @param componentType string\r\n     * @return string label for the component type\r\n     */\r\n    getComponentTypeLabel(componentType) {\r\n        let label = this.$translate(componentType + '.componentTypeLabel');\r\n\r\n        return label ? label : componentType;\r\n    }\r\n}\r\n\r\n// Get the last element of the array\r\nif (!Array.prototype.last) {\r\n    Array.prototype.last = function() {\r\n        return this[this.length - 1];\r\n    };\r\n};\r\n\r\nUtilService.$inject = [\r\n    '$filter',\r\n    '$rootScope'\r\n];\r\n\r\nexport default UtilService;\r\n"]}