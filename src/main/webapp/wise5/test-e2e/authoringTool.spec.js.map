{"version":3,"sources":["authoringTool.spec.es6"],"names":["describe","hasClass","element","cls","getAttribute","then","classes","split","indexOf","waitForUrlToChangeTo","urlRegex","currentUrl","browser","getCurrentUrl","storeCurrentUrl","url","wait","compareCurrentUrl","test","exitAuthoringToolButton","createNewProjectButton","it","ignoreSynchronization","get","expect","getTitle","toEqual","$","sendKeys","click","refresh","RegExp","isPresent","toBeTruthy","createProjectButton","cancelCreateProjectButton","clear","toMatch","all","by","repeater","nodeItem","getText","toBe","isEnabled","getAllWindowHandles","handles","switchTo","window","toContain","driver","close","signOutButton"],"mappings":"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","file":"authoringTool.spec.js","sourcesContent":["// E2E test for Authoring Tool\ndescribe('WISE Authoring Tool', () => {\n\n    function hasClass(element, cls) {\n        return element.getAttribute('class').then((classes) => {\n            return classes.split(' ').indexOf(cls) !== -1;\n        });\n    };\n\n    /**\n     * @name waitForUrlToChangeTo\n     * @description Wait until the URL changes to match a provided regex\n     * @param {RegExp} urlRegex wait until the URL changes to match this regex\n     * @returns {!webdriver.promise.Promise} Promise\n     */\n    function waitForUrlToChangeTo(urlRegex) {\n        var currentUrl;\n\n        return browser.getCurrentUrl().then(function storeCurrentUrl(url) {\n                currentUrl = url;\n            }\n        ).then(function waitForUrlToChangeTo() {\n                return browser.wait(function waitForUrlToChangeTo() {\n                    return browser.getCurrentUrl().then(function compareCurrentUrl(url) {\n                        return urlRegex.test(url);\n                    });\n                });\n            }\n        );\n    };\n\n    var exitAuthoringToolButton;\n    var createNewProjectButton;\n\n    it('should require user to log in to use the authoring tool', () => {\n        browser.ignoreSynchronization = true;  // doesn't use Angular\n        browser.get('http://localhost:8080/wise/login');\n\n        expect(browser.getTitle()).toEqual('Sign In');\n    });\n\n    it('should log in using preview username and password and open the authoring tool', () => {\n        browser.ignoreSynchronization = true;  // doesn't use Angular\n        $('#username').sendKeys('preview');\n        $('#password').sendKeys('wise');\n        $('#signInButton').click();\n\n        browser.ignoreSynchronization = false;  // uses Angular\n        browser.get('http://localhost:8080/wise/author');\n        browser.refresh();  // needed for this issue https://github.com/angular/protractor/issues/2643\n        waitForUrlToChangeTo(new RegExp('http://localhost:8080/wise/author#/', 'gi'));\n\n        // check that the exitAuthoringTool button and create new project buttons are displayed\n        expect(browser.getTitle()).toEqual('WISE Authoring');\n        expect(browser.getCurrentUrl()).toEqual('http://localhost:8080/wise/author#/');\n        exitAuthoringToolButton = $('#exitAuthoringToolButton');\n        expect(exitAuthoringToolButton.isPresent()).toBeTruthy();\n        createNewProjectButton = $('#createNewProjectButton');\n        expect(createNewProjectButton.isPresent()).toBeTruthy();\n    });\n\n    it('should create a new project and open it', () => {\n        createNewProjectButton.click();  // click button to create a new project\n        expect(browser.getCurrentUrl()).toEqual('http://localhost:8080/wise/author#/new');\n        let createProjectButton = $('#createProjectButton');\n        expect(createProjectButton.isPresent()).toBeTruthy();\n        let cancelCreateProjectButton = $('#cancelCreateProjectButton');\n        expect(cancelCreateProjectButton.isPresent()).toBeTruthy();\n        cancelCreateProjectButton.click();  // cancel create. We should go back to main authoring page.\n        expect(browser.getCurrentUrl()).toEqual('http://localhost:8080/wise/author#/');\n\n        createNewProjectButton.click();  // click button to create a new project\n        expect(browser.getCurrentUrl()).toEqual('http://localhost:8080/wise/author#/new');\n        $('#newProjectTitle').clear();  // clear out what's there.\n        $('#newProjectTitle').sendKeys('My Science Project');\n        createProjectButton.click();\n        expect(browser.getCurrentUrl()).toMatch('http://localhost:8080/wise/author#/project/[0-9]+');  // should open the project editing view.\n    });\n\n    it('should have elements on the page in project view', () => {\n        expect($(\"#projectTitle\").getAttribute('value')).toEqual(\"My Science Project\");\n\n        element.all(by.repeater(\"item in projectController.items\")).then((nodeItem) => {\n            expect(nodeItem[1].getText()).toBe(\"1 First Activity\");  // should have one default activity\n        });\n\n        // check that move, delete buttons are disabled and other buttons are enabled.\n        expect($(\"#moveButton\").isEnabled()).toBe(false);\n        expect($(\"#copyButton\").isEnabled()).toBe(false);\n        expect($(\"#deleteButton\").isEnabled()).toBe(false);\n        expect($(\"#saveProjectButton\").isEnabled()).toBe(true);\n        expect($(\"#closeProjectButton\").isEnabled()).toBe(true);\n        expect($(\"#createNewActivityButton\").isEnabled()).toBe(true);\n        expect($(\"#createNewStepButton\").isEnabled()).toBe(true);\n        expect($(\"#previewProjectButton\").isEnabled()).toBe(true);\n        expect($(\"#manageAssetsButton\").isEnabled()).toBe(true);\n        expect($(\"#viewHistoryButton\").isEnabled()).toBe(true);\n    });\n\n    it('should display my assets', () => {\n        $(\"#manageAssetsButton\").click();\n        expect(browser.getCurrentUrl()).toMatch('http://localhost:8080/wise/author#/project/[0-9]+/asset');\n        expect($(\".drop-box\").isPresent()).toBeTruthy();  // the drop box for uploading assets should exist.\n        $(\"#closeAssetsButton\").click();\n        expect(browser.getCurrentUrl()).toMatch('http://localhost:8080/wise/author#/project/[0-9]+');  // should go back to the project editing view.\n    });\n\n    it('should allow user to preview the project', () => {\n        // Clicking on the preview project button should open the preview in a new window\n        $(\"#previewProjectButton\").click();\n        browser.getAllWindowHandles().then((handles) => {\n            browser.switchTo().window(handles[1]).then(() => {\n                browser.refresh();  // needed for this issue https://github.com/angular/protractor/issues/2643\n                expect(browser.getCurrentUrl()).toContain('http://localhost:8080/wise/project/');\n                // close the current window\n                browser.driver.close().then(() => {\n                    // switch to the main authoring window\n                    browser.switchTo().window(handles[0]);\n                });\n            });\n        });\n    });\n\n    // TODO: add test for opening newly-created project\n\n    // TODO: add test for copying a project\n\n    // TODO: add test for copying a step\n\n\n    it('should exit the authoring tool and then sign out', () => {\n        exitAuthoringToolButton.click();\n\n        browser.ignoreSynchronization = true;  // doesn't use Angular\n        expect(browser.getTitle()).toEqual('WISE Teacher Dashboard');\n        var signOutButton = $(\"#signOut\");\n        expect(signOutButton.isPresent()).toBeTruthy();\n        signOutButton.click();\n        expect(browser.getTitle()).toEqual('Web-based Inquiry Science Environment (WISE)');\n        expect(browser.getCurrentUrl()).toEqual('http://localhost:8080/wise/');\n    });\n});"]}