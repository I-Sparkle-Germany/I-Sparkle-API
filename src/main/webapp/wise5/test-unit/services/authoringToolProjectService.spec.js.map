{"version":3,"sources":["authoringToolProjectService.spec.es6"],"names":["describe","beforeEach","mock","module","name","ConfigService","ProjectService","$rootScope","$httpBackend","inject","_ConfigService_","_ProjectService_","_$rootScope_","_$httpBackend_","demoProjectJSON","window","mocks","demoProjectJSONString","JSON","stringify","scootersProjectJSON","scootersProjectJSONString","invalidProjectJSONString","projectIdDefault","projectBaseURL","projectURL","registerNewProjectURL","saveProjectURL","commitMessageDefault","defaultCommitHistory","wiseBaseURL","i18nURL_common_en","i18nURL_vle_en","sampleI18N_common_en","sampleI18N_vle_en","createNormalSpy","spyOn","and","callFake","param","xit","newProjectIdExpected","when","respond","newProjectIdActualPromise","registerNewProject","flush","expectPOST","it","returnValue","expect","getConfigParam","toHaveBeenCalledWith","toBeNull","toEqual","e","message"],"mappings":"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","file":"authoringToolProjectService.spec.js","sourcesContent":["import angular from 'angular';\nimport mainModule from 'authoringTool/main';\nimport 'angular-mocks';\n\ndescribe('AuthoringToolProjectService Unit Test', () => {\n\n  beforeEach(angular.mock.module(mainModule.name));\n\n  let ConfigService, ProjectService, $rootScope, $httpBackend;\n  beforeEach(inject(function(_ConfigService_, _ProjectService_, _$rootScope_, _$httpBackend_) {\n    ConfigService = _ConfigService_;\n    ProjectService = _ProjectService_;\n    $rootScope = _$rootScope_;\n    $httpBackend = _$httpBackend_;\n  }));\n\n  describe('AuthoringToolProjectService', () => {\n    // Load sample projects\n    const demoProjectJSON = window.mocks['test-unit/sampleData/curriculum/DemoProject/project'];\n    const demoProjectJSONString = JSON.stringify(demoProjectJSON);\n    const scootersProjectJSON = window.mocks['test-unit/sampleData/curriculum/SelfPropelledVehiclesChallenge/project'];\n    const scootersProjectJSONString = JSON.stringify(scootersProjectJSON);\n    const invalidProjectJSONString = \"{'a':1\";\n\n    const projectIdDefault = 1;\n    const projectBaseURL = \"http://localhost:8080/curriculum/12345/\";\n    const projectURL = projectBaseURL + \"project.json\";\n    const registerNewProjectURL = \"http://localhost:8080/wise/project/new\";\n    const saveProjectURL = \"http://localhost:8080/wise/project/save/\" + projectIdDefault;\n    const commitMessageDefault = \"Made simple changes\";\n    const defaultCommitHistory = [{\"id\":\"abc\",\"message\":\"first commit\"}, {\"id\":\"def\", \"message\":\"second commit\"}];\n    const wiseBaseURL = \"/wise\";\n\n    // i18n\n    const i18nURL_common_en = \"wise5/i18n/common/i18n_en.json\";\n    const i18nURL_vle_en = \"wise5/i18n/vle/i18n_en.json\";\n    const sampleI18N_common_en = window.mocks['test-unit/sampleData/i18n/common/i18n_en'];\n    const sampleI18N_vle_en = window.mocks['test-unit/sampleData/i18n/vle/i18n_en'];\n\n    function createNormalSpy() {\n      spyOn(ConfigService, \"getConfigParam\").and.callFake((param) => {\n        if (param === \"projectBaseURL\") {\n          return projectBaseURL;\n        } else if (param === \"projectURL\") {\n          return projectURL;\n        } else if (param === \"registerNewProjectURL\") {\n          return registerNewProjectURL;\n        } else if (param === \"saveProjectURL\") {\n          return saveProjectURL;\n        } else if (param === \"wiseBaseURL\") {\n          return wiseBaseURL;\n        }\n      });\n    }\n\n    // MARK: Register Project\n    xit('should register new project', () => {\n      createNormalSpy();\n      const newProjectIdExpected = projectIdDefault; // Id of new project created on the server\n      $httpBackend.when('POST', registerNewProjectURL).respond(newProjectIdExpected);\n      $httpBackend.when('GET', i18nURL_common_en).respond(sampleI18N_common_en);\n      $httpBackend.when('GET', i18nURL_vle_en).respond(sampleI18N_vle_en);\n      const newProjectIdActualPromise = ProjectService.registerNewProject(scootersProjectJSONString, commitMessageDefault);\n      $httpBackend.flush();\n      $httpBackend.expectPOST(registerNewProjectURL);\n    });\n\n    it('should not register new project when Config.registerNewProjectURL is undefined', () => {\n      spyOn(ConfigService, \"getConfigParam\").and.returnValue(null);\n      $httpBackend.when('GET', i18nURL_common_en).respond(sampleI18N_common_en);\n      $httpBackend.when('GET', i18nURL_vle_en).respond(sampleI18N_vle_en);\n      const newProjectIdActualPromise = ProjectService.registerNewProject(scootersProjectJSONString, commitMessageDefault);\n      expect(ConfigService.getConfigParam).toHaveBeenCalledWith(\"registerNewProjectURL\");\n      expect(newProjectIdActualPromise).toBeNull();\n    });\n\n    it('should not register new project when projectJSON is invalid JSON', () => {\n      spyOn(ConfigService, \"getConfigParam\").and.returnValue(registerNewProjectURL);\n      try {\n        const newProjectIdActualPromise = ProjectService.registerNewProject(invalidProjectJSONString, commitMessageDefault);\n        expect(1).toEqual(2);   // This line should not get called because the above line will throw an error\n      } catch (e) {\n        expect(ConfigService.getConfigParam).toHaveBeenCalledWith(\"registerNewProjectURL\");\n        expect(e.message).toEqual(\"Invalid projectJSONString.\")\n      }\n    });\n  });\n});\n"]}