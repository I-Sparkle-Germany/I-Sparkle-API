{"version":3,"sources":["editNotebookItemController.es6"],"names":["EditNotebookItemController","$filter","$mdDialog","$q","$injector","$rootScope","$scope","ConfigService","NotebookService","ProjectService","StudentAssetService","StudentDataService","UtilService","$translate","showUpload","itemId","currentNodeId","getCurrentNodeId","currentNodeTitle","getNodeTitleByNodeId","item","id","localNotebookItemId","generateKey","type","nodeId","title","content","text","attachments","angular","copy","getLatestNotebookItemByLocalNotebookItemId","isNotebookItemPublic","workgroupId","getWorkgroupId","isEditMode","notebookConfig","getNotebookConfig","color","itemTypes","label","singular","noteLabel","saveEnabled","file","files","attachStudentAssetToNote","setShowUpload","isFileUploadEnabled","studentWorkIds","groups","includes","push","i","length","splice","update","ev","stopPropagation","copyNotebookItem","hide","attachment","studentAssetId","iconURL","reader","FileReader","onload","event","target","result","$apply","readAsDataURL","getNodePositionAndTitleByNodeId","getNodePositionById","getThemePath","indexOf","uploadAssetPromises","clientSaveTime","Date","parse","deferred","defer","uploadAsset","then","studentAsset","copyAssetForReference","copiedAsset","newAttachment","resolve","promise","all","saveNotebookItem","isRequireTextOnEveryNote","note","requireTextOnEveryNote","enableStudentUploads","isSpaceExists","isMyNotebookItem","$inject"],"mappings":"AAAA;;;;;;;;;;IAEMA,0B;AACJ,sCAAYC,OAAZ,EACYC,SADZ,EAEYC,EAFZ,EAGYC,SAHZ,EAIYC,UAJZ,EAKYC,MALZ,EAMYC,aANZ,EAOYC,eAPZ,EAQYC,cARZ,EASYC,mBATZ,EAUYC,kBAVZ,EAWYC,WAXZ,EAWyB;AAAA;;AACvB,SAAKX,OAAL,GAAeA,OAAf;AACA,SAAKC,SAAL,GAAiBA,SAAjB;AACA,SAAKC,EAAL,GAAUA,EAAV;AACA,SAAKC,SAAL,GAAiBA,SAAjB;AACA,SAAKC,UAAL,GAAkBA,UAAlB;AACA,SAAKC,MAAL,GAAcA,MAAd;AACA,SAAKC,aAAL,GAAqBA,aAArB;AACA,SAAKC,eAAL,GAAuBA,eAAvB;AACA,SAAKC,cAAL,GAAsBA,cAAtB;AACA,SAAKC,mBAAL,GAA2BA,mBAA3B;AACA,SAAKC,kBAAL,GAA0BA,kBAA1B;AACA,SAAKC,WAAL,GAAmBA,WAAnB;AACA,SAAKC,UAAL,GAAkB,KAAKZ,OAAL,CAAa,WAAb,CAAlB;AACA,SAAKa,UAAL,GAAkB,KAAlB;;AAEA,QAAI,KAAKC,MAAL,IAAe,IAAnB,EAAyB;AACvB,UAAMC,gBAAgB,KAAKL,kBAAL,CAAwBM,gBAAxB,EAAtB;AACA,UAAMC,mBAAmB,KAAKT,cAAL,CAAoBU,oBAApB,CAAyCH,aAAzC,CAAzB;;AAEA,WAAKI,IAAL,GAAY;AACVC,YAAI,IADM,EACA;AACVC,6BAAqB,KAAKV,WAAL,CAAiBW,WAAjB,CAA6B,EAA7B,CAFX,EAE6C;AACvDC,cAAM,MAHI,EAGI;AACdC,gBAAQT,aAJE,EAIa;AACvBU,eAAO,KAAKb,UAAL,CAAgB,UAAhB,EAA4B,EAAEK,kBAAkBA,gBAApB,EAA5B,CALG,EAKmE;AAC7ES,iBAAS;AACPC,gBAAM,EADC;AAEPC,uBAAa;AAFN;AANC,OAAZ;AAWD,KAfD,MAeO;AACL,WAAKT,IAAL,GAAYU,QAAQC,IAAR,CAAa,KAAKvB,eAAL,CAAqBwB,0CAArB,CAAgE,KAAKjB,MAArE,CAAb,CAAZ;AACA,WAAKK,IAAL,CAAUC,EAAV,GAAe,IAAf,CAFK,CAEgB;AACrB,UAAI,KAAKb,eAAL,CAAqByB,oBAArB,CAA0C,KAAKb,IAA/C,KACA,KAAKA,IAAL,CAAUc,WAAV,IAAyB,KAAK3B,aAAL,CAAmB4B,cAAnB,EAD7B,EACkE;AAChE,aAAKC,UAAL,GAAkB,KAAlB;AACD;AACF;;AAED,SAAKC,cAAL,GAAsB,KAAK7B,eAAL,CAAqB8B,iBAArB,EAAtB;AACA,SAAKC,KAAL,GAAa,KAAKF,cAAL,CAAoBG,SAApB,CAA8B,KAAKpB,IAAL,CAAUI,IAAxC,EAA8CiB,KAA9C,CAAoDF,KAAjE;;AAEA,QAAIE,QAAQ,KAAKJ,cAAL,CAAoBG,SAApB,CAA8B,KAAKpB,IAAL,CAAUI,IAAxC,EAA8CiB,KAA9C,CAAoDC,QAAhE;AACA,QAAI,KAAKN,UAAT,EAAqB;AACnB,UAAI,KAAKrB,MAAT,EAAiB;AACf,aAAKW,KAAL,GAAa,KAAKb,UAAL,CAAgB,UAAhB,EAA4B,EAAE8B,WAAWF,KAAb,EAA5B,CAAb;AACD,OAFD,MAEO;AACL,aAAKf,KAAL,GAAa,KAAKb,UAAL,CAAgB,SAAhB,EAA2B,EAAE8B,WAAWF,KAAb,EAA3B,CAAb;AACD;AACF,KAND,MAMO;AACL,WAAKf,KAAL,GAAa,KAAKb,UAAL,CAAgB,UAAhB,EAA4B,EAAE8B,WAAWF,KAAb,EAA5B,CAAb;AACD;AACD,SAAKG,WAAL,GAAmB,KAAnB;;AAEA,QAAI,KAAKC,IAAL,IAAa,IAAjB,EAAuB;AACrB;AACA,UAAMC,QAAQ,CAAC,KAAKD,IAAN,CAAd;AACA,WAAKE,wBAAL,CAA8BD,KAA9B;AACD,KAJD,MAIO;AACL,WAAKE,aAAL;AACD;;AAED,QAAI,KAAKpB,IAAL,IAAa,IAAjB,EAAuB;AACrB,WAAKR,IAAL,CAAUO,OAAV,CAAkBC,IAAlB,GAAyB,KAAKA,IAA9B;AACA,WAAKgB,WAAL,GAAmB,IAAnB;AACD;AACD,QAAI,CAAC,KAAKK,mBAAV,EAA+B;AAC7B,WAAKnC,UAAL,GAAkB,KAAlB;AACD;;AAED,QAAI,KAAKoC,cAAL,IAAuB,IAA3B,EAAiC;AAC/B,WAAK9B,IAAL,CAAUO,OAAV,CAAkBuB,cAAlB,GAAmC,KAAKA,cAAxC;AACD;AACF;;;;wCAEmB;AAClB,aAAO,KAAK9B,IAAL,CAAU+B,MAAV,IAAoB,IAApB,IAA4B,KAAK/B,IAAL,CAAU+B,MAAV,CAAiBC,QAAjB,CAA0B,QAA1B,CAAnC;AACD;;;2CAEsB;AACrB,UAAI,KAAKhC,IAAL,CAAU+B,MAAV,IAAoB,IAAxB,EAA8B;AAC5B,aAAK/B,IAAL,CAAU+B,MAAV,GAAmB,EAAnB;AACD;AACD,UAAI,CAAC,KAAK/B,IAAL,CAAU+B,MAAV,CAAiBC,QAAjB,CAA0B,QAA1B,CAAL,EAA0C;AACxC,aAAKhC,IAAL,CAAU+B,MAAV,CAAiBE,IAAjB,CAAsB,QAAtB;AACD,OAFD,MAEO;AACL,aAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAI,KAAKlC,IAAL,CAAU+B,MAAV,CAAiBI,MAArC,EAA6CD,GAA7C,EAAkD;AAChD,cAAI,KAAKlC,IAAL,CAAU+B,MAAV,CAAiBG,CAAjB,MAAwB,QAA5B,EAAsC;AACpC,iBAAKlC,IAAL,CAAU+B,MAAV,CAAiBK,MAAjB,CAAwBF,CAAxB,EAA2B,CAA3B;AACA;AACD;AACF;AACF;AACD,WAAKG,MAAL;AACD;;;2CAEsBC,E,EAAI;AACzBA,SAAGC,eAAH;AACA,WAAKnD,eAAL,CAAqBoD,gBAArB,CAAsC,KAAK7C,MAA3C;AACA,WAAKb,SAAL,CAAe2D,IAAf;AACD;;;+CAEoC;AAAA;;AAAA,UAAZf,KAAY,uEAAJ,EAAI;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,cAC1BD,IAD0B;;AAEjC,cAAMiB,aAAa;AACjBC,4BAAgB,IADC;AAEjBC,qBAAS,EAFQ;AAGjBnB,kBAAMA;AAHW,WAAnB;;AAMA;;;;AAIA,cAAMoB,SAAS,IAAIC,UAAJ,EAAf;AACAD,iBAAOE,MAAP,GAAgB,UAACC,KAAD,EAAW;AACzBN,uBAAWE,OAAX,GAAqBI,MAAMC,MAAN,CAAaC,MAAlC;AACA,kBAAKlD,IAAL,CAAUO,OAAV,CAAkBE,WAAlB,CAA8BwB,IAA9B,CAAmCS,UAAnC;AACA,kBAAKL,MAAL;AACA,kBAAKnD,MAAL,CAAYiE,MAAZ;AACD,WALD;AAMAN,iBAAOO,aAAP,CAAqB3B,IAArB;AAnBiC;;AACnC,6BAAiBC,KAAjB,8HAAwB;AAAA;AAmBvB;AApBkC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAqBpC;;;oCAEe;AACd,UAAI,KAAK1B,IAAL,IAAa,IAAjB,EAAuB;AACrB,eAAO,IAAP;AACD,OAFD,MAEO;AACL,eAAO,KAAKA,IAAL,CAAUK,MAAjB;AACD;AACF;;;sCAEiB;AAChB,UAAI,KAAKL,IAAL,IAAa,IAAjB,EAAuB;AACrB,eAAO,EAAP;AACD,OAFD,MAEO;AACL,eAAO,KAAKX,cAAL,CAAoBgE,+BAApB,CAAoD,KAAKrD,IAAL,CAAUK,MAA9D,CAAP;AACD;AACF;;;0CAEqB;AACpB,UAAI,KAAKL,IAAL,IAAa,IAAjB,EAAuB;AACrB,eAAO,EAAP;AACD,OAFD,MAEO;AACL,eAAO,KAAKX,cAAL,CAAoBiE,mBAApB,CAAwC,KAAKtD,IAAL,CAAUK,MAAlD,CAAP;AACD;AACF;;;qCAEgB;AACf,aAAO,KAAKhB,cAAL,CAAoBkE,YAApB,KAAqC,iCAA5C;AACD;;;qCAEgBb,U,EAAY;AAC3B,UAAI,KAAK1C,IAAL,CAAUO,OAAV,CAAkBE,WAAlB,CAA8B+C,OAA9B,CAAsCd,UAAtC,KAAqD,CAAC,CAA1D,EAA6D;AAC3D,aAAK1C,IAAL,CAAUO,OAAV,CAAkBE,WAAlB,CAA8B2B,MAA9B,CAAqC,KAAKpC,IAAL,CAAUO,OAAV,CAAkBE,WAAlB,CAA8B+C,OAA9B,CAAsCd,UAAtC,CAArC,EAAwF,CAAxF;AACA,aAAKL,MAAL;AACD;AACF;;;4BAEMC,E,EAAI;AACT;AACD;;;6BAEQ;AACP,WAAKxD,SAAL,CAAe2D,IAAf;AACD;;;4BAEO;AACN,WAAK3D,SAAL,CAAe2D,IAAf;AACD;;;2BAEM;AAAA;;AACL;AACA,UAAIgB,sBAAsB,EAA1B;AACA,WAAKzD,IAAL,CAAUO,OAAV,CAAkBmD,cAAlB,GAAmCC,KAAKC,KAAL,CAAW,IAAID,IAAJ,EAAX,CAAnC,CAHK,CAGuD;AAC5D,UAAI,KAAK3D,IAAL,CAAUO,OAAV,CAAkBE,WAAlB,IAAiC,IAArC,EAA2C;AAAA,qCAChCyB,CADgC;AAEvC,cAAIQ,aAAa,OAAK1C,IAAL,CAAUO,OAAV,CAAkBE,WAAlB,CAA8ByB,CAA9B,CAAjB;AACA,cAAIQ,WAAWC,cAAX,IAA6B,IAA7B,IAAqCD,WAAWjB,IAAX,IAAmB,IAA5D,EAAkE;AAChE;AACA,gBAAIA,OAAOiB,WAAWjB,IAAtB;AACIoC,uBAAW,OAAK9E,EAAL,CAAQ+E,KAAR,EAHiD;;AAIhE,mBAAKxE,mBAAL,CAAyByE,WAAzB,CAAqCtC,IAArC,EAA2CuC,IAA3C,CAAgD,UAACC,YAAD,EAAkB;AAChE,qBAAK3E,mBAAL,CAAyB4E,qBAAzB,CAA+CD,YAA/C,EAA6DD,IAA7D,CAAkE,UAACG,WAAD,EAAiB;AACjF,oBAAIA,eAAe,IAAnB,EAAyB;AACvB,sBAAIC,gBAAgB;AAClBzB,oCAAgBwB,YAAYlE,EADV;AAElB2C,6BAASuB,YAAYvB;AAFH,mBAApB;AAIA,yBAAK5C,IAAL,CAAUO,OAAV,CAAkBE,WAAlB,CAA8ByB,CAA9B,IAAmCkC,aAAnC;AACAP,2BAASQ,OAAT;AACD;AACF,eATD;AAUD,aAXD;AAYAZ,gCAAoBxB,IAApB,CAAyB4B,SAASS,OAAlC;AACD;AApBsC;;AACzC,aAAK,IAAIpC,IAAI,CAAb,EAAgBA,IAAI,KAAKlC,IAAL,CAAUO,OAAV,CAAkBE,WAAlB,CAA8B0B,MAAlD,EAA0DD,GAA1D,EAA+D;AAAA,cAKvD2B,QALuD;;AAAA,iBAAtD3B,CAAsD;AAoB9D;AACF;;AAED;AACA,WAAKnD,EAAL,CAAQwF,GAAR,CAAYd,mBAAZ,EAAiCO,IAAjC,CAAsC,YAAM;AAC1C,eAAK5E,eAAL,CAAqBoF,gBAArB,CACI,OAAKxE,IAAL,CAAUC,EADd,EACkB,OAAKD,IAAL,CAAUK,MAD5B,EACoC,OAAKL,IAAL,CAAUE,mBAD9C,EAEI,OAAKF,IAAL,CAAUI,IAFd,EAEoB,OAAKJ,IAAL,CAAUM,KAF9B,EAEqC,OAAKN,IAAL,CAAUO,OAF/C,EAEwD,OAAKP,IAAL,CAAU+B,MAFlE,EAGI,OAAK/B,IAAL,CAAUO,OAAV,CAAkBmD,cAHtB,EAIKM,IAJL,CAIU,YAAM;AACV,iBAAKlF,SAAL,CAAe2D,IAAf;AACD,SANL;AAOD,OARD;AASD;;;6BAEQ;AACP,WAAKjB,WAAL,GAAmB,KAAKxB,IAAL,CAAUO,OAAV,CAAkBC,IAAlB,IACd,CAAC,KAAKiE,wBAAL,EAAD,IACD,KAAKzE,IAAL,CAAUO,OAAV,CAAkBE,WAAlB,CAA8B0B,MAFlC;AAGA,WAAKP,aAAL;AACD;;;+CAE0B;AACzB,aAAO,KAAKX,cAAL,CAAoBG,SAApB,IAAiC,IAAjC,IACL,KAAKH,cAAL,CAAoBG,SAApB,CAA8BsD,IAA9B,IAAsC,IADjC,IAEL,KAAKzD,cAAL,CAAoBG,SAApB,CAA8BsD,IAA9B,CAAmCC,sBAFrC;AAGD;;;oCAEe;AACd,WAAKjF,UAAL,GAAkB,KAAKuB,cAAL,CAAoBG,SAApB,IAAiC,IAAjC,IAChB,KAAKH,cAAL,CAAoBG,SAApB,CAA8BsD,IAA9B,IAAsC,IADtB,IAEhB,KAAKzD,cAAL,CAAoBG,SAApB,CAA8BsD,IAA9B,CAAmCE,oBAFnB,IAGhB,KAAK5E,IAAL,CAAUO,OAAV,CAAkBE,WAHF,IAIhB,KAAKT,IAAL,CAAUO,OAAV,CAAkBE,WAAlB,CAA8B0B,MAA9B,GAAuC,CAJzC;AAKD;;;wCAEmB;AAClB,aAAO,KAAK9C,cAAL,CAAoBwF,aAApB,CAAkC,QAAlC,CAAP;AACD;;;gDAE2B;AAC1B,aAAO,KAAKxF,cAAL,CAAoBwF,aAApB,CAAkC,QAAlC,KACL,CAAC,KAAKC,gBAAL,EADH;AAED;;;uCAEkB;AACjB,aAAO,KAAK9E,IAAL,CAAUc,WAAV,KAA0B,KAAK3B,aAAL,CAAmB4B,cAAnB,EAAjC;AACD;;;;;;AAGHnC,2BAA2BmG,OAA3B,GAAqC,CACnC,SADmC,EAEnC,WAFmC,EAGnC,IAHmC,EAInC,WAJmC,EAKnC,YALmC,EAMnC,QANmC,EAOnC,eAPmC,EAQnC,iBARmC,EASnC,gBATmC,EAUnC,qBAVmC,EAWnC,oBAXmC,EAYnC,aAZmC,CAArC;;kBAeenG,0B","file":"editNotebookItemController.js","sourcesContent":["'use strict';\n\nclass EditNotebookItemController {\n  constructor($filter,\n              $mdDialog,\n              $q,\n              $injector,\n              $rootScope,\n              $scope,\n              ConfigService,\n              NotebookService,\n              ProjectService,\n              StudentAssetService,\n              StudentDataService,\n              UtilService) {\n    this.$filter = $filter;\n    this.$mdDialog = $mdDialog;\n    this.$q = $q;\n    this.$injector = $injector;\n    this.$rootScope = $rootScope;\n    this.$scope = $scope;\n    this.ConfigService = ConfigService;\n    this.NotebookService = NotebookService;\n    this.ProjectService = ProjectService;\n    this.StudentAssetService = StudentAssetService;\n    this.StudentDataService = StudentDataService;\n    this.UtilService = UtilService;\n    this.$translate = this.$filter('translate');\n    this.showUpload = false;\n\n    if (this.itemId == null) {\n      const currentNodeId = this.StudentDataService.getCurrentNodeId();\n      const currentNodeTitle = this.ProjectService.getNodeTitleByNodeId(currentNodeId);\n\n      this.item = {\n        id: null, // null id means we're creating a new notebook item.\n        localNotebookItemId: this.UtilService.generateKey(10), // Id that is common across the same notebook item revisions.\n        type: \"note\", // the notebook item type, TODO: once questions are enabled, don't hard code\n        nodeId: currentNodeId, // Id of the node this note was created on\n        title: this.$translate('noteFrom', { currentNodeTitle: currentNodeTitle }),  // Title of the node this note was created on\n        content: {\n          text: \"\",\n          attachments: []\n        }\n      };\n    } else {\n      this.item = angular.copy(this.NotebookService.getLatestNotebookItemByLocalNotebookItemId(this.itemId));\n      this.item.id = null; // set to null so we're creating a new notebook item. An edit to a notebook item results in a new entry in the db.\n      if (this.NotebookService.isNotebookItemPublic(this.item) &&\n          this.item.workgroupId != this.ConfigService.getWorkgroupId()) {\n        this.isEditMode = false;\n      }\n    }\n\n    this.notebookConfig = this.NotebookService.getNotebookConfig();\n    this.color = this.notebookConfig.itemTypes[this.item.type].label.color;\n\n    let label = this.notebookConfig.itemTypes[this.item.type].label.singular;\n    if (this.isEditMode) {\n      if (this.itemId) {\n        this.title = this.$translate('editNote', { noteLabel: label });\n      } else {\n        this.title = this.$translate('addNote', { noteLabel: label });\n      }\n    } else {\n      this.title = this.$translate('viewNote', { noteLabel: label });\n    }\n    this.saveEnabled = false;\n\n    if (this.file != null) {\n      // student is trying to add a file to this notebook item.\n      const files = [this.file];\n      this.attachStudentAssetToNote(files);\n    } else {\n      this.setShowUpload();\n    }\n\n    if (this.text != null) {\n      this.item.content.text = this.text;\n      this.saveEnabled = true;\n    }\n    if (!this.isFileUploadEnabled) {\n      this.showUpload = false;\n    }\n\n    if (this.studentWorkIds != null) {\n      this.item.content.studentWorkIds = this.studentWorkIds;\n    }\n  }\n\n  isSharedWithClass() {\n    return this.item.groups != null && this.item.groups.includes(\"public\");\n  }\n\n  toggleMakeNotePublic() {\n    if (this.item.groups == null) {\n      this.item.groups = [];\n    }\n    if (!this.item.groups.includes(\"public\")) {\n      this.item.groups.push(\"public\");\n    } else {\n      for (let i = 0; i < this.item.groups.length; i++) {\n        if (this.item.groups[i] === \"public\") {\n          this.item.groups.splice(i, 1);\n          break;\n        }\n      }\n    }\n    this.update();\n  }\n\n  copyPublicNotebookItem(ev) {\n    ev.stopPropagation();\n    this.NotebookService.copyNotebookItem(this.itemId);\n    this.$mdDialog.hide();\n  }\n\n  attachStudentAssetToNote(files = []) {\n    for (let file of files) {\n      const attachment = {\n        studentAssetId: null,\n        iconURL: \"\",\n        file: file\n      };\n\n      /*\n       * read image data as URL and set it in the attachment iconURL attribute\n       * so students can preview the image\n       */\n      const reader = new FileReader();\n      reader.onload = (event) => {\n        attachment.iconURL = event.target.result;\n        this.item.content.attachments.push(attachment);\n        this.update();\n        this.$scope.$apply();\n      };\n      reader.readAsDataURL(file);\n    }\n  }\n\n  getItemNodeId() {\n    if (this.item == null) {\n      return null;\n    } else {\n      return this.item.nodeId;\n    }\n  }\n\n  getItemNodeLink() {\n    if (this.item == null) {\n      return \"\";\n    } else {\n      return this.ProjectService.getNodePositionAndTitleByNodeId(this.item.nodeId);\n    }\n  }\n\n  getItemNodePosition() {\n    if (this.item == null) {\n      return \"\";\n    } else {\n      return this.ProjectService.getNodePositionById(this.item.nodeId);\n    }\n  }\n\n  getTemplateUrl() {\n    return this.ProjectService.getThemePath() + '/notebook/editNotebookItem.html';\n  }\n\n  removeAttachment(attachment) {\n    if (this.item.content.attachments.indexOf(attachment) != -1) {\n      this.item.content.attachments.splice(this.item.content.attachments.indexOf(attachment), 1);\n      this.update();\n    }\n  }\n\n  delete(ev) {\n    // TODO: add archiving/deleting notebook items\n  }\n\n  cancel() {\n    this.$mdDialog.hide();\n  }\n\n  close() {\n    this.$mdDialog.hide();\n  }\n\n  save() {\n    // go through the notebook item's attachments and look for any attachments that need to be uploaded and made into StudentAsset.\n    let uploadAssetPromises = [];\n    this.item.content.clientSaveTime = Date.parse(new Date());  // set save timestamp\n    if (this.item.content.attachments != null) {\n      for (let i = 0; i < this.item.content.attachments.length; i++) {\n        let attachment = this.item.content.attachments[i];\n        if (attachment.studentAssetId == null && attachment.file != null) {\n          // this attachment hasn't been uploaded yet, so we'll do that now.\n          let file = attachment.file;\n          var deferred = this.$q.defer();\n          this.StudentAssetService.uploadAsset(file).then((studentAsset) => {\n            this.StudentAssetService.copyAssetForReference(studentAsset).then((copiedAsset) => {\n              if (copiedAsset != null) {\n                var newAttachment = {\n                  studentAssetId: copiedAsset.id,\n                  iconURL: copiedAsset.iconURL\n                };\n                this.item.content.attachments[i] = newAttachment;\n                deferred.resolve();\n              }\n            });\n          });\n          uploadAssetPromises.push(deferred.promise);\n        }\n      }\n    }\n\n    // make sure all the assets are created before saving the notebook item.\n    this.$q.all(uploadAssetPromises).then(() => {\n      this.NotebookService.saveNotebookItem(\n          this.item.id, this.item.nodeId, this.item.localNotebookItemId,\n          this.item.type, this.item.title, this.item.content, this.item.groups,\n          this.item.content.clientSaveTime)\n          .then(() => {\n            this.$mdDialog.hide();\n          });\n    });\n  }\n\n  update() {\n    this.saveEnabled = this.item.content.text ||\n        (!this.isRequireTextOnEveryNote() &&\n        this.item.content.attachments.length);\n    this.setShowUpload();\n  }\n\n  isRequireTextOnEveryNote() {\n    return this.notebookConfig.itemTypes != null &&\n      this.notebookConfig.itemTypes.note != null &&\n      this.notebookConfig.itemTypes.note.requireTextOnEveryNote;\n  }\n\n  setShowUpload() {\n    this.showUpload = this.notebookConfig.itemTypes != null &&\n      this.notebookConfig.itemTypes.note != null &&\n      this.notebookConfig.itemTypes.note.enableStudentUploads &&\n      this.item.content.attachments &&\n      this.item.content.attachments.length < 1;\n  }\n\n  canShareWithClass() {\n    return this.ProjectService.isSpaceExists(\"public\");\n  }\n\n  canCopyPublicNotebookItem() {\n    return this.ProjectService.isSpaceExists(\"public\") &&\n      !this.isMyNotebookItem();\n  }\n\n  isMyNotebookItem() {\n    return this.item.workgroupId === this.ConfigService.getWorkgroupId();\n  }\n}\n\nEditNotebookItemController.$inject = [\n  '$filter',\n  \"$mdDialog\",\n  \"$q\",\n  \"$injector\",\n  \"$rootScope\",\n  \"$scope\",\n  \"ConfigService\",\n  \"NotebookService\",\n  \"ProjectService\",\n  \"StudentAssetService\",\n  \"StudentDataService\",\n  \"UtilService\"\n];\n\nexport default EditNotebookItemController;\n"]}