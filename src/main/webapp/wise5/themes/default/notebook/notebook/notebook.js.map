{"version":3,"sources":["notebook.es6"],"names":["NotebookController","$filter","$mdDialog","$scope","$rootScope","ConfigService","NotebookService","ProjectService","StudentAssetService","StudentDataService","$translate","themePath","getThemePath","itemId","item","workgroupId","getWorkgroupId","isStudentNotebook","config","getStudentNotebookConfig","getTeacherNotebookConfig","enabled","reportVisible","itemTypes","report","notesVisible","insertMode","insertContent","requester","$on","event","args","notebook","angular","copy","open","setInsertMode","closeNotes","note","isEditMode","file","noteText","isEditTextEnabled","isFileUploadEnabled","studentWorkIds","ev","showEditNoteDialog","text","showCopyNoteConfirmDialog","logOutListener","$broadcast","getNotebookByWorkgroup","publicNotebookItems","publicNotebookItemspublicNotebookItems","reportId","notes","getMode","isRunOwner","isRunSharedTeacher","studentAsset","alert","notebookItemTemplate","show","parent","element","document","body","targetEvent","templateUrl","controller","EditNotebookItemController","controllerAs","bindToController","locals","$event","notebookItem","selectedNotebookItem","componentController","attachNotebookItemToComponent","stopPropagation","notebookItems","items","notebookItemKey","last","type","push","value","retrievePublicNotebookItems","then","addNote","$inject","Notebook","bindings","filter","mode","template"],"mappings":"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","file":"notebook.js","sourcesContent":["'use strict';\n\nimport EditNotebookItemController from '../editNotebookItemController';\n\nclass NotebookController {\n  constructor($filter,\n              $mdDialog,\n              $scope,\n              $rootScope,\n              ConfigService,\n              NotebookService,\n              ProjectService,\n              StudentAssetService,\n              StudentDataService) {\n    this.$filter = $filter;\n    this.$mdDialog = $mdDialog;\n    this.$scope = $scope;\n    this.$rootScope = $rootScope;\n    this.ConfigService = ConfigService;\n    this.NotebookService = NotebookService;\n    this.ProjectService = ProjectService;\n    this.StudentAssetService = StudentAssetService;\n    this.StudentDataService = StudentDataService;\n    this.$translate = this.$filter('translate');\n    this.themePath = this.ProjectService.getThemePath();\n    this.itemId = null;\n    this.item = null;\n    if (this.workgroupId == null) {\n      this.workgroupId = this.ConfigService.getWorkgroupId();\n    }\n\n    if (this.isStudentNotebook()) {\n      this.config = this.NotebookService.getStudentNotebookConfig();\n    } else {\n      this.config = this.NotebookService.getTeacherNotebookConfig();\n    }\n\n    if (!this.config.enabled) {\n      return;\n    }\n\n    this.reportVisible = this.config.itemTypes.report.enabled;\n    this.notesVisible = false;\n    this.insertMode = false;\n    this.insertContent = null;\n    this.requester = null;\n\n    this.$scope.$on('notebookUpdated', (event, args) => {\n      this.notebook = angular.copy(args.notebook);\n    });\n\n    this.$scope.$on('openNotebook', (event, args) => {\n      this.open('note', event);\n      this.setInsertMode(args.insertMode, args.requester);\n    });\n\n    this.$scope.$on('closeNotebook', (event, args) => {\n      this.closeNotes(event);\n    });\n\n    this.$scope.$on('editNote', (event, args) => {\n      const note = args.note;\n      const isEditMode = true;\n      const file = null;\n      const noteText = null;\n      const isEditTextEnabled = true;\n      const isFileUploadEnabled = true;\n      const studentWorkIds = null;\n      const ev = args.ev;\n      this.showEditNoteDialog(note, isEditMode, file, noteText, isEditTextEnabled, isFileUploadEnabled, studentWorkIds, ev);\n    });\n\n    this.$scope.$on('addNote', (event, args) => {\n      const note = null;\n      const isEditMode = true;\n      const file = args.file;\n      const noteText = args.text;\n      const isEditTextEnabled = args.isEditTextEnabled;\n      const isFileUploadEnabled = args.isFileUploadEnabled;\n      const studentWorkIds = args.studentWorkIds;\n      const ev = args.ev;\n      this.showEditNoteDialog(note, isEditMode, file, noteText, isEditTextEnabled, isFileUploadEnabled, studentWorkIds, ev);\n    });\n\n    this.$scope.$on('copyNote', (event, args) => {\n      const itemId = args.itemId;\n      const ev = args.ev;\n      this.showCopyNoteConfirmDialog(itemId, ev);\n    });\n\n    this.logOutListener = $scope.$on('logOut', (event, args) => {\n      this.logOutListener();\n      this.$rootScope.$broadcast('componentDoneUnloading');\n    });\n\n    this.notebook = this.NotebookService.getNotebookByWorkgroup(this.workgroupId);\n    this.publicNotebookItems = this.NotebookService.publicNotebookItemspublicNotebookItems;\n\n    // assume only 1 report for now\n    this.reportId = this.config.itemTypes.report.notes[0].reportId;\n  }\n\n  isStudentNotebook() {\n    return this.ConfigService.getMode() === 'studentRun' ||\n        this.ConfigService.getMode() === 'preview' ||\n        ((this.ConfigService.isRunOwner() || this.ConfigService.isRunSharedTeacher()) &&\n          this.ConfigService.getWorkgroupId() !== this.workgroupId);\n  }\n\n  deleteStudentAsset(studentAsset) {\n    alert(this.$translate('deleteStudentAssetFromNotebookNotImplementedYet'));\n  }\n\n  showEditNoteDialog(note, isEditMode, file, text, isEditTextEnabled, isFileUploadEnabled, studentWorkIds, ev) {\n    const notebookItemTemplate = this.themePath + '/notebook/editNotebookItem.html';\n    this.$mdDialog.show({\n      parent: angular.element(document.body),\n      targetEvent: ev,\n      templateUrl: notebookItemTemplate,\n      controller: EditNotebookItemController,\n      controllerAs: 'editNotebookItemController',\n      bindToController: true,\n      locals: {\n        note: note,\n        isEditMode: isEditMode,\n        file: file,\n        text: text,\n        studentWorkIds: studentWorkIds,\n        isEditTextEnabled: isEditTextEnabled,\n        isFileUploadEnabled: isFileUploadEnabled\n      }\n    });\n  }\n\n  notebookItemSelected($event, notebookItem) {\n    this.selectedNotebookItem = notebookItem;\n  }\n\n  attachNotebookItemToComponent($event, notebookItem) {\n    this.componentController.attachNotebookItemToComponent(notebookItem);\n    this.selectedNotebookItem = null;  // reset selected notebook item\n    // TODO: add some kind of unobtrusive confirmation to let student know that the notebook item has been added to current component\n    $event.stopPropagation();  // prevents parent notebook list item from getting the onclick event so this item won't be re-selected.\n  }\n\n  getNotes() {\n    const notes = [];\n    const notebookItems = this.notebook.items;\n    for (let notebookItemKey in notebookItems) {\n      const notebookItem = notebookItems[notebookItemKey];\n      if (notebookItem.last().type === 'note') {\n        notes.push(notebookItem);\n      }\n    }\n    return notes;\n  }\n\n  open(value, event) {\n    if (value === 'report') {\n      this.reportVisible = !this.reportVisible;\n    } else if (value === 'note') {\n      if (this.notesVisible) {\n        this.closeNotes(event);\n      } else {\n        this.NotebookService.retrievePublicNotebookItems('public').then(() => {\n          this.notesVisible = true;\n        });\n      }\n    } else if (value === 'new') {\n      this.NotebookService.addNote(event);\n    }\n  }\n\n  closeNotes($event) {\n    this.notesVisible = false;\n    this.insertMode = false;\n  }\n\n  setInsertMode(value, requester) {\n    this.insertMode = value;\n    if (value) {\n      this.NotebookService.retrievePublicNotebookItems('public').then(() => {\n        this.notesVisible = true;\n      });\n    }\n    this.requester = requester;\n  }\n\n  insert(notebookItem, $event) {\n    if (this.requester === 'report') {\n      this.insertContent = angular.copy(notebookItem);\n    } else {\n      this.$rootScope.$broadcast('notebookItemChosen', { requester: this.requester, notebookItem: notebookItem });\n    }\n  }\n}\n\nNotebookController.$inject = [\n  '$filter',\n  '$mdDialog',\n  '$scope',\n  '$rootScope',\n  'ConfigService',\n  'NotebookService',\n  'ProjectService',\n  'StudentAssetService',\n  'StudentDataService'\n];\n\nconst Notebook = {\n  bindings: {\n    filter: '@',\n    mode: '@',\n    workgroupId: '='\n  },\n  template:\n    `<div ng-if=\"$ctrl.config.enabled\" ng-class=\"{'notes-visible': $ctrl.notesVisible}\">\n      <div class=\"notebook-overlay\"></div>\n      <notebook-launcher ng-if=\"$ctrl.itemTypes.note.enabled\"\n                 config=\"$ctrl.config\"\n                 note-count=\"$ctrl.notebook.items.length\"\n                 notes-visible=\"$ctrl.notesVisible\"\n                 on-open=\"$ctrl.open(value, event)\"></notebook-launcher>\n      <notebook-report ng-if=\"$ctrl.config.itemTypes.report.enabled\"\n               mode=\"{{$ctrl.mode}}\"\n               insert-content=\"$ctrl.insertContent\"\n               insert-mode=\"$ctrl.insertMode\"\n               config=\"$ctrl.config\"\n               reportId=\"$ctrl.reportId\"\n               visible=\"$ctrl.reportVisible\"\n               workgroup-id=\"$ctrl.workgroupId\"\n               on-collapse=\"$ctrl.insertMode=false\"\n               on-set-insert-mode=\"$ctrl.setInsertMode(value, requester)\"></notebook-report>               \n    </div>\n    <notebook-notes ng-if=\"$ctrl.config.enabled\"\n            notebook=\"$ctrl.notebook\"\n            notes-visible=\"$ctrl.notesVisible\"\n            config=\"$ctrl.config\"\n            insert-mode=\"$ctrl.insertMode\"\n            workgroup-id=\"$ctrl.workgroupId\"\n            on-close=\"$ctrl.closeNotes()\"\n            on-insert=\"$ctrl.insert(note, event)\"\n            on-set-insert-mode=\"$ctrl.setInsertMode(value, requester)\"></notebook-notes>\n    `,\n  controller: NotebookController\n};\n\nexport default Notebook;\n"]}