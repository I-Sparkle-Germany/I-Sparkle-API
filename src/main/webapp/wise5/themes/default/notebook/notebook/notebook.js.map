{"version":3,"sources":["notebook.es6"],"names":["NotebookController","$filter","$mdDialog","$scope","$rootScope","ConfigService","NotebookService","ProjectService","StudentAssetService","StudentDataService","$translate","themePath","getThemePath","itemId","item","config","enabled","workgroupId","getWorkgroupId","reportVisible","itemTypes","report","notesVisible","insertMode","insertContent","requester","$on","event","args","notebook","angular","copy","open","setInsertMode","closeNotes","ev","studentWorkIds","editNote","file","doDelete","deleteNote","showCopyNoteConfirmDialog","shareNote","showUnshareNoteConfirmDialog","logOutListener","$broadcast","getNotebookByWorkgroup","publicNotebookItems","publicNotebookItemspublicNotebookItems","reportId","notes","studentAsset","alert","isEditMode","notebookItemTemplate","show","parent","element","document","body","targetEvent","templateUrl","controller","controllerAs","bindToController","locals","confirm","title","ariaLabel","ok","cancel","then","noteCopy","getLatestNotebookItemByLocalNotebookItemId","id","content","clientSaveTime","Date","parse","clientDeleteTime","saveNotebookItem","nodeId","localNotebookItemId","type","groups","copyNotebookItem","addNotebookItemToGroup","removeNotebookItemFromGroup","$event","notebookItem","selectedNotebookItem","componentController","attachNotebookItemToComponent","stopPropagation","notebookItems","items","notebookItemKey","last","push","value","retrievePublicNotebookItems","addNewItem","notebookItemId","getNotebookItemByNotebookItemId","getPublicNotebookItemById","$inject","Notebook","bindings","template"],"mappings":"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","file":"notebook.js","sourcesContent":["\"use strict\";\n\nimport EditNotebookItemController from '../editNotebookItemController';\n\nclass NotebookController {\n    constructor($filter,\n                $mdDialog,\n                $scope,\n                $rootScope,\n                ConfigService,\n                NotebookService,\n                ProjectService,\n                StudentAssetService,\n                StudentDataService) {\n        this.$filter = $filter;\n        this.$mdDialog = $mdDialog;\n        this.$scope = $scope;\n        this.$rootScope = $rootScope;\n        this.ConfigService = ConfigService;\n        this.NotebookService = NotebookService;\n        this.ProjectService = ProjectService;\n        this.StudentAssetService = StudentAssetService;\n        this.StudentDataService = StudentDataService;\n\n        this.$translate = this.$filter('translate');\n\n        this.themePath = this.ProjectService.getThemePath();\n        this.itemId = null;\n        this.item = null;\n        this.config = this.NotebookService.config;\n\n        if (!this.config.enabled) {\n            return;\n        }\n\n        this.workgroupId = this.ConfigService.getWorkgroupId();\n        //this.reportVisible = false;\n        this.reportVisible = this.config.itemTypes.report.enabled;\n        this.notesVisible = false;\n        this.insertMode = false;\n        this.insertContent = null;\n        this.requester = null;\n\n        this.$scope.$on('notebookUpdated', (event, args) => {\n            this.notebook = angular.copy(args.notebook);\n        });\n\n        this.$scope.$on('openNotebook', (event, args) => {\n          this.open('note', event);\n          this.setInsertMode(args.insertMode, args.requester);\n        });\n\n        this.$scope.$on('closeNotebook', (event, args) => {\n          this.closeNotes(event);\n        });\n\n        // show edit note dialog on 'editNote' event\n        this.$scope.$on('editNote', (event, args) => {\n            let itemId = args.itemId;\n            let ev = args.ev;\n            const studentWorkIds = null;\n            this.editNote(itemId, true, null, studentWorkIds, ev);\n        });\n\n        // show edit note dialog on 'addNewNote' event\n        this.$scope.$on('addNewNote', (event, args) => {\n            let ev = args.ev;\n            let file = args.file;\n            const studentWorkIds = args.studentWorkIds;\n            this.editNote(null, true, file, studentWorkIds, ev);\n        });\n\n        // show delete note confirm dialog on 'deleteNote' event\n        this.$scope.$on('deleteNote', (event, args) => {\n            let itemId = args.itemId;\n            let ev = args.ev;\n            let doDelete = true;\n            this.deleteNote(itemId, ev, doDelete);\n        });\n\n        // show revive note confirm dialog on 'reviveNote' event\n        this.$scope.$on('reviveNote', (event, args) => {\n            let itemId = args.itemId;\n            let ev = args.ev;\n            let doDelete = false;\n            this.deleteNote(itemId, ev, doDelete);\n        });\n\n        this.$scope.$on('copyNote', (event, args) => {\n          let itemId = args.itemId;\n          let ev = args.ev;\n          this.showCopyNoteConfirmDialog(itemId, ev);\n        });\n\n        // show share note confirm dialog on 'shareNote' event\n        this.$scope.$on('shareNote', (event, args) => {\n          let itemId = args.itemId;\n          let ev = args.ev;\n          this.shareNote(itemId, ev);\n        });\n\n        this.$scope.$on('unshareNote', (event, args) => {\n            let itemId = args.itemId;\n            let ev = args.ev;\n            this.showUnshareNoteConfirmDialog(itemId, ev);\n        });\n\n        this.logOutListener = $scope.$on('logOut', (event, args) => {\n            this.logOutListener();\n            this.$rootScope.$broadcast('componentDoneUnloading');\n        });\n\n        // get the notebook for this workgroup\n        this.notebook = this.NotebookService.getNotebookByWorkgroup(this.workgroupId);\n\n        this.publicNotebookItems = this.NotebookService.publicNotebookItemspublicNotebookItems;\n\n        // assume only 1 report for now\n        this.reportId = this.config.itemTypes.report.notes[0].reportId;\n    }\n\n    deleteStudentAsset(studentAsset) {\n        alert(this.$translate('deleteStudentAssetFromNotebookNotImplementedYet'));\n        /*\n         StudentAssetService.deleteAsset(studentAsset).then(angular.bind(this, function(deletedStudentAsset) {\n         // remove studentAsset\n         this.studentAssets.splice(this.studentAssets.indexOf(deletedStudentAsset), 1);\n         this.calculateTotalUsage();\n         }));\n         */\n    }\n\n    editNote(itemId, isEditMode, file, studentWorkIds, ev) {\n        let notebookItemTemplate = this.themePath + '/notebook/editNotebookItem.html';\n\n        // Display a dialog where students can view/add/edit a notebook item\n        this.$mdDialog.show({\n            parent: angular.element(document.body),\n            targetEvent: ev,\n            templateUrl: notebookItemTemplate,\n            controller: EditNotebookItemController,\n            controllerAs: 'editNotebookItemController',\n            bindToController: true,\n            locals: {\n                itemId: itemId,\n                isEditMode: isEditMode,\n                file: file,\n                 studentWorkIds: studentWorkIds\n            }\n        });\n    }\n\n    /**\n     * Delete the note specified by the itemId.\n     */\n    deleteNote(itemId, ev, doDelete = true) {\n        let confirm = null;\n\n        if (doDelete) {\n            confirm = this.$mdDialog.confirm()\n                .title(this.$translate('deleteNoteConfirmMessage'))\n                .ariaLabel('delete note confirmation')\n                .targetEvent(ev)\n                .ok(this.$translate('delete'))\n                .cancel(this.$translate('cancel'));\n        } else {\n            confirm = this.$mdDialog.confirm()\n                .title(this.$translate('reviveNoteConfirmMessage'))\n                .ariaLabel('revive note confirmation')\n                .targetEvent(ev)\n                .ok(this.$translate('revive'))\n                .cancel(this.$translate('cancel'));\n        }\n\n        this.$mdDialog.show(confirm).then(() => {\n            let noteCopy = angular.copy(this.NotebookService.getLatestNotebookItemByLocalNotebookItemId(itemId));\n            noteCopy.id = null; // set to null so we're creating a new notebook item. An edit to a notebook item results in a new entry in the db.\n            noteCopy.content.clientSaveTime = Date.parse(new Date());  // set save timestamp\n            let clientDeleteTime = null;  // if delete timestamp is null, then we are in effect un-deleting this note item\n            if (doDelete) {\n                clientDeleteTime = Date.parse(new Date());  // set delete timestamp\n            }\n            this.NotebookService.saveNotebookItem(noteCopy.id, noteCopy.nodeId, noteCopy.localNotebookItemId,\n                noteCopy.type, noteCopy.title, noteCopy.content, noteCopy.groups, noteCopy.content.clientSaveTime, clientDeleteTime);\n        }, () => {\n            // they chose not to delete. Do nothing, the dialog will close.\n        });\n    }\n\n    showCopyNoteConfirmDialog(itemId, ev) {\n      let confirm = this.$mdDialog.confirm()\n        .title('copyNoteConfirmMessage')\n        .ariaLabel('copy note confirmation')\n        .ok(this.$translate('copy'))\n        .cancel(this.$translate('cancel'));\n      this.$mdDialog.show(confirm).then(() => {\n        this.NotebookService.copyNotebookItem(itemId);\n      });\n    }\n\n    shareNote(itemId, ev) {\n      let confirm = this.$mdDialog.confirm()\n        .title('shareNoteConfirmMessage')\n        .ariaLabel('share note confirmation')\n        .ok(this.$translate('share'))\n        .cancel(this.$translate('cancel'));\n      this.$mdDialog.show(confirm).then(() => {\n        this.NotebookService.addNotebookItemToGroup(itemId, 'public');\n      });\n    }\n\n    showUnshareNoteConfirmDialog(itemId, ev) {\n        let confirm = this.$mdDialog.confirm()\n            .title('unshareNoteConfirmMessage')\n            .ariaLabel('unshare note confirmation')\n            .ok(this.$translate('unshare'))\n            .cancel(this.$translate('cancel'));\n        this.$mdDialog.show(confirm).then(() => {\n            this.NotebookService.removeNotebookItemFromGroup(itemId, 'public');\n        });\n    }\n\n    notebookItemSelected($event, notebookItem) {\n        this.selectedNotebookItem = notebookItem;\n    }\n\n    attachNotebookItemToComponent($event, notebookItem) {\n        this.componentController.attachNotebookItemToComponent(notebookItem);\n        this.selectedNotebookItem = null;  // reset selected notebook item\n        // TODO: add some kind of unobtrusive confirmation to let student know that the notebook item has been added to current component\n        $event.stopPropagation();  // prevents parent notebook list item from getting the onclick event so this item won't be re-selected.\n    }\n\n    getNotes() {\n        let notes = [];\n        let notebookItems = this.notebook.items;\n        for (let notebookItemKey in notebookItems) {\n            let notebookItem = notebookItems[notebookItemKey];\n            if (notebookItem.last().type === 'note') {\n                notes.push(notebookItem);\n            }\n        }\n        return notes;\n    }\n\n    open(value, event) {\n        if (value === 'report') {\n            // toggle the report view\n            this.reportVisible = !this.reportVisible;\n        } else if (value === 'note') {\n            // toggle the notes view\n            if (this.notesVisible) {\n                this.closeNotes(event);\n            } else {\n                this.NotebookService.retrievePublicNotebookItems(\"public\").then(() => {\n                    this.notesVisible = true;\n                });\n            }\n        } else if (value === 'new') {\n            // open the new note dialog\n            this.NotebookService.addNewItem(event);\n        }\n    }\n\n    closeNotes($event) {\n        this.notesVisible = false;\n        this.insertMode = false;\n    }\n\n    /*closeReport() {\n        this.reportVisible = false;\n    }*/\n\n    setInsertMode(value, requester) {\n        this.insertMode = value;\n        if (value) {\n          this.NotebookService.retrievePublicNotebookItems(\"public\").then(() => {\n            this.notesVisible = true;\n          });\n        }\n        this.requester = requester;\n    }\n\n    insert(notebookItemId, $event) {\n      let notebookItem = this.NotebookService.getNotebookItemByNotebookItemId(notebookItemId, this.workgroupId);\n      if (notebookItem == null) {\n        notebookItem = this.NotebookService.getPublicNotebookItemById(notebookItemId);\n      }\n      if (this.requester == 'report') {\n        this.insertContent = angular.copy(notebookItem);\n      } else {\n        this.$rootScope.$broadcast('notebookItemChosen', { requester: this.requester, notebookItem: notebookItem });\n      }\n    }\n}\n\nNotebookController.$inject = [\n    '$filter',\n    '$mdDialog',\n    '$scope',\n    '$rootScope',\n    'ConfigService',\n    'NotebookService',\n    'ProjectService',\n    'StudentAssetService',\n    'StudentDataService'\n];\n\nconst Notebook = {\n    bindings: {\n    },\n    template:\n        `<div ng-if=\"$ctrl.config.enabled\" ng-class=\"{'notes-visible': $ctrl.notesVisible}\">\n            <div class=\"notebook-overlay\"></div>\n            <notebook-launcher config=\"$ctrl.config\"\n                               note-count=\"$ctrl.notebook.items.length\"\n                               notes-visible=\"$ctrl.notesVisible\"\n                               on-open=\"$ctrl.open(value, event)\"></notebook-launcher>\n            <notebook-report ng-if=\"$ctrl.config.itemTypes.report.enabled\"\n                             insert-content=\"$ctrl.insertContent\"\n                             insert-mode=\"$ctrl.insertMode\"\n                             config=\"$ctrl.config\"\n                             reportId=\"$ctrl.reportId\"\n                             visible=\"$ctrl.reportVisible\"\n                             workgroup-id=\"$ctrl.workgroupId\"\n                             on-collapse=\"$ctrl.insertMode=false\"\n                             on-set-insert-mode=\"$ctrl.setInsertMode(value, requester)\"></notebook-report>\n        </div>\n        <notebook-notes ng-if=\"$ctrl.config.enabled\"\n                        notebook=\"$ctrl.notebook\"\n                        notes-visible=\"$ctrl.notesVisible\"\n                        config=\"$ctrl.config\"\n                        insert-mode=\"$ctrl.insertMode\"\n                        workgroup-id=\"$ctrl.workgroupId\"\n                        on-close=\"$ctrl.closeNotes()\"\n                        on-insert=\"$ctrl.insert(value, event)\"\n                        on-set-insert-mode=\"$ctrl.setInsertMode(value, requester)\"></notebook-notes>`,\n    controller: NotebookController\n};\n\nexport default Notebook;\n"]}