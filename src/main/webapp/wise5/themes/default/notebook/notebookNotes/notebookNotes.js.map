{"version":3,"sources":["notebookNotes.es6"],"names":["NotebookNotesController","$filter","$rootScope","$scope","NotebookService","$translate","groups","selectedTabIndex","publicNotebookItems","groupNameToGroup","personalGroup","title","name","isEditAllowed","items","Object","entries","notebook","personalItemKey","personalItemValue","last","type","push","$onInit","color","config","itemTypes","note","label","$onChanges","changes","angular","copy","currentValue","hasNotes","keys","length","$on","event","args","publicGroupFound","group","publicGroup","notebookItem","updatePrivateNotebookNote","includes","updatePublicNotebookNote","updateNotebookNote","localNotebookItemId","workgroupId","removeNotebookNote","added","i","item","splice","insertMode","link","$ev","$itemId","doDelete","$broadcast","itemId","ev","onInsert","value","editItem","alert","$event","onClose","onSetInsertMode","$inject","NotebookNotes","bindings","notesVisible","template","controller"],"mappings":"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","file":"notebookNotes.js","sourcesContent":["\"use strict\";\n\nclass NotebookNotesController {\n  constructor($filter,\n              $rootScope,\n              $scope,\n              NotebookService) {\n    this.$translate = $filter('translate');\n    this.$rootScope = $rootScope;\n    this.NotebookService = NotebookService;\n    this.groups = [];\n    this.selectedTabIndex = 0;\n    this.$scope = $scope;\n    this.publicNotebookItems = this.NotebookService.publicNotebookItems;\n    this.groupNameToGroup = {};\n\n    const personalGroup = {\n      title: \"Personal\",\n      name: \"private\",\n      isEditAllowed: true,\n      items: []\n    };\n    this.groupNameToGroup['private'] = personalGroup;\n    this.groupNameToGroup['public'] = {\n      title: \"Public\",\n      name: \"public\",\n      items: []\n    };\n\n    for (const [personalItemKey, personalItemValue] of Object.entries(this.notebook.items)) {\n      if (personalItemValue.last().type === 'note') {\n        personalGroup.items.push(personalItemValue.last());\n      }\n    };\n\n    this.groups.push(personalGroup);\n\n    this.$onInit = () => {\n      this.color = this.config.itemTypes.note.label.color;\n    }\n\n    this.$onChanges = (changes) => {\n      if (changes.notebook) {\n        this.notebook = angular.copy(changes.notebook.currentValue);\n        this.hasNotes = Object.keys(this.notebook.items).length ? true : false;\n      }\n    }\n\n    this.$rootScope.$on('publicNotebookItemsRetrieved', (event, args) => {\n      let publicGroupFound = false;\n      for (let group of this.groups) {\n        if (group.name == \"public\") {\n          group.items = this.publicNotebookItems[\"public\"];\n          publicGroupFound = true;\n        }\n      }\n      if (!publicGroupFound) {\n        const publicGroup = {\n          title: \"Public\",\n          name: \"public\",\n          isEditAllowed: false,\n          items: this.publicNotebookItems[\"public\"]\n        };\n        this.groups.push(publicGroup);\n        this.groupNameToGroup['public'] = publicGroup;\n      }\n      this.selectedTabIndex = 0;\n    });\n\n    this.$rootScope.$on('notebookUpdated', (event, args) => {\n      let notebookItem = args.notebookItem;\n      if (notebookItem.groups == null || notebookItem.groups.length == 0) {\n        this.updatePrivateNotebookNote(notebookItem)\n      }\n      if (notebookItem.groups != null && notebookItem.groups.includes('public')) {\n        this.updatePublicNotebookNote(notebookItem);\n      }\n    });\n  }\n\n  updatePrivateNotebookNote(notebookItem) {\n    this.updateNotebookNote(this.groupNameToGroup['private'],\n        notebookItem.localNotebookItemId, notebookItem.workgroupId, notebookItem);\n    this.removeNotebookNote(this.groupNameToGroup['public'],\n        notebookItem.localNotebookItemId, notebookItem.workgroupId);\n  }\n\n  updatePublicNotebookNote(notebookItem) {\n    this.updateNotebookNote(this.groupNameToGroup['public'],\n        notebookItem.localNotebookItemId, notebookItem.workgroupId, notebookItem);\n    this.removeNotebookNote(this.groupNameToGroup['private'],\n        notebookItem.localNotebookItemId, notebookItem.workgroupId);\n  }\n\n  updateNotebookNote(group, localNotebookItemId, workgroupId, notebookItem) {\n    let added = false;\n    let items = group.items;\n    for (let i = 0; i < items.length; i++) {\n      let item = items[i];\n      if (item.localNotebookItemId == localNotebookItemId && item.workgroupId == workgroupId) {\n        items[i] = notebookItem;\n        added = true;\n      }\n    }\n    if (!added) {\n      items.push(notebookItem);\n    }\n  }\n\n  removeNotebookNote(group, localNotebookItemId, workgroupId) {\n    let items = group.items;\n    for (let i = 0; i < items.length; i++) {\n      let item = items[i];\n      if (item.localNotebookItemId == localNotebookItemId && item.workgroupId == workgroupId) {\n        items.splice(i, 1);\n        i--;\n      }\n    }\n  }\n\n  getTitle() {\n    let title = '';\n    if (this.insertMode) {\n      title = this.$translate('selectItemToInsert');\n    } else {\n      title = this.config.itemTypes.note.label.link;\n    }\n    return title;\n  }\n\n  deleteItem($ev, $itemId, doDelete = true) {\n    this.$rootScope.$broadcast('deleteNote', {itemId: $itemId, ev: $ev});\n  }\n\n  reviveItem(ev, itemId) {\n    this.$rootScope.$broadcast('reviveNote', {itemId: $itemId, ev: $ev});\n  }\n\n  editItem($ev, $itemId) {\n    this.$rootScope.$broadcast('editNote', {itemId: $itemId, ev: $ev});\n  }\n\n  select($ev, $itemId) {\n    if (this.insertMode) {\n      this.onInsert({value: $itemId, event: $ev});\n    } else {\n      this.editItem($ev, $itemId);\n    }\n  }\n\n  edit(itemId) {\n    alert(\"Edit the item: \" + itemId);\n  }\n\n  close($event) {\n    this.onClose($event);\n  }\n\n  cancelInsertMode($event) {\n    this.onSetInsertMode({value: false});\n  }\n}\n\nNotebookNotesController.$inject = [\n  '$filter',\n  '$rootScope',\n  '$scope',\n  'NotebookService'\n];\n\nconst NotebookNotes = {\n  bindings: {\n    config: '<',\n    insertMode: '<',\n    notebook: '<',\n    publicNotebookItems: '<',\n    notesVisible: '<',\n    workgroupId: '<',\n    onClose: '&',\n    onInsert: '&',\n    onSetInsertMode: '&'\n  },\n  template:\n    `<md-sidenav md-component-id=\"notes\"\n        md-is-open=\"$ctrl.notesVisible\"\n        md-whiteframe=\"4\"\n        md-disable-backdrop\n        layout=\"column\"\n        class=\"md-sidenav-right notebook-sidebar\">\n      <md-toolbar>\n          <div class=\"md-toolbar-tools\"\n               ng-class=\"{'insert-mode': $ctrl.insertMode}\"\n               style=\"background-color: {{$ctrl.color}};\">\n              {{$ctrl.getTitle()}}\n              <span flex></span>\n              <md-button ng-click=\"$ctrl.close($event)\"\n                  class=\"md-icon-button\"\n                  aria-label=\"{{ 'Close' | translate }}\">\n                <md-icon>close</md-icon>\n              </md-button>\n          </div>\n      </md-toolbar>\n      <md-content>\n      <md-tabs md-selected=\"$ctrl.selectedTabIndex\" md-dynamic-height md-border-bottom md-autoselect md-swipe-content>\n        <md-tab ng-repeat=\"group in $ctrl.groups\"\n            ng-disabled=\"group.disabled\"\n            label=\"{{group.title}}\">\n          <div class=\"demo-tab tab{{$index%4}}\" style=\"padding: 25px; text-align: center;\">\n              <div class=\"notebook-items\" ng-class=\"{'notebook-items--insert': $ctrl.insertMode}\" layout=\"row\" layout-wrap>\n                <div class=\"md-padding\" ng-if=\"!$ctrl.hasNotes\" translate=\"noNotes\" translate-value-term=\"{{$ctrl.config.itemTypes.note.label.plural}}\"></div>\n                <notebook-item ng-repeat=\"note in group.items\"\n                    config=\"$ctrl.config\"\n                    group=\"{{group.name}}\"\n                    item-id=\"note.localNotebookItemId\"\n                    is-edit-allowed=\"group.isEditAllowed\"\n                    is-choose-mode=\"$ctrl.insertMode\"\n                    workgroup-id=\"note.workgroupId\"\n                    on-select=\"$ctrl.select($ev, $itemId)\"\n                    on-delete=\"$ctrl.deleteItem($ev, $itemId)\"\n                    style=\"display: flex;\"\n                    flex=\"100\"\n                    flex-gt-xs=\"50\">\n                </notebook-item>\n            </div>\n          </div>\n        </md-tab>\n      </md-tabs>\n      </md-content>\n    </md-sidenav>`,\n  controller: NotebookNotesController\n};\n\nexport default NotebookNotes;\n"]}