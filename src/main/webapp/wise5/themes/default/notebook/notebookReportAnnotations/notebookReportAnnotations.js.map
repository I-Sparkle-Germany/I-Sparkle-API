{"version":3,"sources":["notebookReportAnnotations.es6"],"names":["NotebookReportAnnotationsController","$scope","$filter","ConfigService","ProjectService","StudentDataService","$translate","maxScoreDisplay","parseInt","maxScore","latestAnnotationTime","isNew","label","icon","showScore","showComment","$onChanges","changes","annotations","angular","copy","currentValue","processAnnotations","latest","comment","score","commentSaveTime","serverSaveTime","scoreSaveTime","getLatestAnnotation","time","convertToClientTimestamp","type","nodeId","componentId","displayAnnotation","setLabelAndIcon","getLatestAnnotationTime","show","$inject","NotebookReportAnnotations","bindings","hasNew","template","controller"],"mappings":"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","file":"notebookReportAnnotations.js","sourcesContent":["'use strict';\n\nclass NotebookReportAnnotationsController {\n    constructor($scope,\n                $filter,\n                ConfigService,\n                ProjectService,\n                StudentDataService) {\n\n        this.$scope = $scope;\n        this.$filter = $filter;\n        this.ConfigService = ConfigService;\n        this.ProjectService = ProjectService;\n        this.StudentDataService = StudentDataService;\n\n        this.$translate = this.$filter('translate');\n\n        this.maxScoreDisplay = (parseInt(this.maxScore) > 0) ? '/' + this.maxScore : '';\n\n        // the latest annotation time\n        this.latestAnnotationTime = null;\n\n        // whether the annotation is new or not\n        this.isNew = false;\n\n        // the annotation label\n        this.label = '';\n\n        // the avatar icon (default to person/teacher)\n        this.icon = 'person';\n\n        this.showScore = true;\n        this.showComment = true;\n\n        this.$onChanges = (changes) => {\n            if (changes.annotations) {\n                this.annotations = angular.copy(changes.annotations.currentValue);\n                this.processAnnotations();\n            }\n        }\n    }\n\n    /**\n     * Get the most recent annotation (from the current score and comment annotations)\n     * @return Object (latest annotation)\n     */\n    getLatestAnnotation() {\n        let latest = null;\n\n        if (this.annotations.comment || this.annotations.score) {\n            let commentSaveTime = this.annotations.comment ? this.annotations.comment.serverSaveTime : 0;\n            let scoreSaveTime = this.annotations.score ? this.annotations.score.serverSaveTime : 0;\n\n            if (commentSaveTime >= scoreSaveTime) {\n                latest = this.annotations.comment;\n            } else if (scoreSaveTime > commentSaveTime) {\n                latest = this.annotations.score;\n            }\n        }\n\n        return latest;\n    };\n\n    /**\n     * Calculate the save time of the latest annotation\n     * @return Number (latest annotation post time)\n     */\n    getLatestAnnotationTime() {\n        let latest = this.getLatestAnnotation();\n        let time = null;\n\n        if (latest) {\n            let serverSaveTime = latest.serverSaveTime;\n            time = this.ConfigService.convertToClientTimestamp(serverSaveTime)\n        }\n\n        return time;\n    };\n\n    /**\n     * Set the label based on whether this is an automated or teacher annotation\n     **/\n    setLabelAndIcon() {\n        let latest = this.getLatestAnnotation();\n\n        if (latest) {\n            if (latest.type === 'autoComment' || latest.type === 'autoScore') {\n                this.label = this.$translate('automatedFeedbackLabel');\n                this.icon = 'keyboard';\n            } else {\n                this.label = this.$translate('teacherFeedbackLabel');\n                this.icon = \"person\";\n            }\n        }\n    };\n\n    processAnnotations() {\n        if (this.annotations.comment || this.annotations.score) {\n            this.nodeId = this.annotations.comment ? this.annotations.comment.nodeId : this.annotations.score.nodeId;\n            this.componentId = this.annotations.comment ? this.annotations.comment.componentId : this.annotations.score.nodeId;\n\n            if (!this.ProjectService.displayAnnotation(this.annotations.score)) {\n                // we do not want to show the score\n                this.showScore = false;\n            }\n\n            if (!this.ProjectService.displayAnnotation(this.annotations.comment)) {\n                // we do not want to show the comment\n                this.showComment = false;\n            }\n\n            // set the annotation label and icon\n            this.setLabelAndIcon();\n\n            this.latestAnnotationTime = this.getLatestAnnotationTime();\n\n            this.show = (this.showScore && this.annotations.score) || (this.showComment && this.annotations.comment);\n        }\n    };\n}\n\nNotebookReportAnnotationsController.$inject = [\n    '$scope',\n    '$filter',\n    'ConfigService',\n    'ProjectService',\n    'StudentDataService'\n];\n\nconst NotebookReportAnnotations = {\n    bindings: {\n        annotations: '<',\n        hasNew: '<',\n        maxScore: '<'\n    },\n    template:\n        `<div class=\"md-padding gray-lightest-bg annotations-container--student--report\" ng-if=\"$ctrl.show\">\n            <md-card class=\"annotations--student annotations--student--report\">\n                <md-card-title class=\"annotations--student__header gray-darker-bg\">\n                    <div class=\"annotations--student__avatar avatar--icon avatar--square md-36 avatar md-whiteframe-1dp\">\n                        <md-icon class=\"annotations--student__icon md-36\">{{$ctrl.icon}}</md-icon>\n                    </div>\n                    <div class=\"annotations--student__title\" layout=\"row\" flex>\n                        <span>{{$ctrl.label}}</span>\n                        <span ng-if=\"$ctrl.hasNew\" class=\"badge annotations--student__status info-bg animate-fade\" translate=\"new\"></span>\n                    </div>\n                </md-card-title>\n                <md-card-content class=\"annotations--student__body md-body-1\">\n                    <div ng-if=\"$ctrl.showComment && $ctrl.annotations.comment.data.value\"><compile data=\"$ctrl.annotations.comment.data.value\"></compile></div>\n                    <hr ng-if=\"$ctrl.annotations.comment\" />\n                    <div layout=\"row\" laoyut-align=\"start center\">\n                        <span ng-if=\"$ctrl.showScore && $ctrl.annotations.score\"\n                              class=\"annotations--student__score\"\n                              translate=\"scoreLabelAndValue\"\n                              translate-value-score=\"{{$ctrl.annotations.score.data.value}}{{$ctrl.maxScoreDisplay}}\"></span>\n                        <span flex></span>\n                        <span>\n                            <span class=\"annotations__info\" am-time-ago=\"$ctrl.latestAnnotationTime\"></span>\n                            <md-tooltip md-direction=\"top\">{{ $ctrl.latestAnnotationTime | amDateFormat:'ddd, MMM D YYYY, h:mm a' }}</md-tooltip>\n                        </span>\n                    </div>\n                </md-card-content>\n            </md-card>\n        </div>`,\n    controller: NotebookReportAnnotationsController\n};\n\nexport default NotebookReportAnnotations;\n"]}