{"version":3,"sources":["notebookReportAnnotations.es6"],"names":["NotebookReportAnnotationsController","$scope","$filter","ConfigService","ProjectService","StudentDataService","$translate","maxScoreDisplay","parseInt","maxScore","latestAnnotationTime","isNew","label","icon","showScore","showComment","$onChanges","changes","annotations","angular","copy","currentValue","processAnnotations","latest","comment","score","commentSaveTime","serverSaveTime","scoreSaveTime","getLatestAnnotation","time","convertToClientTimestamp","type","nodeId","componentId","displayAnnotation","setLabelAndIcon","getLatestAnnotationTime","show","$inject","NotebookReportAnnotations","bindings","hasNew","template","controller"],"mappings":"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","file":"notebookReportAnnotations.js","sourcesContent":["'use strict';\r\n\r\nclass NotebookReportAnnotationsController {\r\n    constructor($scope,\r\n                $filter,\r\n                ConfigService,\r\n                ProjectService,\r\n                StudentDataService) {\r\n\r\n        this.$scope = $scope;\r\n        this.$filter = $filter;\r\n        this.ConfigService = ConfigService;\r\n        this.ProjectService = ProjectService;\r\n        this.StudentDataService = StudentDataService;\r\n\r\n        this.$translate = this.$filter('translate');\r\n\r\n        this.maxScoreDisplay = (parseInt(this.maxScore) > 0) ? '/' + this.maxScore : '';\r\n\r\n        // the latest annotation time\r\n        this.latestAnnotationTime = null;\r\n\r\n        // whether the annotation is new or not\r\n        this.isNew = false;\r\n\r\n        // the annotation label\r\n        this.label = '';\r\n\r\n        // the avatar icon (default to person/teacher)\r\n        this.icon = 'person';\r\n\r\n        this.showScore = true;\r\n        this.showComment = true;\r\n\r\n        this.$onChanges = (changes) => {\r\n            if (changes.annotations) {\r\n                this.annotations = angular.copy(changes.annotations.currentValue);\r\n                this.processAnnotations();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the most recent annotation (from the current score and comment annotations)\r\n     * @return Object (latest annotation)\r\n     */\r\n    getLatestAnnotation() {\r\n        let latest = null;\r\n\r\n        if (this.annotations.comment || this.annotations.score) {\r\n            let commentSaveTime = this.annotations.comment ? this.annotations.comment.serverSaveTime : 0;\r\n            let scoreSaveTime = this.annotations.score ? this.annotations.score.serverSaveTime : 0;\r\n\r\n            if (commentSaveTime >= scoreSaveTime) {\r\n                latest = this.annotations.comment;\r\n            } else if (scoreSaveTime > commentSaveTime) {\r\n                latest = this.annotations.score;\r\n            }\r\n        }\r\n\r\n        return latest;\r\n    };\r\n\r\n    /**\r\n     * Calculate the save time of the latest annotation\r\n     * @return Number (latest annotation post time)\r\n     */\r\n    getLatestAnnotationTime() {\r\n        let latest = this.getLatestAnnotation();\r\n        let time = null;\r\n\r\n        if (latest) {\r\n            let serverSaveTime = latest.serverSaveTime;\r\n            time = this.ConfigService.convertToClientTimestamp(serverSaveTime)\r\n        }\r\n\r\n        return time;\r\n    };\r\n\r\n    /**\r\n     * Set the label based on whether this is an automated or teacher annotation\r\n     **/\r\n    setLabelAndIcon() {\r\n        let latest = this.getLatestAnnotation();\r\n\r\n        if (latest) {\r\n            if (latest.type === 'autoComment' || latest.type === 'autoScore') {\r\n                this.label = this.$translate('automatedFeedbackLabel');\r\n                this.icon = 'keyboard';\r\n            } else {\r\n                this.label = this.$translate('teacherFeedbackLabel');\r\n                this.icon = \"person\";\r\n            }\r\n        }\r\n    };\r\n\r\n    processAnnotations() {\r\n        if (this.annotations.comment || this.annotations.score) {\r\n            this.nodeId = this.annotations.comment ? this.annotations.comment.nodeId : this.annotations.score.nodeId;\r\n            this.componentId = this.annotations.comment ? this.annotations.comment.componentId : this.annotations.score.nodeId;\r\n\r\n            if (!this.ProjectService.displayAnnotation(this.annotations.score)) {\r\n                // we do not want to show the score\r\n                this.showScore = false;\r\n            }\r\n\r\n            if (!this.ProjectService.displayAnnotation(this.annotations.comment)) {\r\n                // we do not want to show the comment\r\n                this.showComment = false;\r\n            }\r\n\r\n            // set the annotation label and icon\r\n            this.setLabelAndIcon();\r\n\r\n            this.latestAnnotationTime = this.getLatestAnnotationTime();\r\n\r\n            this.show = (this.showScore && this.annotations.score) || (this.showComment && this.annotations.comment);\r\n        }\r\n    };\r\n}\r\n\r\nNotebookReportAnnotationsController.$inject = [\r\n    '$scope',\r\n    '$filter',\r\n    'ConfigService',\r\n    'ProjectService',\r\n    'StudentDataService'\r\n];\r\n\r\nconst NotebookReportAnnotations = {\r\n    bindings: {\r\n        annotations: '<',\r\n        hasNew: '<',\r\n        maxScore: '<'\r\n    },\r\n    template:\r\n        `<div class=\"md-padding gray-lightest-bg annotations-container--student--report\" ng-if=\"$ctrl.show\">\r\n            <md-card class=\"annotations annotations--report\">\r\n                <md-card-title class=\"annotations__header\">\r\n                    <div class=\"annotations__avatar avatar--icon avatar--square md-36 avatar md-whiteframe-1dp\">\r\n                        <md-icon class=\"annotations__icon md-36\">{{$ctrl.icon}}</md-icon>\r\n                    </div>\r\n                    <div class=\"annotations__title\" layout=\"row\" flex>\r\n                        <span>{{$ctrl.label}}</span>\r\n                        <span flex></span>\r\n                        <span ng-if=\"$ctrl.hasNew\" class=\"badge annotations__status animate-fade\" translate=\"new\"></span>\r\n                    </div>\r\n                </md-card-title>\r\n                <md-card-content class=\"annotations__body md-body-1\">\r\n                    <div ng-if=\"$ctrl.showComment && $ctrl.annotations.comment.data.value\"><compile data=\"$ctrl.annotations.comment.data.value\"></compile></div>\r\n                    <hr ng-if=\"$ctrl.annotations.comment\" />\r\n                    <div layout=\"row\" laoyut-align=\"start center\">\r\n                        <span ng-if=\"$ctrl.showScore && $ctrl.annotations.score\"\r\n                              class=\"annotations__score\"\r\n                              translate=\"SCORE_LABEL_AND_VALUE\"\r\n                              translate-value-score=\"{{$ctrl.annotations.score.data.value}}{{$ctrl.maxScoreDisplay}}\"></span>\r\n                        <span flex></span>\r\n                        <span>\r\n                            <span class=\"annotations__info\" am-time-ago=\"$ctrl.latestAnnotationTime\"></span>\r\n                            <md-tooltip md-direction=\"top\">{{ $ctrl.latestAnnotationTime | amDateFormat:'ddd, MMM D YYYY, h:mm a' }}</md-tooltip>\r\n                        </span>\r\n                    </div>\r\n                </md-card-content>\r\n            </md-card>\r\n        </div>`,\r\n    controller: NotebookReportAnnotationsController\r\n};\r\n\r\nexport default NotebookReportAnnotations;\r\n"]}