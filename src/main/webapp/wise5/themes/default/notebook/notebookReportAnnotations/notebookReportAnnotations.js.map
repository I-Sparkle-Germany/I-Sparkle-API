{"version":3,"sources":["notebookReportAnnotations.es6"],"names":["NotebookReportAnnotationsController","$scope","$filter","ConfigService","ProjectService","StudentDataService","$translate","maxScoreDisplay","parseInt","maxScore","latestAnnotationTime","isNew","label","icon","showScore","showComment","$onChanges","changes","annotations","angular","copy","currentValue","processAnnotations","latestAnnotation","comment","score","commentSaveTime","serverSaveTime","scoreSaveTime","getLatestAnnotation","convertToClientTimestamp","type","nodeId","componentId","displayAnnotation","setLabelAndIcon","getLatestAnnotationTime","show","$inject","NotebookReportAnnotations","bindings","hasNew","template","controller"],"mappings":"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","file":"notebookReportAnnotations.js","sourcesContent":["'use strict';\n\nclass NotebookReportAnnotationsController {\n  constructor($scope,\n              $filter,\n              ConfigService,\n              ProjectService,\n              StudentDataService) {\n    this.$scope = $scope;\n    this.$filter = $filter;\n    this.ConfigService = ConfigService;\n    this.ProjectService = ProjectService;\n    this.StudentDataService = StudentDataService;\n    this.$translate = this.$filter('translate');\n    this.maxScoreDisplay = (parseInt(this.maxScore) > 0) ? '/' + this.maxScore : '';\n    this.latestAnnotationTime = null;\n    this.isNew = false;\n    this.label = '';\n    this.icon = 'person';\n    this.showScore = true;\n    this.showComment = true;\n\n    this.$onChanges = (changes) => {\n      if (changes.annotations) {\n        this.annotations = angular.copy(changes.annotations.currentValue);\n        this.processAnnotations();\n      }\n    };\n  }\n\n  /**\n   * Get the most recent annotation (from the current score and comment annotations)\n   * @return Object (latest annotation)\n   */\n  getLatestAnnotation() {\n    let latestAnnotation = null;\n    if (this.annotations.comment || this.annotations.score) {\n      const commentSaveTime = this.annotations.comment ? this.annotations.comment.serverSaveTime : 0;\n      const scoreSaveTime = this.annotations.score ? this.annotations.score.serverSaveTime : 0;\n      if (commentSaveTime >= scoreSaveTime) {\n        latestAnnotation = this.annotations.comment;\n      } else if (scoreSaveTime > commentSaveTime) {\n        latestAnnotation = this.annotations.score;\n      }\n    }\n    return latestAnnotation;\n  }\n\n  /**\n   * Calculate the save time of the latest annotation\n   * @return Number (latest annotation post time)\n   */\n  getLatestAnnotationTime() {\n    const latestAnnotation = this.getLatestAnnotation();\n    if (latestAnnotation) {\n      return this.ConfigService.convertToClientTimestamp(latestAnnotation.serverSaveTime);\n    }\n    return null;\n  }\n\n  /**\n   * Set the label based on whether this is an automated or teacher annotation\n   **/\n  setLabelAndIcon() {\n    const latestAnnotation = this.getLatestAnnotation();\n    if (latestAnnotation) {\n      if (latestAnnotation.type === 'autoComment' || latestAnnotation.type === 'autoScore') {\n        this.label = this.$translate('automatedFeedbackLabel');\n        this.icon = 'keyboard';\n      } else {\n        this.label = this.$translate('teacherFeedbackLabel');\n        this.icon = 'person';\n      }\n    }\n  }\n\n  processAnnotations() {\n    if (this.annotations.comment || this.annotations.score) {\n      this.nodeId = this.annotations.comment ?\n          this.annotations.comment.nodeId : this.annotations.score.nodeId;\n      this.componentId = this.annotations.comment ?\n          this.annotations.comment.componentId : this.annotations.score.nodeId;\n\n      if (!this.ProjectService.displayAnnotation(this.annotations.score)) {\n        this.showScore = false;\n      }\n\n      if (!this.ProjectService.displayAnnotation(this.annotations.comment)) {\n        this.showComment = false;\n      }\n\n      this.setLabelAndIcon();\n      this.latestAnnotationTime = this.getLatestAnnotationTime();\n      this.show = (this.showScore && this.annotations.score) || (this.showComment && this.annotations.comment);\n    }\n  }\n}\n\nNotebookReportAnnotationsController.$inject = [\n  '$scope',\n  '$filter',\n  'ConfigService',\n  'ProjectService',\n  'StudentDataService'\n];\n\nconst NotebookReportAnnotations = {\n  bindings: {\n    annotations: '<',\n    hasNew: '<',\n    maxScore: '<'\n  },\n  template:\n    `<div class=\"md-padding gray-lightest-bg annotations-container--student--report\" ng-if=\"$ctrl.show\">\n            <md-card class=\"annotations annotations--report\">\n                <md-card-title class=\"annotations__header\">\n                    <div class=\"annotations__avatar avatar--icon avatar--square md-36 avatar md-whiteframe-1dp\">\n                        <md-icon class=\"annotations__icon md-36\">{{$ctrl.icon}}</md-icon>\n                    </div>\n                    <div class=\"annotations__title\" layout=\"row\" flex>\n                        <span>{{$ctrl.label}}</span>\n                        <span flex></span>\n                        <span ng-if=\"$ctrl.hasNew\" class=\"badge annotations__status animate-fade\" translate=\"new\"></span>\n                    </div>\n                </md-card-title>\n                <md-card-content class=\"annotations__body md-body-1\">\n                    <div ng-if=\"$ctrl.showComment && $ctrl.annotations.comment.data.value\"><compile data=\"$ctrl.annotations.comment.data.value\"></compile></div>\n                    <hr ng-if=\"$ctrl.annotations.comment\" />\n                    <div layout=\"row\" laoyut-align=\"start center\">\n                        <span ng-if=\"$ctrl.showScore && $ctrl.annotations.score\"\n                              class=\"annotations__score\"\n                              translate=\"SCORE_LABEL_AND_VALUE\"\n                              translate-value-score=\"{{$ctrl.annotations.score.data.value}}{{$ctrl.maxScoreDisplay}}\"></span>\n                        <span flex></span>\n                        <span>\n                            <span class=\"annotations__info\" am-time-ago=\"$ctrl.latestAnnotationTime\"></span>\n                            <md-tooltip md-direction=\"top\">{{ $ctrl.latestAnnotationTime | amDateFormat:'ddd, MMM D YYYY, h:mm a' }}</md-tooltip>\n                        </span>\n                    </div>\n                </md-card-content>\n            </md-card>\n        </div>`,\n  controller: NotebookReportAnnotationsController\n};\n\nexport default NotebookReportAnnotations;\n"]}