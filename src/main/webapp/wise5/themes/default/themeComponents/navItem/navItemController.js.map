{"version":3,"sources":["navItemController.es6"],"names":["NavItemController","$filter","$rootScope","$scope","$element","dragulaService","NodeService","PlanningService","ProjectService","StudentDataService","$mdDialog","$translate","autoScroll","require","expanded","item","idToNode","nodeId","isGroup","isGroupNode","nodeStatuses","nodeStatus","nodeTitle","showPosition","nodeIdToNumber","title","currentNode","previousNode","isCurrentNode","id","isPlanning","availablePlanningNodes","node","getNodeById","isPlanningInstance","parentGroupId","planningMode","parentGroup","getParentGroup","isParentGroupPlanning","getAvailablePlanningNodes","$watch","value","newNode","oldNode","isPrev","isApplicationNode","previousStep","$parent","isPrevStep","prevNodeisGroup","prevNodeIsDescendant","isNodeDescendentOfGroup","zoomToElement","itemExpanded","$on","event","args","planningModeClickedNodeId","dragId","dropEvent","el","target","source","nodeChangedId","data","nodeid","planningNodeItemsChanged","options","moves","handle","sibling","getAttribute","drake","find","scroll","document","querySelector","margin","pixels","scrollWhenOutside","down","dragging","getThemePath","setTimeout","top","offsetTop","location","delay","$","animate","scrollTop","endCurrentNodeAndSetCurrentNodeByNodeId","show","alert","textContent","ariaLabel","ok","targetEvent","planningNodeAdded","componentId","componentType","category","eventName","eventData","nodeIdAdded","planningNodeTemplateId","eventNodeId","saveVLEEvent","planningNodeId","maxAddAllowed","planningGroupNode","a","length","availablePlanningNode","max","numPlanningNodesAdded","ids","c","childPlanningNodeId","childPlanningNode","getPlannindNodeMaxAllowed","getNumPlannindNodeInstances","nodeIdToInsertInside","templateNodeId","nextAvailablePlanningNodeId","getNextAvailablePlanningNodeId","planningNodeInstance","createPlanningNodeInstance","addPlanningNodeInstanceInside","updateNodeStatuses","planningNodeChanged","savePlanningNodeAddedEvent","targetNodeId","insertInside","choosePlanningItemTemplateUrl","navitemCtrl","parent","angular","element","body","locals","templateUrl","controller","ChoosePlanningItemController","addSelectedPlanningInstance","addPlanningNodeInstanceAfter","hide","close","$inject","nodeIdToInsertAfter","planningNodeInstanceNodeId","confirm","cancel","then","deleteNode","nodeIdRemoved","description","nodeIdToMove","nodeIdToMoveAfter","movePlanningNodeInstanceInside","movePlanningNodeInstanceAfter","savePlanningNodeChanges","$broadcast","nodeState","createNewNodeState","isAutoSave","isSubmit","studentData","nodes","planningNode","push","nodeStates","saveNodeStates","index","indexOf","nodeIdAddedAfter","movePlanningNode"],"mappings":"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","file":"navItemController.js","sourcesContent":["\"use strict\";\n\nclass NavItemController {\n    constructor($filter,\n                $rootScope,\n                $scope,\n                $element,\n                dragulaService,\n                NodeService,\n                PlanningService,\n                ProjectService,\n                StudentDataService,\n                $mdDialog) {\n\n        this.$filter = $filter;\n        this.$rootScope = $rootScope;\n        this.$scope = $scope;\n        this.$element = $element;\n        this.dragulaService = dragulaService;\n        this.NodeService = NodeService;\n        this.PlanningService = PlanningService;\n        this.ProjectService = ProjectService;\n        this.StudentDataService = StudentDataService;\n        this.$mdDialog = $mdDialog;\n        this.$translate = this.$filter('translate');\n        this.autoScroll = require('dom-autoscroller');\n\n        this.expanded = false;\n\n        this.item = this.ProjectService.idToNode[this.nodeId];\n        this.isGroup = this.ProjectService.isGroupNode(this.nodeId);\n        this.nodeStatuses = this.StudentDataService.nodeStatuses;\n        this.nodeStatus = this.nodeStatuses[this.nodeId];\n\n        this.nodeTitle = this.showPosition ? (this.ProjectService.nodeIdToNumber[this.nodeId] + ': ' + this.item.title) : this.item.title;\n        this.currentNode = this.StudentDataService.currentNode;\n        this.previousNode = null;\n        this.isCurrentNode = (this.currentNode.id === this.nodeId);\n\n        // whether this node is a planning node\n        this.isPlanning = this.PlanningService.isPlanning(this.nodeId);\n\n        // the array of nodes used for drag/drop planning sorting\n        this.availablePlanningNodes = [];\n\n        // whether the node is a planning node instance\n        this.node = this.ProjectService.getNodeById(this.nodeId);\n        this.isPlanningInstance = this.PlanningService.isPlanningInstance(this.nodeId);\n\n        this.parentGroupId = null;\n\n        /*\n         * whether planning mode is on or off which determines if students\n         * can edit planning related aspects of the project such as adding,\n         * moving, or deleting planning steps.\n         */\n        this.planningMode = false;\n\n        var parentGroup = this.ProjectService.getParentGroup(this.nodeId);\n\n        if (parentGroup != null) {\n            this.parentGroupId = parentGroup.id;\n            this.isParentGroupPlanning = this.PlanningService.isPlanning(this.parentGroupId);\n        }\n\n        if (this.isPlanning) {\n            /*\n             * planning is enabled so we will get the available planning\n             * nodes that can be used in this group\n             */\n            this.availablePlanningNodes = this.PlanningService.getAvailablePlanningNodes(this.nodeId);\n        }\n\n        if (this.isParentGroupPlanning) {\n\n            if (parentGroup.planningMode) {\n                // the parent is currently in planning mode\n                this.planningMode = true;\n            }\n\n            /*\n             * planning is enabled so we will get the available planning\n             * nodes that can be used in this group\n             */\n            this.availablePlanningNodes = this.PlanningService.getAvailablePlanningNodes(this.parentGroupId);\n\n            this.$scope.$watch(\n                () => {\n                    // watch the position of this node\n                    return this.ProjectService.nodeIdToNumber[this.nodeId];\n                },\n                (value) => {\n                    // the position has changed for this node so we will update it in the UI\n                    this.nodeTitle = this.showPosition ? (this.ProjectService.nodeIdToNumber[this.nodeId] + ': ' + this.item.title) : this.item.title;\n                }\n            );\n        }\n\n        this.$scope.$watch(\n            () => { return this.StudentDataService.currentNode; },\n            (newNode, oldNode) => {\n                this.currentNode = newNode;\n                this.previousNode = oldNode;\n                this.isCurrentNode = (this.nodeId === newNode.id);\n                let isPrev = false;\n\n                if (this.ProjectService.isApplicationNode(newNode.id)) {\n                    return;\n                }\n\n                if (oldNode) {\n                    isPrev = (this.nodeId === oldNode.id);\n\n                    if (this.StudentDataService.previousStep) {\n                        this.$scope.$parent.isPrevStep = (this.nodeId === this.StudentDataService.previousStep.id);\n                    }\n                }\n\n                if (this.isGroup) {\n                    let prevNodeisGroup = (!oldNode || this.ProjectService.isGroupNode(oldNode.id));\n                    let prevNodeIsDescendant = this.ProjectService.isNodeDescendentOfGroup(oldNode, this.item);\n                    if (this.isCurrentNode) {\n                        this.expanded = true;\n                        if (prevNodeisGroup || !prevNodeIsDescendant) {\n                            this.zoomToElement();\n                        }\n                    } else {\n                        if (!prevNodeisGroup) {\n                            if (prevNodeIsDescendant) {\n                                this.expanded = true;\n                            } else {\n                                this.expanded = false;\n                            }\n                        }\n                    }\n                } else {\n                    if (isPrev && this.ProjectService.isNodeDescendentOfGroup(this.item, newNode)) {\n                        this.zoomToElement();\n                    }\n                }\n            }\n        );\n\n        this.$scope.$watch(\n            () => { return this.expanded; },\n            (value) => {\n                this.$scope.$parent.itemExpanded = value;\n            }\n        );\n\n        this.$scope.$watch(\n            () => { return this.planningMode; },\n            (value) => {\n                this.$scope.$parent.planningMode = value;\n            }\n        );\n\n        // a group node has turned on or off planning mode\n        this.$rootScope.$on('togglePlanningMode', (event, args) => {\n\n            // get the group node that has had its planning node changed\n            let planningModeClickedNodeId = args.nodeId;\n            let planningMode = args.planningMode;\n\n            // get this node's parent group\n            let parentGroup = this.ProjectService.getParentGroup(this.nodeId);\n            let parentGroupId = null;\n\n            if (parentGroup != null) {\n                parentGroupId = parentGroup.id;\n            }\n\n            if (parentGroupId == planningModeClickedNodeId) {\n                // the parent of this node has changed their planning mode\n                this.planningMode = planningMode;\n            }\n        });\n\n        let dragId = 'planning_' + this.nodeId ;\n        // handle item drop events\n        let dropEvent = dragId + '.drop-model';\n        this.$scope.$on(dropEvent, (el, target, source) => {\n            let nodeChangedId = target.data().nodeid;\n            this.planningNodeItemsChanged(nodeChangedId);\n        });\n\n        this.dragulaService.options(this.$scope, dragId, {\n            moves: (el, source, handle, sibling) => {\n                if (!this.planningMode) {\n                    return false;\n                }\n\n                let nodeId = el.getAttribute('data-nodeid');\n                return this.PlanningService.isPlanningInstance(nodeId);\n            }\n        });\n\n        let drake = dragulaService.find(this.$scope, dragId).drake;\n\n        // support scroll while dragging\n        let scroll = this.autoScroll(\n            [document.querySelector('#content')], {\n            margin: 30,\n            pixels: 50,\n            scrollWhenOutside: true,\n            autoScroll: function() {\n                // Only scroll when the pointer is down, and there is a child being dragged\n                return this.down && drake.dragging;\n            }\n        });\n    }\n\n    getTemplateUrl(){\n        return this.ProjectService.getThemePath() + '/themeComponents/navItem/navItem.html';\n    };\n\n    zoomToElement() {\n        setTimeout(()=> {\n            // smooth scroll to expanded group's page location\n            let top = this.$element[0].offsetTop;\n            let location = this.isGroup ? top - 32 : top - 80;\n            let delay = 350;\n            $('#content').animate({\n                scrollTop: location\n            }, delay, 'linear');\n        }, 500);\n    };\n\n    itemClicked(event) {\n        if (this.isGroup) {\n            this.expanded = !this.expanded;\n            if (this.expanded) {\n                if (this.isCurrentNode) {\n                    this.zoomToElement();\n                } else {\n                    this.StudentDataService.endCurrentNodeAndSetCurrentNodeByNodeId(this.nodeId);\n                }\n            }\n        } else {\n            if (this.StudentDataService.planningMode) {\n                // Don't allow students to enter planning steps while in planning mode\n                this.$mdDialog.show(\n                    this.$mdDialog.alert()\n                        .title(this.$translate('itemLocked'))\n                        .textContent(this.$translate('planningModeStepsUnVisitable'))\n                        .ariaLabel(this.$translate('itemLocked'))\n                        .ok(this.$translate('ok'))\n                        .targetEvent(event)\n                );\n            } else {\n                this.StudentDataService.endCurrentNodeAndSetCurrentNodeByNodeId(this.nodeId);\n            }\n        }\n    };\n\n    /**\n     * Save an event when planning node is added\n     * @param planningNodeAdded\n     */\n    savePlanningNodeAddedEvent(planningNodeAdded) {\n        let componentId = null;\n        let componentType = null;\n        let category = \"Planning\";\n        let eventName = \"planningNodeAdded\";\n        let eventData = {\n            nodeIdAdded: planningNodeAdded.id,\n            planningNodeTemplateId: planningNodeAdded.planningNodeTemplateId\n        };\n        let eventNodeId = this.nodeId;\n        this.StudentDataService.saveVLEEvent(eventNodeId, componentId, componentType, category, eventName, eventData);\n    };\n\n    /**\n     * Returns the max times a planning node can be added to the project (-1 is\n     * is returned if there is no limit)\n     * @param planningNodeId\n     */\n    getPlannindNodeMaxAllowed(planningNodeId) {\n        let maxAddAllowed = -1;  // by default, students can add as many instances as they want\n        let planningGroupNode = null;\n        if (this.isParentGroupPlanning) {\n            planningGroupNode = this.ProjectService.getNodeById(this.parentGroupId);\n        } else {\n            planningGroupNode = this.ProjectService.getNodeById(this.nodeId);\n        }\n        // get the maxAddAllowed value by looking up the planningNode in the project.\n        if (planningGroupNode && planningGroupNode.availablePlanningNodes) {\n            for (let a = 0; a < planningGroupNode.availablePlanningNodes.length; a++) {\n                let availablePlanningNode = planningGroupNode.availablePlanningNodes[a];\n                if (availablePlanningNode.nodeId === planningNodeId && availablePlanningNode.max != null) {\n                    maxAddAllowed = availablePlanningNode.max;\n                }\n            }\n        }\n\n        return maxAddAllowed;\n    };\n\n    /**\n     * Returns the number of times a planning node has been added to the project\n     * @param planningNodeId\n     */\n    getNumPlannindNodeInstances(planningNodeId) {\n        let numPlanningNodesAdded = 0;  // keep track of number of instances\n        // otherwise, see how many times the planning node template has been used.\n\n        let planningGroupNode = null;\n        if (this.isParentGroupPlanning) {\n            planningGroupNode = this.ProjectService.getNodeById(this.parentGroupId);\n        } else {\n            planningGroupNode = this.ProjectService.getNodeById(this.nodeId);\n        }\n\n        // loop through the child ids in the planning group and see how many times they've been used\n        if (planningGroupNode && planningGroupNode.ids) {\n            for (let c = 0; c < planningGroupNode.ids.length; c++) {\n                let childPlanningNodeId = planningGroupNode.ids[c];\n                let childPlanningNode = this.ProjectService.getNodeById(childPlanningNodeId);\n                if (childPlanningNode != null && childPlanningNode.planningNodeTemplateId === planningNodeId) {\n                    numPlanningNodesAdded++;\n                }\n            }\n        }\n\n        return numPlanningNodesAdded;\n    };\n\n    /**\n     * Returns true iff this student can add the specified planning node.\n     * Limits include reaching the max allowed count\n     * @param planningNodeId\n     */\n    canAddPlanningNode(planningNodeId) {\n        let maxAddAllowed = this.getPlannindNodeMaxAllowed(planningNodeId);\n\n        // if maxAddAllowed was not found or is set to 0, it means students can add as many as they want\n        if (maxAddAllowed < 1) {\n            return true;\n        }\n\n        let numPlanningNodesAdded = this.getNumPlannindNodeInstances(planningNodeId);\n\n        return numPlanningNodesAdded < maxAddAllowed;\n    };\n\n    /**\n     * Create a planning node instance and add it to the project\n     * @param groupId the group the new planning node instance will be added to\n     * @param templateNodeId the node id of the planning node template\n     * @returns the planning node instance\n     */\n    addPlanningNodeInstanceInside(nodeIdToInsertInside, templateNodeId) {\n        // create the planning node instance\n        let nextAvailablePlanningNodeId = this.StudentDataService.getNextAvailablePlanningNodeId();\n        let planningNodeInstance = this.PlanningService.createPlanningNodeInstance(templateNodeId, nextAvailablePlanningNodeId);\n\n        // add the planning node instance inside\n        this.PlanningService.addPlanningNodeInstanceInside(nodeIdToInsertInside, planningNodeInstance);\n\n        /*\n         * update the node statuses so that a node status is created for\n         * the new planning node instance\n         */\n        this.StudentDataService.updateNodeStatuses();\n\n        // perform any necessary updating\n        this.planningNodeChanged();\n\n        // Save add planning node event\n        this.savePlanningNodeAddedEvent(planningNodeInstance);\n\n        return planningNodeInstance;\n    }\n\n    /**\n     * Open the planning mode select dialog to choose a planning node template\n     * to create a new planning instance\n     * @param event the trigger event\n     * @param targetNodeId the node to insert the new planning instance after or inside\n     * @param insertInside boolean whether to insert the new planning instance\n     * inside the target node (optional; default is after)\n     */\n    addPlanningInstance(event, targetNodeId, insertInside) {\n        // show dialog with list of planning nodes user can add to current group\n\n        let choosePlanningItemTemplateUrl = this.ProjectService.getThemePath() + '/themeComponents/navItem/choosePlanningItem.html';\n        let navitemCtrl = this;\n\n        this.$mdDialog.show({\n            parent: angular.element(document.body),\n            locals: {\n                targetNodeId: targetNodeId,\n                insertInside: insertInside,\n                navitemCtrl: navitemCtrl,\n            },\n            templateUrl: choosePlanningItemTemplateUrl,\n            targetEvent: event,\n            controller: ChoosePlanningItemController\n        });\n\n        function ChoosePlanningItemController($scope, $mdDialog, targetNodeId, insertInside, navitemCtrl) {\n            $scope.navitemCtrl = navitemCtrl;\n            $scope.targetNodeId = targetNodeId;\n            $scope.insertInside = insertInside;\n\n            $scope.addSelectedPlanningInstance = (templateNodeId) => {\n                if ($scope.insertInside) {\n                    $scope.navitemCtrl.addPlanningNodeInstanceInside($scope.targetNodeId, templateNodeId);\n                } else {\n                    $scope.navitemCtrl.addPlanningNodeInstanceAfter($scope.targetNodeId, templateNodeId);\n                }\n\n                $mdDialog.hide();\n            };\n\n            $scope.close = () => {\n                $mdDialog.hide();\n            };\n        }\n        ChoosePlanningItemController.$inject = [\"$scope\", \"$mdDialog\", \"targetNodeId\", \"insertInside\", \"navitemCtrl\"];\n    };\n\n    /**\n     * Create a planning node instance and add it to the project after the specified nodeId\n     * @param groupId the group the new planning node instance will be added to\n     * @param nodeId the node id of the planning node template\n     */\n    addPlanningNodeInstanceAfter(nodeIdToInsertAfter, templateNodeId) {\n\n        var parentGroup = this.ProjectService.getParentGroup(nodeIdToInsertAfter);\n\n        if (parentGroup != null) {\n            var parentGroupId = parentGroup.id;\n\n            // create the planning node instance\n            let nextAvailablePlanningNodeId = this.StudentDataService.getNextAvailablePlanningNodeId();\n            let planningNodeInstance = this.PlanningService.createPlanningNodeInstance(templateNodeId, nextAvailablePlanningNodeId);\n\n            // insert planning node instance after\n            this.PlanningService.addPlanningNodeInstanceAfter(nodeIdToInsertAfter, planningNodeInstance);\n\n            /*\n             * update the node statuses so that a node status is created for\n             * the new planning node instance\n             */\n            this.StudentDataService.updateNodeStatuses();\n\n            // perform any necessary updating\n            this.planningNodeChanged();\n\n            // Save add planning node event\n            this.savePlanningNodeAddedEvent(planningNodeInstance);\n\n            return planningNodeInstance;\n        }\n    }\n\n    /**\n     * Remove the planning node instance\n     * @param planningNodeInstanceNodeId the planning node instance to remove\n     * @param event the event that triggered the function call\n     */\n    removePlanningNodeInstance(planningNodeInstanceNodeId, event) {\n        let confirm = this.$mdDialog.confirm()\n            .parent(angular.element(document.body))\n            .title(this.$translate('areYouSureYouWantToDeleteThisItem'))\n            .textContent(this.$translate('noteAnyWorkYouHaveDoneOnThisItemWillBeLost'))\n            .ariaLabel(this.$translate('deleteItemFromProject'))\n            .targetEvent(event)\n            .ok(this.$translate('yes'))\n            .cancel(this.$translate('no'));\n\n        this.$mdDialog.show(confirm).then(() => {\n            // delete the node from the project\n            this.ProjectService.deleteNode(planningNodeInstanceNodeId);\n\n            // perform any necessary updating\n            this.planningNodeChanged(this.parentGroupId);\n\n            // Save remove planning node event\n            let componentId = null;\n            let componentType = null;\n            let category = \"Planning\";\n            let eventName = \"planningNodeRemoved\";\n            let eventData = {\n                nodeIdRemoved: planningNodeInstanceNodeId\n            };\n            let eventNodeId = this.nodeId;\n            this.StudentDataService.saveVLEEvent(eventNodeId, componentId, componentType, category, eventName, eventData);\n        }, () => {});\n    }\n\n    /**\n     * Get the node title\n     * @param nodeId get the title for this node\n     * @returns the title for the node\n     */\n    getNodeTitle(nodeId) {\n        var node = this.ProjectService.idToNode[nodeId];\n        var title = null;\n\n        if (node != null) {\n            title = node.title;\n        }\n\n        return title;\n    }\n\n    /**\n     * Get the node description\n     * @param nodeId get the description for this node\n     * @returns the description for the node\n     */\n    getNodeDescription(nodeId) {\n        var node = this.ProjectService.idToNode[nodeId];\n        var description = null;\n\n        if (node != null) {\n            description = node.description;\n        }\n\n        return description;\n    }\n\n    /**\n     * Move the planning node. If the other node is a group node, we will\n     * insert this node as the first node in the group. If the other node is\n     * a step node, we will insert this node after the other node.\n     * @param otherNodeId the other node we will move this node inside or after\n     */\n    movePlanningNode(nodeIdToMove, nodeIdToMoveAfter) {\n\n        /*\n         * check that this node is not the same as the other node.\n         * if they are the same we don't need to do anything.\n         */\n        if (nodeIdToMove != nodeIdToMoveAfter) {\n            if (this.ProjectService.isGroupNode(nodeIdToMoveAfter)) {\n                this.PlanningService.movePlanningNodeInstanceInside(nodeIdToMove, nodeIdToMoveAfter);\n            } else {\n                this.PlanningService.movePlanningNodeInstanceAfter(nodeIdToMove, nodeIdToMoveAfter);\n            }\n        }\n\n        // perform any necessary updating\n        this.planningNodeChanged();\n    }\n\n    /**\n     * Something related to planning has changed in the project. This\n     * means a planning node was added, moved, or deleted.\n     * @param param planningNodeId planning node id\n     */\n    planningNodeChanged(planningNodeId) {\n        this.savePlanningNodeChanges(planningNodeId);\n\n        this.$rootScope.$broadcast('planningNodeChanged');\n    }\n\n    /**\n    * Save the changed nodes in NodeState\n    * @param param planningNodeId planning node id\n    **/\n    savePlanningNodeChanges(planningNodeId) {\n        let nodeState = this.NodeService.createNewNodeState();\n        let nodeId = planningNodeId ? planningNodeId : this.nodeId;\n        nodeState.nodeId = nodeId;\n        nodeState.isAutoSave = false;\n        nodeState.isSubmit = false;\n\n        var studentData = {};\n        studentData.nodeId = nodeId;\n        studentData.nodes = [];\n        let planningNode = this.ProjectService.getNodeById(nodeId);\n        studentData.nodes.push(planningNode);  // add the planning node (group)\n        // loop through the child ids in the planning group and save them also\n        if (planningNode.ids != null) {\n            for (let c = 0; c < planningNode.ids.length; c++) {\n                let childPlanningNodeId = planningNode.ids[c];\n                let childPlanningNode = this.ProjectService.getNodeById(childPlanningNodeId);\n                studentData.nodes.push(childPlanningNode);\n            }\n        }\n\n        nodeState.studentData = studentData;\n        var nodeStates = [];\n        nodeStates.push(nodeState);\n        this.StudentDataService.saveNodeStates(nodeStates);\n    }\n\n    /**\n     * Toggle the planning mode on and off. Notify child nodes that\n     * the planning mode has changed so they can act accordingly.\n     */\n    togglePlanningMode() {\n        /*if (this.StudentDataService.planningMode && !this.item.planningMode) {\n            // Don't allow multiple concurrent planning modes.\n            this.$translate('planningModeOnlyOnePlanningModeAllowed').then((planningModeOnlyOnePlanningModeAllowed) => {\n                alert(planningModeOnlyOnePlanningModeAllowed);\n            });\n\n            return;\n        }*/\n\n        // toggle the planning mode\n        //this.planningMode = !this.planningMode;\n        this.item.planningMode = this.planningMode;\n\n        // also toggle StudentDataService planning mode. This will be used to constrain the entire project when in planning mode.\n        this.StudentDataService.planningMode = this.planningMode;\n\n        // Save planning mode on/off event\n        let componentId = null;\n        let componentType = null;\n        let category = \"Planning\";\n        let eventName = this.planningMode ? \"planningModeOn\" : \"planningModeOff\";\n        let eventData = {\n            nodeId: this.nodeId\n        };\n        let eventNodeId = this.nodeId;\n        this.StudentDataService.saveVLEEvent(eventNodeId, componentId, componentType, category, eventName, eventData);\n\n        // notify the child nodes that the planning mode of this group node has changed\n        this.$rootScope.$broadcast('togglePlanningMode', { nodeId: this.nodeId, planningMode: this.planningMode });\n    }\n\n    /**\n     * The planning node's items array has changed\n     * @param newValue the new value of the planning node's items array\n     * @param oldValue the old value of the planning node's items array\n     */\n    planningNodeItemsChanged(nodeChangedId) {\n        let index = this.item.ids.indexOf(nodeChangedId);\n        let nodeIdAddedAfter = this.item.ids[index-1];\n\n        if (nodeIdAddedAfter) {\n            // the node was moved after another node in the group\n            this.movePlanningNode(nodeChangedId, nodeIdAddedAfter);\n        } else {\n            // the node was moved to the beginning of the group\n            this.movePlanningNode(nodeChangedId, this.nodeId);\n        }\n    };\n}\n\nNavItemController.$inject = [\n    '$filter',\n    '$rootScope',\n    '$scope',\n    '$element',\n    'dragulaService',\n    'NodeService',\n    'PlanningService',\n    'ProjectService',\n    'StudentDataService',\n    '$mdDialog'\n];\n\nexport default NavItemController;\n"]}