{"version":3,"sources":["notebookItemController.es6"],"names":[],"mappings":"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","file":"notebookItemController.js","sourcesContent":["'use strict';\n\nclass NotebookItemController {\n\n    constructor($injector,\n                $rootScope,\n                $scope,\n                $translate,\n                ConfigService,\n                NotebookService,\n                ProjectService,\n                StudentAssetService,\n                StudentDataService) {\n        this.$injector = $injector;\n        this.$rootScope = $rootScope;\n        this.$scope = $scope;\n        this.$translate = $translate;\n        this.ConfigService = ConfigService;\n        this.NotebookService = NotebookService;\n        this.ProjectService = ProjectService;\n        this.StudentAssetService = StudentAssetService;\n        this.StudentDataService = StudentDataService;\n        this.mode = this.ConfigService.getMode();\n\n        if (this.itemId == null) {\n            let currentNodeId = this.StudentDataService.getCurrentNodeId();\n            let currentNodeTitle = this.ProjectService.getNodeTitleByNodeId(currentNodeId);\n            this.latestNotebookItemContentRevision = {\n                text: \"\",\n                attachments: []\n            };\n\n            this.item = {\n                id: null,       // null id means we're creating a new notebook item.\n                type: \"note\",\n                nodeId: currentNodeId, // Id of the node this note was created on\n                title: \"Note on \" + currentNodeTitle,  // Title of the node this note was created on\n                content: []\n            };\n        } else {\n            this.item = this.NotebookService.getNotebookItemById(this.itemId);\n            this.latestNotebookItemContentRevision = {\n                text: this.item.content.last().text,\n                attachments: this.item.content.last().attachments\n            };\n        }\n    }\n\n    getItemNodeId() {\n        if (this.item == null) {\n            return null;\n        } else {\n            return this.item.nodeId;\n        }\n    }\n\n    /**\n     * Returns this NotebookItem's position and title.\n     */\n    getItemNodePositionAndTitle() {\n        if (this.item == null) {\n            return \"\";\n        } else {\n            return this.ProjectService.getNodePositionAndTitleByNodeId(this.item.nodeId);\n        }\n    }\n\n    getTemplateUrl() {\n        return this.templateUrl;\n    }\n\n    editNotebookItem() {\n        // the actual closing of the dialog will be performed by the vleController.\n        this.$rootScope.$broadcast('openNoteDialog', {notebookItem: this.item});\n    }\n\n    saveNotebookItem() {\n        // add new notebook item content revision\n        this.latestNotebookItemContentRevision.clientSaveTime = Date.parse(new Date());  // set save timestamp\n        this.item.content.push(this.latestNotebookItemContentRevision)\n        this.NotebookService.saveNotebookItem(this.item.id, this.item.nodeId, this.item.type, this.item.title, this.item.content)\n            .then(() => {\n                this.closeNoteDialog();\n            });\n    }\n\n    closeNoteDialog() {\n        // the actual closing of the dialog will be performed by the vleController.\n        this.$rootScope.$broadcast('closeNoteDialog');\n    }\n\n    attachStudentAssetToNote(files) {\n        if (files != null) {\n            for (var f = 0; f < files.length; f++) {\n                var file = files[f];\n                this.StudentAssetService.uploadAsset(file).then((studentAsset) => {\n                    this.StudentAssetService.copyAssetForReference(studentAsset).then((copiedAsset) => {\n                        if (copiedAsset != null) {\n                            var attachment = {\n                                studentAssetId: copiedAsset.id,\n                                iconURL: copiedAsset.iconURL\n                            };\n\n                            this.latestNotebookItemContentRevision.attachments.push(attachment);\n                        }\n                    });\n                });\n            }\n        }\n    }\n\n    removeAttachment(attachment) {\n        if (this.latestNotebookItemContentRevision.attachments.indexOf(attachment) != -1) {\n            this.latestNotebookItemContentRevision.attachments.splice(this.latestNotebookItemContentRevision.attachments.indexOf(attachment), 1);\n        }\n    }\n}\n\nNotebookItemController.$inject = [\n    \"$injector\",\n    \"$rootScope\",\n    \"$scope\",\n    \"$translate\",\n    \"ConfigService\",\n    \"NotebookService\",\n    \"ProjectService\",\n    \"StudentAssetService\",\n    \"StudentDataService\"\n];\n\nexport default NotebookItemController;"]}