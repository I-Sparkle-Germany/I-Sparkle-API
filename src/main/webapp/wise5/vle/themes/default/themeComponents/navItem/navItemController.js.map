{"version":3,"sources":["navItemController.es6"],"names":[],"mappings":"AAAA;;;;;;;;;;IAEM;AACF,aADE,iBACF,CAAY,UAAZ,EACY,MADZ,EAEY,QAFZ,EAGY,WAHZ,EAIY,cAJZ,EAKY,kBALZ,EAKgC;;;8BAN9B,mBAM8B;;AAE5B,aAAK,UAAL,GAAkB,UAAlB,CAF4B;AAG5B,aAAK,MAAL,GAAc,MAAd,CAH4B;AAI5B,aAAK,QAAL,GAAgB,QAAhB,CAJ4B;AAK5B,aAAK,WAAL,GAAmB,WAAnB,CAL4B;AAM5B,aAAK,cAAL,GAAsB,cAAtB,CAN4B;AAO5B,aAAK,kBAAL,GAA0B,kBAA1B,CAP4B;;AAS5B,aAAK,QAAL,GAAgB,KAAhB,CAT4B;;AAW5B,aAAK,IAAL,GAAY,KAAK,cAAL,CAAoB,QAApB,CAA6B,KAAK,MAAL,CAAzC,CAX4B;AAY5B,aAAK,OAAL,GAAe,KAAK,cAAL,CAAoB,WAApB,CAAgC,KAAK,MAAL,CAA/C,CAZ4B;AAa5B,aAAK,YAAL,GAAoB,KAAK,kBAAL,CAAwB,YAAxB,CAbQ;AAc5B,aAAK,UAAL,GAAkB,KAAK,YAAL,CAAkB,KAAK,MAAL,CAApC,CAd4B;;AAgB5B,aAAK,SAAL,GAAiB,KAAK,YAAL,GAAqB,KAAK,cAAL,CAAoB,YAApB,CAAiC,KAAK,MAAL,CAAjC,GAAgD,IAAhD,GAAuD,KAAK,IAAL,CAAU,KAAV,GAAmB,KAAK,IAAL,CAAU,KAAV,CAhBpF;AAiB5B,aAAK,WAAL,GAAmB,KAAK,kBAAL,CAAwB,WAAxB,CAjBS;AAkB5B,aAAK,aAAL,GAAsB,KAAK,WAAL,CAAiB,EAAjB,KAAwB,KAAK,MAAL,CAlBlB;AAmB5B,aAAK,UAAL,GAAkB,KAAlB;;;AAnB4B,YAsB5B,CAAK,UAAL,GAAkB,KAAK,cAAL,CAAoB,UAApB,CAA+B,KAAK,MAAL,CAAjD,CAtB4B;AAuB5B,aAAK,wBAAL,GAAgC,IAAhC,CAvB4B;AAwB5B,aAAK,aAAL,GAAqB,IAArB;;;;;;;AAxB4B,YA+B5B,CAAK,YAAL,GAAoB,KAApB,CA/B4B;;AAiC5B,YAAI,cAAc,KAAK,cAAL,CAAoB,cAApB,CAAmC,KAAK,MAAL,CAAjD,CAjCwB;;AAmC5B,YAAI,eAAe,IAAf,EAAqB;AACrB,iBAAK,aAAL,GAAqB,YAAY,EAAZ,CADA;AAErB,iBAAK,qBAAL,GAA6B,KAAK,cAAL,CAAoB,UAApB,CAA+B,KAAK,aAAL,CAA5D,CAFqB;SAAzB;;AAKA,YAAI,KAAK,UAAL,EAAiB;;;;;AAKjB,iBAAK,wBAAL,GAAgC,KAAK,cAAL,CAAoB,2BAApB,CAAgD,KAAK,MAAL,CAAhF,CALiB;SAArB;;AAQA,YAAI,KAAK,qBAAL,EAA4B;;AAE5B,gBAAI,YAAY,YAAZ,EAA0B;;AAE1B,qBAAK,YAAL,GAAoB,IAApB,CAF0B;aAA9B;;;;;;AAF4B,gBAW5B,CAAK,wBAAL,GAAgC,KAAK,cAAL,CAAoB,2BAApB,CAAgD,KAAK,aAAL,CAAhF;;;;;;AAX4B,gBAiB5B,CAAK,oBAAL,GAjB4B;;AAmB5B,iBAAK,MAAL,CAAY,MAAZ,CACI,YAAY;;AAER,uBAAO,KAAK,cAAL,CAAoB,YAApB,CAAiC,KAAK,MAAL,CAAxC,CAFQ;aAAZ,CAGE,IAHF,CAGO,IAHP,CADJ,EAKI,UAAS,KAAT,EAAgB;;AAEZ,qBAAK,SAAL,GAAiB,KAAK,YAAL,GAAqB,KAAK,cAAL,CAAoB,YAApB,CAAiC,KAAK,MAAL,CAAjC,GAAgD,IAAhD,GAAuD,KAAK,IAAL,CAAU,KAAV,GAAmB,KAAK,IAAL,CAAU,KAAV;;;;;;AAFpG,oBAQZ,CAAK,oBAAL,GARY;aAAhB,CASE,IATF,CASO,IATP,CALJ,EAnB4B;SAAhC;;AAqCA,aAAK,MAAL,CAAY,MAAZ,CACI,YAAY;AAAE,mBAAO,KAAK,kBAAL,CAAwB,WAAxB,CAAT;SAAZ,CAA4D,IAA5D,CAAiE,IAAjE,CADJ,EAEI,UAAU,OAAV,EAAmB;AACf,iBAAK,WAAL,GAAmB,OAAnB,CADe;AAEf,gBAAI,KAAK,kBAAL,CAAwB,YAAxB,EAAsC;AACtC,qBAAK,MAAL,CAAY,OAAZ,CAAoB,UAApB,GAAkC,KAAK,MAAL,KAAgB,KAAK,kBAAL,CAAwB,YAAxB,CAAqC,EAArC,CADZ;aAA1C;AAGA,iBAAK,aAAL,GAAsB,KAAK,WAAL,CAAiB,EAAjB,KAAwB,KAAK,MAAL,CAL/B;AAMf,gBAAI,KAAK,aAAL,IAAsB,KAAK,cAAL,CAAoB,iBAApB,CAAsC,QAAQ,EAAR,CAA5D,IAA2E,QAAQ,EAAR,KAAe,KAAK,cAAL,CAAoB,QAApB,CAA6B,EAA7B,EAAiC;AAC3H,qBAAK,WAAL,GAD2H;aAA/H;SANJ,CASE,IATF,CASO,IATP,CAFJ,EArF4B;;AAmG5B,aAAK,MAAL,CAAY,MAAZ,CACI,YAAY;AAAE,mBAAO,KAAK,QAAL,CAAT;SAAZ,CAAsC,IAAtC,CAA2C,IAA3C,CADJ,EAEI,UAAU,KAAV,EAAiB;AACb,iBAAK,MAAL,CAAY,OAAZ,CAAoB,YAApB,GAAmC,KAAnC,CADa;AAEb,gBAAI,KAAJ,EAAW;AACP,qBAAK,aAAL,GADO;aAAX;SAFJ,CAKE,IALF,CAKO,IALP,CAFJ,EAnG4B;;AA6G5B,aAAK,UAAL,CAAgB,GAAhB,CAAoB,qBAApB,EAA2C,YAAM;;;;;AAK7C,kBAAK,oBAAL,GAL6C;SAAN,CAA3C;;;AA7G4B,YAsH5B,CAAK,UAAL,CAAgB,GAAhB,CAAoB,2BAApB,EAAiD,UAAC,KAAD,EAAQ,IAAR,EAAiB;;;AAG9D,gBAAI,4BAA4B,KAAK,MAAL,CAH8B;AAI9D,gBAAI,eAAe,KAAK,YAAL;;;AAJ2C,gBAO1D,cAAc,MAAK,cAAL,CAAoB,cAApB,CAAmC,MAAK,MAAL,CAAjD,CAP0D;AAQ9D,gBAAI,gBAAgB,IAAhB,CAR0D;;AAU9D,gBAAI,eAAe,IAAf,EAAqB;AACrB,gCAAgB,YAAY,EAAZ,CADK;aAAzB;;AAIA,gBAAI,iBAAiB,yBAAjB,EAA4C;;AAE5C,sBAAK,YAAL,GAAoB,YAApB,CAF4C;aAAhD;SAd6C,CAAjD,CAtH4B;;AA0I5B,aAAK,WAAL,GA1I4B;KALhC;;iBADE;;+CAmJqB;AACnB,gBAAI,eAAe,KAAK,cAAL,CAAoB,mBAApB,CAAwC,KAAK,aAAL,CAAvD,CADe;;AAGnB,iBAAK,cAAL,GAAsB,EAAtB,CAHmB;AAInB,iBAAK,cAAL,CAAoB,IAApB,CAAyB,KAAK,aAAL,CAAzB,CAJmB;AAKnB,iBAAK,cAAL,GAAsB,KAAK,cAAL,CAAoB,MAApB,CAA2B,YAA3B,CAAtB,CALmB;;;;yCAQP;AACZ,mBAAO,KAAK,cAAL,CAAoB,YAApB,KAAqC,uCAArC,CADK;;;;sCAIF;AACV,iBAAK,MAAL,CAAY,QAAZ,GAAwB,KAAK,aAAL,IAAuB,KAAK,MAAL,CAAY,OAAZ,IAAuB,KAAK,cAAL,CAAoB,uBAApB,CAA4C,KAAK,MAAL,CAAY,WAAZ,EAAyB,KAAK,MAAL,CAAY,IAAZ,CAA5F,CADrC;AAEV,gBAAI,KAAK,MAAL,CAAY,QAAZ,IAAwB,KAAK,aAAL,EAAoB;AAC5C,qBAAK,QAAL,GAAgB,IAAhB,CAD4C;AAE5C,qBAAK,aAAL,GAF4C;aAAhD;;;;wCAMY;;;AACZ,uBAAW,YAAK;;AAEZ,oBAAI,WAAW,OAAK,OAAL,GAAe,OAAK,QAAL,CAAc,CAAd,EAAiB,SAAjB,GAA6B,EAA7B,GAAkC,CAAjD,CAFH;AAGZ,oBAAI,QAAQ,OAAK,OAAL,GAAe,GAAf,GAAqB,CAArB,CAHA;AAIZ,kBAAE,UAAF,EAAc,OAAd,CAAsB;AAClB,+BAAW,QAAX;iBADJ,EAEG,KAFH,EAEU,QAFV,EAEoB,YAAK;AACrB,wBAAI,OAAK,UAAL,EAAiB;AACjB,+BAAK,UAAL,GAAkB,KAAlB,CADiB;AAEjB,+BAAK,kBAAL,CAAwB,uCAAxB,CAAgE,OAAK,MAAL,CAAhE,CAFiB;qBAArB;iBADgB,CAFpB,CAJY;aAAL,EAYR,GAZH,EADY;;;;sCAgBF;AACV,gBAAI,KAAK,OAAL,EAAc;AACd,oBAAI,CAAC,KAAK,QAAL,EAAe;AAChB,yBAAK,UAAL,GAAkB,IAAlB,CADgB;iBAApB;AAGA,qBAAK,QAAL,GAAgB,CAAC,KAAK,QAAL,CAJH;aAAlB,MAKO;AACH,oBAAI,KAAK,YAAL,EAAmB;;;;;AAKnB,0BAAM,yGAAN,EALmB;iBAAvB,MAMO;AACH,yBAAK,kBAAL,CAAwB,uCAAxB,CAAgE,KAAK,MAAL,CAAhE,CADG;iBANP;aANJ;;;;;;;;;;;sDAuB0B,sBAAsB,gBAAgB;;AAEhE,gBAAI,uBAAuB,KAAK,cAAL,CAAoB,0BAApB,CAA+C,oBAA/C,EAAqE,cAArE,CAAvB;;;AAF4D,gBAKhE,CAAK,cAAL,CAAoB,6BAApB,CAAkD,oBAAlD,EAAwE,oBAAxE;;;;;;AALgE,gBAWhE,CAAK,kBAAL,CAAwB,kBAAxB;;;AAXgE,gBAchE,CAAK,mBAAL,GAdgE;;;;;;;;;;;qDAsBvC,qBAAqB,gBAAgB;;AAE9D,gBAAI,cAAc,KAAK,cAAL,CAAoB,cAApB,CAAmC,mBAAnC,CAAd,CAF0D;;AAI9D,gBAAI,eAAe,IAAf,EAAqB;AACrB,oBAAI,gBAAgB,YAAY,EAAZ;;;AADC,oBAIjB,uBAAuB,KAAK,cAAL,CAAoB,0BAApB,CAA+C,aAA/C,EAA8D,cAA9D,CAAvB;;;AAJiB,oBAOrB,CAAK,cAAL,CAAoB,4BAApB,CAAiD,mBAAjD,EAAsE,oBAAtE;;;;;;AAPqB,oBAarB,CAAK,kBAAL,CAAwB,kBAAxB;;;AAbqB,oBAgBrB,CAAK,mBAAL,GAhBqB;aAAzB;;;;;;;;;;mDAwBuB,4BAA4B;;AAEnD,iBAAK,cAAL,CAAoB,UAApB,CAA+B,0BAA/B;;;AAFmD,gBAKnD,CAAK,mBAAL,GALmD;;;;;;;;;;;qCAa1C,QAAQ;AACjB,gBAAI,OAAO,KAAK,cAAL,CAAoB,QAApB,CAA6B,MAA7B,CAAP,CADa;AAEjB,gBAAI,QAAQ,IAAR,CAFa;;AAIjB,gBAAI,QAAQ,IAAR,EAAc;AACd,wBAAQ,KAAK,KAAL,CADM;aAAlB;;;AAJiB,gBASb,WAAW,KAAK,cAAL,CAAoB,YAApB,CAAiC,MAAjC,CAAX,CATa;;AAWjB,gBAAI,YAAY,IAAZ,EAAkB;AAClB,uBAAO,KAAP,CADkB;aAAtB,MAEO;AACH,uBAAO,WAAW,IAAX,GAAkB,KAAlB,CADJ;aAFP;;;;;;;;;;;2CAYe,QAAQ;AACvB,gBAAI,OAAO,KAAK,cAAL,CAAoB,QAApB,CAA6B,MAA7B,CAAP,CADmB;AAEvB,gBAAI,cAAc,IAAd,CAFmB;;AAIvB,gBAAI,QAAQ,IAAR,EAAc;AACd,8BAAc,KAAK,WAAL,CADA;aAAlB;;AAIA,mBAAO,WAAP,CARuB;;;;;;;;;;;;yCAiBV,aAAa;;;;;;AAM1B,gBAAI,KAAK,MAAL,IAAe,WAAf,EAA4B;AAC5B,oBAAI,KAAK,cAAL,CAAoB,WAApB,CAAgC,WAAhC,CAAJ,EAAkD;;AAE9C,yBAAK,cAAL,CAAoB,8BAApB,CAAmD,KAAK,MAAL,EAAa,WAAhE,EAF8C;iBAAlD,MAGO;;AAEH,yBAAK,cAAL,CAAoB,6BAApB,CAAkD,KAAK,MAAL,EAAa,WAA/D,EAFG;iBAHP;aADJ;;;AAN0B,gBAiB1B,CAAK,mBAAL,GAjB0B;;;;;;;;;;8CAwBR;AAClB,iBAAK,UAAL,CAAgB,UAAhB,CAA2B,qBAA3B,EADkB;;;;;;;;;;6CAQD;;AAEjB,iBAAK,YAAL,GAAoB,CAAC,KAAK,YAAL,CAFJ;AAGjB,iBAAK,IAAL,CAAU,YAAV,GAAyB,KAAK,YAAL,CAHR;;AAKjB,gBAAI,CAAC,KAAK,YAAL,EAAmB;;AAEpB,oBAAI,YAAY,KAAK,WAAL,CAAiB,kBAAjB,EAAZ,CAFgB;AAGpB,0BAAU,MAAV,GAAmB,KAAK,MAAL,CAHC;AAIpB,0BAAU,UAAV,GAAuB,KAAvB,CAJoB;AAKpB,0BAAU,QAAV,GAAqB,KAArB,CALoB;;AAOpB,oBAAI,cAAc,EAAd,CAPgB;AAQpB,4BAAY,MAAZ,GAAqB,KAAK,MAAL,CARD;AASpB,4BAAY,KAAZ,GAAoB,EAApB,CAToB;AAUpB,oBAAI,eAAe,KAAK,cAAL,CAAoB,WAApB,CAAgC,KAAK,MAAL,CAA/C,CAVgB;AAWpB,4BAAY,KAAZ,CAAkB,IAAlB,CAAuB,YAAvB;;AAXoB,oBAahB,aAAa,GAAb,IAAoB,IAApB,EAA0B;AAC1B,yBAAK,IAAI,IAAI,CAAJ,EAAO,IAAI,aAAa,GAAb,CAAiB,MAAjB,EAAyB,GAA7C,EAAkD;AAC9C,4BAAI,sBAAsB,aAAa,GAAb,CAAiB,CAAjB,CAAtB,CAD0C;AAE9C,4BAAI,oBAAoB,KAAK,cAAL,CAAoB,WAApB,CAAgC,mBAAhC,CAApB,CAF0C;AAG9C,oCAAY,KAAZ,CAAkB,IAAlB,CAAuB,iBAAvB,EAH8C;qBAAlD;iBADJ;;AAQA,0BAAU,WAAV,GAAwB,WAAxB,CArBoB;AAsBpB,oBAAI,aAAa,EAAb,CAtBgB;AAuBpB,2BAAW,IAAX,CAAgB,SAAhB,EAvBoB;AAwBpB,qBAAK,kBAAL,CAAwB,cAAxB,CAAuC,UAAvC,EAxBoB;aAAxB;;;;;;AALiB,gBAoCjB,CAAK,UAAL,CAAgB,UAAhB,CAA2B,2BAA3B,EAAwD,EAAE,QAAQ,KAAK,MAAL,EAAa,cAAc,KAAK,YAAL,EAA7F,EApCiB;;;;WAtVnB;;;AA8XN,kBAAkB,OAAlB,GAA4B,CACxB,YADwB,EAExB,QAFwB,EAGxB,UAHwB,EAIxB,aAJwB,EAKxB,gBALwB,EAMxB,oBANwB,CAA5B;;kBASe","file":"navItemController.js","sourcesContent":["\"use strict\";\n\nclass NavItemController {\n    constructor($rootScope,\n                $scope,\n                $element,\n                NodeService,\n                ProjectService,\n                StudentDataService) {\n\n        this.$rootScope = $rootScope;\n        this.$scope = $scope;\n        this.$element = $element;\n        this.NodeService = NodeService;\n        this.ProjectService = ProjectService;\n        this.StudentDataService = StudentDataService;\n\n        this.expanded = false;\n\n        this.item = this.ProjectService.idToNode[this.nodeId];\n        this.isGroup = this.ProjectService.isGroupNode(this.nodeId);\n        this.nodeStatuses = this.StudentDataService.nodeStatuses;\n        this.nodeStatus = this.nodeStatuses[this.nodeId];\n\n        this.nodeTitle = this.showPosition ? (this.ProjectService.idToPosition[this.nodeId] + ': ' + this.item.title) : this.item.title;\n        this.currentNode = this.StudentDataService.currentNode;\n        this.isCurrentNode = (this.currentNode.id === this.nodeId);\n        this.setNewNode = false;\n        \n        // whether this node is a planning node\n        this.isPlanning = this.ProjectService.isPlanning(this.nodeId);\n        this.availablePlanningNodeIds = null;\n        this.parentGroupId = null;\n        \n        /*\n         * whether planning mode is on or off which determines if students\n         * can edit planning related aspects of the project such as adding,\n         * moving, or deleting planning steps.\n         */\n        this.planningMode = false;\n        \n        var parentGroup = this.ProjectService.getParentGroup(this.nodeId);\n        \n        if (parentGroup != null) {\n            this.parentGroupId = parentGroup.id;\n            this.isParentGroupPlanning = this.ProjectService.isPlanning(this.parentGroupId);\n        }\n        \n        if (this.isPlanning) {\n            /*\n             * planning is enabled so we will get the available planning\n             * nodes that can be used in this group\n             */\n            this.availablePlanningNodeIds = this.ProjectService.getAvailablePlanningNodeIds(this.nodeId);\n        }\n        \n        if (this.isParentGroupPlanning) {\n            \n            if (parentGroup.planningMode) {\n                // the parent is currently in planning mode\n                this.planningMode = true;\n            }\n            \n            /*\n             * planning is enabled so we will get the available planning\n             * nodes that can be used in this group\n             */\n            this.availablePlanningNodeIds = this.ProjectService.getAvailablePlanningNodeIds(this.parentGroupId);\n            \n            /*\n             * update the nodes in the select drop down used to move planning\n             * nodes around\n             */\n            this.updateSiblingNodeIds();\n\n            this.$scope.$watch(\n                function () {\n                    // watch the position of this node\n                    return this.ProjectService.idToPosition[this.nodeId];\n                }.bind(this),\n                function(value) {\n                    // the position has changed for this node so we will update it in the UI\n                    this.nodeTitle = this.showPosition ? (this.ProjectService.idToPosition[this.nodeId] + ': ' + this.item.title) : this.item.title;\n                    \n                    /*\n                     * update the nodes in the select drop down used to move planning\n                     * nodes around\n                     */\n                    this.updateSiblingNodeIds();\n                }.bind(this)\n            );\n        }\n\n        this.$scope.$watch(\n            function () { return this.StudentDataService.currentNode; }.bind(this),\n            function (newNode) {\n                this.currentNode = newNode;\n                if (this.StudentDataService.previousStep) {\n                    this.$scope.$parent.isPrevStep = (this.nodeId === this.StudentDataService.previousStep.id);\n                }\n                this.isCurrentNode = (this.currentNode.id === this.nodeId);\n                if (this.isCurrentNode || this.ProjectService.isApplicationNode(newNode.id) || newNode.id === this.ProjectService.rootNode.id) {\n                    this.setExpanded();\n                }\n            }.bind(this)\n        );\n\n        this.$scope.$watch(\n            function () { return this.expanded; }.bind(this),\n            function (value) {\n                this.$scope.$parent.itemExpanded = value;\n                if (value) {\n                    this.zoomToElement();\n                }\n            }.bind(this)\n        );\n        \n        this.$rootScope.$on('planningNodeChanged', () => {\n            /*\n             * update the nodes in the select drop down used to move planning\n             * nodes around\n             */\n            this.updateSiblingNodeIds();\n        });\n        \n        // a group node has turned on or off planning mode\n        this.$rootScope.$on('togglePlanningModeClicked', (event, args) => {\n            \n            // get the group node that has had its planning node changed\n            var planningModeClickedNodeId = args.nodeId;\n            var planningMode = args.planningMode;\n            \n            // get this node's parent group\n            var parentGroup = this.ProjectService.getParentGroup(this.nodeId);\n            var parentGroupId = null;\n            \n            if (parentGroup != null) {\n                parentGroupId = parentGroup.id;\n            }\n            \n            if (parentGroupId == planningModeClickedNodeId) {\n                // the parent of this node has changed their planning mode\n                this.planningMode = planningMode;\n            }\n        });\n\n        this.setExpanded();\n    }\n    \n    updateSiblingNodeIds() {\n        var childNodeIds = this.ProjectService.getChildNodeIdsById(this.parentGroupId);\n        \n        this.siblingNodeIds = [];\n        this.siblingNodeIds.push(this.parentGroupId);\n        this.siblingNodeIds = this.siblingNodeIds.concat(childNodeIds);\n    }\n\n    getTemplateUrl(){\n        return this.ProjectService.getThemePath() + '/themeComponents/navItem/navItem.html';\n    };\n\n    setExpanded() {\n        this.$scope.expanded = (this.isCurrentNode || (this.$scope.isGroup && this.ProjectService.isNodeDescendentOfGroup(this.$scope.currentNode, this.$scope.item)));\n        if (this.$scope.expanded && this.isCurrentNode) {\n            this.expanded = true;\n            this.zoomToElement();\n        }\n    };\n\n    zoomToElement() {\n        setTimeout(()=> {\n            // smooth scroll to expanded group's page location\n            let location = this.isGroup ? this.$element[0].offsetTop - 32 : 0;\n            let delay = this.isGroup ? 350 : 0;\n            $('#content').animate({\n                scrollTop: location\n            }, delay, 'linear', ()=> {\n                if (this.setNewNode) {\n                    this.setNewNode = false;\n                    this.StudentDataService.endCurrentNodeAndSetCurrentNodeByNodeId(this.nodeId);\n                }\n            });\n        }, 250);\n    };\n\n    itemClicked() {\n        if (this.isGroup) {\n            if (!this.expanded) {\n                this.setNewNode = true;\n            }\n            this.expanded = !this.expanded;\n        } else {\n            if (this.planningMode) {\n                /*\n                 * students are not allowed to enter planning steps while in\n                 * planning mode\n                 */\n                alert('You are not allowed to enter the step while in Planning Mode. Turn off Planning Mode to enter the step.');\n            } else {\n                this.StudentDataService.endCurrentNodeAndSetCurrentNodeByNodeId(this.nodeId);\n            }\n        }\n    };\n    \n    /**\n     * Create a planning node instance and add it to the project\n     * @param groupId the group the new planning node instance will be added to\n     * @param templateNodeId the node id of the planning node template\n     */\n    addPlanningNodeInstanceInside(nodeIdToInsertInside, templateNodeId) {\n        // create the planning node instance\n        var planningNodeInstance = this.ProjectService.createPlanningNodeInstance(nodeIdToInsertInside, templateNodeId);\n        \n        // add the planning node instance inside\n        this.ProjectService.addPlanningNodeInstanceInside(nodeIdToInsertInside, planningNodeInstance);\n        \n        /*\n         * update the node statuses so that a node status is created for\n         * the new planning node instance\n         */\n        this.StudentDataService.updateNodeStatuses();\n        \n        // perform any necessary updating\n        this.planningNodeChanged();\n    }\n    \n    /**\n     * Create a planning node instance and add it to the project\n     * @param groupId the group the new planning node instance will be added to\n     * @param nodeId the node id of the planning node template\n     */\n    addPlanningNodeInstanceAfter(nodeIdToInsertAfter, templateNodeId) {\n        \n        var parentGroup = this.ProjectService.getParentGroup(nodeIdToInsertAfter);\n        \n        if (parentGroup != null) {\n            var parentGroupId = parentGroup.id;\n            \n            // create the planning node instance\n            var planningNodeInstance = this.ProjectService.createPlanningNodeInstance(parentGroupId, templateNodeId);\n            \n            // insert planning node instance after\n            this.ProjectService.addPlanningNodeInstanceAfter(nodeIdToInsertAfter, planningNodeInstance);\n            \n            /*\n             * update the node statuses so that a node status is created for\n             * the new planning node instance\n             */\n            this.StudentDataService.updateNodeStatuses();\n            \n            // perform any necessary updating\n            this.planningNodeChanged();\n        }\n    }\n    \n    /**\n     * Remove the planning node instance\n     * @param planningNodeInstanceNodeId the planning node instance to remove\n     */\n    removePlanningNodeInstance(planningNodeInstanceNodeId) {\n        // delete the node from the project\n        this.ProjectService.deleteNode(planningNodeInstanceNodeId);\n        \n        // perform any necessary updating\n        this.planningNodeChanged();\n    }\n    \n    /**\n     * Get the node title\n     * @param nodeId get the title for this node\n     * @returns the title for the node\n     */\n    getNodeTitle(nodeId) {\n        var node = this.ProjectService.idToNode[nodeId];\n        var title = null;\n        \n        if (node != null) {\n            title = node.title;\n        }\n        \n        // get the position\n        var position = this.ProjectService.idToPosition[nodeId];\n        \n        if (position == null) {\n            return title;\n        } else {\n            return position + ': ' + title;\n        }\n    }\n\n    /**\n     * Get the node description\n     * @param nodeId get the description for this node\n     * @returns the description for the node\n     */\n    getNodeDescription(nodeId) {\n        var node = this.ProjectService.idToNode[nodeId];\n        var description = null;\n\n        if (node != null) {\n            description = node.description;\n        }\n\n        return description;\n    }\n    \n    /**\n     * Move the planning node. If the other node is a group node, we will\n     * insert this node as the first node in the group. If the other node is\n     * a step node, we will insert this node after the other node.\n     * @param otherNodeId the other node we will move this node inside or after\n     */\n    movePlanningNode(otherNodeId) {\n        \n        /*\n         * check that this node is not the same as the other node.\n         * if they are the same we don't need to do anything.\n         */\n        if (this.nodeId != otherNodeId) {\n            if (this.ProjectService.isGroupNode(otherNodeId)) {\n                // insert this node inside the group node\n                this.ProjectService.movePlanningNodeInstanceInside(this.nodeId, otherNodeId);\n            } else {\n                // insert this node after the other node\n                this.ProjectService.movePlanningNodeInstanceAfter(this.nodeId, otherNodeId);\n            }\n        }\n        \n        // perform any necessary updating\n        this.planningNodeChanged();\n    }\n    \n    /**\n     * Something related to planning has changed in the project. This\n     * means a planning node was added, moved, or deleted.\n     */\n    planningNodeChanged() {\n        this.$rootScope.$broadcast('planningNodeChanged');\n    }\n    \n    /**\n     * Toggle the planning mode on and off. Notify child nodes that \n     * the planning mode has changed so they can act accordingly.\n     */\n    togglePlanningMode() {\n        // toggle the planning mode\n        this.planningMode = !this.planningMode;\n        this.item.planningMode = this.planningMode;\n\n        if (!this.planningMode) {\n            // Student is exiting planning mode, so save the changed nodes in NodeState\n            let nodeState = this.NodeService.createNewNodeState();\n            nodeState.nodeId = this.nodeId;\n            nodeState.isAutoSave = false;\n            nodeState.isSubmit = false;\n\n            var studentData = {};\n            studentData.nodeId = this.nodeId;\n            studentData.nodes = [];\n            let planningNode = this.ProjectService.getNodeById(this.nodeId);\n            studentData.nodes.push(planningNode);  // add the planning node (group)\n            // loop through the child ids in the planning group and save them also\n            if (planningNode.ids != null) {\n                for (let c = 0; c < planningNode.ids.length; c++) {\n                    let childPlanningNodeId = planningNode.ids[c];\n                    let childPlanningNode = this.ProjectService.getNodeById(childPlanningNodeId);\n                    studentData.nodes.push(childPlanningNode);\n                }\n            }\n\n            nodeState.studentData = studentData;\n            var nodeStates = [];\n            nodeStates.push(nodeState);\n            this.StudentDataService.saveNodeStates(nodeStates);\n        }\n\n        /*\n         * notify the child nodes that the planning mode of this group\n         * node has changed\n         */\n        this.$rootScope.$broadcast('togglePlanningModeClicked', { nodeId: this.nodeId, planningMode: this.planningMode });\n    }\n}\n\nNavItemController.$inject = [\n    '$rootScope',\n    '$scope',\n    '$element',\n    'NodeService',\n    'ProjectService',\n    'StudentDataService'\n];\n\nexport default NavItemController;\n"]}