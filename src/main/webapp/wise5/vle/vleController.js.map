{"version":3,"sources":["vleController.es6"],"names":[],"mappings":"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","file":"vleController.js","sourcesContent":["//import theme from './themes/default/theme2.js';\n\nclass VLEController {\n    constructor($scope,\n                $rootScope,\n                $state,\n                ConfigService,\n                NotebookService,\n                ProjectService,\n                SessionService,\n                StudentDataService,\n                StudentWebSocketService,\n                $ocLazyLoad) {\n\n        this.$scope = $scope;\n        this.$rootScope = $rootScope;\n        this.$state = $state;\n        this.ConfigService = ConfigService;\n        this.NotebookService = NotebookService;\n        this.ProjectService = ProjectService;\n        this.SessionService = SessionService;\n        this.StudentDataService = StudentDataService;\n        this.StudentWebSocketService = StudentWebSocketService;\n        this.$ocLazyLoad = $ocLazyLoad;\n\n        this.mode = 'student';\n        this.layoutLogic = this.ConfigService.layoutLogic;\n        this.currentNode = null;\n        this.themeLoaded = false;\n\n        this.navFilters = this.ProjectService.getFilters();\n        this.navFilter = this.navFilters[0].name;\n\n        var nodeId = null;\n        var stateParams = null;\n        var stateParamNodeId = null;\n\n        if (this.$state != null) {\n            stateParams = this.$state.params;\n        }\n\n        if (stateParams != null) {\n            stateParamNodeId = stateParams.nodeId;\n        }\n\n        if (stateParamNodeId != null && stateParamNodeId !== '') {\n            nodeId = stateParamNodeId;\n        } else {\n            var latestComponentState = this.StudentDataService.getLatestComponentState();\n\n            if (latestComponentState != null) {\n                nodeId = latestComponentState.nodeId;\n            }\n        }\n\n        if (nodeId == null || nodeId === '') {\n            nodeId = this.ProjectService.getStartNodeId();\n        }\n\n        this.projectStyle = this.ProjectService.getStyle();\n        this.projectName = this.ProjectService.getName();\n\n        this.StudentDataService.setCurrentNodeByNodeId(nodeId);\n\n        this.notebookFilters = this.NotebookService.getFilters();\n        this.notebookFilter = this.notebookFilters[0].name;\n        this.notebookOpen = false;\n\n        this.toggleNotebook = function() {\n            this.notebookOpen = !this.notebookOpen;\n        };\n\n        this.$scope.$on('currentNodeChanged', angular.bind(this, function(event, args) {\n            var previousNode = args.previousNode;\n            //var currentNode = args.currentNode;\n            var currentNode = this.StudentDataService.getCurrentNode();\n            var currentNodeId = currentNode.id;\n\n            this.StudentDataService.updateStackHistory(currentNodeId);\n            this.StudentDataService.updateVisitedNodesHistory(currentNodeId);\n            this.StudentDataService.updateNodeStatuses();\n\n            this.setLayoutState();\n\n            this.StudentWebSocketService.sendStudentStatus();\n            this.$state.go('root.vle', {nodeId:currentNodeId});\n\n            var componentId, componentType, category, eventName, eventData, eventNodeId;\n            if (previousNode != null && this.ProjectService.isGroupNode(previousNode.id)) {\n                // going from group to node or group to group\n                componentId = null;\n                componentType = null;\n                category = \"Navigation\";\n                eventName = \"nodeExited\";\n                eventData = {};\n                eventData.nodeId = previousNode.id;\n                eventNodeId = previousNode.id;\n                this.StudentDataService.saveVLEEvent(eventNodeId, componentId, componentType, category, eventName, eventData);\n            }\n\n            if (this.ProjectService.isGroupNode(currentNodeId)) {\n                // save nodeEntered event if this is a group\n                componentId = null;\n                componentType = null;\n                category = \"Navigation\";\n                eventName = \"nodeEntered\";\n                eventData = {};\n                eventData.nodeId = currentNode.id;\n                eventNodeId = currentNode.id;\n                this.StudentDataService.saveVLEEvent(eventNodeId, componentId, componentType, category, eventName, eventData);\n            }\n        }));\n\n        this.$scope.$on('componentStudentDataChanged', angular.bind(this, function() {\n            this.StudentDataService.updateNodeStatuses();\n        }));\n\n        // Make sure if we drop something on the page we don't navigate away\n        // https://developer.mozilla.org/En/DragDrop/Drag_Operations#drop\n        $(document.body).on('dragover', function(e) {\n            e.preventDefault();\n            return false;\n        });\n\n        $(document.body).on('drop', function(e){\n            e.preventDefault();\n            return false;\n        });\n\n        this.themePath = this.ProjectService.getThemePath();\n        var scope = this;\n        // load theme module + files\n        /*\n         this.$ocLazyLoad.load([\n         this.themePath + '/theme3.js'\n         ]).then(function(){\n         scope.themeLoaded = true;\n         scope.setLayoutState();\n         scope.updateLayout();\n         });\n         */\n        scope.themeLoaded = true;\n        scope.setLayoutState();\n        scope.updateLayout();\n    }\n\n    setLayoutState() {\n        var layoutState = 'nav'; // default layout state\n        var node = this.StudentDataService.getCurrentNode();\n\n        if(node) {\n            var id = node.id;\n            if (this.ProjectService.isApplicationNode(id)) {\n                layoutState = 'node';\n            } else if (this.ProjectService.isGroupNode(id)) {\n                layoutState = 'nav';\n            }\n        }\n\n        this.layoutState = layoutState;\n    };\n\n    updateLayout() {\n        if (this.project != null) {\n            this.ProjectService.getProject();\n        }\n    };\n\n    showNavigation() {\n        this.layoutState = 'nav';\n    };\n\n    goHome() {\n        // save goHome event\n        var nodeId = null;\n        var componentId = null;\n        var componentType = null;\n        var category = \"Navigation\";\n        var event = \"goHomeButtonClicked\";\n        var eventData = {};\n        this.StudentDataService.saveVLEEvent(nodeId, componentId, componentType, category, event, eventData);\n\n        this.$rootScope.$broadcast('goHome');\n    };\n\n    logOut() {\n        // save logOut event\n        var nodeId = null;\n        var componentId = null;\n        var componentType = null;\n        var category = \"Navigation\";\n        var event = \"logOutButtonClicked\";\n        var eventData = {};\n        this.StudentDataService.saveVLEEvent(nodeId, componentId, componentType, category, event, eventData);\n\n        this.$rootScope.$broadcast('logOut');\n    };\n\n    loadRoot() {\n        this.StudentDataService.endCurrentNodeAndSetCurrentNodeByNodeId(this.ProjectService.rootNode.id);\n    };\n\n    layoutLogicStarMap(VLEState) {\n        if (VLEState.state === 'initial') {\n            this.showProjectDiv = true;\n            this.showNodeDiv = false;\n        } else if (VLEState.state === 'showNavigationClicked') {\n            this.showProjectDiv = true;\n            this.showNodeDiv = false;\n        }\n    };\n\n    chooseTransition(transitions) {\n        var transitionResult = null;\n        if (transitions != null) {\n            for (var t = 0; t < transitions.length; t++) {\n                var transition = transitions[t];\n                var toNodeId = transition.to;\n                if (toNodeId != null) {\n                    var toNodeNodeStatus = this.StudentDataService.getNodeStatusByNodeId(toNodeId);\n                    if (toNodeNodeStatus != null && toNodeNodeStatus.isVisitable) {\n                        transitionResult = transition;\n                        break;\n                    }\n                }\n            }\n        }\n        return transitionResult;\n    };\n\n    /**\n     * The user has moved the mouse on the page\n     */\n    mouseMoved() {\n        /*\n         * tell the session service a mouse event occurred so it\n         * can reset the session timeout timers\n         */\n        this.SessionService.mouseEventOccurred();\n    };\n}\n\nVLEController.$inject = [\n    '$scope',\n    '$rootScope',\n    '$state',\n    'ConfigService',\n    'NotebookService',\n    'ProjectService',\n    'SessionService',\n    'StudentDataService',\n    'StudentWebSocketService',\n    '$ocLazyLoad'\n];\n\nexport default VLEController;\n"]}