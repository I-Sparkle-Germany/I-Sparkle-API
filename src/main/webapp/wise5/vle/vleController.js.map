{"version":3,"sources":["vleController.es6"],"names":[],"mappings":"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","file":"vleController.js","sourcesContent":["//import theme from './themes/default/theme2.js';\n'use strict';\n\nclass VLEController {\n    constructor($scope,\n                $rootScope,\n                $state,\n                ConfigService,\n                NotebookService,\n                ProjectService,\n                SessionService,\n                StudentDataService,\n                StudentWebSocketService,\n                $ocLazyLoad) {\n\n        this.$scope = $scope;\n        this.$rootScope = $rootScope;\n        this.$state = $state;\n        this.ConfigService = ConfigService;\n        this.NotebookService = NotebookService;\n        this.ProjectService = ProjectService;\n        this.SessionService = SessionService;\n        this.StudentDataService = StudentDataService;\n        this.StudentWebSocketService = StudentWebSocketService;\n        this.$ocLazyLoad = $ocLazyLoad;\n\n        this.mode = 'student';\n        this.layoutLogic = this.ConfigService.layoutLogic;\n        this.currentNode = null;\n        this.themeLoaded = false;\n\n        this.navFilters = this.ProjectService.getFilters();\n        this.navFilter = this.navFilters[0].name;\n\n        this.projectStyle = this.ProjectService.getStyle();\n        this.projectName = this.ProjectService.getName();\n\n        this.notebookFilters = this.NotebookService.getFilters();\n        this.notebookFilter = this.notebookFilters[0].name;\n        this.notebookOpen = false;\n\n        this.toggleNotebook = function() {\n            this.notebookOpen = !this.notebookOpen;\n        };\n\n        this.$scope.$on('currentNodeChanged', angular.bind(this, function(event, args) {\n            var previousNode = args.previousNode;\n            //var currentNode = args.currentNode;\n            var currentNode = this.StudentDataService.getCurrentNode();\n            var currentNodeId = currentNode.id;\n\n            this.StudentDataService.updateStackHistory(currentNodeId);\n            this.StudentDataService.updateVisitedNodesHistory(currentNodeId);\n            this.StudentDataService.updateNodeStatuses();\n\n            this.setLayoutState();\n\n            this.StudentWebSocketService.sendStudentStatus();\n            this.$state.go('root.vle', {nodeId:currentNodeId});\n\n            var componentId, componentType, category, eventName, eventData, eventNodeId;\n            if (previousNode != null && this.ProjectService.isGroupNode(previousNode.id)) {\n                // going from group to node or group to group\n                componentId = null;\n                componentType = null;\n                category = \"Navigation\";\n                eventName = \"nodeExited\";\n                eventData = {};\n                eventData.nodeId = previousNode.id;\n                eventNodeId = previousNode.id;\n                this.StudentDataService.saveVLEEvent(eventNodeId, componentId, componentType, category, eventName, eventData);\n            }\n\n            if (this.ProjectService.isGroupNode(currentNodeId)) {\n                // save nodeEntered event if this is a group\n                componentId = null;\n                componentType = null;\n                category = \"Navigation\";\n                eventName = \"nodeEntered\";\n                eventData = {};\n                eventData.nodeId = currentNode.id;\n                eventNodeId = currentNode.id;\n                this.StudentDataService.saveVLEEvent(eventNodeId, componentId, componentType, category, eventName, eventData);\n            }\n        }));\n\n        this.$scope.$on('componentStudentDataChanged', angular.bind(this, function() {\n            this.StudentDataService.updateNodeStatuses();\n        }));\n\n        // Make sure if we drop something on the page we don't navigate away\n        // https://developer.mozilla.org/En/DragDrop/Drag_Operations#drop\n        $(document.body).on('dragover', function(e) {\n            e.preventDefault();\n            return false;\n        });\n\n        $(document.body).on('drop', function(e){\n            e.preventDefault();\n            return false;\n        });\n\n        this.themePath = this.ProjectService.getThemePath();\n        var scope = this;\n        // load theme module + files\n        /*\n         this.$ocLazyLoad.load([\n         this.themePath + '/theme3.js'\n         ]).then(function(){\n         scope.themeLoaded = true;\n         scope.setLayoutState();\n         scope.updateLayout();\n         });\n         */\n        scope.themeLoaded = true;\n        scope.setLayoutState();\n        scope.updateLayout();\n\n        var nodeId = null;\n        var stateParams = null;\n        var stateParamNodeId = null;\n\n        if (this.$state != null) {\n            stateParams = this.$state.params;\n        }\n\n        if (stateParams != null) {\n            stateParamNodeId = stateParams.nodeId;\n        }\n\n        if (stateParamNodeId != null && stateParamNodeId !== '') {\n            nodeId = stateParamNodeId;\n        } else {\n            var latestComponentState = this.StudentDataService.getLatestComponentState();\n\n            if (latestComponentState != null) {\n                nodeId = latestComponentState.nodeId;\n            }\n        }\n\n        if (nodeId == null || nodeId === '') {\n            nodeId = this.ProjectService.getStartNodeId();\n        }\n\n        this.StudentDataService.setCurrentNodeByNodeId(nodeId);\n    }\n\n    setLayoutState() {\n        var layoutState = 'nav'; // default layout state\n        var node = this.StudentDataService.getCurrentNode();\n\n        if(node) {\n            var id = node.id;\n            if (this.ProjectService.isApplicationNode(id)) {\n                layoutState = 'node';\n            } else if (this.ProjectService.isGroupNode(id)) {\n                layoutState = 'nav';\n            }\n        }\n\n        this.layoutState = layoutState;\n    };\n\n    updateLayout() {\n        if (this.project != null) {\n            this.ProjectService.getProject();\n        }\n    };\n\n    showNavigation() {\n        this.layoutState = 'nav';\n    };\n\n    goHome() {\n        // save goHome event\n        var nodeId = null;\n        var componentId = null;\n        var componentType = null;\n        var category = \"Navigation\";\n        var event = \"goHomeButtonClicked\";\n        var eventData = {};\n        this.StudentDataService.saveVLEEvent(nodeId, componentId, componentType, category, event, eventData);\n\n        this.$rootScope.$broadcast('goHome');\n    };\n\n    logOut() {\n        // save logOut event\n        var nodeId = null;\n        var componentId = null;\n        var componentType = null;\n        var category = \"Navigation\";\n        var event = \"logOutButtonClicked\";\n        var eventData = {};\n        this.StudentDataService.saveVLEEvent(nodeId, componentId, componentType, category, event, eventData);\n\n        this.$rootScope.$broadcast('logOut');\n    };\n\n    loadRoot() {\n        this.StudentDataService.endCurrentNodeAndSetCurrentNodeByNodeId(this.ProjectService.rootNode.id);\n    };\n\n    layoutLogicStarMap(VLEState) {\n        if (VLEState.state === 'initial') {\n            this.showProjectDiv = true;\n            this.showNodeDiv = false;\n        } else if (VLEState.state === 'showNavigationClicked') {\n            this.showProjectDiv = true;\n            this.showNodeDiv = false;\n        }\n    };\n\n    chooseTransition(transitions) {\n        var transitionResult = null;\n        if (transitions != null) {\n            for (var t = 0; t < transitions.length; t++) {\n                var transition = transitions[t];\n                var toNodeId = transition.to;\n                if (toNodeId != null) {\n                    var toNodeNodeStatus = this.StudentDataService.getNodeStatusByNodeId(toNodeId);\n                    if (toNodeNodeStatus != null && toNodeNodeStatus.isVisitable) {\n                        transitionResult = transition;\n                        break;\n                    }\n                }\n            }\n        }\n        return transitionResult;\n    };\n\n    /**\n     * The user has moved the mouse on the page\n     */\n    mouseMoved() {\n        /*\n         * tell the session service a mouse event occurred so it\n         * can reset the session timeout timers\n         */\n        this.SessionService.mouseEventOccurred();\n    };\n}\n\nVLEController.$inject = [\n    '$scope',\n    '$rootScope',\n    '$state',\n    'ConfigService',\n    'NotebookService',\n    'ProjectService',\n    'SessionService',\n    'StudentDataService',\n    'StudentWebSocketService',\n    '$ocLazyLoad'\n];\n\nexport default VLEController;\n"]}